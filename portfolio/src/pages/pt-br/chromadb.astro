---
import PostLayout from '@layouts/PostLayout.astro';
import CodeBlockInputCell from '@components/CodeBlockInputCell.astro';
import CodeBlockOutputCell from '@components/CodeBlockOutputCell.astro';

const { metadata_page } = await import('@portfolio/consts.json');
const { colors } = await import('@portfolio/consts.json');
const { svg_paths } = await import('@portfolio/consts.json');

const page_title = 'ChromaDB';
const end_url = 'chromadb';
const description = 'Descubra como o ChromaDB redefine a pesquisa vetorial e o gerenciamento de dados para aplicativos de IA, com pesquisas de similaridade ultrarrápidas e precisas em espaços de alta dimensão';
const keywords = 'chromadb, pesquisa vetorial, banco de dados vetorial, pesquisa de similaridade vetorial, dados vetoriais, gerenciamento de dados vetoriais, pesquisa de dados vetoriais, mecanismo de pesquisa de dados vetoriais, ferramenta de pesquisa de dados vetoriais, plataforma de pesquisa de dados vetoriais, software de pesquisa de dados vetoriais, serviço de pesquisa de dados vetoriais, biblioteca de pesquisa de dados vetoriais, sistema de pesquisa de dados vetoriais, solução de pesquisa de dados vetoriais, produto de pesquisa de dados vetoriais, aplicativo de pesquisa de dados vetoriais, API de pesquisa de dados vetoriais, SDK de pesquisa de dados vetoriais, estrutura de pesquisa de dados vetoriais, tecnologia de pesquisa de dados vetoriais, empresa de pesquisa de dados vetoriais, startup de pesquisa de dados vetoriais';
const languaje = 'PT';
const image_path = 'https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/chromadb_dalle3.webp';
const opening_brace = '{';
const closing_brace = '}';
---

<PostLayout 
    title={page_title}
    languaje={languaje}
    description={description}
    keywords={keywords}
    author={metadata_page.author}
    theme_color={colors.background_color}
    end_url={end_url}
    image_path={image_path}
    image_width=1024
    image_height=1024
    image_extension=webp
    article_date=2024-02-18+T00:00:00Z
>

  <section class="post-body">


    <aside class="post-index">
      <a class="anchor-link" href="#Croma"><h2>Croma</h2></a>
      <a class="anchor-link" href="#Instalacao"><h2>Instalação</h2></a>
      <a class="anchor-link" href="#Uso rapido"><h2>Uso rápido</h2></a>
      <a class="anchor-link" href="#Bancos de dados persistentes"><h2>Bancos de dados persistentes</h2></a>
      <a class="anchor-link" href="#Colecoes"><h2>Coleções</h2></a>
      <a class="anchor-link" href="#Criar colecoes"><h3>Criar coleções</h3></a>
      <a class="anchor-link" href="#Recuperar colecoes"><h3>Recuperar coleções</h3></a>
      <a class="anchor-link" href="#Recuperar ou criar colecoes"><h3>Recuperar ou criar coleções</h3></a>
      <a class="anchor-link" href="#Excluir colecoes"><h3>Excluir coleções</h3></a>
      <a class="anchor-link" href="#Obter itens de colecoes"><h3>Obter itens de coleções</h3></a>
      <a class="anchor-link" href="#Obter o numero total de itens nas colecoes"><h3>Obter o número total de itens nas coleções</h3></a>
      <a class="anchor-link" href="#Alterar a funcao de similaridade"><h3>Alterar a função de similaridade</h3></a>
      <a class="anchor-link" href="#Adicionar dados a colecao"><h3>Adicionar dados à coleção</h3></a>
      <a class="anchor-link" href="#Adicionar documentos"><h4>Adicionar documentos</h4></a>
      <a class="anchor-link" href="#Adicionar incorporacoes"><h4>Adicionar incorporações</h4></a>
      <a class="anchor-link" href="#Adicionar documentos e embeddings"><h4>Adicionar documentos e embeddings</h4></a>
      <a class="anchor-link" href="#Consultas"><h3>Consultas</h3></a>
      <a class="anchor-link" href="#Consultas por documentos"><h4>Consultas por documentos</h4></a>
      <a class="anchor-link" href="#Varias consultas ao mesmo tempo"><h4>Várias consultas ao mesmo tempo</h4></a>
      <a class="anchor-link" href="#Consultas para incorporacoes"><h4>Consultas para incorporações</h4></a>
      <a class="anchor-link" href="#Recuperar documentos por ID."><h3>Recuperar documentos por <code>ID</code>.</h3></a>
      <a class="anchor-link" href="#Filtragem"><h3>Filtragem</h3></a>
      <a class="anchor-link" href="#Filtragem por metadados"><h4>Filtragem por metadados</h4></a>
      <a class="anchor-link" href="#Filtragem por conteudo do documento"><h4>Filtragem por conteúdo do documento</h4></a>
      <a class="anchor-link" href="#Atualizar dados"><h3>Atualizar dados</h3></a>
      <a class="anchor-link" href="#Atualizar ou adicionar dados"><h3>Atualizar ou adicionar dados</h3></a>
      <a class="anchor-link" href="#Excluir dados"><h3>Excluir dados</h3></a>
      <a class="anchor-link" href="#Embeddings"><h2>Embeddings</h2></a>
      <a class="anchor-link" href="#Multimodalidade"><h2>Multimodalidade</h2></a>
    </aside>


    <div class="post-body-content">
      
      <section class="section-block-markdown-cell">
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Vimos na postagem <a href="https://www.maximofn.com/embeddings">embeddings</a> que os embeddings são uma forma de representar palavras em um espaço vetorial. Nesta postagem, veremos como podemos armazenar esses embeddings em bancos de dados vetoriais e como podemos fazer consultas a eles.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Este caderno foi traduzido automaticamente para torná-lo acessível a mais pessoas, por favor me avise se você vir algum erro de digitação..</p>
      <p>Quando temos uma consulta, podemos criar a incorporação da consulta, pesquisar no banco de dados de vetores as incorporações que mais se aproximam da consulta e retornar os documentos que correspondem a essas incorporações ou uma explicação desses documentos.</p>
      <img decoding="async" onerror="this.parentNode.removeChild(this)" src="https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/vector_database.svg" alt="banco de dados vetorial">
      <p>Ou seja, vamos gerar um banco de dados de informações, vamos criar embeddings dessas informações e vamos armazená-las em um banco de dados vetorial. Então, quando um usuário fizer uma consulta, converteremos a consulta em embeddings, pesquisaremos no banco de dados os embeddings com a maior similaridade e retornaremos os documentos que correspondem a esses embeddings.</p>
      <p>Além dos documentos, outras informações podem ser armazenadas no banco de dados, que chamaremos de metadados. Por exemplo, se estivermos trabalhando com um conjunto de itens de notícias, podemos armazenar o título, a data, o autor etc. do item de notícias.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h2 id="Croma">Croma<a class="anchor-link" href="#Croma"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 59" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Nesta postagem, vamos analisar o <a href="https://www.trychroma.com/" target="_blank" rel="nofollow noreferrer">crhoma</a>, pois ele é o <a href="https://blog.langchain.dev/langchain-state-of-ai-2023/#most-used-vectorstores">banco de dados de vetores</a> mais usado, como pode ser visto neste relatório <a href="https://blog.langchain.dev/langchain-state-of-ai-2023">langchain state of ai 2023</a>.</p>
      <p>Vectorstores mais usados](https://blog.langchain.dev/content/images/size/w1000/2023/12/Top-vectorstores--1-.png)</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h2 id="Instalacao">Instalação<a class="anchor-link" href="#Instalacao"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 60" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Portanto, para instalar o chroma com o conda, você precisa fazer o seguinte</p>
      <div class='highlight'><pre><code class="language-bash">conda install conda-forge::chromadb</code></pre></div>
      <p>Ou se você quiser instalar com o pip</p>
      <div class='highlight'><pre><code class="language-bash">pip install chromadb</code></pre></div>
      </section>
      
      <section class="section-block-markdown-cell">
      <h2 id="Uso rapido">Uso rápido<a class="anchor-link" href="#Uso rapido"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 61" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Para uma aplicação rápida, primeiro importamos o chroma</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">chromadb</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Em seguida, criamos um cliente chroma.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">chroma_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Criamos uma coleção. Uma coleção é o local onde as incorporações, as incorporações e os metadados serão armazenados.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_collection&quot;</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como você pode ver, é exibida uma mensagem indicando que nenhuma função de embeddings foi introduzida e, portanto, o padrão será <code>all-MiniLM-L6-v2</code>, que é semelhante ao modelo <code>paraphrase-MiniLM-L6-v2</code> que usamos na postagem <a href="https://maximofn.com/embeddings/">embeddings</a>.</p>
      <p>Falaremos mais sobre isso mais tarde, mas podemos escolher como gerar os embeddings.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Agora, adicionamos documentos, IDs e metadados à coleção.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;This is a python docs&quot;</span><span class="p">,</span> <span class="s2">&quot;This is JavaScript docs&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Python source&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;JavaScript source&quot;</span><span class="p">}],</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id1&quot;</span><span class="p">,</span> <span class="s2">&quot;id2&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Agora podemos fazer uma consulta</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;This is a query of Python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">2</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">results</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;, &#x27;id2&#x27;]],',
          '&#x27;distances&#x27;: [[0.6205940246582031, 1.4631636142730713]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;, &#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;, &#x27;This is JavaScript docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como podemos ver, a distância para id1 é menor do que a distância para id2, portanto, parece que o documento 1 é mais adequado para responder à consulta.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h2 id="Bancos de dados persistentes">Bancos de dados persistentes<a class="anchor-link" href="#Bancos de dados persistentes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 62" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>O banco de dados que criamos anteriormente é temporário e, assim que fecharmos o notebook, ele desaparecerá. Portanto, para criar um banco de dados persistente, é necessário passar para o chroma o caminho onde ele será salvo.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Primeiro, vamos criar a pasta onde salvaremos o banco de dados</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>',
      '<span class="w"> </span>',
      '<span class="n">chroma_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;chromadb&quot;</span><span class="p">)</span>',
      '<span class="n">chroma_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Agora, criamos um cliente na pasta que criamos.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">chroma_client_persistent</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">PersistentClient</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">chroma_path</span><span class="p">))</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <h2 id="Colecoes">Coleções<a class="anchor-link" href="#Colecoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 63" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <h3 id="Criar colecoes">Criar coleções<a class="anchor-link" href="#Criar colecoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 64" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Ao criar uma coleção, um nome deve ser especificado. O nome deve ter as seguintes considerações:</p>
      <ul>
        <li>O comprimento do nome deve ter entre 3 e 63 caracteres.</li>
        <li>O nome deve começar e terminar com uma letra minúscula ou dígito e pode conter pontos finais, hífens e sublinhados no meio.</li>
        <li>O nome não deve conter dois dois pontos consecutivos.</li>
        <li>O nome não deve ser um endereço IP válido.</li>
      </ul>
      <p>Também podemos atribuir a ele uma função de incorporação. Se não for atribuída uma função, o padrão será a função <code>all-MiniLM-L6-v2</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_other_collection&quot;</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como você pode ver, uma segunda coleção foi criada para o mesmo cliente <code>chroma_client</code>, portanto, para um único cliente, podemos ter várias coleções.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h3 id="Recuperar colecoes">Recuperar coleções<a class="anchor-link" href="#Recuperar colecoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 65" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Se quisermos recuperar uma coleção de um cliente, podemos fazer isso com o método <code>get_collection</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my_collection&quot;</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <h3 id="Recuperar ou criar colecoes">Recuperar ou criar coleções<a class="anchor-link" href="#Recuperar ou criar colecoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 66" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Podemos obter coleções e, se elas não existirem, criá-las com o método <code>get_or_create_collection</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">get_or_create_collection</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my_tird_collection&quot;</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <h3 id="Excluir colecoes">Excluir coleções<a class="anchor-link" href="#Excluir colecoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 67" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Podemos excluir uma coleção com o método <code>delete_collection</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">chroma_client</span><span class="o">.</span><span class="n">delete_collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_tird_collection&quot;</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <h3 id="Obter itens de colecoes">Obter itens de coleções<a class="anchor-link" href="#Obter itens de colecoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 68" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Podemos obter os primeiros 10 itens da coleção com o método <code>peek</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my_collection&quot;</span><span class="p">)</span>',
      '<span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;, &#x27;id2&#x27;],',
          '&#x27;embeddings&#x27;: [[-0.06924048811197281,',
          '&#x20;&#x20;&#x20;0.061624377965927124,',
          '&#x20;&#x20;&#x20;-0.090973399579525,',
          '&#x20;&#x20;&#x20;0.013923337683081627,',
          '&#x20;&#x20;&#x20;0.006247623357921839,',
          '&#x20;&#x20;&#x20;-0.1078396588563919,',
          '&#x20;&#x20;&#x20;-0.012472339905798435,',
          '&#x20;&#x20;&#x20;0.03485661745071411,',
          '&#x20;&#x20;&#x20;-0.06300634145736694,',
          '&#x20;&#x20;&#x20;-0.00880391988903284,',
          '&#x20;&#x20;&#x20;0.06879935413599014,',
          '&#x20;&#x20;&#x20;0.0564003586769104,',
          '&#x20;&#x20;&#x20;0.07040536403656006,',
          '&#x20;&#x20;&#x20;-0.020754728466272354,',
          '&#x20;&#x20;&#x20;-0.04048658534884453,',
          '&#x20;&#x20;&#x20;-0.006666888482868671,',
          '&#x20;&#x20;&#x20;-0.0953674241900444,',
          '&#x20;&#x20;&#x20;0.049781784415245056,',
          '&#x20;&#x20;&#x20;0.021780474111437798,',
          '&#x20;&#x20;&#x20;-0.06344643980264664,',
          '&#x20;&#x20;&#x20;0.06119797006249428,',
          '&#x20;&#x20;&#x20;0.0834411084651947,',
          '&#x20;&#x20;&#x20;-0.034758951514959335,',
          '&#x20;&#x20;&#x20;0.0029120452236384153,',
          '&#x20;&#x20;&#x20;...',
          '&#x20;&#x20;&#x20;-0.013378280214965343]],',
          '&#x27;metadatas&#x27;: [&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;, &#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [&#x27;This is a python docs&#x27;, &#x27;This is JavaScript docs&#x27;],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Nesse caso, apenas dois foram obtidos, porque nossa coleção tem apenas dois documentos.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Se você quiser obter outro número de itens, poderá especificá-lo com o argumento <code>limit</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;],',
          '&#x27;embeddings&#x27;: [[-0.06924048811197281,',
          '&#x20;&#x20;&#x20;0.061624377965927124,',
          '&#x20;&#x20;&#x20;-0.090973399579525,',
          '&#x20;&#x20;&#x20;0.013923337683081627,',
          '&#x20;&#x20;&#x20;0.006247623357921839,',
          '&#x20;&#x20;&#x20;-0.1078396588563919,',
          '&#x20;&#x20;&#x20;-0.012472339905798435,',
          '&#x20;&#x20;&#x20;0.03485661745071411,',
          '&#x20;&#x20;&#x20;-0.06300634145736694,',
          '&#x20;&#x20;&#x20;-0.00880391988903284,',
          '&#x20;&#x20;&#x20;0.06879935413599014,',
          '&#x20;&#x20;&#x20;0.0564003586769104,',
          '&#x20;&#x20;&#x20;0.07040536403656006,',
          '&#x20;&#x20;&#x20;-0.020754728466272354,',
          '&#x20;&#x20;&#x20;-0.04048658534884453,',
          '&#x20;&#x20;&#x20;-0.006666888482868671,',
          '&#x20;&#x20;&#x20;-0.0953674241900444,',
          '&#x20;&#x20;&#x20;0.049781784415245056,',
          '&#x20;&#x20;&#x20;0.021780474111437798,',
          '&#x20;&#x20;&#x20;-0.06344643980264664,',
          '&#x20;&#x20;&#x20;0.06119797006249428,',
          '&#x20;&#x20;&#x20;0.0834411084651947,',
          '&#x20;&#x20;&#x20;-0.034758951514959335,',
          '&#x20;&#x20;&#x20;0.0029120452236384153,',
          '&#x20;&#x20;&#x20;...',
          '&#x20;&#x20;&#x20;0.012315398082137108]],',
          '&#x27;metadatas&#x27;: [&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [&#x27;This is a python docs&#x27;],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <h3 id="Obter o numero total de itens nas colecoes">Obter o número total de itens nas coleções<a class="anchor-link" href="#Obter o numero total de itens nas colecoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 69" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Podemos obter o número total de itens na coleção com o método <code>count</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '2',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <h3 id="Alterar a funcao de similaridade">Alterar a função de similaridade<a class="anchor-link" href="#Alterar a funcao de similaridade"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 70" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Anteriormente, quando fizemos uma consulta, obtivemos a similaridade dos embeddings com nossa consulta, porque, por padrão, em uma coleção, a função de distância é usada, mas podemos especificar qual função de similaridade queremos usar. As possibilidades são</p>
      <ul>
        <li>L2 ao quadrado (<code>l2</code>)</li>
        <li>Produto interno (<code>ip</code>)</li>
        <li>Similaridade de cosseno (<code>cosine</code>)</li>
      </ul>
      <p>Na postagem [Measurement of similarity between embeddings] (http://maximofn.com/embeddings-similarity/), vimos a similaridade L2 e cosseno, caso queira saber mais sobre elas.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Portanto, podemos criar coleções com outra função de similaridade com o argumento <code>metadata={opening_brace}&quot;hnsw:space&quot;: &#x3C;function&#x3E;{closing_brace}</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;colection_cosine&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hnsw:space&quot;</span><span class="p">:</span> <span class="s2">&quot;cosine&quot;</span><span class="p">})</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <h3 id="Adicionar dados a colecao">Adicionar dados à coleção<a class="anchor-link" href="#Adicionar dados a colecao"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 71" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <h4 id="Adicionar documentos">Adicionar documentos<a class="anchor-link" href="#Adicionar documentos"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 72" src={svg_paths.link_svg_path}/></a></h4>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Vamos examinar os dados que temos na coleção novamente com o método <code>peek</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [],',
          '&#x27;embeddings&#x27;: [],',
          '&#x27;metadatas&#x27;: [],',
          '&#x27;documents&#x27;: [],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como podemos ver, ela está vazia, porque a última coleção que criamos foi a função de similaridade <code>cosine</code>, mas não adicionamos dados a ela. Vamos ver como é isso, obtendo o nome da coleção</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">name</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x27;colection_cosine&#x27;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Assim, trazemos de volta a primeira coleção que criamos e para a qual inserimos dados.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my_collection&quot;</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Agora podemos adicionar dados à coleção com o método <code>add</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;This is a Mojo docs&quot;</span><span class="p">,</span> <span class="s2">&quot;This is Rust docs&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Mojo source&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Rust source&quot;</span><span class="p">}],</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id3&quot;</span><span class="p">,</span> <span class="s2">&quot;id4&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como você pode ver, os <code>IDs são consecutivos e não têm o mesmo valor de antes, pois os </code>IDs precisam ser exclusivos.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Se tentarmos adicionar dados repetindo <code>ID</code>s, ele indicará que já existem dados com esses <code>ID</code>s.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;This is a Pytorch docs&quot;</span><span class="p">,</span> <span class="s2">&quot;This is TensorRT docs&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Pytorch source&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;TensorRT source&quot;</span><span class="p">}],</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id3&quot;</span><span class="p">,</span> <span class="s2">&quot;id4&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Add of existing embedding ID: id3',
          'Add of existing embedding ID: id4',
          'Insert of existing embedding ID: id3',
          'Insert of existing embedding ID: id4',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Não foi possível adicionar os documentos do Pytorch e do TensorRT.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Vamos dar uma olhada nos dados de coleta</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;, &#x27;id2&#x27;, &#x27;id3&#x27;, &#x27;id4&#x27;],',
          '&#x27;embeddings&#x27;: [[-0.06924048811197281,',
          '&#x20;&#x20;&#x20;0.061624377965927124,',
          '&#x20;&#x20;&#x20;-0.090973399579525,',
          '&#x20;&#x20;&#x20;0.013923337683081627,',
          '&#x20;&#x20;&#x20;0.006247623357921839,',
          '&#x20;&#x20;&#x20;-0.1078396588563919,',
          '&#x20;&#x20;&#x20;-0.012472339905798435,',
          '&#x20;&#x20;&#x20;0.03485661745071411,',
          '&#x20;&#x20;&#x20;-0.06300634145736694,',
          '&#x20;&#x20;&#x20;-0.00880391988903284,',
          '&#x20;&#x20;&#x20;0.06879935413599014,',
          '&#x20;&#x20;&#x20;0.0564003586769104,',
          '&#x20;&#x20;&#x20;0.07040536403656006,',
          '&#x20;&#x20;&#x20;-0.020754728466272354,',
          '&#x20;&#x20;&#x20;-0.04048658534884453,',
          '&#x20;&#x20;&#x20;-0.006666888482868671,',
          '&#x20;&#x20;&#x20;-0.0953674241900444,',
          '&#x20;&#x20;&#x20;0.049781784415245056,',
          '&#x20;&#x20;&#x20;0.021780474111437798,',
          '&#x20;&#x20;&#x20;-0.06344643980264664,',
          '&#x20;&#x20;&#x20;0.06119797006249428,',
          '&#x20;&#x20;&#x20;0.0834411084651947,',
          '&#x20;&#x20;&#x20;-0.034758951514959335,',
          '&#x20;&#x20;&#x20;0.0029120452236384153,',
          '&#x20;&#x20;&#x20;...',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Mojo source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Rust source&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [&#x27;This is a python docs&#x27;,',
          '&#x20;&#x20;&#x27;This is JavaScript docs&#x27;,',
          '&#x20;&#x20;&#x27;This is a Mojo docs&#x27;,',
          '&#x20;&#x20;&#x27;This is Rust docs&#x27;],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como pode ser visto, os conteúdos originais de <code>ID3</code> e <code>ID4</code> foram mantidos.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h4 id="Adicionar incorporacoes">Adicionar incorporações<a class="anchor-link" href="#Adicionar incorporacoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 73" src={svg_paths.link_svg_path}/></a></h4>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Podemos adicionar embeddings diretamente sem adicionar documentos. No entanto, isso não faz muito sentido, pois se adicionarmos apenas embeddings, quando quisermos fazer uma consulta, não haverá documentos para recuperar.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Obtemos algumas incorporações para criar outras com as mesmas dimensões.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">embedding1</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;embeddings&#39;</span><span class="p">]</span>',
      '<span class="nb">len</span><span class="p">(</span><span class="n">embedding1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">embedding1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '(1, 384)',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Criamos novas incorporações com todos eles para sabermos quais foram criados.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">new_embedding</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">embedding1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>',
      '<span class="n">new_embedding</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_embedding</span><span class="p">]</span>',
      '<span class="nb">len</span><span class="p">(</span><span class="n">new_embedding</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '(1, 384)',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Agora adicionamos os novos embeddings</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">embeddings</span><span class="o">=</span><span class="n">new_embedding</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Only embeddings&quot;</span><span class="p">}],</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id5&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vamos dar uma olhada nos dados de coleta</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="s1">&#39;embeddings&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '[1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '...,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>O último elemento da condição tem as incorporações que adicionamos.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <blockquote>
      <p>Observação: Se tentarmos adicionar bordados com um tamanho diferente dos que já estão na coleção, ocorrerá um erro.</p>
      </blockquote>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">new_embedding_differetn_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">embedding1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>',
      '<span class="n">new_embedding_differetn_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_embedding_differetn_size</span><span class="p">]</span>',
      '<span class="nb">len</span><span class="p">(</span><span class="n">new_embedding_differetn_size</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_embedding_differetn_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '(1, 383)',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como você pode ver, a dimensão de incorporação é 383, em vez de 384.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">embeddings</span><span class="o">=</span><span class="n">new_embedding_differetn_size</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;New embeddings different size&quot;</span><span class="p">}],</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id6&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '---------------------------------------------------------------------------InvalidDimensionException                 Traceback (most recent call last)Cell In[28], line 1',
          '----&amp;gt; 1 collection.add(',
          '&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;2     embeddings=new_embedding_differetn_size,',
          '&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;3     metadatas=[&#x7B;&quot;source&quot;: &quot;New embeddings different size&quot;&#x7D;],',
          '&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;4     ids=[&quot;id6&quot;]',
          '&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;5 )',
          'File ~/miniforge3/envs/crhomadb/lib/python3.11/site-packages/chromadb/api/models/Collection.py:168, in Collection.add(self, ids, embeddings, metadatas, documents, images, uris)',
          '&#x20;&#x20;&#x20;&#x20;163             raise ValueError(',
          '&#x20;&#x20;&#x20;&#x20;164                 &quot;You must set a data loader on the collection if loading from URIs.&quot;',
          '&#x20;&#x20;&#x20;&#x20;165             )',
          '&#x20;&#x20;&#x20;&#x20;166         embeddings = self._embed(self._data_loader(uris))',
          '--&amp;gt; 168 self._client._add(ids, self.id, embeddings, metadatas, documents, uris)',
          'File ~/miniforge3/envs/crhomadb/lib/python3.11/site-packages/chromadb/telemetry/opentelemetry/__init__.py:127, in trace_method.&amp;lt;locals&amp;gt;.decorator.&amp;lt;locals&amp;gt;.wrapper(*args, **kwargs)',
          '&#x20;&#x20;&#x20;&#x20;125 global tracer, granularity',
          '&#x20;&#x20;&#x20;&#x20;126 if trace_granularity &amp;lt; granularity:',
          '--&amp;gt; 127     return f(*args, **kwargs)',
          '&#x20;&#x20;&#x20;&#x20;128 if not tracer:',
          '&#x20;&#x20;&#x20;&#x20;129     return f(*args, **kwargs)',
          'File ~/miniforge3/envs/crhomadb/lib/python3.11/site-packages/chromadb/api/segment.py:375, in SegmentAPI._add(self, ids, collection_id, embeddings, metadatas, documents, uris)',
          '&#x20;&#x20;&#x20;&#x20;365 records_to_submit = []',
          '&#x20;&#x20;&#x20;&#x20;366 for r in _records(',
          '&#x20;&#x20;&#x20;&#x20;367     t.Operation.ADD,',
          '&#x20;&#x20;&#x20;&#x20;368     ids=ids,',
          '&#x20;&#x20;&#x20;(...)',
          '&#x20;&#x20;&#x20;&#x20;373     uris=uris,',
          '&#x20;&#x20;&#x20;&#x20;374 ):',
          '--&amp;gt; 375     self._validate_embedding_record(coll, r)',
          '&#x20;&#x20;&#x20;&#x20;376     records_to_submit.append(r)',
          '&#x20;&#x20;&#x20;&#x20;377 self._producer.submit_embeddings(coll[&quot;topic&quot;], records_to_submit)',
          'File ~/miniforge3/envs/crhomadb/lib/python3.11/site-packages/chromadb/telemetry/opentelemetry/__init__.py:127, in trace_method.&amp;lt;locals&amp;gt;.decorator.&amp;lt;locals&amp;gt;.wrapper(*args, **kwargs)',
          '&#x20;&#x20;&#x20;&#x20;125 global tracer, granularity',
          '&#x20;&#x20;&#x20;&#x20;126 if trace_granularity &amp;lt; granularity:',
          '--&amp;gt; 127     return f(*args, **kwargs)',
          '&#x20;&#x20;&#x20;&#x20;128 if not tracer:',
          '&#x20;&#x20;&#x20;&#x20;129     return f(*args, **kwargs)',
          'File ~/miniforge3/envs/crhomadb/lib/python3.11/site-packages/chromadb/api/segment.py:799, in SegmentAPI._validate_embedding_record(self, collection, record)',
          '&#x20;&#x20;&#x20;&#x20;797 add_attributes_to_current_span(&#x7B;&quot;collection_id&quot;: str(collection[&quot;id&quot;])&#x7D;)',
          '&#x20;&#x20;&#x20;&#x20;798 if record[&quot;embedding&quot;]:',
          '--&amp;gt; 799     self._validate_dimension(collection, len(record[&quot;embedding&quot;]), update=True)',
          'File ~/miniforge3/envs/crhomadb/lib/python3.11/site-packages/chromadb/telemetry/opentelemetry/__init__.py:127, in trace_method.&amp;lt;locals&amp;gt;.decorator.&amp;lt;locals&amp;gt;.wrapper(*args, **kwargs)',
          '&#x20;&#x20;&#x20;&#x20;125 global tracer, granularity',
          '&#x20;&#x20;&#x20;&#x20;126 if trace_granularity &amp;lt; granularity:',
          '--&amp;gt; 127     return f(*args, **kwargs)',
          '&#x20;&#x20;&#x20;&#x20;128 if not tracer:',
          '&#x20;&#x20;&#x20;&#x20;129     return f(*args, **kwargs)',
          'File ~/miniforge3/envs/crhomadb/lib/python3.11/site-packages/chromadb/api/segment.py:814, in SegmentAPI._validate_dimension(self, collection, dim, update)',
          '&#x20;&#x20;&#x20;&#x20;812         self._collection_cache[id][&quot;dimension&quot;] = dim',
          '&#x20;&#x20;&#x20;&#x20;813 elif collection[&quot;dimension&quot;] != dim:',
          '--&amp;gt; 814     raise InvalidDimensionException(',
          '&#x20;&#x20;&#x20;&#x20;815         f&quot;Embedding dimension &#x7B;dim&#x7D; does not match collection dimensionality &#x7B;collection[&#x27;dimension&#x27;]&#x7D;&quot;',
          '&#x20;&#x20;&#x20;&#x20;816     )',
          '&#x20;&#x20;&#x20;&#x20;817 else:',
          '&#x20;&#x20;&#x20;&#x20;818     return',
          'InvalidDimensionException: Embedding dimension 383 does not match collection dimensionality 384',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <h4 id="Adicionar documentos e embeddings">Adicionar documentos e embeddings<a class="anchor-link" href="#Adicionar documentos e embeddings"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 74" src={svg_paths.link_svg_path}/></a></h4>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>O Chroma também permite adicionar documentos e embeddings ao mesmo tempo. Portanto, se isso for feito, ele não criará os embeddings do documento.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;This is a Pytorch docs&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">embeddings</span><span class="o">=</span><span class="n">new_embedding</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Pytorch source&quot;</span><span class="p">}],</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id6&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Se observarmos os embeddings do último elemento da coleção, veremos que eles são os que adicionamos.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="s1">&#39;embeddings&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '[1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '...,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0,',
          '1.0]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <h3 id="Consultas">Consultas<a class="anchor-link" href="#Consultas"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 75" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <h4 id="Consultas por documentos">Consultas por documentos<a class="anchor-link" href="#Consultas por documentos"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 76" src={svg_paths.link_svg_path}/></a></h4>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Para fazer uma consulta, usamos o método <code>query</code>. Com o parâmetro <code>n_results</code>, podemos especificar quantos resultados queremos obter.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;]],',
          '&#x27;distances&#x27;: [[0.5389559268951416]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Se, em vez de <code>n_results = 1</code>, definirmos um valor maior, ele retornará mais resultados.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Number of requested results 10 is greater than number of elements in index 6, updating n_results = 6',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;, &#x27;id2&#x27;, &#x27;id4&#x27;, &#x27;id3&#x27;, &#x27;id5&#x27;, &#x27;id6&#x27;]],',
          '&#x27;distances&#x27;: [[0.5389559268951416,',
          '&#x20;&#x20;&#x20;1.5743632316589355,',
          '&#x20;&#x20;&#x20;1.578398585319519,',
          '&#x20;&#x20;&#x20;1.59961998462677,',
          '&#x20;&#x20;&#x20;384.56890869140625,',
          '&#x20;&#x20;&#x20;384.56890869140625]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Rust source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Mojo source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Only embeddings&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Pytorch source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is JavaScript docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is Rust docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is a Mojo docs&#x27;,',
          '&#x20;&#x20;&#x20;None,',
          '&#x20;&#x20;&#x20;&#x27;This is a Pytorch docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Podemos filtrar por um valor de metadados com o argumento <code>where</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">where</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Python source&quot;</span><span class="p">}</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Number of requested results 10 is greater than number of elements in index 6, updating n_results = 6',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;]],',
          '&#x27;distances&#x27;: [[0.5389559268951416]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Podemos ver que apenas um resultado já foi retornado</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Também podemos filtrar pelo conteúdo do documento com o argumento <code>where_document</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">where_document</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;$contains&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">}</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Number of requested results 10 is greater than number of elements in index 6, updating n_results = 6',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;]],',
          '&#x27;distances&#x27;: [[0.5389559268951416]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Mais tarde, falaremos mais sobre as possibilidades que temos aqui</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Quando fazemos uma consulta, podemos dizer quais dados queremos que sejam retornados, por exemplo, apenas os embeddings, apenas os metadados ou vários dados, especificando-os em uma lista usando o argumento <code>include</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="s2">&quot;distances&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Number of requested results 10 is greater than number of elements in index 6, updating n_results = 6',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;, &#x27;id2&#x27;, &#x27;id4&#x27;, &#x27;id3&#x27;, &#x27;id5&#x27;, &#x27;id6&#x27;]],',
          '&#x27;distances&#x27;: [[0.5389559268951416,',
          '&#x20;&#x20;&#x20;1.5743632316589355,',
          '&#x20;&#x20;&#x20;1.578398585319519,',
          '&#x20;&#x20;&#x20;1.59961998462677,',
          '&#x20;&#x20;&#x20;384.56890869140625,',
          '&#x20;&#x20;&#x20;384.56890869140625]],',
          '&#x27;metadatas&#x27;: None,',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is JavaScript docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is Rust docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is a Mojo docs&#x27;,',
          '&#x20;&#x20;&#x20;None,',
          '&#x20;&#x20;&#x20;&#x27;This is a Pytorch docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vemos que <code>metadatas</code> agora é <code>None</code>.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h4 id="Varias consultas ao mesmo tempo">Várias consultas ao mesmo tempo<a class="anchor-link" href="#Varias consultas ao mesmo tempo"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 77" src={svg_paths.link_svg_path}/></a></h4>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Podemos consultar a coleção várias vezes ao mesmo tempo, passando uma lista para o parâmetro <code>query_texts</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;programming language&quot;</span><span class="p">,</span> <span class="s2">&quot;high level&quot;</span><span class="p">,</span> <span class="s2">&quot;multi propuse&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;], [&#x27;id1&#x27;], [&#x27;id3&#x27;]],',
          '&#x27;distances&#x27;: [[1.152251958847046], [1.654376745223999], [1.6786067485809326]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;],',
          '&#x20;&#x20;[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;],',
          '&#x20;&#x20;[&#x7B;&#x27;source&#x27;: &#x27;Mojo source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;],',
          '&#x20;&#x20;[&#x27;This is a python docs&#x27;],',
          '&#x20;&#x20;[&#x27;This is a Mojo docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Para cada consulta, ele retornou um resultado</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Isso é muito útil quando o banco de dados está hospedado em um servidor e somos cobrados por cada consulta que fazemos. Portanto, em vez de fazer uma consulta para cada pergunta que temos, fazemos uma consulta com todas as perguntas que temos.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h4 id="Consultas para incorporacoes">Consultas para incorporações<a class="anchor-link" href="#Consultas para incorporacoes"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 78" src={svg_paths.link_svg_path}/></a></h4>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Quando consultamos os documentos, o que o chroma faz é calcular a incorporação dos <code>textos de consulta</code> e procurar os documentos que mais se assemelham a essa incorporação. Mas se já tivermos a incorporação, podemos fazer a consulta diretamente com a incorporação.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Primeiro, vamos obter a incorporação de uma consulta com a mesma função de incorporação das coleções.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">query_texts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;python language&quot;</span><span class="p">]</span>',
      '<span class="n">query_embeddings</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">_embedding_function</span><span class="p">(</span><span class="n">query_texts</span><span class="p">)</span>',
      '<span class="n">query_embeddings</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '[[-0.04816831275820732,',
          '&#x20;&#x20;0.014662696048617363,',
          '&#x20;&#x20;-0.031021444126963615,',
          '&#x20;&#x20;0.008308809250593185,',
          '&#x20;&#x20;-0.07176128774881363,',
          '&#x20;&#x20;-0.10355626791715622,',
          '&#x20;&#x20;0.06690476089715958,',
          '&#x20;&#x20;0.04229631647467613,',
          '&#x20;&#x20;-0.03681119903922081,',
          '&#x20;&#x20;-0.04993892088532448,',
          '&#x20;&#x20;0.03186540678143501,',
          '&#x20;&#x20;0.015252595767378807,',
          '&#x20;&#x20;0.0642094686627388,',
          '&#x20;&#x20;0.018130118027329445,',
          '&#x20;&#x20;0.016300885006785393,',
          '&#x20;&#x20;-0.028082313016057014,',
          '&#x20;&#x20;-0.03994889184832573,',
          '&#x20;&#x20;0.023195551708340645,',
          '&#x20;&#x20;0.004547565709799528,',
          '&#x20;&#x20;-0.11764183640480042,',
          '&#x20;&#x20;0.019792592152953148,',
          '&#x20;&#x20;0.0496944822371006,',
          '&#x20;&#x20;-0.013253907673060894,',
          '&#x20;&#x20;0.03610404208302498,',
          '&#x20;&#x20;0.030529780313372612,',
          '&#x20;&#x20;-0.01815914921462536,',
          '&#x20;&#x20;-0.009753326885402203,',
          '&#x20;&#x20;0.03412770479917526,',
          '&#x20;&#x20;0.03020440600812435,',
          '&#x20;&#x20;...',
          '&#x20;&#x20;0.02079579420387745,',
          '&#x20;&#x20;-0.00972712505608797,',
          '&#x20;&#x20;0.13462257385253906,',
          '&#x20;&#x20;0.15277136862277985,',
          '&#x20;&#x20;-0.028574923053383827]]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Agora podemos fazer a consulta com a incorporação</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_embeddings</span><span class="o">=</span><span class="n">query_embeddings</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;]],',
          '&#x27;distances&#x27;: [[0.6297433376312256]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como antes, podemos obter mais resultados aumentando o valor do parâmetro <code>n_results</code> e podemos filtrar com os parâmetros <code>where</code> e <code>where_document</code>. Também podemos fazer várias consultas ao mesmo tempo e especificar quais dados queremos retornar com o parâmetro <code>include</code>.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <blockquote>
      <p>Observação: se tentarmos fazer uma consulta com uma incorporação de uma dimensão diferente das que já estão na coleção, receberemos um erro.</p>
      </blockquote>
      </section>
      
      <section class="section-block-markdown-cell">
      <h3>Recuperar documentos por <code>ID</code>.</h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Se soubermos o <code>ID</code> de um documento, poderemos recuperar o documento com o método <code>get</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id1&quot;</span><span class="p">],</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;metadatas&#x27;: [&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [&#x27;This is a python docs&#x27;],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Também é possível recuperar vários documentos de uma só vez.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id1&quot;</span><span class="p">,</span> <span class="s2">&quot;id2&quot;</span><span class="p">,</span> <span class="s2">&quot;id3&quot;</span><span class="p">],</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;, &#x27;id2&#x27;, &#x27;id3&#x27;],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;metadatas&#x27;: [&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Mojo source&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [&#x27;This is a python docs&#x27;,',
          '&#x20;&#x20;&#x27;This is JavaScript docs&#x27;,',
          '&#x20;&#x20;&#x27;This is a Mojo docs&#x27;],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como antes, podemos filtrar com os argumentos <code>where</code> e <code>where_document</code>. Também podemos fazer várias consultas ao mesmo tempo e especificar quais dados queremos retornar com o parâmetro <code>include</code>.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h3 id="Filtragem">Filtragem<a class="anchor-link" href="#Filtragem"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 79" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Como vimos, você pode filtrar por metadados com o parâmetro <code>where</code> e pelo conteúdo do documento com o parâmetro <code>where_document</code>.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h4 id="Filtragem por metadados">Filtragem por metadados<a class="anchor-link" href="#Filtragem por metadados"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 80" src={svg_paths.link_svg_path}/></a></h4>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Como os metadados entrarão em mim como um dicionário</p>
      
      <section class="section-block-markdown-cell">
            <div class='highlight'><pre><code class="language-python">collection.add(<br>&#x20;&#x20;documents=["This is a python docs", "This is JavaScript docs"],<br>&#x20;&#x20;metadatas=[{opening_brace}"source": "Python source"{closing_brace}, {opening_brace}"source": "JavaScript source"{closing_brace}],<br>&#x20;&#x20;ids=["id1", "id2"]<br>)</code></pre></div>
            </section>
      <p>A primeira coisa que temos de fazer é indicar a chave dos metadados pelos quais queremos filtrar. Em seguida, temos de colocar um operador e o valor</p>
      
      <section class="section-block-markdown-cell">
            <div class='highlight'><pre><code class="language-python">{opening_brace}<br>&#x20;&#x20;"metadata_field": {opening_brace}<br>&#x20;&#x20;&#x20;&#x20;&lt;Operador&gt;: &lt;Valor&gt;.<br>&#x20;&#x20;{closing_brace}<br>{closing_brace}</code></pre></div>
            </section>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Os valores possíveis do oerador são</p>
      <p>**$eq** - igual a (string, int, float)</p>
      <p>**$ne** - não é igual a (string, int, float)</p>
      <p>**$gt** - maior que (int, float)</p>
      <p>**$gte** - maior ou igual a (int, float)</p>
      <p>**$lt** - menor que (int, float)</p>
      <p>**$lte** - menor que ou igual a (int, float)</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Vamos dar uma olhada em uma consulta</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">where</span><span class="o">=</span>',
      '<span class="w">    </span><span class="p">{</span>',
      '<span class="w">        </span><span class="s2">&quot;source&quot;</span><span class="p">:</span>',
      '<span class="w">        </span><span class="p">{</span>',
      '<span class="w">            </span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="s2">&quot;Python source&quot;</span>',
      '<span class="w">        </span><span class="p">}</span>',
      '<span class="w">    </span><span class="p">}</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;]],',
          '&#x27;distances&#x27;: [[0.5389559268951416]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Se não colocarmos o operador, o padrão será <code>$eq</code>, ou seja, isto</p>
      
      <section class="section-block-markdown-cell">
            <div class='highlight'><pre><code class="language-python">{opening_brace}<br>&#x20;&#x20;"metadata_field": {opening_brace}<br>&#x20;&#x20;&#x20;&#x20;&lt;"$eq"&gt;: &lt;Value&gt;.<br>&#x20;&#x20;{closing_brace}<br>{closing_brace}</code></pre></div>
            </section>
      <p>É o mesmo que isto</p>
      
      <section class="section-block-markdown-cell">
            <div class='highlight'><pre><code class="language-python">{opening_brace}<br>&#x20;&#x20;"metadata_field": &lt;Value&gt;.<br>{closing_brace}</code></pre></div>
            </section>
      </section>
      
      <section class="section-block-markdown-cell">
      <blockquote>
      <p>Observação**: O Chroma só pesquisará dados que tenham os metadados <code>source</code>; por exemplo, se você pesquisar <code>where={opening_brace}&quot;version&quot;: {opening_brace}&quot;$ne&quot;: 1{closing_brace}{closing_brace}</code>, ele só retornará dados que tenham uma chave <code>version</code> em seus metadados e que não sejam 1.</p>
      </blockquote>
      </section>
      
      <section class="section-block-markdown-cell">
      <h4 id="Filtragem por conteudo do documento">Filtragem por conteúdo do documento<a class="anchor-link" href="#Filtragem por conteudo do documento"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 81" src={svg_paths.link_svg_path}/></a></h4>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Ao filtrar pelo conteúdo do documento, temos duas chaves possíveis: <code><span class="math-inline">contains</code> e <code></span>not_contains</code>.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Por exemplo, procuramos dados na coleção em que a palavra "python" aparece em seu documento.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">where_document</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;$contains&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">}</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Number of requested results 10 is greater than number of elements in index 6, updating n_results = 6',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;]],',
          '&#x27;distances&#x27;: [[0.5389559268951416]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>E todos os dados na coleção em que a palavra <code>python</code> não aparece em seu documento</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">where_document</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;$not_contains&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">}</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Number of requested results 10 is greater than number of elements in index 6, updating n_results = 6',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id2&#x27;, &#x27;id4&#x27;, &#x27;id3&#x27;, &#x27;id6&#x27;]],',
          '&#x27;distances&#x27;: [[1.5743632316589355,',
          '&#x20;&#x20;&#x20;1.578398585319519,',
          '&#x20;&#x20;&#x20;1.59961998462677,',
          '&#x20;&#x20;&#x20;384.56890869140625]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Rust source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Mojo source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Pytorch source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is JavaScript docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is Rust docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is a Mojo docs&#x27;,',
          '&#x20;&#x20;&#x20;&#x27;This is a Pytorch docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Também podemos usar os operadores lógicos <code><span class="math-inline">and</code> e <code></span>or</code> para fazer consultas mais complexas.</p>
      
      <section class="section-block-markdown-cell">
            <div class='highlight'><pre><code class="language-python">{opening_brace}<br>&#x20;&#x20;"$e": [<br>&#x20;&#x20;&#x20;&#x20;{opening_brace}<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&lt;Operador&gt;: &lt;Valor&gt;.<br>&#x20;&#x20;&#x20;&#x20;{closing_brace},<br>&#x20;&#x20;&#x20;&#x20;{opening_brace}<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&lt;Operador&gt;: &lt;Valor&gt;.<br>&#x20;&#x20;&#x20;&#x20;{closing_brace}<br>&#x20;&#x20;<br>{closing_brace}</code></pre></div>
            </section>
      
      <section class="section-block-markdown-cell">
            <div class='highlight'><pre><code class="language-python">{opening_brace}<br>&#x20;&#x20;"$or": [<br>&#x20;&#x20;&#x20;&#x20;{opening_brace}<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&lt;Operador&gt;: &lt;Valor&gt;.<br>&#x20;&#x20;&#x20;&#x20;{closing_brace},<br>&#x20;&#x20;&#x20;&#x20;{opening_brace}<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&lt;Operador&gt;: &lt;Valor&gt;.<br>&#x20;&#x20;&#x20;&#x20;{closing_brace}<br>&#x20;&#x20;<br>{closing_brace}</code></pre></div>
            </section>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Por exemplo, pesquisamos todos os documentos que contêm as palavras <code>python</code> e <code>docs</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">where_document</span><span class="o">=</span>',
      '<span class="w">    </span><span class="p">{</span>',
      '<span class="w">        </span><span class="s2">&quot;$and&quot;</span><span class="p">:</span> <span class="p">[</span>',
      '<span class="w">            </span><span class="p">{</span><span class="s2">&quot;$contains&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">},</span>',
      '<span class="w">            </span><span class="p">{</span><span class="s2">&quot;$contains&quot;</span><span class="p">:</span> <span class="s2">&quot;docs&quot;</span><span class="p">},</span>',
      '<span class="w">        </span><span class="p">],</span>',
      '<span class="w">    </span><span class="p">},</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Number of requested results 10 is greater than number of elements in index 6, updating n_results = 6',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;]],',
          '&#x27;distances&#x27;: [[0.5389559268951416]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <h3 id="Atualizar dados">Atualizar dados<a class="anchor-link" href="#Atualizar dados"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 82" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Qualquer item de dados pode ser atualizado com o método update.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id1&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;This is a updated Python docs&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vamos ver se ela foi atualizada</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">n_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">where_document</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;$contains&quot;</span><span class="p">:</span> <span class="s2">&quot;Python&quot;</span><span class="p">}</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'Number of requested results 10 is greater than number of elements in index 6, updating n_results = 6',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;]],',
          '&#x27;distances&#x27;: [[0.8247963190078735]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a updated Python docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <blockquote>
      <p>Observação: se você tentar atualizar um <code>ID</code> que não existe, ocorrerá um erro.</p>
      </blockquote>
      </section>
      
      <section class="section-block-markdown-cell">
      <blockquote>
      <p>Observação: se você tentar atualizar uma incorporação com outra incorporação de tamanho diferente, ocorrerá um erro.</p>
      </blockquote>
      </section>
      
      <section class="section-block-markdown-cell">
      <h3 id="Atualizar ou adicionar dados">Atualizar ou adicionar dados<a class="anchor-link" href="#Atualizar ou adicionar dados"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 83" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Com o método <code>upsert</code>, podemos atualizar um dado se ele já existir ou adicioná-lo se ele não existir.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">upsert</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id6&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;This is a Pytorch docs&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Pytorch source&quot;</span><span class="p">}],</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vamos ver se ele foi adicionado à coleção</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;, &#x27;id2&#x27;, &#x27;id3&#x27;, &#x27;id4&#x27;, &#x27;id5&#x27;, &#x27;id6&#x27;],',
          '&#x27;embeddings&#x27;: [[-0.08374718576669693,',
          '&#x20;&#x20;&#x20;0.01027572900056839,',
          '&#x20;&#x20;&#x20;-0.04819200187921524,',
          '&#x20;&#x20;&#x20;0.01758415624499321,',
          '&#x20;&#x20;&#x20;0.013158757239580154,',
          '&#x20;&#x20;&#x20;-0.11435151100158691,',
          '&#x20;&#x20;&#x20;-0.024248722940683365,',
          '&#x20;&#x20;&#x20;-0.01319972239434719,',
          '&#x20;&#x20;&#x20;-0.09626100957393646,',
          '&#x20;&#x20;&#x20;-0.010561048053205013,',
          '&#x20;&#x20;&#x20;0.09369225800037384,',
          '&#x20;&#x20;&#x20;0.06017905846238136,',
          '&#x20;&#x20;&#x20;0.031283188611269,',
          '&#x20;&#x20;&#x20;0.014855983667075634,',
          '&#x20;&#x20;&#x20;-0.0015984248602762818,',
          '&#x20;&#x20;&#x20;0.023238031193614006,',
          '&#x20;&#x20;&#x20;-0.04709107056260109,',
          '&#x20;&#x20;&#x20;-0.007838696241378784,',
          '&#x20;&#x20;&#x20;0.012870412319898605,',
          '&#x20;&#x20;&#x20;-0.028354981914162636,',
          '&#x20;&#x20;&#x20;-0.007653804495930672,',
          '&#x20;&#x20;&#x20;0.09018168598413467,',
          '&#x20;&#x20;&#x20;0.060235824435949326,',
          '&#x20;&#x20;&#x20;0.0005205210763961077,',
          '&#x20;&#x20;&#x20;...',
          '&#x20;&#x20;&#x20;0.014388148672878742]],',
          '&#x27;metadatas&#x27;: [&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Mojo source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Rust source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Only embeddings&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Pytorch source&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [&#x27;This is a updated Python docs&#x27;,',
          '&#x20;&#x20;&#x27;This is JavaScript docs&#x27;,',
          '&#x20;&#x20;&#x27;This is a Mojo docs&#x27;,',
          '&#x20;&#x20;&#x27;This is Rust docs&#x27;,',
          '&#x20;&#x20;None,',
          '&#x20;&#x20;&#x27;This is a Pytorch docs&#x27;],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vemos que sim</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h3 id="Excluir dados">Excluir dados<a class="anchor-link" href="#Excluir dados"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 84" src={svg_paths.link_svg_path}/></a></h3>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Podemos excluir dados de uma coleção com o método <code>delete</code>.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Removeremos os dados com <code>ID</code> <code>id5</code>, que é o que adicionamos com sua incorporação de todos os dados</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id5&quot;</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vamos ver se ele foi removido</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;, &#x27;id2&#x27;, &#x27;id3&#x27;, &#x27;id4&#x27;, &#x27;id6&#x27;],',
          '&#x27;embeddings&#x27;: [[-0.08374718576669693,',
          '&#x20;&#x20;&#x20;0.01027572900056839,',
          '&#x20;&#x20;&#x20;-0.04819200187921524,',
          '&#x20;&#x20;&#x20;0.01758415624499321,',
          '&#x20;&#x20;&#x20;0.013158757239580154,',
          '&#x20;&#x20;&#x20;-0.11435151100158691,',
          '&#x20;&#x20;&#x20;-0.024248722940683365,',
          '&#x20;&#x20;&#x20;-0.01319972239434719,',
          '&#x20;&#x20;&#x20;-0.09626100957393646,',
          '&#x20;&#x20;&#x20;-0.010561048053205013,',
          '&#x20;&#x20;&#x20;0.09369225800037384,',
          '&#x20;&#x20;&#x20;0.06017905846238136,',
          '&#x20;&#x20;&#x20;0.031283188611269,',
          '&#x20;&#x20;&#x20;0.014855983667075634,',
          '&#x20;&#x20;&#x20;-0.0015984248602762818,',
          '&#x20;&#x20;&#x20;0.023238031193614006,',
          '&#x20;&#x20;&#x20;-0.04709107056260109,',
          '&#x20;&#x20;&#x20;-0.007838696241378784,',
          '&#x20;&#x20;&#x20;0.012870412319898605,',
          '&#x20;&#x20;&#x20;-0.028354981914162636,',
          '&#x20;&#x20;&#x20;-0.007653804495930672,',
          '&#x20;&#x20;&#x20;0.09018168598413467,',
          '&#x20;&#x20;&#x20;0.060235824435949326,',
          '&#x20;&#x20;&#x20;0.0005205210763961077,',
          '&#x20;&#x20;&#x20;...',
          '&#x20;&#x20;&#x20;0.07033486664295197,',
          '&#x20;&#x20;&#x20;0.014388148672878742]],',
          '&#x27;metadatas&#x27;: [&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Mojo source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Rust source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Pytorch source&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [&#x27;This is a updated Python docs&#x27;,',
          '&#x20;&#x20;&#x27;This is JavaScript docs&#x27;,',
          '&#x20;&#x20;&#x27;This is a Mojo docs&#x27;,',
          '&#x20;&#x20;&#x27;This is Rust docs&#x27;,',
          '&#x20;&#x20;&#x27;This is a Pytorch docs&#x27;],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vemos que não é mais</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h2 id="Embeddings">Embeddings<a class="anchor-link" href="#Embeddings"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 85" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Conforme mencionado acima, podemos usar diferentes funções de embeddings e, se nenhuma for especificada, ele usará <code>all-MiniLM-L6-v2</code>. Na página chroma <a href="https://docs.trychroma.com/docs/embeddings/embedding-functions" target="_blank" rel="nofollow noreferrer">embeddings documentation</a>, podemos ver as diferentes funções de embeddings que podemos usar. Como isso pode mudar e algumas delas são pagas e exigem uma chave de API, explicaremos apenas como usar as do HuggingFace.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Primeiro, definimos a função de incorporação</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">chromadb.utils.embedding_functions</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">embedding_functions</span>',
      '<span class="w"> </span>',
      '<span class="n">huggingface_ef</span> <span class="o">=</span> <span class="n">embedding_functions</span><span class="o">.</span><span class="n">HuggingFaceEmbeddingFunction</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;YOUR_API_KEY&quot;</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;sentence-transformers/all-mpnet-base-v2&quot;</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>No meu caso, utilizo o <code>sentence-transformers/all-mpnet-base-v2</code>, que é o mais baixado dos <code>sentence-transformers</code> no momento em que escrevo esta postagem.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Para adicionar agora a função de incorporação à coleção, precisamos adicionar o argumento <code>metadata={opening_brace}&quot;embedding&quot;: &#x3C;function&#x3E;{closing_brace}</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;colection_huggingface&quot;</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">embedding_function</span><span class="o">=</span><span class="n">huggingface_ef</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Podemos verificar se adicionamos a nova função de incorporação calculando as incorporações de uma palavra.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">embedding</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">_embedding_function</span><span class="p">([</span><span class="s2">&quot;python&quot;</span><span class="p">])</span>',
      '<span class="nb">len</span><span class="p">(</span><span class="n">embedding</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '(1, 768)',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>O comprimento da incorporação é de 768</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Se agora calcularmos a incorporação com a função de incorporação da coleção anterior</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my_collection&quot;</span><span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">embedding</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">_embedding_function</span><span class="p">([</span><span class="s2">&quot;python&quot;</span><span class="p">])</span>',
      '<span class="nb">len</span><span class="p">(</span><span class="n">embedding</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '(1, 384)',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vemos que agora o comprimento da incorporação é 384, ou seja, usamos uma nova função de incorporação antes.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h2 id="Multimodalidade">Multimodalidade<a class="anchor-link" href="#Multimodalidade"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 86" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Podemos adicionar embeddings de imagem, pois o chroma tem o <a href="https://github.com/mlfoundations/open_clip" target="_blank" rel="nofollow noreferrer">OpenCLIP</a> incorporado. O <a href="https://github.com/mlfoundations/open_clip">OpenCLIP</a> é uma implementação de código aberto do <a href="https://github.com/openai/CLIP">CLIP</a> (Contrastive Language-Image Pre-Training), que é uma rede neural OpenAI capaz de fornecer uma descrição de uma imagem.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Para usar o OpenCLIP, temos que instalá-lo com o pip</p>
      <div class='highlight'><pre><code class="language-bash">pip install open-clip-torch</code></pre></div>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Depois de instalado, podemos usá-lo para criar embeddings da seguinte imagem</p>
      <img decoding="async" onerror="this.parentNode.removeChild(this)" src="https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/chromadb_dalle3.webp" alt="chroma db - python mixture">
      <p>Eu o tenho em meu caminho local <code>../images/chromadb_dalle3.webp</code>.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">chromadb.utils.embedding_functions</span><span class="w"> </span><span class="kn">import</span>  <span class="n">OpenCLIPEmbeddingFunction</span>',
      '<span class="w"> </span>',
      '<span class="n">embedding_function</span> <span class="o">=</span> <span class="n">OpenCLIPEmbeddingFunction</span><span class="p">()</span>',
      '<span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;../images/chromadb_dalle3.webp&quot;</span>',
      '<span class="n">embedding</span> <span class="o">=</span> <span class="n">embedding_function</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>',
      '<span class="nb">len</span><span class="p">(</span><span class="n">embedding</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '(30, 512)',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como podemos ver, ele cria uma incorporação de tamanho 30x512.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>O Chroma também vem com um carregador de imagens.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">chromadb.utils.data_loaders</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageLoader</span>',
      '<span class="n">data_loader</span> <span class="o">=</span> <span class="n">ImageLoader</span><span class="p">()</span>',
      '<span class="n">data</span> <span class="o">=</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">_load_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>',
      '<span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '(numpy.ndarray, (1024, 1024, 3))',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Portanto, podemos criar uma coleção multimodal com essa função de incorporação e o carregador de imagens.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;multimodal_collection&quot;</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">embedding_function</span><span class="o">=</span><span class="n">embedding_function</span><span class="p">,</span>',
      '<span class="w">    </span><span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>E podemos adicionar os embeddings das imagens a ele.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id1&#39;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">images</span><span class="o">=</span><span class="p">[</span><span class="n">image</span><span class="p">]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Vamos ver o que ele salvou</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;],',
          '&#x27;embeddings&#x27;: [[-0.014372998848557472,',
          '&#x20;&#x20;&#x20;0.0063015008345246315,',
          '&#x20;&#x20;&#x20;-0.03794914484024048,',
          '&#x20;&#x20;&#x20;-0.028725482523441315,',
          '&#x20;&#x20;&#x20;-0.014304812066257,',
          '&#x20;&#x20;&#x20;-0.04323698952794075,',
          '&#x20;&#x20;&#x20;0.008670451119542122,',
          '&#x20;&#x20;&#x20;-0.016066772863268852,',
          '&#x20;&#x20;&#x20;-0.02365742437541485,',
          '&#x20;&#x20;&#x20;0.07881983369588852,',
          '&#x20;&#x20;&#x20;0.022775636985898018,',
          '&#x20;&#x20;&#x20;0.004407387692481279,',
          '&#x20;&#x20;&#x20;0.058205753564834595,',
          '&#x20;&#x20;&#x20;-0.02389293536543846,',
          '&#x20;&#x20;&#x20;-0.027586588636040688,',
          '&#x20;&#x20;&#x20;0.05778728798031807,',
          '&#x20;&#x20;&#x20;-0.2631031572818756,',
          '&#x20;&#x20;&#x20;0.044124454259872437,',
          '&#x20;&#x20;&#x20;0.010588622651994228,',
          '&#x20;&#x20;&#x20;-0.035578884184360504,',
          '&#x20;&#x20;&#x20;-0.041719693690538406,',
          '&#x20;&#x20;&#x20;-0.0033654430881142616,',
          '&#x20;&#x20;&#x20;-0.04731074720621109,',
          '&#x20;&#x20;&#x20;-0.0019943572115153074,',
          '&#x20;&#x20;&#x20;...',
          '&#x20;&#x20;&#x20;0.04397008568048477,',
          '&#x20;&#x20;&#x20;0.04396628588438034]],',
          '&#x27;metadatas&#x27;: [None],',
          '&#x27;documents&#x27;: [None],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>O Chroma não armazena as imagens, apenas os embeddings, portanto, para não perder a relação entre os embeddings e as imagens, podemos salvar o caminho para as imagens nos metadados. Vamos usar o método <code>update</code> para adicionar o caminho à imagem</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id1&#39;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">images</span><span class="o">=</span><span class="p">[</span><span class="n">image</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">}]</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <section class="section-block-markdown-cell">
      <p>Se voltarmos e olharmos para o que a coleção tem reservado</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;],',
          '&#x27;embeddings&#x27;: [[-0.014372998848557472,',
          '&#x20;&#x20;&#x20;0.0063015008345246315,',
          '&#x20;&#x20;&#x20;-0.03794914484024048,',
          '&#x20;&#x20;&#x20;-0.028725482523441315,',
          '&#x20;&#x20;&#x20;-0.014304812066257,',
          '&#x20;&#x20;&#x20;-0.04323698952794075,',
          '&#x20;&#x20;&#x20;0.008670451119542122,',
          '&#x20;&#x20;&#x20;-0.016066772863268852,',
          '&#x20;&#x20;&#x20;-0.02365742437541485,',
          '&#x20;&#x20;&#x20;0.07881983369588852,',
          '&#x20;&#x20;&#x20;0.022775636985898018,',
          '&#x20;&#x20;&#x20;0.004407387692481279,',
          '&#x20;&#x20;&#x20;0.058205753564834595,',
          '&#x20;&#x20;&#x20;-0.02389293536543846,',
          '&#x20;&#x20;&#x20;-0.027586588636040688,',
          '&#x20;&#x20;&#x20;0.05778728798031807,',
          '&#x20;&#x20;&#x20;-0.2631031572818756,',
          '&#x20;&#x20;&#x20;0.044124454259872437,',
          '&#x20;&#x20;&#x20;0.010588622651994228,',
          '&#x20;&#x20;&#x20;-0.035578884184360504,',
          '&#x20;&#x20;&#x20;-0.041719693690538406,',
          '&#x20;&#x20;&#x20;-0.0033654430881142616,',
          '&#x20;&#x20;&#x20;-0.04731074720621109,',
          '&#x20;&#x20;&#x20;-0.0019943572115153074,',
          '&#x20;&#x20;&#x20;...',
          '&#x20;&#x20;&#x20;0.04397008568048477,',
          '&#x20;&#x20;&#x20;0.04396628588438034]],',
          '&#x27;metadatas&#x27;: [&#x7B;&#x27;source&#x27;: &#x27;../images/chromadb_dalle3.webp&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [None],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como a coleção é multimodal, podemos adicionar documentos a ela como antes.</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id2&#39;</span><span class="p">,</span> <span class="s1">&#39;id3&#39;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;This is a python docs&quot;</span><span class="p">,</span> <span class="s2">&quot;This is JavaScript docs&quot;</span><span class="p">],</span>',
      '<span class="w">    </span><span class="n">metadatas</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Python source&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;JavaScript source&quot;</span><span class="p">}]</span>',
      '<span class="p">)</span>',
      '<span class="n">collection</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [&#x27;id1&#x27;, &#x27;id2&#x27;, &#x27;id3&#x27;],',
          '&#x27;embeddings&#x27;: [[-0.014372998848557472,',
          '&#x20;&#x20;&#x20;0.0063015008345246315,',
          '&#x20;&#x20;&#x20;-0.03794914484024048,',
          '&#x20;&#x20;&#x20;-0.028725482523441315,',
          '&#x20;&#x20;&#x20;-0.014304812066257,',
          '&#x20;&#x20;&#x20;-0.04323698952794075,',
          '&#x20;&#x20;&#x20;0.008670451119542122,',
          '&#x20;&#x20;&#x20;-0.016066772863268852,',
          '&#x20;&#x20;&#x20;-0.02365742437541485,',
          '&#x20;&#x20;&#x20;0.07881983369588852,',
          '&#x20;&#x20;&#x20;0.022775636985898018,',
          '&#x20;&#x20;&#x20;0.004407387692481279,',
          '&#x20;&#x20;&#x20;0.058205753564834595,',
          '&#x20;&#x20;&#x20;-0.02389293536543846,',
          '&#x20;&#x20;&#x20;-0.027586588636040688,',
          '&#x20;&#x20;&#x20;0.05778728798031807,',
          '&#x20;&#x20;&#x20;-0.2631031572818756,',
          '&#x20;&#x20;&#x20;0.044124454259872437,',
          '&#x20;&#x20;&#x20;0.010588622651994228,',
          '&#x20;&#x20;&#x20;-0.035578884184360504,',
          '&#x20;&#x20;&#x20;-0.041719693690538406,',
          '&#x20;&#x20;&#x20;-0.0033654430881142616,',
          '&#x20;&#x20;&#x20;-0.04731074720621109,',
          '&#x20;&#x20;&#x20;-0.0019943572115153074,',
          '&#x20;&#x20;&#x20;...',
          '&#x20;&#x20;&#x20;-0.061795610934495926,',
          '&#x20;&#x20;&#x20;-0.02433035336434841]],',
          '&#x27;metadatas&#x27;: [&#x7B;&#x27;source&#x27;: &#x27;../images/chromadb_dalle3.webp&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;],',
          '&#x27;documents&#x27;: [None, &#x27;This is a python docs&#x27;, &#x27;This is JavaScript docs&#x27;],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Por fim, podemos fazer consultas com texto</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;persona trabajando en una mesa&quot;</span><span class="p">],</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'WARNING:chromadb.segment.impl.vector.local_hnsw:Number of requested results 10 is greater than number of elements in index 3, updating n_results = 3',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id2&#x27;, &#x27;id1&#x27;, &#x27;id3&#x27;]],',
          '&#x27;distances&#x27;: [[1.1276676654815674, 1.1777206659317017, 1.2047353982925415]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;../images/chromadb_dalle3.webp&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[&#x27;This is a python docs&#x27;, None, &#x27;This is JavaScript docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Com o texto, não obtivemos a imagem como o primeiro resultado, se eu seguir a documentação do python</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Mas também podemos criá-las com imagens. Neste caso, vou fazer isso com esta imagem</p>
      <img decoding="async" onerror="this.parentNode.removeChild(this)" src="https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/chromadb_elegant.webp" alt="chroma logo">
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">query_image</span> <span class="o">=</span> <span class="s2">&quot;https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/chromadb_elegant.webp&quot;</span>',
      '<span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>',
      '<span class="w">    </span><span class="n">query_images</span><span class="o">=</span><span class="p">[</span><span class="n">query_image</span><span class="p">],</span>',
      '<span class="p">)</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      
      <CodeBlockOutputCell
        text={[
          'WARNING:chromadb.segment.impl.vector.local_hnsw:Number of requested results 10 is greater than number of elements in index 3, updating n_results = 3',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <CodeBlockOutputCell
        text={[
          '&#x7B;&#x27;ids&#x27;: [[&#x27;id1&#x27;, &#x27;id2&#x27;, &#x27;id3&#x27;]],',
          '&#x27;distances&#x27;: [[0.6684874296188354, 0.9450105428695679, 1.0639115571975708]],',
          '&#x27;metadatas&#x27;: [[&#x7B;&#x27;source&#x27;: &#x27;../images/chromadb_dalle3.webp&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;Python source&#x27;&#x7D;,',
          '&#x20;&#x20;&#x20;&#x7B;&#x27;source&#x27;: &#x27;JavaScript source&#x27;&#x7D;]],',
          '&#x27;embeddings&#x27;: None,',
          '&#x27;documents&#x27;: [[None, &#x27;This is a python docs&#x27;, &#x27;This is JavaScript docs&#x27;]],',
          '&#x27;uris&#x27;: None,',
          '&#x27;data&#x27;: None&#x7D;',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Agora, ele apresenta como primeiro resultado a imagem que salvamos</p>
      </section>







    </div>

  </section>

</PostLayout>
