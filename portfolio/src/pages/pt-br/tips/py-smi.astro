---
import PostLayout from '@layouts/PostLayout.astro';
import CodeBlockInputCell from '@components/CodeBlockInputCell.astro';
import CodeBlockOutputCell from '@components/CodeBlockOutputCell.astro';

const { metadata_page } = await import('@portfolio/consts.json');
const { colors } = await import('@portfolio/consts.json');
const { svg_paths } = await import('@portfolio/consts.json');

const page_title = 'py-smi';
const end_url = 'tips/py-smi';
const description = 'Biblioteca Python para obter dados da GPU como `nvidia-smi`';
const keywords = 'python, smi, nvidia, gpu';
const languaje = 'PT';
const image_path = 'https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/nvidia-smi-mockup.webp';
const opening_brace = '{';
const closing_brace = '}';
---

<PostLayout 
    title={page_title}
    languaje={languaje}
    description={description}
    keywords={keywords}
    author={metadata_page.author}
    theme_color={colors.background_color}
    end_url={end_url}
    image_path={image_path}
    image_width=960
    image_height=720
    image_extension=webp
    article_date=2024-12-14+T00:00:00Z
>

  <section class="post-body">


    <aside class="post-index">
      <a class="anchor-link" href="#Instala%C3%A7%C3%A3o"><h2>Instalação</h2></a>
      <a class="anchor-link" href="#Uso"><h2>Uso</h2></a>
    </aside>


    <div class="post-body-content">
      
      <section class="section-block-markdown-cell">
      <h1 id="py-smi">py-smi<a class="anchor-link" href="#py-smi"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 6" src={svg_paths.link_svg_path}/></a></h1>
      </section>
      
      <section class="section-block-markdown-cell">
      <blockquote>
      <p>Aviso: Este post foi traduzido para o português usando um modelo de tradução automática. Por favor, me avise se encontrar algum erro.</p>
      </blockquote>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Queres poder usar <code>nvidia-smi</code> desde Python? Aqui tens uma biblioteca para fazê-lo.</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <h2 id="Instala%C3%A7%C3%A3o">Instalação<a class="anchor-link" href="#Instala%C3%A7%C3%A3o"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 7" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Para poder instalá-la execute:</p>
      <div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>python-smi
      </pre></div>
      </section>
      
      <section class="section-block-markdown-cell">
      <h2 id="Uso">Uso<a class="anchor-link" href="#Uso"><img decoding="async" class="link-img" width="24px" height="24px" alt="link image 8" src={svg_paths.link_svg_path}/></a></h2>
      </section>
      
      <section class="section-block-markdown-cell">
      <p>Importamos a biblioteca</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="kn">from</span> <span class="nn">py_smi</span> <span class="kn">import</span> <span class="n">NVML</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>






      
      <section class="section-block-markdown-cell">
      <p>Criamos um objeto de <code>pynvml</code> (a biblioteca por trás de <code>nvidia-smi</code>)</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">nv</span> <span class="o">=</span> <span class="n">NVML</span><span class="p">()</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>






      
      <section class="section-block-markdown-cell">
      <p>Obtemos a versão do driver e do CUDA</p>
      </section>
      
      <CodeBlockInputCell
        text={[
          '<span></span><span class="n">nv</span><span class="o">.</span><span class="n">driver_version</span><span class="p">,</span> <span class="n">nv</span><span class="o">.</span><span class="n">cuda_version</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      <CodeBlockOutputCell
        text={[
          '(\'560.35.03\', \'12.6\')',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Como no meu caso tenho duas GPUs, crio uma variável com o número de GPUs</p>
      </section>
      
      <CodeBlockInputCell
        text={[
      '<span></span><span class="n">num_gpus</span> <span class="o">=</span> <span class="mi">2</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>






      
      <section class="section-block-markdown-cell">
      <p>Obtenho a memória de cada GPU</p>
      </section>
      
      <CodeBlockInputCell
        text={[
          '<span></span><span class="p">[</span><span class="n">nv</span><span class="o">.</span><span class="n">mem</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gpus</span><span class="p">)]</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      <CodeBlockOutputCell
        text={[
          '[_Memory(free=24136.6875, total=24576.0, used=439.3125),',
          ' _Memory(free=23509.0, total=24576.0, used=1067.0)]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>A utilização</p>
      </section>
      
      <CodeBlockInputCell
        text={[
          '<span></span><span class="p">[</span><span class="n">nv</span><span class="o">.</span><span class="n">utilization</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gpus</span><span class="p">)]</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      <CodeBlockOutputCell
        text={[
          '[_Utilization(gpu=0, memory=0, enc=0, dec=0),',
          ' _Utilization(gpu=0, memory=0, enc=0, dec=0)]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>A potência usada</p>
      </section>
      
      <section class="section-block-markdown-cell">
      <blockquote>
      <p>Isso me dá muito jeito, porque quando eu treinava um modelo e tinha as duas GPUs cheias, às vezes o meu computador desligava, e vendo a potência, vejo que a segunda consome muito, por isso pode ser o que eu já suspeitava, que era por alimentação.</p>
      </blockquote>
      </section>
      
      <CodeBlockInputCell
        text={[
          '<span></span><span class="p">[</span><span class="n">nv</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gpus</span><span class="p">)]</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      <CodeBlockOutputCell
        text={[
          '[_Power(usage=15.382, limit=350.0), _Power(usage=40.573, limit=350.0)]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Os relógios de cada GPU</p>
      </section>
      
      <CodeBlockInputCell
        text={[
          '<span></span><span class="p">[</span><span class="n">nv</span><span class="o">.</span><span class="n">clocks</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gpus</span><span class="p">)]</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      <CodeBlockOutputCell
        text={[
          '[_Clocks(graphics=0, sm=0, mem=405), _Clocks(graphics=540, sm=540, mem=810)]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>Dados do PCI</p>
      </section>
      
      <CodeBlockInputCell
        text={[
          '<span></span><span class="p">[</span><span class="n">nv</span><span class="o">.</span><span class="n">pcie_throughput</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gpus</span><span class="p">)]</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      <CodeBlockOutputCell
        text={[
          '[_PCIeThroughput(rx=0.0, tx=0.0),',
          ' _PCIeThroughput(rx=0.1630859375, tx=0.0234375)]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      
      <section class="section-block-markdown-cell">
      <p>E os processos (agora não estou executando nada)</p>
      </section>
      
      <CodeBlockInputCell
        text={[
          '<span></span><span class="p">[</span><span class="n">nv</span><span class="o">.</span><span class="n">processes</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gpus</span><span class="p">)]</span>',
        ]}
        languaje='python'
      ></CodeBlockInputCell>
      <CodeBlockOutputCell
        text={[
          '[[], []]',
        ]}
        languaje='python'
      ></CodeBlockOutputCell>
      






    </div>

  </section>

</PostLayout>
