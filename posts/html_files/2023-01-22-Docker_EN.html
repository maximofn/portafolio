<section class="section-block-markdown-cell">
<h1 id="Docker">Docker<a class="anchor-link" href="#Docker">¶</a></h1>
</section>
<section class="section-block-markdown-cell">
<blockquote>
<p>Disclaimer: This post has been translated to English using a machine translation model. Please, let me know if you find any mistakes.</p>
</blockquote>
</section>
<section class="section-block-markdown-cell">
<h2 id="Containers">Containers<a class="anchor-link" href="#Containers">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Hello world">Hello world<a class="anchor-link" href="#Hello world">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Run the first Hello World container with the command <code>docker run hello-world</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;hello-world:latest&#x27; locally
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>latest: Pulling from library/hello-world

85e32844: Pull complete 457kB/2.457kBBDigest: sha256:dcba6daec718f547568c562956fa47e1b03673dd010fe6ee58ca806767031d1c
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
&#x20;&#x20;&#x20;&#x20;(amd64)
 3. The Docker daemon created a new container from that image which runs the
&#x20;&#x20;&#x20;&#x20;executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
&#x20;&#x20;&#x20;&#x20;to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Since we don't have the container saved locally, Docker downloads it from Docker Hub. If we now run the container again, the initial message indicating that it is being downloaded will not appear.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
&#x20;&#x20;&#x20;&#x20;(amd64)
 3. The Docker daemon created a new container from that image which runs the
&#x20;&#x20;&#x20;&#x20;executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
&#x20;&#x20;&#x20;&#x20;to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>To see the containers that are running, execute <code>docker ps</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>As we can see, there are no open containers. However, if we run <code>docker ps -a</code> (<code>all</code>), we see that they do appear.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
1efb51bbbf38   hello-world   &quot;/hello&quot;   10 seconds ago   Exited (0) 9 seconds ago              strange_thompson
5f5705e7603e   hello-world   &quot;/hello&quot;   15 seconds ago   Exited (0) 14 seconds ago             laughing_jang
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that two containers called <code>hello-world</code> appear, which are the two we executed before. Therefore, each time we run the <code>run</code> command, Docker creates a new container, it does not execute one that already exists.</p>
</section>
<section class="section-block-markdown-cell">
<p>If we want to get more information about one of the two containers, we can run <code>docker inspect &#x3C;id&#x3E;</code>, where <code>&#x3C;id&#x3E;</code> corresponds to the ID of the container that was displayed in the previous list.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">inspect</span> <span class="mi">1</span><span class="n">efb51bbbf38</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[
&#x20;&#x20;&#x20;&#x20;&#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Id&quot;: &quot;1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Created&quot;: &quot;2023-09-04T03:59:17.795499354Z&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Path&quot;: &quot;/hello&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Args&quot;: [],
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;State&quot;: &#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Status&quot;: &quot;exited&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Running&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Paused&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Restarting&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;OOMKilled&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Dead&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Pid&quot;: 0,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ExitCode&quot;: 0,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Error&quot;: &quot;&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;StartedAt&quot;: &quot;2023-09-04T03:59:18.406663026Z&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;FinishedAt&quot;: &quot;2023-09-04T03:59:18.406181184Z&quot;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Image&quot;: &quot;sha256:9c7a54a9a43cca047013b82af109fe963fde787f63f9e016fdc3384500c2823d&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/resolv.conf&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/hostname&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;HostsPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/hosts&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;LogPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e-json.log&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Name&quot;: &quot;/strange_thompson&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;...
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x7D;
]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Since remembering IDs is complicated for us, Docker assigns names to containers to make our life easier. So in the previous list, the last column corresponds to the name that Docker has assigned to each container, so if we now run <code>docker inspect &#x3C;name&#x3E;</code> we will get the same information as with the ID.</p>
</section>
<section class="section-block-markdown-cell">
<p>I run <code>docker ps -a</code> again to see the list once more.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND    CREATED         STATUS                     PORTS     NAMES
1efb51bbbf38   hello-world   &quot;/hello&quot;   2 minutes ago   Exited (0) 2 minutes ago             strange_thompson
5f5705e7603e   hello-world   &quot;/hello&quot;   2 minutes ago   Exited (0) 2 minutes ago             laughing_jang
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>And now I run <code>docker inspect &#x3C;name&#x3E;</code> to view the container information.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">inspect</span> <span class="n">strange_thompson</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[
&#x20;&#x20;&#x20;&#x20;&#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Id&quot;: &quot;1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Created&quot;: &quot;2023-09-04T03:59:17.795499354Z&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Path&quot;: &quot;/hello&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Args&quot;: [],
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;State&quot;: &#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Status&quot;: &quot;exited&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Running&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Paused&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Restarting&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;OOMKilled&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Dead&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Pid&quot;: 0,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ExitCode&quot;: 0,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Error&quot;: &quot;&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;StartedAt&quot;: &quot;2023-09-04T03:59:18.406663026Z&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;FinishedAt&quot;: &quot;2023-09-04T03:59:18.406181184Z&quot;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Image&quot;: &quot;sha256:9c7a54a9a43cca047013b82af109fe963fde787f63f9e016fdc3384500c2823d&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/resolv.conf&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/hostname&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;HostsPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/hosts&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;LogPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e-json.log&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Name&quot;: &quot;/strange_thompson&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;...
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x7D;
]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>But why don't we see any containers with <code>docker ps</code> and do see them with <code>docker ps -a</code>? This is because <code>docker ps</code> only shows the containers that are running, while <code>docker ps -a</code> shows all containers, both those that are running and those that are stopped.</p>
</section>
<section class="section-block-markdown-cell">
<p>We can create a container by assigning it a name using the command <code>docker run --name &#x3C;name&#x3E; hello-world</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">hello_world</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
&#x20;&#x20;&#x20;&#x20;(amd64)
 3. The Docker daemon created a new container from that image which runs the
&#x20;&#x20;&#x20;&#x20;executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
&#x20;&#x20;&#x20;&#x20;to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>This will be more convenient for us, as we will be able to control the names of the containers ourselves.</p>
</section>
<section class="section-block-markdown-cell">
<p>If we now want to create another container with the same name, we won't be able to, because Docker does not allow container names to be duplicated. So, if we want to rename the container, we can use the command <code>docker rename &#x3C;old name&#x3E; &#x3C;new name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rename</span> <span class="n">hello_world</span> <span class="n">hello_world2</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We now have a bunch of identical containers. So if we want to delete one, we have to use the command <code>docker rm &#x3C;id&#x3E;</code> or <code>docker rm &#x3C;name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND    CREATED         STATUS                     PORTS     NAMES
f432c9c2ca21   hello-world   &quot;/hello&quot;   9 seconds ago   Exited (0) 8 seconds ago             hello_world2
1efb51bbbf38   hello-world   &quot;/hello&quot;   4 minutes ago   Exited (0) 4 minutes ago             strange_thompson
5f5705e7603e   hello-world   &quot;/hello&quot;   4 minutes ago   Exited (0) 4 minutes ago             laughing_jang
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">hello_world2</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>hello_world2
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we look at the list of containers again, the <code>hello_world2</code> container will no longer be there.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND    CREATED         STATUS                     PORTS     NAMES
1efb51bbbf38   hello-world   &quot;/hello&quot;   5 minutes ago   Exited (0) 5 minutes ago             strange_thompson
5f5705e7603e   hello-world   &quot;/hello&quot;   5 minutes ago   Exited (0) 5 minutes ago             laughing_jang
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we want to delete all containers, we can do it one by one, but since that is very tedious, we can delete all of them using the command <code>docker container prune</code>. This command removes only stopped containers.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">container</span> <span class="n">prune</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>WARNING! This will remove all stopped containers.
Are you sure you want to continue? [y/N] y
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Docker asks if you're sure, and if you say yes, it deletes all of them. If I now list all containers, none appear.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="The interactive mode">The interactive mode<a class="anchor-link" href="#The interactive mode">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>We are going to run an Ubuntu using the command <code>docker run ubuntu</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;ubuntu:latest&#x27; locally
latest: Pulling from library/ubuntu

Digest: sha256:20fa2d7bb4de7723f542be5923b06c4d704370f0390e4ae9e1c833c8785644c1[1A
Status: Downloaded newer image for ubuntu:latest
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>As we can see, it has now taken longer to download. If we list the containers using the command <code>docker ps</code>, we see that the container we just created does not appear, meaning it is not running.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We now list all the containers</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS                     PORTS     NAMES
da16b3a85178   ubuntu    &quot;bash&quot;    4 seconds ago   Exited (0) 3 seconds ago             hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that the container status is <code>Exited (0)</code></p>
</section>
<section class="section-block-markdown-cell">
<p>If we look at the container command, it shows <code>bash</code> and alongside the status <code>Exited (0)</code>, indicating that Ubuntu has started, executed its *bash*, completed execution, and returned a 0. This happens because the Ubuntu bash was not given anything to do. To solve this, we will now run the container using the command <code>docker run -it ubuntu</code>, where <code>it</code> indicates that we want to run it in interactive mode.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@5b633e9d838f:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we see that we are inside the Ubuntu bash. If we run the command <code>cat /etc/lsb-release</code> we can see the Ubuntu distribution.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">root</span><span class="o">@</span><span class="mi">5</span><span class="n">b633e9d838f</span><span class="p">:</span><span class="o">/</span><span class="c1"># cat /etc/lsb-release</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=22.04
DISTRIB_CODENAME=jammy
DISTRIB_DESCRIPTION=&quot;Ubuntu 22.04.1 LTS&quot;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we open another terminal and check the list of containers, the Ubuntu container will now appear as running.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS         PORTS     NAMES
5b633e9d838f   ubuntu    &quot;bash&quot;    3 minutes ago   Up 3 minutes             funny_mirzakhani
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see the container with Ubuntu and in its status we can see <code>UP</code></p>
</section>
<section class="section-block-markdown-cell">
<p>If we now look at the list of all containers, we will see that both Ubuntu containers appear, the first one stopped and the second one running.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS                     PORTS     NAMES
5b633e9d838f   ubuntu    &quot;bash&quot;    3 minutes ago   Up 3 minutes                         funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;    3 minutes ago   Exited (0) 3 minutes ago             hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we go back to the terminal where we had Ubuntu running inside a Docker container, if we type <code>exit</code> we will exit Ubuntu.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">root</span><span class="o">@</span><span class="mi">5</span><span class="n">b633e9d838f</span><span class="p">:</span><span class="o">/</span><span class="c1"># exit</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>exit
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we run <code>docker ps</code> the container no longer appears</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>But if I run <code>docker ps -a</code> it does appear. This means that the container has stopped.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS                      PORTS     NAMES
5b633e9d838f   ubuntu    &quot;bash&quot;    4 minutes ago   Exited (0) 27 seconds ago             funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;    4 minutes ago   Exited (0) 4 minutes ago              hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>This happens because when we type <code>exit</code>, we are actually typing it in the Ubuntu bash console, which means we are ending the Ubuntu bash process.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Container Lifecycle">Container Lifecycle<a class="anchor-link" href="#Container Lifecycle">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>In Docker, when the main process of a container ends, the container shuts down. Multiple processes can run inside a container, but the container only stops when the main process terminates.</p>
<p>Therefore, if we want to run a container that does not stop when a process finishes, we must ensure that its main process does not terminate. In this case, that bash does not exit.</p>
<p>If we want to run a container with Ubuntu, but prevent it from exiting when the Bash process finishes, we can do it as follows</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">d</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ce4d60427dcd4b326d15aa832b816c209761d6b4e067a016bb75bf9366c37054
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>What we do is first give it the name <code>alwaysup</code>, secondly pass it the <code>-d</code> (<code>detach</code>) option so that the container runs in the background, and finally tell it the main process we want to run in the container, which in this case is <code>tail -f /dev/null</code> which is equivalent to a <code>nop</code> command.</p>
<p>This will return the container's ID, but we won't be inside Ubuntu as before.</p>
</section>
<section class="section-block-markdown-cell">
<p>If we now look at the list of running containers, the container we just created will appear.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS          PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   18 seconds ago   Up 17 seconds             alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Since we already have a container running all the time, we can connect to it using the <code>exec</code> command. We tell it the name or ID of the container and pass the process we want to run. Additionally, we pass the <code>-it</code> option to make it interactive.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">alwaysup</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@ce4d60427dcd:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we are back inside Ubuntu. If we run the command <code>ps -aux</code> we can see a list of the processes that are running inside Ubuntu.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ps</span> <span class="o">-</span><span class="n">aux</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.0  0.0   2820  1048 ?        Ss   13:04   0:00 tail -f /dev/null
root           7  0.0  0.0   4628  3796 pts/0    Ss   13:04   0:00 bash
root          15  0.0  0.0   7060  1556 pts/0    R+   13:05   0:00 ps -aux
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We only see three processes, the <code>ps -aux</code>, the <code>bash</code>, and the <code>tail -f /dev/null</code></p>
<p>This container will remain running as long as the process <code>tail -f /dev/null</code> continues to run.</p>
</section>
<section class="section-block-markdown-cell">
<p>If we exit the container with the command <code>exit</code> and run the command <code>docker ps</code>, we see that the container is still running.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">exit</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>exit
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED         STATUS         PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   2 minutes ago   Up 2 minutes             alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>To be able to complete the process and shut down the container, we must use the command <code>docker stop &#x3C;name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">stop</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we now list the running containers again, the container with Ubuntu will no longer appear.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>And if we list all the containers, the container with Ubuntu appears, and its status is <code>Exited</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                            PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   14 minutes ago   Exited (137) About a minute ago             alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                19 minutes ago   Exited (0) 15 minutes ago                   funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                20 minutes ago   Exited (0) 20 minutes ago                   hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We can also pause a container using the command <code>docker pause &#x3C;name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">d</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>8282eaf9dc3604fa94df206b2062287409cc92cbcd203f1a018742b5c171c9e4
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we pause it</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">pause</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we look at all the containers again, we see that the container with Ubuntu is paused</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                       PORTS     NAMES
8282eaf9dc36   ubuntu    &quot;tail -f /dev/null&quot;   41 seconds ago   Up 41 seconds (Paused)                 alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                19 minutes ago   Exited (0) 15 minutes ago              funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                20 minutes ago   Exited (0) 20 minutes ago              hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Single-use containers">Single-use containers<a class="anchor-link" href="#Single-use containers">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>If at the time of running a container, we put the option <code>--rm</code>, that container will be deleted when it finishes executing.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">name</span> <span class="n">autoremove</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we now see which containers we have</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that the container we just created is not there.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Exposing containers to the outside world">Exposing containers to the outside world<a class="anchor-link" href="#Exposing containers to the outside world">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Let's create a new container with a server</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">proxy</span> <span class="n">nginx</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;nginx:latest&#x27; locally
latest: Pulling from library/nginx

f1ad4ce1: Pulling fs layer 
b079d0f8: Pulling fs layer 
5fbbebc6: Pulling fs layer 
ffdd25f4: Pulling fs layer 
32c8fba2: Pulling fs layer 
24b8ba39: Pull complete 393kB/1.393kBB[5ADigest: sha256:2888a97f7c7d498bbcc47ede1ad0f6ced07d72dfd181071dde051863f1f79d7b
Status: Downloaded newer image for nginx:latest
1a530e04f14be082811b72ea8b6ea5a95dad3037301ee8a1351a0108ff8d3b30
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>This creates a server, let's list the containers that are running</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND                  CREATED        STATUS                  PORTS     NAMES
1a530e04f14b   nginx     &quot;/docker-entrypoint.…&quot;   1 second ago   Up Less than a second   80/tcp    proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now a new column appears with the port, and it tells us that the server we just created is on port <code>80</code> under the <code>tcp</code> protocol.</p>
<p>If we open a browser and try to connect to the server using <code>http://localhost:80</code>, we won't be able to connect. This is because each container has its own network interface. In other words, the server is listening on port <code>80</code> of the container, but we are trying to connect to port <code>80</code> of the host.</p>
</section>
<section class="section-block-markdown-cell">
<p>We stop the container to relaunch it in a different way</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">stop</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we list the containers, it is not running</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We delete it to recreate it</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we list all the containers, it is no longer there.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                       PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   19 minutes ago   Exited (137) 5 minutes ago             alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                24 minutes ago   Exited (0) 20 minutes ago              funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                24 minutes ago   Exited (0) 24 minutes ago              hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>To recreate the container with the server and be able to see it from the host, we need to use the <code>-p</code> (<code>publish</code>) option, specifying first the port where we want to see it on the host and then the container's port, i.e., <code>-p &#x3C;host ip&#x3E;:&#x3C;container ip&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">proxy</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span><span class="p">:</span><span class="mi">80</span> <span class="n">nginx</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>c199235e42f76a30266f6e1af972e0a59811806eb3d3a9afdd873f6fa1785eae
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We list the containers</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                   NAMES
c199235e42f7   nginx     &quot;/docker-entrypoint.…&quot;   22 seconds ago   Up 21 seconds   0.0.0.0:8080-&amp;gt;80/tcp, :::8080-&amp;gt;80/tcp   proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that the container port is <code>0.0.0.0:8080-&#x3E;80/tcp</code>. If we now go to a browser and enter <code>0.0.0.0:8080</code>, we will be able to access the container's server.</p>
</section>
<section class="section-block-markdown-cell">
<p>When listing the containers, in the <code>PORTS</code> column it shows <code>0.0.0.0:8080-&#x3E;80/tcp</code>, which helps us see the port mapping relationship.</p>
</section>
<section class="section-block-markdown-cell">
<p>To view the container logs, using the command <code>docker logs &#x3C;name&#x3E;</code> I can see the container logs.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">logs</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2022/09/13 13:24:06 [notice] 1#1: using the &quot;epoll&quot; event method
2022/09/13 13:24:06 [notice] 1#1: nginx/1.23.1
2022/09/13 13:24:06 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6) 
2022/09/13 13:24:06 [notice] 1#1: OS: Linux 5.15.0-46-generic
2022/09/13 13:24:06 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2022/09/13 13:24:06 [notice] 1#1: start worker processes
2022/09/13 13:24:06 [notice] 1#1: start worker process 31
2022/09/13 13:24:06 [notice] 1#1: start worker process 32
2022/09/13 13:24:06 [notice] 1#1: start worker process 33
2022/09/13 13:24:06 [notice] 1#1: start worker process 34
2022/09/13 13:24:06 [notice] 1#1: start worker process 35
2022/09/13 13:24:06 [notice] 1#1: start worker process 36
2022/09/13 13:24:06 [notice] 1#1: start worker process 37
2022/09/13 13:24:06 [notice] 1#1: start worker process 38
2022/09/13 13:24:06 [notice] 1#1: start worker process 39
2022/09/13 13:24:06 [notice] 1#1: start worker process 40
2022/09/13 13:24:06 [notice] 1#1: start worker process 41
...
172.17.0.1 - - [13/Sep/2022:13:24:40 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://0.0.0.0:8080/&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\xE2\x19V$Zqi&#x27;\xD7\xFC[\x80\xEF\xBA\xE5\xC7\xE8\xF7&amp;amp;3nS\xEB\xC9\xEC\x91\xC2\xD8\xD1\x89\x9E\xBE \xC7?\xE1\xFA\x04a\x1C\xCE\x90\x0F\x8F\x98u\xE3/\xD8RfOH\xEC\x92+\x93\x5C\xBB\xB1\xBF\xD2m\xB09\x00 \xFA\xFA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03)\x9A\x8FbC\xD9m\xF1\x86\xEBd\x22\xCF\xC4E\x87#~L\xC1\x84\x7F\xB5\x91k\x98\xABl\xEE\x1E[0 \xD0\xD2`\x85\xC6\x8B\x85R\x8B\x87\xEAq&#x7B;P\xF2\xFB\xE2\xA8\x9DI\xF4tH\x99\x13\x10~\xCA1-|\x8E\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:26:28 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now I can see all the requests that have been made to the server. But if I want to view the logs in real time, I can do so with <code>docker logs -f &#x3C;name&#x3E;</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now I can see the logs in real time. To exit, press <code>CTRL+C</code></p>
</section>
<section class="section-block-markdown-cell">
<p>As there can come a time when there are many logs, if you only want the latest logs, with the option <code>--tail &#x3C;num&#x3E;</code> you can view the last <code>&#x3C;num&#x3E;</code> logs. If I add the option <code>-f</code>, we will always be seeing the last <code>&#x3C;num&#x3E;</code> logs.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">logs</span> <span class="o">--</span><span class="n">tail</span> <span class="mi">10</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>2022/09/13 13:24:06 [notice] 1#1: start worker process 41
2022/09/13 13:24:06 [notice] 1#1: start worker process 42
172.17.0.1 - - [13/Sep/2022:13:24:16 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\x01E\x14\x8E\xB6\x0BEg\xF3\xC9\x9A\x19\x9C\xCA\xEC\xA7y#3\x92\x05\x95\xDCQ\x07\x19\x1D\xEF\xEA$\xBF# \x0B\x83\xF7-,s\x1B!r\xEA|\xAE\xDF\xA1\x9DLZ\xAA4y\xB3t\xAB\xC0\xCE_\xB8\xE7\xFF&#x27;\xCF\x86\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x8A\x8A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:24:16 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03&#x7D;\xA9Dr&#x7B;\x8C;\x90z\x82\xAD\xBC\x8Az\xC2x\xDF\x1E\x9A\xE6l?\xA7\xE0DoK\x91&#x27;g\xBB\xB5 %\xBB\xFD\xD9\x82?\xDB\x80\xB3T\xF6cJ\xF7\xE5\xC2\xD2\x11\xBC\xA2\x1F\x90\x14\xA3\xEB\xBD=R\xBC\x83\x89\x85\x00 \xCA\xCA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:24:39 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
2022/09/13 13:24:40 [error] 34#34: *3 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 172.17.0.1, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;0.0.0.0:8080&quot;, referrer: &quot;http://0.0.0.0:8080/&quot;
172.17.0.1 - - [13/Sep/2022:13:24:40 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://0.0.0.0:8080/&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\xE2\x19V$Zqi&#x27;\xD7\xFC[\x80\xEF\xBA\xE5\xC7\xE8\xF7&amp;amp;3nS\xEB\xC9\xEC\x91\xC2\xD8\xD1\x89\x9E\xBE \xC7?\xE1\xFA\x04a\x1C\xCE\x90\x0F\x8F\x98u\xE3/\xD8RfOH\xEC\x92+\x93\x5C\xBB\xB1\xBF\xD2m\xB09\x00 \xFA\xFA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03)\x9A\x8FbC\xD9m\xF1\x86\xEBd\x22\xCF\xC4E\x87#~L\xC1\x84\x7F\xB5\x91k\x98\xABl\xEE\x1E[0 \xD0\xD2`\x85\xC6\x8B\x85R\x8B\x87\xEAq&#x7B;P\xF2\xFB\xE2\xA8\x9DI\xF4tH\x99\x13\x10~\xCA1-|\x8E\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:26:28 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we add the <code>-t</code> option, we can see the date and time of each log, so if we have had a problem, we can know when it occurred.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">logs</span> <span class="o">--</span><span class="n">tail</span> <span class="o">-</span><span class="n">t</span> <span class="mi">10</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>2022-09-13T13:24:06.573362728Z 2022/09/13 13:24:06 [notice] 1#1: start worker process 41
2022-09-13T13:24:06.651127107Z 2022/09/13 13:24:06 [notice] 1#1: start worker process 42
2022-09-13T13:24:16.651160189Z 172.17.0.1 - - [13/Sep/2022:13:24:16 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\x01E\x14\x8E\xB6\x0BEg\xF3\xC9\x9A\x19\x9C\xCA\xEC\xA7y#3\x92\x05\x95\xDCQ\x07\x19\x1D\xEF\xEA$\xBF# \x0B\x83\xF7-,s\x1B!r\xEA|\xAE\xDF\xA1\x9DLZ\xAA4y\xB3t\xAB\xC0\xCE_\xB8\xE7\xFF&#x27;\xCF\x86\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x8A\x8A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
2022-09-13T13:24:16.116817914Z 172.17.0.1 - - [13/Sep/2022:13:24:16 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03&#x7D;\xA9Dr&#x7B;\x8C;\x90z\x82\xAD\xBC\x8Az\xC2x\xDF\x1E\x9A\xE6l?\xA7\xE0DoK\x91&#x27;g\xBB\xB5 %\xBB\xFD\xD9\x82?\xDB\x80\xB3T\xF6cJ\xF7\xE5\xC2\xD2\x11\xBC\xA2\x1F\x90\x14\xA3\xEB\xBD=R\xBC\x83\x89\x85\x00 \xCA\xCA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
2022-09-13T13:24:39.117398081Z 172.17.0.1 - - [13/Sep/2022:13:24:39 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
2022-09-13T13:24:39.117412408Z 2022/09/13 13:24:40 [error] 34#34: *3 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 172.17.0.1, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;0.0.0.0:8080&quot;, referrer: &quot;http://0.0.0.0:8080/&quot;
2022-09-13T13:24:40.117419389Z 172.17.0.1 - - [13/Sep/2022:13:24:40 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://0.0.0.0:8080/&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
2022-09-13T13:25:00.117434249Z 172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\xE2\x19V$Zqi&#x27;\xD7\xFC[\x80\xEF\xBA\xE5\xC7\xE8\xF7&amp;amp;3nS\xEB\xC9\xEC\x91\xC2\xD8\xD1\x89\x9E\xBE \xC7?\xE1\xFA\x04a\x1C\xCE\x90\x0F\x8F\x98u\xE3/\xD8RfOH\xEC\x92+\x93\x5C\xBB\xB1\xBF\xD2m\xB09\x00 \xFA\xFA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
2022-09-13T13:25:00.223560881Z 172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03)\x9A\x8FbC\xD9m\xF1\x86\xEBd\x22\xCF\xC4E\x87#~L\xC1\x84\x7F\xB5\x91k\x98\xABl\xEE\x1E[0 \xD0\xD2`\x85\xC6\x8B\x85R\x8B\x87\xEAq&#x7B;P\xF2\xFB\xE2\xA8\x9DI\xF4tH\x99\x13\x10~\xCA1-|\x8E\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
2022-09-13T13:26:25.223596738Z 172.17.0.1 - - [13/Sep/2022:13:26:28 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We stop and delete the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                        PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   26 minutes ago   Exited (137) 13 minutes ago             alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                31 minutes ago   Exited (0) 27 minutes ago               funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                32 minutes ago   Exited (0) 32 minutes ago               hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Data in Docker">Data in Docker<a class="anchor-link" href="#Data in Docker">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Bind mounts">Bind mounts<a class="anchor-link" href="#Bind mounts">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Let's check the stopped containers we have.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                        PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   26 minutes ago   Exited (137) 13 minutes ago             alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                31 minutes ago   Exited (0) 28 minutes ago               funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                32 minutes ago   Exited (0) 32 minutes ago               hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's delete the two from Ubuntu where their main command is Bash and keep the one we left as no operation.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">funny_mirzakhani</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>funny_mirzakhani
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">hardcore_kare</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                        PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   27 minutes ago   Exited (137) 14 minutes ago             alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We are going to restart the Ubuntu container that we left running, this is done using the <code>start</code> command.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">start</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We dive into it again.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">alwaysup</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@ce4d60427dcd:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>In the container, I can create a new folder called <code>dockerfolder</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerfolder</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we list the files, the new folder will appear</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bin  boot  dev  dockerfolder  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we exit the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">exit</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>exit
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>And we delete it</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we list all the containers, the last one we created no longer appears.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's do everything again, but first we will create a folder on the host where we will share the data with the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that the folder is empty.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we get our absolute path</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">pwd</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>/home/wallabot/Documentos/web/portafolio/posts
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We recreate the container but add the <code>-v</code> option (<code>bind mount</code>). Next, we add the absolute path of the folder on the host and the absolute path of the folder in the container, <code>-v &#x3C;host path&#x3E;:&#x3C;container path&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>4ede4512c293bdcc155e9c8e874dfb4a28e5163f4d5c7ddda24ad2863f28921b
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We enter the container, list the files, and the folder we created already appears.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">alwaysup</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@4ede4512c293:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">root</span><span class="o">@</span><span class="mi">4</span><span class="n">ede4512c293</span><span class="p">:</span><span class="o">/</span><span class="c1"># ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bin   dev                    etc   lib    lib64   media  opt   root  sbin  sys  usr
boot  dockerContainerFolder  home  lib32  libx32  mnt    proc  run   srv   tmp  var
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's go to the container directory that we have shared, create a file, and exit the container.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">root</span><span class="o">@</span><span class="mi">4</span><span class="n">ede4512c293</span><span class="p">:</span><span class="o">/</span><span class="c1"># cd dockerContainerFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">root</span><span class="o">@</span><span class="mi">4</span><span class="n">ede4512c293</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span><span class="c1"># touch bindFile.txt</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">root</span><span class="o">@</span><span class="mi">4</span><span class="n">ede4512c293</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span><span class="c1"># exit</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>exit
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's see what's inside the shared folder</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>But more than that, if we delete the container, the file is still there.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If I recreate the container sharing the folders, all files will be in the container.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>6c021d37ea29d8b23fe5cd4968baa446085ae1756682f65340288b4c851c362d
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">alwaysup</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@6c021d37ea29:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">root</span><span class="o">@</span><span class="mi">6</span><span class="n">c021d37ea29</span><span class="p">:</span><span class="o">/</span><span class="c1"># ls dockerContainerFolder/</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We remove the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Volumes">Volumes<a class="anchor-link" href="#Volumes">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Volumes were created as an evolution of <code>bind mounts</code> to provide more security. We can list all Docker volumes using <code>docker volume ls</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>DRIVER    VOLUME NAME
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's create a new volume for the Ubuntu container, for this we use the command <code>docker volume create &#x3C;volume name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">volume</span> <span class="n">create</span> <span class="n">ubuntuVolume</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ubuntuVolume
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we list the volumes again, the one we just created will appear.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>DRIVER    VOLUME NAME
local     ubuntuVolume
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>However, it does not appear as a folder in the host's file system. With <code>ls -d */</code> we list all the folders</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="o">-</span><span class="n">d</span> <span class="o">*/</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockerHostFolder/  __pycache__/
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's recreate a container, but this time we create it with the volume we just created using the <code>--mount</code> option, specifying the source volume with <code>src=&#x3C;volume name&#x3E;</code> (if the volume did not exist, Docker would create it), followed by the destination separated by a <code>,</code>, <code>dst=&#x3C;container path&#x3E;</code>, i.e., <code>--mount src=&#x3C;volume name&#x3E;,dst=&#x3C;container path&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">--</span><span class="n">mount</span> <span class="n">src</span><span class="o">=</span><span class="n">ubuntuVolume</span><span class="p">,</span><span class="n">dst</span><span class="o">=/</span><span class="n">dockerVolumeFolder</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>42cdcddf4e46dc298a87b0570115e0b2fc900cb4c6db5eea22a61409b8cb271d
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Once created, we can view the container's volumes using the <code>inspect</code> command and filtering by <code>&#x27;{{.Mounts}}&#x27;</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker inspect --format &#39;&#123;&#123;.Mounts&#125;&#125;&#39; alwaysup<br>[<br>&#123;<br>volume ubuntuVolume /var/lib/docker/volumes/ubuntuVolume/_data /dockerVolumeFolder local z true<br>It seems like you&#39;ve provided an incomplete or incorrect Markdown structure. Please provide the full Markdown text for translation.<br>]</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>We see that the volume is called <code>ubuntuVolume</code> and we can also see the path where it is stored, in this case at <code>/var/lib/docker/volumes/ubuntuVolume/_data</code>. We do the same as before, enter the container, create a file in the volume's path, exit, and check on the host if it has been created.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it alwaysup bash<br>root@42cdcddf4e46:/# touch dockerVolumeFolder/volumeFile.txt<br>root@42cdcddf4e46:/# exit</code></pre></div>
      </section>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ sudo ls /var/lib/docker/volumes/ubuntuVolume/_data<br>volumeFile.txt</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>The file is created</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Insert and extract files from a container">Insert and extract files from a container<a class="anchor-link" href="#Insert and extract files from a container">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>First, let's create a file that we want to copy into a container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We enter the container</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it alwaysup bash<br>root@42cdcddf4e46:/#</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>We create a new folder where we are going to copy the file and exit</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@42cdcddf4e46:/# mkdir folderToCopy<br>root@42cdcddf4e46:/# ls<br>bin  boot  dev  dockerVolumeFolder  etc  folderToCopy  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  varroot@42cdcddf4e46:/# exit<br>exit</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>We copy the file into the container using the <code>cp</code> command, specifying the file I **want** to copy, the container where we want to copy it, and the path inside the container, <code>docker cp &#x3C;file&#x3E; &#x3C;container&#x3E;:&#x3C;container path&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">cp</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span> <span class="n">alwaysup</span><span class="p">:</span><span class="o">/</span><span class="n">folderToCopy</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We go back into the container and check that the file is there.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it alwaysup bash<br>root@42cdcddf4e46:/# ls folderToCopy/It seems like you&#39;re referring to a file named `text.txt`. However, the content of the file is not provided here. Could you please share the content of the file so I can translate it for you?</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>We exit the container</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">/# exit<br>exit</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Now we are going to extract the file from the container and save it on the host with a different name. For this, we use the <code>cp</code> command again, but now specifying the container, the file path in the container, and the path and name we want the file to have on the host, <code>docker cp &#x3C;container&#x3E;:&#x3C;docker file path&#x3E; &#x3C;host file path&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">cp</span> <span class="n">alwaysup</span><span class="p">:</span><span class="o">/</span><span class="n">folderToCopy</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">fileExtract</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that it is on the host</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt  fileExtract.txt  text.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Although the container is stopped, files can still be copied.</p>
</section>
<section class="section-block-markdown-cell">
<p>Finally, we delete the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Images">Images<a class="anchor-link" href="#Images">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Fundamental Concepts">Fundamental Concepts<a class="anchor-link" href="#Fundamental Concepts">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Images are the files ("templates") with all the configuration to create a container. Every time we create a container, it is created from an image. When we created new containers for the first time, a message appeared saying that we did not have the image and that it was going to download it. On Docker Hub, there are numerous images of all kinds of machines, but for a very specific development environment, we can create our own template to pass it on to someone so they can work in a container with the same configuration as ours.</p>
</section>
<section class="section-block-markdown-cell">
<p>We can see all the images we have saved on our computer using the command <code>docker image ls</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
nginx         latest    2d389e545974   8 hours ago     142MB
ubuntu        latest    2dc39ba059dc   11 days ago     77.8MB
hello-world   latest    feb5d9fea6a5   11 months ago   13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We can see the sizes, and we can see how the <code>nginx</code> one takes up a lot of space, which is why it took longer to download than the others.</p>
</section>
<section class="section-block-markdown-cell">
<p>Another column we can see is the <code>TAG</code> one, which indicates the version of the image. In all cases, it says <code>latest</code>, meaning it is the latest version. That is, when we download it, we have downloaded the latest version available on Docker Hub. This is not optimal in a development environment because we might download an Ubuntu image without specifying a version, for example, 20.04. But after some time, someone else may want to develop with you and download that image, but since they don't specify the version, they will download the latest one again, which could be 22.04 in their case. This can lead to issues where things work for one person but not for another.</p>
</section>
<section class="section-block-markdown-cell">
<p>We can see all the images available on Docker Hub by going to <code>https://hub.docker.com/</code>. There you can search for the image that best fits the project you want to work on. If we navigate to the Ubuntu image, for example, we can see the versions (<code>tags</code>) of the images.</p>
</section>
<section class="section-block-markdown-cell">
<p>We are going to download, **but not execute** an image. For this, we use the command <code>docker pull &#x3C;hub&#x3E; &#x3C;image name&#x3E;:&#x3C;tag&#x3E;</code>. If we do not specify the hub, it will download from docker hub by default, but we can specify another one, for example a private one from our organization. Also, if we do not specify the tag, it will download the latest version by default.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">pull</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">20.04</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>20.04: Pulling from library/ubuntu

Digest: sha256:35ab2bf57814e9ff49e365efd5a5935b6915eede5c7f8581e9e1b85e0eecbe16[1A
Status: Downloaded newer image for ubuntu:20.04
docker.io/library/ubuntu:20.04
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we list the images again, we see that we now have two Ubuntu images, one with the tag <code>20.04</code> and another with the tag <code>latest</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
nginx         latest    2d389e545974   8 hours ago     142MB
ubuntu        latest    2dc39ba059dc   11 days ago     77.8MB
ubuntu        20.04     a0ce5a295b63   11 days ago     72.8MB
hello-world   latest    feb5d9fea6a5   11 months ago   13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Creating images using Dockerfile">Creating images using <code>Dockerfile</code><a class="anchor-link" href="#Creating images using Dockerfile">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>We create a directory on the host called <code>dockerImages</code> to work in it.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We create a <code>Dockerfile</code> with which we will create an image</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerImages</span><span class="o">/</span><span class="n">Dockerfile</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We open the created file with our preferred editor and write the following:</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu:latest
</code></pre></div>
<p>This tells Docker to create the image based on the <code>latest</code> image of Ubuntu</p>
</section>
<section class="section-block-markdown-cell">
<p>Below, we write a command that will be executed at compile time</p>
<div class='highlight'><pre><code class="language-Dockerfile">RUN touch /test.txt
</code></pre></div>
<p>This means that when the <code>Dockerfile</code> is built, that command will be executed, but not when the container of the image is run.</p>
</section>
<section class="section-block-markdown-cell">
<p>At the end, the <code>Dockerfile</code> looks like this:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile">FROM ubuntu:latest<br>RUN touch /test.txt</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>We compile the <code>Dockerfile</code> using the <code>build</code> command, with the <code>-t</code> option we can give it a <code>tag</code>. Finally, we need to specify the path of the <code>build</code> context, which we will explain later.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/2 : FROM ubuntu:latest
 ---&amp;gt; 2dc39ba059dc
Step 2/2 : RUN touch /test.txt
 ---&amp;gt; Using cache
 ---&amp;gt; a78cf3ea16d8
Successfully built a78cf3ea16d8
Successfully tagged ubuntu:test

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>As we can see, it compiles in 2 steps, each one has an <code>id</code>, each of these <code>id</code>s are layers of the image, we will also see this later.</p>
<p>We go back to see the images we have saved on our computer and the one we just created appears.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
ubuntu        test      a78cf3ea16d8   8 minutes ago   77.8MB
nginx         latest    2d389e545974   8 hours ago     142MB
ubuntu        latest    2dc39ba059dc   11 days ago     77.8MB
ubuntu        20.04     a0ce5a295b63   11 days ago     72.8MB
hello-world   latest    feb5d9fea6a5   11 months ago   13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We run the container from the image we just created</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker run -it ubuntu:test<br>root@b57b9d4eedeb:/#</code></pre></div>
      </section>
<p>We enter the bash of the container. As we said, the RUN command is executed at image build time, so the file that we have asked to be created should be in our container.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@b57b9d4eedeb:/# ls<br>bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  test.txt  tmp  usr  var</code></pre></div>
      </section>
<p>It is important to understand that this file was created when the image was built, that is, the container image already has this file. It is not created when the container is launched.</p>
<p>We exit the container</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@b57b9d4eedeb:/# exit<br>exit</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Since we already have an image, we could upload it to the Docker hub, but let's list the images again before doing that.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY    TAG       IMAGE ID       CREATED          SIZE
ubuntu        test      a78cf3ea16d8   20 minutes ago   77.8MB
nginx         latest    2d389e545974   8 hours ago      142MB
ubuntu        latest    2dc39ba059dc   11 days ago      77.8MB
ubuntu        20.04     a0ce5a295b63   11 days ago      72.8MB
hello-world   latest    feb5d9fea6a5   11 months ago    13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we look, it is telling us that the image we just created belongs to the ubuntu repository, but we do not have access to the ubuntu repository, so we need to create an account on Docker Hub to be able to upload the image to our own repository. In my case, my repository is called <code>maximofn</code>, so I change the repository of the image using the <code>tag</code> command, specifying the image we want to change and the new repository. The new repository usually indicates the name of the repository followed by the type of image and the tag, in my case <code>maximofn/ubuntu:test</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">tag</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we now list the images again</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY        TAG       IMAGE ID       CREATED          SIZE
ubuntu            test      a78cf3ea16d8   24 minutes ago   77.8MB
maximofn/ubuntu   test      a78cf3ea16d8   24 minutes ago   77.8MB
nginx             latest    2d389e545974   8 hours ago      142MB
ubuntu            latest    2dc39ba059dc   11 days ago      77.8MB
ubuntu            20.04     a0ce5a295b63   11 days ago      72.8MB
hello-world       latest    feb5d9fea6a5   11 months ago    13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we need to log in to Docker Hub to be able to upload the image, for this we use the <code>login</code> command.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker login<br>Login with your Docker ID to push and pull images from Docker Hub. If you do not have a Docker ID, head over to https://hub.docker.com to create one.<br>Username: maximofn<br>Password:<br><br>Login succeeded</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Now we can upload the image using the <code>push</code> command</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">push</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The push refers to repository [docker.io/maximofn/ubuntu]

06994357: Preparing 
06994357: Pushed  from library/ubuntu test: digest: sha256:318d83fc3c35ff930d695b0dc1c5ad1b0ea54e1ec6e3478b8ca85c05fd793c4e size: 735
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>He uploaded only the first layer, the second one, since I used it based on the Ubuntu image, what it does is place a pointer to that image so that layers are not uploaded more than once.</p>
</section>
<section class="section-block-markdown-cell">
<p>It's important to keep in mind that this repository is public, so you should not upload images with sensitive data. Additionally, if an image is not used within 6 months, it will be deleted.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="The layer system">The layer system<a class="anchor-link" href="#The layer system">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Using the <code>history</code> command we can see the layers of an image. If we look at the layers of the image we just created, we use <code>docker history ubuntu:test</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">history</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>IMAGE          CREATED        CREATED BY                                      SIZE      COMMENT
a78cf3ea16d8   3 minutes ago  /bin/sh -c touch /test.txt                      0B        
2dc39ba059dc   12 days ago    /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B        
&amp;lt;missing&amp;gt;      12 days ago    /bin/sh -c #(nop) ADD file:a7268f82a86219801…   77.8MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that the first layer has the command we introduced in the <code>Dockerfile</code>, and it says it was created 3 minutes ago. However, the rest of the layers were created 12 days ago, and they are the layers of the Ubuntu image we based ourselves on.</p>
</section>
<section class="section-block-markdown-cell">
<p>To the <code>Dockerfile</code> we created earlier, we add the line</p>
<div class='highlight'><pre><code class="language-docker">RUN rm /test.txt
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>At the end, the <code>Dockerfile</code> looks like this:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile">FROM ubuntu:latest<br>RUN touch /test.txtRUN rm /test.txt</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>If we compile again, let's see what happens</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM ubuntu:latest
 ---&amp;gt; 2dc39ba059dc
Step 2/3 : RUN touch /test.txt
 ---&amp;gt; Using cache
 ---&amp;gt; a78cf3ea16d8
Step 3/3 : RUN rm /test.txt
 ---&amp;gt; Running in c2e6887f2025
Removing intermediate container c2e6887f2025
 ---&amp;gt; 313243a9b573
Successfully built 313243a9b573
Successfully tagged ubuntu:test

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>As we can see, there is an additional layer with the new line we have added. If we look at the image layers again with <code>history</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">history</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>IMAGE          CREATED              CREATED BY                                      SIZE      COMMENT
313243a9b573   About a minute ago   /bin/sh -c rm /test.txt                         0B        
a78cf3ea16d8   3 minutes ago        /bin/sh -c touch /test.txt                      0B        
2dc39ba059dc   12 days ago          /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B        
&amp;lt;missing&amp;gt;      12 days ago          /bin/sh -c #(nop) ADD file:a7268f82a86219801…   77.8MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that the first layers are the same as before and it has added a new layer with the new command</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Search on Docker Hub">Search on Docker Hub<a class="anchor-link" href="#Search on Docker Hub">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>There's no need to go to the Docker Hub page to search for images; you can do it from the terminal. For this, we use the command <code>docker search &#x3C;image name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">search</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>NAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
ubuntu                           Ubuntu is a Debian-based Linux operating sys…   16425     [OK]       
websphere-liberty                WebSphere Liberty multi-architecture images …   297       [OK]       
open-liberty                     Open Liberty multi-architecture images based…   62        [OK]       
neurodebian                      NeuroDebian provides neuroscience research s…   104       [OK]       
ubuntu-debootstrap               DEPRECATED; use &quot;ubuntu&quot; instead                52        [OK]       
ubuntu-upstart                   DEPRECATED, as is Upstart (find other proces…   115       [OK]       
ubuntu/nginx                     Nginx, a high-performance reverse proxy &amp;amp; we…   98                   
ubuntu/squid                     Squid is a caching proxy for the Web. Long-t…   66                   
ubuntu/cortex                    Cortex provides storage for Prometheus. Long…   4                    
ubuntu/apache2                   Apache, a secure &amp;amp; extensible open-source HT…   60                   
ubuntu/kafka                     Apache Kafka, a distributed event streaming …   35                   
ubuntu/mysql                     MySQL open source fast, stable, multi-thread…   53                   
ubuntu/bind9                     BIND 9 is a very flexible, full-featured DNS…   62                   
ubuntu/prometheus                Prometheus is a systems and service monitori…   51                   
ubuntu/zookeeper                 ZooKeeper maintains configuration informatio…   12                   
ubuntu/postgres                  PostgreSQL is an open source object-relation…   31                   
ubuntu/redis                     Redis, an open source key-value store. Long-…   19                   
ubuntu/grafana                   Grafana, a feature rich metrics dashboard &amp;amp; …   9                    
ubuntu/memcached                 Memcached, in-memory keyvalue store for smal…   5                    
ubuntu/dotnet-aspnet             Chiselled Ubuntu runtime image for ASP.NET a…   11                   
ubuntu/dotnet-deps               Chiselled Ubuntu for self-contained .NET &amp;amp; A…   11                   
ubuntu/prometheus-alertmanager   Alertmanager handles client alerts from Prom…   9                    
ubuntu/dotnet-runtime            Chiselled Ubuntu runtime image for .NET apps…   10                   
ubuntu/cassandra                 Cassandra, an open source NoSQL distributed …   2                    
ubuntu/telegraf                  Telegraf collects, processes, aggregates &amp;amp; w…   4
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Using Docker to Create Applications">Using Docker to Create Applications<a class="anchor-link" href="#Using Docker to Create Applications">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Port Exposure">Port Exposure<a class="anchor-link" href="#Port Exposure">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>We previously saw how we could link a container port to a computer port (<code>-p 8080:80</code>). But for that to be possible, when creating the image, the port must be exposed. This is done by adding the line <code>EXPOSE &#x3C;port&#x3E;</code> to the Dockerfile, as in the previous case.</p>
<div class='highlight'><pre><code class="language-docker">EXPOSE 80
</code></pre></div>
<p>Or use images as a base that already have exposed ports</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Layer Cache Reuse When Building">Layer Cache Reuse When Building<a class="anchor-link" href="#Layer Cache Reuse When Building">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>When we compile an image, if any of the layers we have defined have already been compiled before, Docker detects this and uses them, without recompiling them. If we recompile the image we have defined in the <code>Dockerfile</code> now, it will take very little time because all the layers are already compiled and Docker does not recompile them.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM ubuntu:latest
 ---&amp;gt; 2dc39ba059dc
Step 2/3 : RUN touch /test.txt
 ---&amp;gt; Using cache
 ---&amp;gt; a78cf3ea16d8
Step 3/3 : RUN rm /test.txt
 ---&amp;gt; Using cache
 ---&amp;gt; 313243a9b573
Successfully built 313243a9b573
Successfully tagged ubuntu:test

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>In the second and third layer, the text <code>Using cache</code> appears.</p>
<p>Since this is a Jupyter notebook, when you run the cells it gives you information about how long they take to execute. The last time I compiled the image, it took 1.4 seconds, while now it has taken 0.5 seconds.</p>
</section>
<section class="section-block-markdown-cell">
<p>But if I now change the Dockerfile, and in the first line, where it said we were based on the latest version of Ubuntu, we change to version 20.04</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:20.04
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>At the end, the <code>Dockerfile</code> looks like this:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile">FROM ubuntu:20.04<br>RUN touch /test.txtRUN rm /test.txt</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>If we compile again, it will take much longer.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM ubuntu:20.04
 ---&amp;gt; a0ce5a295b63
Step 2/3 : RUN touch /test.txt
 ---&amp;gt; Running in a40fe8df2c0d
Removing intermediate container a40fe8df2c0d
 ---&amp;gt; 0bb9b452c11f
Step 3/3 : RUN rm /test.txt
 ---&amp;gt; Running in 2e14919f3685
Removing intermediate container 2e14919f3685
 ---&amp;gt; fdc248fa833b
Successfully built fdc248fa833b
Successfully tagged ubuntu:test

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>It took 1.9 seconds and the text <code>Using cache</code> no longer appears.</p>
</section>
<section class="section-block-markdown-cell">
<p>When changing the first layer, Docker recompiles all layers. This can be a problem because when developing code, the following case may occur:</p>
<ul>
  <li>We developed the code on our computer</li>
  <li>When building the image, we copy all the code from our computer to the container</li>
  <li>Then we ask the image to install the necessary libraries</li>
</ul>
<p>This can cause that when changing any part of the code, having to recompile the image, the layer where the libraries are installed will have to be recompiled, since a previous layer has changed.</p>
</section>
<section class="section-block-markdown-cell">
<p>To solve this, the idea would be that when creating the image, we first request that the libraries be installed and then copy the code from our computer to the container. This way, every time we change the code and recompile the image, only the layer where the code is copied will be recompiled, making the compilation faster.</p>
</section>
<section class="section-block-markdown-cell">
<p>You might think it's better to share a folder between the host and the container (<code>bind mount</code>) where we will have the code, so there's no need to rebuild the image every time the code changes. And the answer is that you're right; I only used this example because it's very easy to understand, but it's meant to illustrate that when creating images, you should think carefully so that if you do need to rebuild it, it recompiles the minimum number of layers.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Writing a Correct Dockerfile">Writing a Correct Dockerfile<a class="anchor-link" href="#Writing a Correct Dockerfile">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>As we have seen, Docker does not recompile layers of a Dockerfile if it has already compiled them before, so it loads them from cache. Let's see how the correct way to write a Dockerfile should be to take advantage of this.</p>
</section>
<section class="section-block-markdown-cell">
<p>Let's start from this Dockerfile to comment on possible corrections</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu
COPY ./sourceCode /sourceCode
RUN apt-get update
RUN apt-get install -y python3 sshCMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
<p>As can be seen, it starts with an Ubuntu image, the folder with the code is copied, the repositories are updated, Python is installed, SSH is also installed, and the application is run.</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="Copy the code before execution">Copy the code before execution<a class="anchor-link" href="#Copy the code before execution">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>As we said before, if we first copy the code and then install Python, every time we make a change to the code and build the image, it will build the entire image. But if we copy the code after installing Python, every time we change the code and build the image, it will only build from the code copy and will not reinstall Python, so the Dockerfile should be changed to this:</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu
RUN apt-get update
RUN apt-get install -y python3 sshCOPY ./sourceCode /sourceCode
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Copy only the necessary code">Copy only the necessary code<a class="anchor-link" href="#Copy only the necessary code">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>We are copying the folder with all the code, but perhaps inside we have code that we don't need, so we need to copy only the code that we really need for the application, this way the image will take up less memory. So the Dockerfile would look like this</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu
RUN apt-get update
RUN apt-get install -y python3 sshCOPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Update repositories and install Python in the same line">Update repositories and install Python in the same line<a class="anchor-link" href="#Update repositories and install Python in the same line">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>We are updating the repositories in one line and installing python3 in another.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu
RUN apt-get update &amp;&amp; apt-get install -y python3 ssh
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Do not install ssh">Do not install ssh<a class="anchor-link" href="#Do not install ssh">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>We had installed ssh in the image to be able to debug if needed, but that makes the image take up more memory. If we need to debug, we should enter the container, install ssh, and then debug. Therefore, we remove the installation of ssh.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu
RUN apt-get update &amp;&amp; apt-get install -y python3
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Use --no-install-recommends">Use <code>--no-install-recommends</code><a class="anchor-link" href="#Use --no-install-recommends">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>When we install something in Ubuntu, it installs recommended packages that we don't need, so the image takes up more space. Therefore, to avoid this, we add <code>--no-install-recommends</code> to the installation.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu
RUN apt-get update &amp;&amp; apt-get install -y python3 --no-install-recommends
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Delete list of updated repositories">Delete list of updated repositories<a class="anchor-link" href="#Delete list of updated repositories">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>We have updated the list of repositories and installed python, but once that's done we no longer need the updated repository list, as it will only make the image larger, so we remove them after installing python and in the same line.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu
RUN apt-get update &amp;&amp; apt-get install -y python3 --no-install-recommends &amp;&amp; rm -rf /var/lib/apt/lists/*
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Use a Python image">Use a Python image<a class="anchor-link" href="#Use a Python image">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Everything we have done to update the package list and install Python is not necessary, as there are already Python images based on Ubuntu that have likely followed good practices, possibly even better than what we would do ourselves, and have been scanned for vulnerabilities by Docker Hub. Therefore, we remove all of that and start from a Python image.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python
COPY ./sourceCode/sourceApp /sourceCode/sourceAppCMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Specify the Python image">Specify the Python image<a class="anchor-link" href="#Specify the Python image">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>If the Python image is not specified, the latest one is being downloaded, but depending on when you build the container, a different version might be downloaded. Therefore, you should add the tag with the desired Python version.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18
COPY ./sourceCode/sourceApp /sourceCode/sourceAppCMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Choose a small tag">Choose a small tag<a class="anchor-link" href="#Choose a small tag">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>We have chosen the tag <code>3.9.18</code>, but that version of Python has a lot of libraries that we might not need, so we can use the <code>3.9.18-slim</code> versions which have many fewer installed libraries, or the <code>3.9.18-alpine</code> version which is a Python version on Alpine and not on Ubuntu. Alpine is a very lightweight Linux distribution with very few packages installed and is often used in Docker containers to take up very little space.</p>
<p>The <code>3.9.18</code> Python image takes up 997 MB, the <code>3.9.18-slim</code> takes up 126 MB, and the <code>3.9.18-alpine</code> takes up 47.8 MB.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Specify the workspace">Specify the workspace<a class="anchor-link" href="#Specify the workspace">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Instead of specifying the image path as <code>/sourceCode/sourceApp</code>, we set this path to be the image's workspace. This way, when we copy the code or run the application, there is no need to specify the path.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
WORKDIR /sourceCode/sourceApp
COPY ./sourceCode/sourceApp .
CMD ["python3", "app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Specify the workspace">Specify the workspace<a class="anchor-link" href="#Specify the workspace">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Instead of specifying the image path as <code>/sourceCode/sourceApp</code>, we set this path to be the image's workspace. This way, when we copy the code or run the application, there is no need to specify the path.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
WORKDIR /sourceCode/sourceApp
COPY ./sourceCode/sourceApp .
CMD ["python3", "app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Code shared in a bind mount folder">Code shared in a <code>bind mount</code> folder<a class="anchor-link" href="#Code shared in a bind mount folder">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>We had created a folder called <code>dockerHostFolder</code> in which we had shared files between the host and a container. Inside, there should also be three files.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt  fileExtract.txt  text.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's use the <code>text.txt</code> file to check that out. Let's see what's inside <code>text.txt</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cat</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>There is no output, the file is empty. Let's create an Ubuntu container again, sharing the folder <code>dockerHostFolder</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>24adbded61f507cdf7f192eb5e246e43ee3ffafc9944b7c57918eb2d547dff19
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that the container is running</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS          PORTS     NAMES
24adbded61f5   ubuntu    &quot;tail -f /dev/null&quot;   16 seconds ago   Up 15 seconds             alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We enter the container, we see that <code>text.txt</code> is there and it is empty</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it alwaysup bash<br>root@24adbded61f5:/# ls dockerContainerFolder/<br>bindFile.txt  fileExtract.txt  text.txt<br>root@24adbded61f5:/# cat dockerContainerFolder/text.txt<br>root@24adbded61f5:/#</code></pre></div>
      </section>
<p>Now we open the <code>text.txt</code> file on the host with the text editor of our choice, write <code>Hello world</code> and save it. If we now check what's inside the file in the container, we will see the same text.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@24adbded61f5:/# cat dockerContainerFolder/text.txt<br>Hello world</code></pre></div>
      </section>
<p>Now we edit the file in the container and exit the container</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@24adbded61f5:/# echo hello container &gt; dockerContainerFolder/text.txt<br>root@24adbded61f5:/# cat dockerContainerFolder/text.txt<br>hello container<br>root@24adbded61f5:/# exit<br>exit</code></pre></div>
      </section>
<p>If we look at the file in the host, we will see the text we wrote in the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cat</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>hola contenedor
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We delete the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Connecting containers via network">Connecting containers via network<a class="anchor-link" href="#Connecting containers via network">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>If we want to have several containers running and want them to communicate, we can make them communicate through a network. Docker gives us the possibility to do this through its virtual networks.</p>
</section>
<section class="section-block-markdown-cell">
<p>Let's see what networks Docker has with the command <code>docker network ls</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>NETWORK ID     NAME      DRIVER    SCOPE
de6e8b7b737e   bridge    bridge    local
da1f5f6fccc0   host      host      local
d3b0d93993c0   none      null      local
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that by default Docker has three networks</p>
<ul>
  <li>bridge: It's for backward compatibility with previous versions, but we shouldn't use it anymore</li>
  <li>host: It is the host's network</li>
  <li>none: This is the option we should use if we want a container to have no internet access</li>
</ul>
</section>
<section class="section-block-markdown-cell">
<p>We can create new networks to which other containers can connect, for this we use the command <code>docker network create &#x3C;name&#x3E;</code>, in addition, for other containers to be able to connect, we must add the option <code>--attachable</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="o">--</span><span class="n">attachable</span> <span class="n">myNetwork</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>2f6f3ddbfa8642e9f6819aa0965c16339e9e910be7bcf56ebb718fcac324cc27
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We can inspect it using the command <code>docker network inspect &#x3C;name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">inspect</span> <span class="n">myNetwork</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[
&#x20;&#x20;&#x20;&#x20;&#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Name&quot;: &quot;myNetwork&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Id&quot;: &quot;2f6f3ddbfa8642e9f6819aa0965c16339e9e910be7bcf56ebb718fcac324cc27&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Created&quot;: &quot;2022-09-14T15:20:08.539830161+02:00&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Scope&quot;: &quot;local&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Driver&quot;: &quot;bridge&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;EnableIPv6&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;IPAM&quot;: &#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Driver&quot;: &quot;default&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Options&quot;: &#x7B;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Config&quot;: [
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Subnet&quot;: &quot;172.18.0.0/16&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Gateway&quot;: &quot;172.18.0.1&quot;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;]
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Internal&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Attachable&quot;: true,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Ingress&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ConfigFrom&quot;: &#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Network&quot;: &quot;&quot;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ConfigOnly&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Containers&quot;: &#x7B;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Options&quot;: &#x7B;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Labels&quot;: &#x7B;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x7D;
]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we need to create two containers so they can communicate.</p>
</section>
<section class="section-block-markdown-cell">
<p>Let's create a new container, which we will call <code>container1</code>, with a shared folder that will be called <code>folder1</code> inside it.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">container1</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">folder1</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>a5fca8ba1e4ff0a67002f8f1b8cc3cd43185373c2a7e295546f774059ad8dd1a
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we create another container, called <code>container2</code>, with another shared folder, but it should be named <code>folder2</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">container2</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">folder2</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>6c8dc18315488ef686f7548516c19b3d716728dd8a173cdb889ec0dd082232f9
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see the containers running and we see that both are there.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED         STATUS         PORTS     NAMES
6c8dc1831548   ubuntu    &quot;tail -f /dev/null&quot;   3 seconds ago   Up 2 seconds             container2
a5fca8ba1e4f   ubuntu    &quot;tail -f /dev/null&quot;   4 seconds ago   Up 3 seconds             container1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we need to connect the containers to the network, for this we use the command <code>docker network connect &#x3C;network name&#x3E; &#x3C;container name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">connect</span> <span class="n">myNetwork</span> <span class="n">container1</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">connect</span> <span class="n">myNetwork</span> <span class="n">container2</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>To check that they have connected correctly, we can inspect the network, but filtering by the connected containers.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker network inspect --format &#39;&#123;&#123;.Containers&#125;&#125;&#39; myNetwork<br>map<br>[<br>6c8dc18315488ef686f7548516c19b3d716728dd8a173cdb889ec0dd082232f9:<br>&#123;<br>container2<br>This appears to be a SHA-256 hash, which is not translatable. If you intended to provide markdown text for translation, please provide the actual text content instead of a hash value.<br>02:42:ac:12:00:03<br>172.18.0.3/16<br>&#125;<br>a5fca8ba1e4ff0a67002f8f1b8cc3cd43185373c2a7e295546f774059ad8dd1a:<br>&#123;<br>container1<br>This does not appear to be Markdown text, but rather a hash or unique identifier. If you intended to provide Markdown content for translation, please share the appropriate text.<br>02:42:ac:12:00:02<br>172.18.0.2/16<br>It seems like there was an issue with the input you provided. Could you please provide the Markdown text you would like to be translated?<br>]</code></pre></div>
      </section>
<p>As we can see, the container <code>container1</code> has the IP <code>172.18.0.2</code> and the container <code>container2</code> has the IP <code>172.18.0.3</code></p>
</section>
<section class="section-block-markdown-cell">
<p>We get inside the container <code>container1</code> and install <code>ping</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it container1 bash<br>root@a5fca8ba1e4f:/# apt update<br>...<br>root@a5fca8ba1e4f:/# apt install iputils-ping<br>...<br>root@a5fca8ba1e4f:/#</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>We get inside the container <code>container2</code> and install <code>ping</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it container2 bash<br>root@a5fca8ba1e4f:/# apt update<br>...<br>root@a5fca8ba1e4f:/# apt install iputils-ping<br>...<br>root@a5fca8ba1e4f:/#</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Now from the container <code>container1</code> we ping the IP <code>172.18.0.3</code>, which belongs to the container <code>container2</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@a5fca8ba1e4f:/# ping 172.18.0.3<br>PING 172.18.0.3 (172.18.0.3) 56(84) bytes of data.<br>64 bytes from 172.18.0.3: icmp_seq=1 ttl=64 time=0.115 ms<br>64 bytes from 172.18.0.3: icmp_seq=2 ttl=64 time=0.049 ms<br>64 bytes from 172.18.0.3: icmp_seq=3 ttl=64 time=0.056 ms<br>64 bytes from 172.18.0.3: icmp_seq=4 ttl=64 time=0.060 ms<br>^C<br>--- 172.18.0.3 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3068ms<br>rtt min/avg/max/mdev = 0.049/0.070/0.115/0.026 ms</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>And from the container <code>container2</code> we make a ping to the IP <code>172.18.0.2</code>, which belongs to the container <code>container1</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@6c8dc1831548:/# ping 172.18.0.2<br>PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.<br>64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.076 ms<br>64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.045 ms<br>64 bytes from 172.18.0.2: icmp_seq=3 ttl=64 time=0.049 ms<br>64 bytes from 172.18.0.2: icmp_seq=4 ttl=64 time=0.051 ms<br>^C<br>--- 172.18.0.2 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3074ms<br>rtt min/avg/max/mdev = 0.045/0.055/0.076/0.012 ms</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>But there is something better that Docker allows us to do: if I don't know the IP of the container I want to connect to, instead of writing its IP, I can write its name.</p>
</section>
<section class="section-block-markdown-cell">
<p>Now from the container <code>container1</code> we ping the IP of <code>container2</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@a5fca8ba1e4f:/# ping container2<br>PING container2 (172.18.0.3) 56(84) bytes of data.<br>64 bytes from container2.myNetwork (172.18.0.3): icmp_seq=1 ttl=64 time=0.048 ms<br>64 bytes from container2.myNetwork (172.18.0.3): icmp_seq=2 ttl=64 time=0.050 ms<br>64 bytes from container2.myNetwork (172.18.0.3): icmp_seq=3 ttl=64 time=0.052 ms<br>64 bytes from container2.myNetwork (172.18.0.3): icmp_seq=4 ttl=64 time=0.053 ms<br>^C<br>--- container2 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3071ms<br>rtt min/avg/max/mdev = 0.048/0.050/0.053/0.002 ms</code></pre></div>
      </section>
<p>As we can see, Docker knows that the IP of the container <code>container2</code> is <code>172.18.0.3</code></p>
</section>
<section class="section-block-markdown-cell">
<p>And from the container <code>container2</code> we make a ping to the IP of <code>container1</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@6c8dc1831548:/# ping container1<br>PING container1 (172.18.0.2) 56(84) bytes of data.<br>64 bytes from container1.myNetwork (172.18.0.2): icmp_seq=1 ttl=64 time=0.051 ms<br>64 bytes from container1.myNetwork (172.18.0.2): icmp_seq=2 ttl=64 time=0.058 ms<br>64 bytes from container1.myNetwork (172.18.0.2): icmp_seq=3 ttl=64 time=0.052 ms<br>64 bytes from container1.myNetwork (172.18.0.2): icmp_seq=4 ttl=64 time=0.056 ms<br>^C<br>--- container1 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3057ms<br>rtt min/avg/max/mdev = 0.051/0.054/0.058/0.003 ms</code></pre></div>
      </section>
<p>As we can see, Docker knows that the IP of the container <code>container1</code> is <code>172.18.0.2</code></p>
</section>
<section class="section-block-markdown-cell">
<p>We exit the containers and delete them</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">container1</span> <span class="n">container2</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>container1
container2
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We also delete the network we have created</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">rm</span> <span class="n">myNetwork</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>myNetwork
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Use of GPUs">Use of GPUs<a class="anchor-link" href="#Use of GPUs">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>To be able to use the host's GPUs within Docker containers, it is necessary to follow the steps described in the installation page of the <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">Nvidia container toolkit</a></p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Set up the repository and the GPG key">Set up the repository and the GPG key<a class="anchor-link" href="#Set up the repository and the GPG key">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>We need to configure the <code>nvidia container toolkit</code> repository and the GPG key, for this we run the following command in the console</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \<br>&amp;&amp; curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \<br>&amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \sed &#39;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#39; | \<br>sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<h3 id="Installation of nvidia container toolkit">Installation of <code>nvidia container toolkit</code><a class="anchor-link" href="#Installation of nvidia container toolkit">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Once we have updated the repository and the key, we update the repositories using the command</p>
<div class='highlight'><pre><code class="language-bash">sudo apt update
</code></pre></div>
<p>And we install <code>nvidia container toolkit</code></p>
<div class='highlight'><pre><code class="language-bash">sudo apt install -y nvidia-docker2
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker Reset">Docker Reset<a class="anchor-link" href="#Docker Reset">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Once we have finished, we need to restart the Docker daemon by</p>
<div class='highlight'><pre><code class="language-bash">sudo systemctl restart docker
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Use of GPUs">Use of GPUs<a class="anchor-link" href="#Use of GPUs">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Now that we have configured Docker to use the host's GPUs within containers, we can test it using the <code>--gpus all</code> option. If you have more than one GPU and only want to use one, you would need to specify it, but for now, here we only explain how to use all of them.</p>
</section>
<section class="section-block-markdown-cell">
<p>We create a container that will not run in the background, but instead it will execute the command <code>nvidia-smi</code> so we can see if it has access to the GPUs.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">container_gpus</span> <span class="o">--</span><span class="n">gpus</span> <span class="nb">all</span> <span class="n">ubuntu</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;ubuntu:latest&#x27; locally
latest: Pulling from library/ubuntu

6a12be2b: Pull complete .54MB/29.54MBBDigest: sha256:aabed3296a3d45cede1dc866a24476c4d7e093aa806263c27ddaadbdce3c1054
Status: Downloaded newer image for ubuntu:latest
Mon Sep  4 07:10:36 2023       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 510.39.01    Driver Version: 510.39.01    CUDA Version: 11.6     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Quadro T1000        On   | 00000000:01:00.0 Off |                  N/A |
| N/A   44C    P0    15W /  N/A |      9MiB /  4096MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|    0   N/A  N/A      2545      G                                       4MiB |
|    0   N/A  N/A      3421      G                                       4MiB |
+-----------------------------------------------------------------------------+
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We delete the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">doker</span> <span class="n">rm</span> <span class="n">container_gpus</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Docker compose">Docker compose<a class="anchor-link" href="#Docker compose">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose vs docker-compose">Docker compose vs docker-compose<a class="anchor-link" href="#Docker compose vs docker-compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p><code>docker-compose</code> was a tool created to help with the maintenance of images and containers, and it had to be installed separately from Docker. However, Docker incorporated it into its latest versions, so it is no longer necessary to install it separately. Nevertheless, to use it, instead of using the <code>docker-compose</code> command, you need to use the <code>docker compose</code> command. You will find information with <code>docker-compose</code> in many places, but when you install Docker, <code>docker compose</code> will be installed by default, so everything that could be done with <code>docker-compose</code> is compatible with <code>docker compose</code>.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose">Docker compose<a class="anchor-link" href="#Docker compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Docker Compose is a Docker tool that does everything we've seen so far, but saves us time and effort. By editing a <code>.yml</code> file, we can tell Docker Compose to create all the containers we want.</p>
<p>There won't be much difference in writing all the commands we saw before or writing the <code>.yml</code> file for a one-time use, but when you want to have the same container configuration running again, just by calling the <code>.yml</code> file, it will recreate the entire setup.</p>
</section>
<section class="section-block-markdown-cell">
<p>Let's create a folder where we will store the Docker Compose files</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerComposeFiles</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We create the .yml file inside</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerComposeFiles</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>A Docker Compose file must start with the version</p>
<div class='highlight'><pre><code class="language-json">version: "&lt;v.v&gt;"
</code></pre></div>
<p>At the time of writing this, the latest version is <code>3.8</code>, so we write that.</p>
</section>
<section class="section-block-markdown-cell">
<p>*docker-compose.yml*:</p>
<div class='highlight'><pre><code class="language-json">version: "3.8"
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>The following are the services, which are the containers. In each service, you must specify the image, and additionally, you can add other parameters such as ports, environment variables, etc.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">services:<br>container1:<br>image: ubuntu<br>    <br>container2:<br>image: ubuntu</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>The <code>docker-compose.yml</code> would look like this:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">version: "3.8"<br><br>services:<br>container1:<br>image: ubuntu    <br>container2:<br>image: ubuntu</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Once we have created the file, in its path, we can run everything using the command <code>docker compose up</code>, but by adding the option <code>-d</code> we will make it run in the background.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 1/0
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠋ Container dockercomposefiles-container2-1  Creating                     0.0s
 ⠋ Container dockercomposefiles-container1-1  Creating                     0.0s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠙ Container dockercomposefiles-container2-1  Creating                     0.1s
 ⠙ Container dockercomposefiles-container1-1  Creating                     0.1s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.2s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.2s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.3s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.3s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.4s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.4s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.5s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.5s
[+] Running 2/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Started                      0.5s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.6s
[+] Running 3/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Started                      0.5s
 ⠿ Container dockercomposefiles-container1-1  Started                      0.7s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we look, it has created two containers <code>dockercomposefiles-container1-1</code> and <code>dockercomposefiles-container2-1</code> and the network that connects them <code>dockercomposefiles_default</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Let's delete the two containers</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">dockercomposefiles</span><span class="o">-</span><span class="n">container1</span><span class="o">-</span><span class="mi">1</span> <span class="n">dockercomposefiles</span><span class="o">-</span><span class="n">container2</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container1-1
dockercomposefiles-container2-1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>And we delete the network that has been created</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">rm</span> <span class="n">dockercomposefiles_default</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles_default
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's try to do what we did before with what we know so far. We'll create a new image that comes with <code>ping</code> installed.</p>
<p>*Dockerfile*:</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:20.04
RUN apt update
RUN apt install iputils-ping -y
</code></pre></div>
<p>And we compile it</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM ubuntu:20.04
 ---&amp;gt; a0ce5a295b63
Step 2/3 : RUN apt update
 ---&amp;gt; Running in 3bd5278d39b4

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Get:1 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]
Get:2 http://archive.ubuntu.com/ubuntu focal InRelease [265 kB]
Get:3 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [898 kB]
Get:4 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]
Get:5 http://archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]
Get:6 http://archive.ubuntu.com/ubuntu focal/universe amd64 Packages [11.3 MB]
Get:7 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [2133 kB]
Get:8 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [27.5 kB]
Get:9 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [1501 kB]
Get:10 http://archive.ubuntu.com/ubuntu focal/main amd64 Packages [1275 kB]
Get:11 http://archive.ubuntu.com/ubuntu focal/restricted amd64 Packages [33.4 kB]
Get:12 http://archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [177 kB]
Get:13 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [2594 kB]
Get:14 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [1613 kB]
Get:15 http://archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [30.2 kB]
Get:16 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [1200 kB]
Get:17 http://archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [27.4 kB]
...
Successfully built c3d32aa9de02
Successfully tagged ubuntu:ping

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We check that it has been created</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY        TAG       IMAGE ID       CREATED              SIZE
ubuntu            ping      c3d32aa9de02   About a minute ago   112MB
maximofn/ubuntu   test      a78cf3ea16d8   25 hours ago         77.8MB
nginx             latest    2d389e545974   33 hours ago         142MB
ubuntu            latest    2dc39ba059dc   12 days ago          77.8MB
ubuntu            20.04     a0ce5a295b63   12 days ago          72.8MB
hello-world       latest    feb5d9fea6a5   11 months ago        13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We changed the tag</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">tag</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY        TAG       IMAGE ID       CREATED              SIZE
ubuntu            ping      c3d32aa9de02   About a minute ago   112MB
maximofn/ubuntu   ping      c3d32aa9de02   About a minute ago   112MB
maximofn/ubuntu   test      c3d32aa9de02   About a minute ago   112MB
nginx             latest    2d389e545974   33 hours ago         142MB
ubuntu            latest    2dc39ba059dc   12 days ago          77.8MB
ubuntu            20.04     a0ce5a295b63   12 days ago          72.8MB
hello-world       latest    feb5d9fea6a5   11 months ago        13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We edit the Docker Compose file to use the images we just created</p>
<p>*docker-compose.yml*:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">version: "3.8"<br><br>services:<br>container1:<br>image: maximofn/ubuntu:ping<br><br>container2:<br>image: maximofn/ubuntu:ping</code></pre></div>
      </section>
<p>And we also tell it to execute a no-operation</p>
<p>The <code>docker-compose.yml</code> would look like this:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">version: "3.8"<br><br>services:<br>container1:<br>image: ubuntu<br>command: tail -f /dev/null<br><br>container2:<br>image: ubuntu<br>command: tail -f /dev/null</code></pre></div>
      </section>
<p>We lift it up</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 0/0
 ⠋ Container dockercomposefiles-container1-1  Recreate                     0.1s
 ⠋ Container dockercomposefiles-container2-1  Recreate                     0.1s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠙ Container dockercomposefiles-container2-1  Recreate                     0.2s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠹ Container dockercomposefiles-container2-1  Recreate                     0.3s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠸ Container dockercomposefiles-container2-1  Recreate                     0.4s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠼ Container dockercomposefiles-container2-1  Recreate                     0.5s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠴ Container dockercomposefiles-container2-1  Recreate                     0.6s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠦ Container dockercomposefiles-container2-1  Recreate                     0.7s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠧ Container dockercomposefiles-container2-1  Recreate                     0.8s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠇ Container dockercomposefiles-container2-1  Recreate                     0.9s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠏ Container dockercomposefiles-container2-1  Recreate                     1.0s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠋ Container dockercomposefiles-container2-1  Recreate                     1.1s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠙ Container dockercomposefiles-container2-1  Recreate                     1.2s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠹ Container dockercomposefiles-container2-1  Recreate                     1.3s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠸ Container dockercomposefiles-container2-1  Recreate                     1.4s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
...
[+] Running 2/2
 ⠿ Container dockercomposefiles-container1-1  Started                     10.8s
 ⠿ Container dockercomposefiles-container2-1  Started                     10.9s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container1-1  Started                     10.8s
 ⠿ Container dockercomposefiles-container2-1  Started                     10.9s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see the containers that are running</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE                  COMMAND               CREATED          STATUS          PORTS     NAMES
935939e5a75d   maximofn/ubuntu:ping   &quot;tail -f /dev/null&quot;   15 seconds ago   Up 13 seconds             dockercomposefiles-container2-1
f9138d7064dd   maximofn/ubuntu:ping   &quot;tail -f /dev/null&quot;   25 seconds ago   Up 13 seconds             dockercomposefiles-container1-1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Both containers are running, now let's get into one and try to do a <code>ping</code> to the other.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it dockercomposefiles-container1-1 bash<br>root@f9138d7064dd:/# ping dockercomposefiles-container2-1<br>PING dockercomposefiles-container2-1 (172.21.0.3) 56(84) bytes of data.<br>64 bytes from dockercomposefiles-container2-1.dockercomposefiles_default (172.21.0.3): icmp_seq=1 ttl=64 time=0.110 ms<br>64 bytes from dockercomposefiles-container2-1.dockercomposefiles_default (172.21.0.3): icmp_seq=2 ttl=64 time=0.049 ms<br>64 bytes from dockercomposefiles-container2-1.dockercomposefiles_default (172.21.0.3): icmp_seq=3 ttl=64 time=0.049 ms<br>64 bytes from dockercomposefiles-container2-1.dockercomposefiles_default (172.21.0.3): icmp_seq=4 ttl=64 time=0.075 ms^C<br>--- dockercomposefiles-container2-1 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3068ms<br>rtt min/avg/max/mdev = 0.049/0.070/0.110/0.025 ms</code></pre></div>
      </section>
<p>As we can see, we can perform <code>ping</code>, we have successfully created the image with <code>ping</code> installed. Additionally, in the docker-compose, we have set it to execute a no-operation so that the containers keep running.</p>
</section>
<section class="section-block-markdown-cell">
<p>We delete the two containers and the network we have created</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">dockercomposefiles</span><span class="o">-</span><span class="n">container1</span><span class="o">-</span><span class="mi">1</span> <span class="n">dockercomposefiles</span><span class="o">-</span><span class="n">container2</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container1-1
dockercomposefiles-container2-1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">rm</span> <span class="n">dockercomposefiles_default</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles_default
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="How Docker Compose Names Containers">How Docker Compose Names Containers<a class="anchor-link" href="#How Docker Compose Names Containers">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>If we look closely, the containers created by Docker are called <code>dockercomposefiles-container1-1</code> and <code>dockercomposefiles-container2-1</code>. This is because the folder containing the Docker Compose file is named <code>dockerComposeFiles</code>, hence the first part of the container names is <code>dockercomposefiles</code>. Following that, it shows the service name we provided in the Docker Compose file (<code>container1</code> and <code>container2</code>), and finally a number to allow for more to be created if necessary.</p>
<p>The same applies to the network name that has been created <code>dockercomposefiles_default</code></p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Logs in docker compose">Logs in docker compose<a class="anchor-link" href="#Logs in docker compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Now let's change the Docker Compose file, in the lines where we had <code>command: tail -f /dev/null</code>, we will put <code>command: ping 0.0.0.0</code></p>
<p>And we also tell it to execute a no-operation</p>
<p>The <code>docker-compose.yml</code> would look like this:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">version: "3.8"<br><br>services:<br>container1:<br>image: ubuntu<br>command: ping 0.0.0.0<br><br>container2:<br>image: ubuntu<br>command: ping 0.0.0.0</code></pre></div>
      </section>
<p>We do this so that each container is constantly spitting out the ping, thus simulating some logs.</p>
<p>If we run the docker-compose again</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 0/0
 ⠋ Container dockercomposefiles-container1-1  Recreate                     0.1s
 ⠋ Container dockercomposefiles-container2-1  Recreate                     0.1s
[+] Running 0/2
 ⠙ Container dockercomposefiles-container1-1  Recreate                     0.2s
 ⠙ Container dockercomposefiles-container2-1  Recreate                     0.2s
[+] Running 0/2
 ⠹ Container dockercomposefiles-container1-1  Recreate                     0.3s
 ⠹ Container dockercomposefiles-container2-1  Recreate                     0.3s
[+] Running 0/2
 ⠸ Container dockercomposefiles-container1-1  Recreate                     0.4s
 ⠸ Container dockercomposefiles-container2-1  Recreate                     0.4s
[+] Running 0/2
 ⠼ Container dockercomposefiles-container1-1  Recreate                     0.5s
 ⠼ Container dockercomposefiles-container2-1  Recreate                     0.5s
[+] Running 0/2
 ⠴ Container dockercomposefiles-container1-1  Recreate                     0.6s
 ⠴ Container dockercomposefiles-container2-1  Recreate                     0.6s
[+] Running 0/2
 ⠦ Container dockercomposefiles-container1-1  Recreate                     0.7s
 ⠦ Container dockercomposefiles-container2-1  Recreate                     0.7s
[+] Running 0/2
 ⠧ Container dockercomposefiles-container1-1  Recreate                     0.8s
 ⠧ Container dockercomposefiles-container2-1  Recreate                     0.8s
[+] Running 0/2
...
 ⠿ Container dockercomposefiles-container1-1  Starting                    11.0s
 ⠿ Container dockercomposefiles-container2-1  Started                     11.0s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container1-1  Started                     11.1s
 ⠿ Container dockercomposefiles-container2-1  Started                     11.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we can see the logs of the two containers using the command <code>docker compose logs</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">logs</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container2-1  | PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.042 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.025 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.022 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.030 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.021 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.021 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.030 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=8 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=9 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=10 ttl=64 time=0.026 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=11 ttl=64 time=0.028 ms
dockercomposefiles-container1-1  | PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=12 ttl=64 time=0.027 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=13 ttl=64 time=0.039 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=14 ttl=64 time=0.035 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=15 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=16 ttl=64 time=0.036 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=17 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=18 ttl=64 time=0.036 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=19 ttl=64 time=0.032 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=20 ttl=64 time=0.032 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=21 ttl=64 time=0.033 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=22 ttl=64 time=0.034 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.037 ms
...
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=214 ttl=64 time=0.015 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=215 ttl=64 time=0.021 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=216 ttl=64 time=0.020 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=217 ttl=64 time=0.049 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>As we can see, we can view the logs of both containers, but if we want to view only those of one, we can specify the **service name**.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">logs</span> <span class="n">container1</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container1-1  | PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.037 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.025 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.023 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.031 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.034 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.033 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.034 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=8 ttl=64 time=0.022 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=9 ttl=64 time=0.032 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=10 ttl=64 time=0.029 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=11 ttl=64 time=0.031 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=12 ttl=64 time=0.024 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=13 ttl=64 time=0.029 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=14 ttl=64 time=0.032 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=15 ttl=64 time=0.033 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=16 ttl=64 time=0.034 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=17 ttl=64 time=0.028 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=18 ttl=64 time=0.034 ms
...
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=332 ttl=64 time=0.027 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=333 ttl=64 time=0.030 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=334 ttl=64 time=0.033 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=335 ttl=64 time=0.036 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">logs</span> <span class="n">container2</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container2-1  | PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.042 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.025 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.022 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.030 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.021 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.021 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.030 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=8 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=9 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=10 ttl=64 time=0.026 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=11 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=12 ttl=64 time=0.027 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=13 ttl=64 time=0.039 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=14 ttl=64 time=0.035 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=15 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=16 ttl=64 time=0.036 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=17 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=18 ttl=64 time=0.036 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=19 ttl=64 time=0.032 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=20 ttl=64 time=0.032 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=21 ttl=64 time=0.033 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=22 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=23 ttl=64 time=0.035 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=24 ttl=64 time=0.037 ms
...
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=340 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=341 ttl=64 time=0.033 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=342 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=343 ttl=64 time=0.036 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we want to view the logs continuously, we can add the <code>-f</code> option: <code>docker compose logs -f &#x3C;service name&#x3E;</code></p>
</section>
<section class="section-block-markdown-cell">
<p>If I have created a docker compose with more than two services, when you want to view the logs of several services, you just need to add more names to the command, <code>docker compose logs &#x3C;name service 1&#x3E; &#x3C;name service 2&#x3E; ...</code></p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Exec services">Exec services<a class="anchor-link" href="#Exec services">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>As we have seen, using the <code>exec</code> command we can enter a container by specifying the container name, the command to be executed, and the <code>-it</code> option. With Docker Compose, this is simpler, as only the service name and the command are required, without the need for the <code>-it</code> option since Docker Compose assumes it.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker compose exec container1 bash<br>root@a7cf282fe66c:/#</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<h3 id="Stopping docker compose">Stopping docker compose<a class="anchor-link" href="#Stopping docker compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>When we have finished working, with a single command (<code>stop</code>), Docker Compose stops everything, there's no need to stop each container one by one.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">stop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 0/0
 ⠋ Container dockercomposefiles-container2-1  Stopping                     0.1s
 ⠋ Container dockercomposefiles-container1-1  Stopping                     0.1s
[+] Running 0/2
 ⠙ Container dockercomposefiles-container2-1  Stopping                     0.2s
 ⠙ Container dockercomposefiles-container1-1  Stopping                     0.2s
[+] Running 0/2
 ⠹ Container dockercomposefiles-container2-1  Stopping                     0.3s
 ⠹ Container dockercomposefiles-container1-1  Stopping                     0.3s
[+] Running 0/2
 ⠸ Container dockercomposefiles-container2-1  Stopping                     0.4s
 ⠸ Container dockercomposefiles-container1-1  Stopping                     0.4s
[+] Running 0/2
 ⠼ Container dockercomposefiles-container2-1  Stopping                     0.5s
 ⠼ Container dockercomposefiles-container1-1  Stopping                     0.5s
[+] Running 0/2
 ⠴ Container dockercomposefiles-container2-1  Stopping                     0.6s
 ⠴ Container dockercomposefiles-container1-1  Stopping                     0.6s
[+] Running 0/2
 ⠦ Container dockercomposefiles-container2-1  Stopping                     0.7s
 ⠦ Container dockercomposefiles-container1-1  Stopping                     0.7s
[+] Running 0/2
 ⠧ Container dockercomposefiles-container2-1  Stopping                     0.8s
 ⠧ Container dockercomposefiles-container1-1  Stopping                     0.8s
...
[+] Running 1/2
 ⠿ Container dockercomposefiles-container2-1  Stopped                     10.4s
 ⠸ Container dockercomposefiles-container1-1  Stopping                    10.4s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container2-1  Stopped                     10.4s
 ⠿ Container dockercomposefiles-container1-1  Stopped                     10.4s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>As can be seen, Docker Compose has stopped the two containers, but it has not deleted them, nor has it deleted the network.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE                  COMMAND          CREATED          STATUS                        PORTS     NAMES
1e6c1dd9adb2   maximofn/ubuntu:ping   &quot;ping 0.0.0.0&quot;   16 minutes ago   Exited (137) 25 seconds ago             dockercomposefiles-container2-1
a7cf282fe66c   maximofn/ubuntu:ping   &quot;ping 0.0.0.0&quot;   16 minutes ago   Exited (137) 25 seconds ago             dockercomposefiles-container1-1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>NETWORK ID     NAME                         DRIVER    SCOPE
13cc632147f3   bridge                       bridge    local
d4a2f718cd83   dockercomposefiles_default   bridge    local
da1f5f6fccc0   host                         host      local
d3b0d93993c0   none                         null      local
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker Compose as a Development Tool">Docker Compose as a Development Tool<a class="anchor-link" href="#Docker Compose as a Development Tool">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Just like we saw before, to be able to develop, it would be ideal to share the folder that contains the code with the service. This is done in Docker Compose by adding the <code>volumes</code> label to the docker-compose file. First, we need to add the path of the folder where the code is located on the host and then the path inside the container.</p>
<p>*docker-compose.yml*:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">version: "3.8"<br><br>services:<br>container1:<br>image: ubuntu<br>command: ping 0.0.0.0<br>volumes:<br>- ../dockerHostFolder/:/dockerContainerFolder<br><br>container2:<br>image: ubuntu<br>command: ping 0.0.0.0</code></pre></div>
      </section>
<p>As can be seen, the host folder path has been set as relative.</p>
<p>If we bring up the Docker Compose</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 1/0
 ⠋ Container dockercomposefiles-container1-1  Recreate                     0.1s
 ⠿ Container dockercomposefiles-container2-1  Created                      0.0s
[+] Running 0/2
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.2s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.2s
[+] Running 0/2
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.3s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.3s
[+] Running 0/2
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.4s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.4s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Started                      0.5s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.5s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container1-1  Started                      0.5s
 ⠿ Container dockercomposefiles-container2-1  Started                      0.6s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we enter the container, we can see what is inside the file text.txt</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker compose exec container1 bash<br>root@c8aae9d619d3:/# ls dockerContainerFolder/<br>bindFile.txt  fileExtract.txt  text.txt<br>root@c8aae9d619d3:/# cat dockerContainerFolder/text.txt<br>hello container</code></pre></div>
      </section>
<p>If we now open it on the host, write <code>hola host</code> and go back to see in the container</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@c8aae9d619d3:/# cat dockerContainerFolder/text.txt<br>hello host</code></pre></div>
      </section>
<p>And now the other way around, if we modify it in the container</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@c8aae9d619d3:/# echo hello compose &gt; dockerContainerFolder/text.txt<br>root@c8aae9d619d3:/# exit<br>exit</code></pre></div>
      </section>
<p>If we see it from the host, we should get <code>hello compose</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cat</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>hola compose
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Port Exposure in Docker Compose">Port Exposure in Docker Compose<a class="anchor-link" href="#Port Exposure in Docker Compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>We can also configure the ports in the Docker Compose file using the <code>ports</code> label, indicating the host port followed by the service IP.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">ports:<br>- &lt;host port&gt;:&lt;service port&gt;</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose in team - docker override">Docker compose in team - docker override<a class="anchor-link" href="#Docker compose in team - docker override">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>If we are a group of people developing with Docker using Docker Compose, it's likely that many people will be changing the Docker Compose file, which can lead to poor synchronization and conflicts.</p>
<p>To solve this, Docker offers a tool called Docker Override. This way, there can be a base Docker Compose file and each user can modify it through Docker Override.</p>
<p>To do this, we now need to create a file called <code>docker-compose.override.yml</code> which will be the one we can edit.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerComposeFiles</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we now try to start the Docker Compose, we will receive an error.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Top-level object must be a mapping
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>And this is because Docker Compose has detected that there is a file called <code>docker-compose.override.yml</code> and it is empty, so we are going to edit it. The <code>docker-compose.override.yml</code> file is used to override the <code>docker-compose.yml</code> file, so if for example we want to make a change in the <code>container2</code> service to add a volume, we would write the <code>docker-compose.override.yml</code> file like this:</p>
<p>*docker-compose.override.yml*:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">version: "3.8"<br><br>services:<br>container2:<br>volumes:<br>- ../dockerHostFolder/:/dockerOverrideFolder</code></pre></div>
      </section>
<p>Notice that I have named the shared folder in the service <code>dockerOverrideFolder</code>, so we are going to start the docker-compose and see if we can see that folder in the container <code>container2</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 1/0
 ⠋ Container dockercomposefiles-container2-1  Recreate                     0.1s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠙ Container dockercomposefiles-container2-1  Recreate                     0.2s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠹ Container dockercomposefiles-container2-1  Recreate                     0.3s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠸ Container dockercomposefiles-container2-1  Recreate                     0.4s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠼ Container dockercomposefiles-container2-1  Recreate                     0.5s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠴ Container dockercomposefiles-container2-1  Recreate                     0.6s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠦ Container dockercomposefiles-container2-1  Recreate                     0.7s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠧ Container dockercomposefiles-container2-1  Recreate                     0.8s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
...
[+] Running 1/2
 ⠿ Container dockercomposefiles-container2-1  Starting                    10.8s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container2-1  Started                     10.8s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that it took 10 seconds to mount the <code>container2</code> service, this is because it was applying the changes.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker compose exec container2 bash<br>root@d8777a4e611a:/# ls dockerOverrideFolder/<br>bindFile.txt  fileExtract.txt  text.txt<br>root@d8777a4e611a:/# cat dockerOverrideFolder/text.txthello compose<br>root@d8777a4e611a:/# exit<br>exit</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>We bring down the Compose and delete the containers and the network created</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">down</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 0/0
 ⠋ Container dockercomposefiles-container2-1  Stopping                     0.1s
 ⠋ Container dockercomposefiles-container1-1  Stopping                     0.1s
[+] Running 0/2
 ⠙ Container dockercomposefiles-container2-1  Stopping                     0.2s
 ⠙ Container dockercomposefiles-container1-1  Stopping                     0.2s
[+] Running 0/2
 ⠹ Container dockercomposefiles-container2-1  Stopping                     0.3s
 ⠹ Container dockercomposefiles-container1-1  Stopping                     0.3s
[+] Running 0/2
 ⠸ Container dockercomposefiles-container2-1  Stopping                     0.4s
 ⠸ Container dockercomposefiles-container1-1  Stopping                     0.4s
[+] Running 0/2
 ⠼ Container dockercomposefiles-container2-1  Stopping                     0.5s
 ⠼ Container dockercomposefiles-container1-1  Stopping                     0.5s
[+] Running 0/2
 ⠴ Container dockercomposefiles-container2-1  Stopping                     0.6s
 ⠴ Container dockercomposefiles-container1-1  Stopping                     0.6s
[+] Running 0/2
 ⠦ Container dockercomposefiles-container2-1  Stopping                     0.7s
 ⠦ Container dockercomposefiles-container1-1  Stopping                     0.7s
[+] Running 0/2
 ⠧ Container dockercomposefiles-container2-1  Stopping                     0.8s
 ⠧ Container dockercomposefiles-container1-1  Stopping                     0.8s
...
 ⠸ Container dockercomposefiles-container2-1  Stopping                    10.4s
 ⠸ Container dockercomposefiles-container1-1  Stopping                    10.4s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container2-1  Removed                     10.4s
 ⠿ Container dockercomposefiles-container1-1  Removing                    10.5s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container2-1  Removed                     10.4s
 ⠿ Container dockercomposefiles-container1-1  Removed                     10.5s
 ⠋ Network dockercomposefiles_default         Removing                     0.1s
[+] Running 3/3
 ⠿ Container dockercomposefiles-container2-1  Removed                     10.4s
 ⠿ Container dockercomposefiles-container1-1  Removed                     10.5s
 ⠿ Network dockercomposefiles_default         Removed                      0.2s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>In this case, with just <code>down</code>, Docker Compose has stopped and removed everything, as we can see in the containers and network it says <code>Removed</code></p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose restart">Docker compose restart<a class="anchor-link" href="#Docker compose restart">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>When writing a Docker Compose file, we can add the <code>restart</code> label so that if the container goes down, it will automatically restart.</p>
<div class='highlight'><pre><code class="language-json">restart: always
</code></pre></div>
<p>In this way, if the container goes down, it will automatically restart. If we want it to restart only a certain number of times, we can add the <code>on-failure</code> option.</p>
<div class='highlight'><pre><code class="language-json">restart: on-failure:&lt;number&gt;
</code></pre></div>
<p>Now the container will restart a number of times, but if it fails more times, it won't restart. If we want it to always restart, we can add the <code>unless-stopped</code> option.</p>
<div class='highlight'><pre><code class="language-json">restart: unless-stopped
</code></pre></div>
<p>Now the container will always restart, unless it is manually stopped.</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="Advanced Docker">Advanced Docker<a class="anchor-link" href="#Advanced Docker">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Manage work environment">Manage work environment<a class="anchor-link" href="#Manage work environment">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<h4 id="Deletion of stopped containers">Deletion of stopped containers<a class="anchor-link" href="#Deletion of stopped containers">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>After developing for a while, we can end up with several stopped containers still stored on the computer. This eventually takes up memory, so with <code>docker container prune</code> we can remove all of those that are stopped.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS                      PORTS     NAMES
effcee24f54a   ubuntu    &quot;bash&quot;    37 seconds ago   Exited (0) 36 seconds ago             musing_rosalind
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker container prune<br>WARNING! This will remove all stopped containers.<br>¿Estás seguro de que quieres continuar? [s/N] s<br>Deleted Containers:<br>This appears to be a hash value, not markdown text. As such, it doesn&#39;t require translation. If you have a specific piece of markdown text to translate, please provide it and I&#39;ll be happy to assist!<br><br>Total reclaimed space: 0B</code></pre></div>
      </section>
<p>In this case we have saved 0 bytes, but in the case of leaving containers turned off after extensive development, the memory savings will certainly be greater.</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="Deletion of all containers">Deletion of all containers<a class="anchor-link" href="#Deletion of all containers">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>In case of having running containers, we can delete all containers through another command</p>
<p>The command <code>docker ps -q</code> returns the ID of all containers, so with the command <code>docker rm -f $(docker ps -aq)</code> we will stop and remove all</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>c22516186ef7e3561fb1ad0d508a914857dbc61274a218f297c4d80b1fc33863
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED              STATUS              PORTS     NAMES
c22516186ef7   ubuntu    &quot;tail -f /dev/null&quot;   About a minute ago   Up About a minute             agitated_knuth
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">aq</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>c22516186ef7
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Deletion of everything">Deletion of everything<a class="anchor-link" href="#Deletion of everything">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>As we have seen, Docker also creates networks, images, volumes, etc., so with the command <code>docker system prune</code> we can delete all stopped containers, all unused networks that are not used by at least one container, duplicate images, and what is duplicated in the build cache.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker system prune<br>WARNING! This will remove:<br>- all stopped containers<br>- all networks not used by at least one container<br>- all dangling images<br>- all dangling build cache<br>¿Estás seguro de que quieres continuar? [s/N] s<br>Total reclaimed space: 0B</code></pre></div>
      </section>
<p>Just like before, not much space has been saved, but after a long time of development, the savings will be significant.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Use of Host Resources by Containers">Use of Host Resources by Containers<a class="anchor-link" href="#Use of Host Resources by Containers">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>For example, when creating a container, we can limit the RAM that the host can use by using the <code>--memory</code> option.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">memory</span> <span class="mi">1</span><span class="n">g</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>d84888eafe531831ef8915d2270422365adec02678122bf59580e2da782e6972
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>But with <code>docker ps</code> we don't have access to the resources that the container is consuming.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS          PORTS     NAMES
d84888eafe53   ubuntu    &quot;tail -f /dev/null&quot;   35 seconds ago   Up 34 seconds             musing_ritchie
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>For this, we have the command <code>docker stats</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker stats<br>CONTAINER ID   NAME             CPU %     MEM USAGE / LIMIT   MEM %     NET I/O       BLOCK I/O   PIDS<br>d84888eafe53   musing_ritchie   0.00%     540KiB / 1GiB       0.05%     5.62kB / 0B   0B / 0B     1</code></pre></div>
      </section>
<p>This is very useful if we want to simulate an environment with a RAM limit</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Stopping containers properly: SHELL vs EXEC">Stopping containers properly: SHELL vs EXEC<a class="anchor-link" href="#Stopping containers properly: SHELL vs EXEC">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>As we have explained, when we assign a process to a container, when that process ends, the container stops, but sometimes we may encounter problems with this. Let's create a new folder called Dockerfile_loop</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">Dockerfile_loop</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we are going to create a file called <code>loop.sh</code> inside <code>Dockerfile_loop</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">Dockerfile_loop</span><span class="o">/</span><span class="n">loop</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>And we are going to write the following inside <code>loop.sh</code></p>
<div class='highlight'><pre><code class="language-shell">#!/usr/bin/env bash
trap "exit 0" SIGTERM
while true; do :; done
</code></pre></div>
<p>If I run this script on the host, it runs until I enter <code>CTRL+C</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">./loop<br>^C</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Now we are going to create a <code>Dockerfile</code> inside <code>Dockerfile_loop</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">Dockerfile_loop</span><span class="o">/</span><span class="n">Dockerfile</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>*Dockerfile*:</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:trusty
COPY ["loop.sh", "/"]CMD /loop.sh
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>Let's create an image based on Ubuntu that copies the script inside and runs it, and the script runs until it receives the <code>SIGTERM</code> signal from the operating system. We compile the image</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span> <span class="o">./</span><span class="n">Dockerfile_loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  3.072kB
Step 1/3 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/3 : COPY [&quot;loop.sh&quot;, &quot;/&quot;]
 ---&amp;gt; 89f2bbd25a88
Step 3/3 : CMD /loop.sh
 ---&amp;gt; Running in ff52569c35fd
Removing intermediate container ff52569c35fd
 ---&amp;gt; feb091e4efa3
Successfully built feb091e4efa3
Successfully tagged ubuntu:loop

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We run the container</p>
<div class='highlight'><pre><code class="language-bash">docker run -d --name looper ubuntu:loop bash
</code></pre></div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">looper</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>8a28f8cc9892213c4e0603dfdde320edf52c091b82c60510083549a391cd6645
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We check and see that the container is running</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND                 CREATED         STATUS         PORTS     NAMES
8a28f8cc9892   ubuntu:loop   &quot;/bin/sh -c /loop.sh&quot;   4 seconds ago   Up 3 seconds             looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We tried to stop the container with <code>docker stop looper</code>. Docker stop attempts to stop the container by sending it the <code>SIGTERM</code> signal.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="err">!</span><span class="n">docker</span> <span class="n">stop</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
CPU times: user 89.2 ms, sys: 21.7 ms, total: 111 ms
Wall time: 10.6 s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>This took about 10 seconds to stop, when it should be immediate. This is because <code>stop</code> sent the <code>SIGTERM</code> signal to stop the container, but since it didn't stop, after a while it sent a <code>SIGKILL</code> to force it to stop. Let's see what happens if we list the containers.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND                 CREATED          STATUS                       PORTS     NAMES
8a28f8cc9892   ubuntu:loop   &quot;/bin/sh -c /loop.sh&quot;   23 seconds ago   Exited (137) 2 seconds ago             looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We can see that the <code>Exited</code> signal is <code>137</code>, which corresponds to SIGKILL, meaning Docker had to force the shutdown.</p>
</section>
<section class="section-block-markdown-cell">
<p>Let's delete the container and run it again</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">looper</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>84bc37f944d270be5f84a952968db2b8cf5372c61146d29383468198ceed18fd
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we now try to stop the container with <code>docker kill looper</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="err">!</span><span class="n">docker</span> <span class="n">kill</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
CPU times: user 9.1 ms, sys: 857 µs, total: 9.96 ms
Wall time: 545 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that the time is around 500 ms, meaning Docker stopped it at a certain point by sending the <code>SIGKILL</code> command. This is because <code>kill</code> does not send <code>SIGTERM</code>, and if the container has not stopped after a certain time, it sends <code>SIGKILL</code>. In this case, it sends <code>SIGKILL</code> from the start.</p>
<p>If we look at the containers, we see that the exit signal is the same, <code>137</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND                 CREATED         STATUS                       PORTS     NAMES
84bc37f944d2   ubuntu:loop   &quot;/bin/sh -c /loop.sh&quot;   6 seconds ago   Exited (137) 2 seconds ago             looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>This is not the correct way to stop a container, because when we want to stop the container, it should be done through the <code>SIGTERM</code> signal, so that it can finish processing what it was doing and then shut down.</p>
</section>
<section class="section-block-markdown-cell">
<p>If we delete the container and run it again</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">looper</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>b9d9f370cc0de7569eb09d0a85cd67e8ea6babc0754a517ccba5c5057f5cc50e
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we now look at the processes running inside the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="n">looper</span> <span class="n">ps</span> <span class="o">-</span><span class="n">ef</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>UID          PID    PPID  C STIME TTY          TIME CMD
root           1       0  0 14:05 ?        00:00:00 /bin/sh -c /loop.sh
root           7       1 93 14:05 ?        00:00:02 bash /loop.sh
root           8       0  0 14:05 ?        00:00:00 ps -ef
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>In fact, the main process, number 1, is not <code>/loop.sh</code> but rather <code>/bin/sh -c /loop.sh</code>, meaning it is a child process of the <code>shell</code>. So when the <code>SIGTERM</code> signal arrived, it reached the <code>shell</code>, but the shell does not forward it to its child processes, which is why <code>loop.sh</code> did not receive it.</p>
</section>
<section class="section-block-markdown-cell">
<p>To prevent this, you need to change the <code>Dockerfile</code> to the following</p>
<p>*Dockerfile*:</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:trusty
COPY ["loop.sh", "/"]
CMD ["/loop.sh"]    # it was previously CMD /loop.sh
</code></pre></div>
<p>This form is called <code>exec form</code>, while the previous one is called <code>shell form</code>. In the previous form, the process runs as a child of the <code>shell</code>, whereas in the <code>exec form</code> it executes the specified process. So we delete the container, recompile, and run the container with the image again.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span> <span class="o">./</span><span class="n">Dockerfile_loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  3.072kB
Step 1/3 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/3 : COPY [&quot;loop.sh&quot;, &quot;/&quot;]
 ---&amp;gt; Using cache
 ---&amp;gt; 89f2bbd25a88
Step 3/3 : CMD [&quot;/loop.sh&quot;]
 ---&amp;gt; Running in 6b8d92fcd57c
Removing intermediate container 6b8d92fcd57c
 ---&amp;gt; 35a7bb2b1892
Successfully built 35a7bb2b1892
Successfully tagged ubuntu:loop

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">looper</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>850ae70c071426850b28428ac60dcbf875c6d35d9b7cc66c17cf391a23392965
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Yes, now I see the processes inside the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="n">looper</span> <span class="n">ps</span> <span class="o">-</span><span class="n">ef</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>UID          PID    PPID  C STIME TTY          TIME CMD
root           1       0 88 14:14 ?        00:00:02 bash /loop.sh
root           7       0  0 14:14 ?        00:00:00 ps -ef
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now I see that the main process, number 1, is <code>/loop.sh</code></p>
<p>If I now try to stop the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="err">!</span><span class="n">docker</span> <span class="n">stop</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
CPU times: user 989 µs, sys: 7.55 ms, total: 8.54 ms
Wall time: 529 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that it takes longer. Let's look at the code where it stopped.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND      CREATED              STATUS                      PORTS     NAMES
850ae70c0714   ubuntu:loop   &quot;/loop.sh&quot;   About a minute ago   Exited (0) 33 seconds ago             looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Executable Containers">Executable Containers<a class="anchor-link" href="#Executable Containers">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>If we want a binary that runs as an executable, in the <code>dockerfile</code> we need to specify the command in <code>ENTRYPOINT</code> and the command parameters in <code>CMD</code>, let's see it</p>
</section>
<section class="section-block-markdown-cell">
<p>Let's create a new folder where we will store the <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerfile_ping</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we create a Dockerfile inside</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerfile_ping</span><span class="o">/</span><span class="n">Dockerfile</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We write the following inside the Dockerfile</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:trusty
ENTRYPOINT [ "/bin/ping", "-c", "3" ]
CMD [ "localhost" ]
</code></pre></div>
<p>We compile the image</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span> <span class="o">./</span><span class="n">dockerfile_ping</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  3.072kB
Step 1/3 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/3 : ENTRYPOINT [ &quot;/bin/ping&quot;, &quot;-c&quot;, &quot;3&quot; ]
 ---&amp;gt; Using cache
 ---&amp;gt; 1cebcfb542b1
Step 3/3 : CMD [ &quot;localhost&quot; ]
 ---&amp;gt; Using cache
 ---&amp;gt; 04ddc3de52a2
Successfully built 04ddc3de52a2
Successfully tagged ubuntu:ping

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we now run the image without passing it a parameter, the container will ping itself.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">ping_localhost</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.041 ms
64 bytes from localhost (127.0.0.1): icmp_seq=2 ttl=64 time=0.058 ms
64 bytes from localhost (127.0.0.1): icmp_seq=3 ttl=64 time=0.054 ms

--- localhost ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2027ms
rtt min/avg/max/mdev = 0.041/0.051/0.058/0.007 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>But if we pass it a parameter, it will ping the address we tell it to.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">ping_google</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span> <span class="n">google</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>PING google.com (216.58.209.78) 56(84) bytes of data.
64 bytes from waw02s06-in-f14.1e100.net (216.58.209.78): icmp_seq=1 ttl=111 time=3.93 ms
64 bytes from waw02s06-in-f14.1e100.net (216.58.209.78): icmp_seq=2 ttl=111 time=6.80 ms
64 bytes from waw02s06-in-f14.1e100.net (216.58.209.78): icmp_seq=3 ttl=111 time=6.92 ms

--- google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 3.930/5.886/6.920/1.383 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We delete the containers</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">ping_localhost</span> <span class="n">ping_google</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ping_localhost
ping_google
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="The context of build">The context of <code>build</code><a class="anchor-link" href="#The context of build">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Let's create a folder called <code>dockerfile_contexto</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dokerfile_contexto</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we create two files in it: a <code>test.txt</code> and the <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dokerfile_contexto</span><span class="o">/</span><span class="n">Dockerfile</span> <span class="n">dokerfile_contexto</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We modify the Dockerfile and put the following</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:trusty
COPY [".", "/"]
</code></pre></div>
<p>This will copy into the image everything that is in the folder where the <code>Dockerfile</code> is located. We compile the image.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">contexto</span> <span class="o">./</span><span class="n">dokerfile_contexto</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon   2.56kB
Step 1/2 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/2 : COPY [&quot;.&quot;, &quot;/&quot;]
 ---&amp;gt; 3ab79fdce389
Successfully built 3ab79fdce389
Successfully tagged ubuntu:contexto

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's see what's inside the container</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">ls</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">contexto</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Dockerfile
bin
boot
dev
etc
home
lib
lib64
media
mnt
opt
proc
root
run
sbin
srv
sys
text.txt
tmp
usr
var
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>As we can see, there is the file <code>text.txt</code>. However, it's possible that within the folder in the same directory as the <code>Dockerfile</code> there are files or folders that we don't want to be copied into the image for whatever reason. Just like with git we have the <code>.gitignore</code>, in docker we have the <code>.dockerignore</code>, where we put the files or folders that we don't want to be taken into account when building the image.</p>
<p>So we create a <code>.dockerignore</code> file</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dokerfile_contexto</span><span class="o">/.</span><span class="n">dockerignore</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>And inside we add the <code>text.txt</code>, and while we're at it, the <code>Dockerfile</code> which we don't need inside the image.</p>
<p>*.dockerignore*:</p>
<div class='highlight'><pre><code class="language-text">DockerfileIt seems like you&#39;re referring to a file named `text.txt`. However, I need the actual content of the Markdown file to translate it. Please provide the text from the file.
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>We delete the container we had created, compile again, and see what's inside the container.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ls
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">contexto</span> <span class="o">./</span><span class="n">dokerfile_contexto</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  3.072kB
Step 1/2 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/2 : COPY [&quot;.&quot;, &quot;/&quot;]
 ---&amp;gt; 7a6689546da4
Successfully built 7a6689546da4
Successfully tagged ubuntu:contexto

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">ls</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">contexto</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bin
boot
dev
etc
home
lib
lib64
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that now neither <code>Dockerfile</code> nor <code>text.txt</code> are present. Let's delete the container.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ls
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Multi-stage build">Multi-stage build<a class="anchor-link" href="#Multi-stage build">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>At the end of a development, we don't want all the code to be in the image that is going to be sent to production.</p>
<p>We can split the <code>dockerfile</code> into two, for example, <code>developer.Dockerfile</code> and <code>production.Dockerfile</code>, where in development there will be more things than in production. When compiling them, using the <code>-f</code> option we choose the <code>dockerfile</code> we want to use.</p>
<div class='highlight'><pre><code class="language-bash">docker build -t &lt;tag&gt; -f developer.Dockerfiledocker build -t &lt;tag&gt; -f production.Dockerfile
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>But to avoid having to create two <code>Dockerfile</code>s, Docker created the <code>multi stage builds</code>. With a single <code>Dockerfile</code> we will solve the problem.</p>
</section>
<section class="section-block-markdown-cell">
<p>We create the folder where we are going to save the <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">docker_multi_stage</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>And inside we create the file <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_stage</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">touch</span> <span class="n">Dockerfile</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We edit the file, adding the following</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile"># Stage 1: Generate the executable with Python based on Alpine<br>FROM python:3.9-alpine as build-stage<br>WORKDIR /app<br># Install dependencies for PyInstaller<br>RUN apk add --no-cache gcc musl-dev libc-dev<br># Generate hello.py<br>RUN echo &#39;print("Hello from Alpine!")&#39; &gt; hello.py<br># Install PyInstaller<br>RUN pip install pyinstaller<br># Using PyInstaller to Create a Standalone Executable<br>RUN pyinstaller --onefile hello.py<br><br># Stage 2: Run the executable in an Alpine image<br>FROM alpine:latest<br>WORKDIR /app<br># Copy the executable from the build stage<br>COPY --from=build-stage /app/dist/hello .<br># Default command to run the executable<br>CMD ["./hello"]</code></pre></div>
      </section>
<p>As can be seen, the <code>Dockerfile</code> is divided into two parts. On one hand, we work on the image <code>python:3.9-alpine</code>, which is called <code>build-stage</code>. On the other hand, we work on the image <code>alpine:latest</code>, which is a very lightweight Linux image and is widely used in production.</p>
<p>We compile it</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multistagebuild</span><span class="p">:</span><span class="n">latest</span> <span class="o">./</span><span class="n">docker_multi_stage</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Building 0.0s (0/2)                                          docker:default
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Building 0.2s (4/6)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile                       0.0s
 =&amp;gt; =&amp;gt; transferring dockerfile: 722B                                       0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.0s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/alpine:latest           0.1s
 =&amp;gt; [internal] load metadata for docker.io/library/python:3.9-alpine       0.1s
...
 =&amp;gt; CACHED [stage-1 3/3] COPY --from=build-stage /app/dist/hello .         0.0s
 =&amp;gt; exporting to image                                                     0.0s
 =&amp;gt; =&amp;gt; exporting layers                                                    0.0s
 =&amp;gt; =&amp;gt; writing image sha256:7fb090d1495d00e892118b6bc3c03400b63a435fd4703  0.0s
 =&amp;gt; =&amp;gt; naming to docker.io/maximofn/multistagebuild:latest                 0.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If we now look at the images we have</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY                 TAG       IMAGE ID       CREATED         SIZE
maximofn/multistagebuild   latest    7fb090d1495d   8 minutes ago   13.6MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's download the Python image to see how much it weighs</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">pull</span> <span class="n">python</span><span class="p">:</span><span class="mf">3.9</span><span class="o">-</span><span class="n">alpine</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>3.9-alpine: Pulling from library/python

a8db6415: Already exists 
d5e70e42: Already exists 
3fe96417: Already exists 
aa4dddbb: Already exists 
518be9f7: Already exists Digest: sha256:6e508b43604ff9a81907ec17405c9ad5c13664e45a5affa2206af128818c7486
Status: Downloaded newer image for python:3.9-alpine
docker.io/library/python:3.9-alpine
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY                 TAG          IMAGE ID       CREATED         SIZE
maximofn/multistagebuild   latest       7fb090d1495d   9 minutes ago   13.6MB
python                     3.9-alpine   6946662f018b   9 days ago      47.8MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We can see that while our image weighs only 13.6 MB, the Python image with which the application was built weighs 47.8 MB. Therefore, we can draw two conclusions: with the first image, the Python one, the application was built, the executable was generated, and it is this executable that we use in the second image, the Alpine one. Additionally, we can see that although the first image used is the Python one, it does not get downloaded to our system, as we had to download it ourselves.</p>
</section>
<section class="section-block-markdown-cell">
<p>Well, it only remains to test it</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">name</span> <span class="n">multi_stage_build</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multistagebuild</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Hello from Alpine!
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>It works!</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Multi arch builds">Multi arch builds<a class="anchor-link" href="#Multi arch builds">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Suppose we want to create an image that can run on a computer and a Raspberry Pi. The computer likely has a microprocessor with AMD64 architecture, while the Raspberry Pi has a microprocessor with ARM architecture. Therefore, we cannot create the same image for both. That is, when we create an image, we do so with a <code>Dockerfile</code> that usually starts like this</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ...
</code></pre></div>
<p>Therefore, the <code>Dockerfile</code> for the computer image could start like this</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu:latest
</code></pre></div>
<p>While the one for the Raspberry could start like this</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM arm64v8/ubuntu:latest
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>We should create two <code>Dockerfile</code> files, build them, and use one image on the computer and another on the Raspberry Pi.</p>
</section>
<section class="section-block-markdown-cell">
<p>To avoid having to look at the computer architecture and see what image we need to use, Docker creates the <code>manifest</code>, which, as its name suggests, is a manifest that indicates, based on the microarchitecture we have, which image to use.</p>
</section>
<section class="section-block-markdown-cell">
<p>So let's see how to do this</p>
</section>
<section class="section-block-markdown-cell">
<p>First, we create a folder where we are going to create our <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">docker_multi_arch</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we create the two Dockerfiles</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_arch</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">touch</span> <span class="n">Dockerfile_arm64</span> <span class="n">Dockerfile_amd64</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We write the <code>Dockerfile</code> for AMD64</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_arch</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">echo</span> <span class="s2">&quot;FROM ubuntu:20.04&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Dockerfile_amd64</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">echo</span> <span class="s2">&quot;CMD echo &#39;Hello from amd64&#39;&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Dockerfile_amd64</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_arch</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">echo</span> <span class="s2">&quot;FROM arm64v8/ubuntu:latest&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Dockerfile_arm</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">echo</span> <span class="s2">&quot;CMD echo &#39;Hello from ARM&#39;&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Dockerfile_arm</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we combine the two images</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_arch</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">arm</span> <span class="o">-</span><span class="n">f</span> <span class="n">Dockerfile_arm</span> <span class="o">.</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Building 0.0s (0/1)                                          docker:default
[+] Building 0.2s (2/3)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile_amd64                 0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 89B                                        0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/ubuntu:20.04            0.1s
[+] Building 0.3s (2/3)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile_amd64                 0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 89B                                        0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/ubuntu:20.04            0.2s
[+] Building 0.5s (2/3)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile_amd64                 0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 89B                                        0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/ubuntu:20.04            0.4s
[+] Building 0.6s (2/3)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile_amd64                 0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 89B                                        0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/ubuntu:20.04            0.5s
...
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load build definition from Dockerfile_arm                   0.0s
 =&amp;gt; =&amp;gt; transferring dockerfile: 94B                                        0.0s
 =&amp;gt; [internal] load metadata for docker.io/arm64v8/ubuntu:latest           1.8s
 =&amp;gt; [auth] arm64v8/ubuntu:pull token for registry-1.docker.io              0.0s
 =&amp;gt; CACHED [1/1] FROM docker.io/arm64v8/ubuntu:latest@sha256:94d12db896d0  0.0s
 =&amp;gt; exporting to image                                                     0.0s
 =&amp;gt; =&amp;gt; exporting layers                                                    0.0s
 =&amp;gt; =&amp;gt; writing image sha256:a9732c1988756dc8e836fd96e5c9512e349c97ea5af46  0.0s
 =&amp;gt; =&amp;gt; naming to docker.io/maximofn/multiarch:arm                          0.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's see if we have both images compiled</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY           TAG       IMAGE ID       CREATED       SIZE
maximofn/multiarch   arm       a9732c198875   4 weeks ago   69.2MB
maximofn/multiarch   amd64     5b612c83025f   6 weeks ago   72.8MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We see that we have compiled the two images. To be able to create a manifest, we first have to upload the images to Docker Hub, so we upload them.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">push</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">amd64</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The push refers to repository [docker.io/maximofn/multiarch]

82bdeb5f: Mounted from library/ubuntu amd64: digest: sha256:30e820f2a11a24ad4d8fb624ae485f7c1bcc299e8cfc72c88adce1acd0447e1d size: 529
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">push</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">arm</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The push refers to repository [docker.io/maximofn/multiarch]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>
eda53374: Layer already exists arm: digest: sha256:6ec5a0752d49d3805061314147761bf25b5ff7430ce143adf34b70d4eda15fb8 size: 529
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If I go to my Docker Hub I can see that my image <code>maximofn/multiarch</code> has the tags <code>amd64</code> and <code>arm</code></p>
<img src="https://images.maximofn.com/docker_multi_arch_tags.webp" alt="docker_multi_arch_tags">
</section>
<section class="section-block-markdown-cell">
<p>Now we are going to create the <code>manifest</code> based on these two images</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">manifest</span> <span class="n">create</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">amd64</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">arm</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Created manifest list docker.io/maximofn/multiarch:latest
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Once created, we have to indicate the CPU architectures to which each one corresponds.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">manifest</span> <span class="n">annotate</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">amd64</span> <span class="o">--</span><span class="n">os</span> <span class="n">linux</span> <span class="o">--</span><span class="n">arch</span> <span class="n">amd64</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">manifest</span> <span class="n">annotate</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">arm64</span> <span class="o">--</span><span class="n">os</span> <span class="n">linux</span> <span class="o">--</span><span class="n">arch</span> <span class="n">arm64</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>manifest for image maximofn/multiarch:arm64 does not exist in maximofn/multiarch:latest
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Once created and annotated, we can upload the <code>manifest</code> to Docker Hub</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">manifest</span> <span class="n">push</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>sha256:1ea28e9a04867fe0e0d8b0efa455ce8e4e29e7d9fd4531412b75dbd0325e9304
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>If I now look at the tags for my image <code>maximofn/multiarch</code>, I also see the <code>latest</code> tag.</p>
<img src="https://images.maximofn.com/docker_multi_arch_tags_manifest.webp" alt="docker_multi_arch_tags_manifest">
</section>
<section class="section-block-markdown-cell">
<p>Now, whether I want to use my image from a machine with an AMD64 or ARM CPU when doing <code>FROM maximofn/multiarch:latest</code>, Docker will check the CPU architecture and download the <code>amd64</code> tag or the <code>arm</code> tag. Let's see it in action; if I run the image on my computer, I get</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;maximofn/multiarch:latest&#x27; locally
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>latest: Pulling from maximofn/multiarch
Digest: sha256:7cef0de10f7fa2b3b0dca0fbf398d1f48af17a0bbc5b9beca701d7c427c9fd84
Status: Downloaded newer image for maximofn/multiarch:latest
Hello from amd64
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Since he doesn't have it, he downloads it.</p>
</section>
<section class="section-block-markdown-cell">
<p>If I now connect via SSH to a Raspberry Pi and try the same thing, I get</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">raspberrry@raspberrypi:~ $ docker run maximofn/multiarch:latest<br>Unable to find image &#39;maximofn/multiarch:latest&#39; locally<br>latest: Pulling from maximofn/multiarch<br>Digest: sha256:1ea28e9a04867fe0e0d8b0efa455ce8e4e29e7d9fd4531412b75dbd0325e9304<br>Status: Downloaded newer image for maximofn/multiarch:latest<br>Hello from ARM</code></pre></div>
      </section>
<p><code>Hello from ARM</code> appears because the Raspberry Pi has a microcontroller with an ARM architecture</p>
</section>
<section class="section-block-markdown-cell">
<p>As can be seen, each machine has downloaded the image it needed.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Advanced Correct Writing of Dockerfiles">Advanced Correct Writing of Dockerfiles<a class="anchor-link" href="#Advanced Correct Writing of Dockerfiles">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>We have already seen how to write Dockerfiles correctly, but there is one more thing we can do now that we know about multi-stage builds: create a container to build the executable and another smaller one to run it.</p>
<p>We came to the conclusion that a good Dockerfile could be this</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
WORKDIR /sourceCode/sourceApp
COPY ./sourceCode/sourceApp .
CMD ["python3", "app.py"]
</code></pre></div>
<p>Let's now create an executable in a builder container and run it in another smaller one.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile">FROM python:3.9.18-alpine as builder<br>WORKDIR /sourceCode/sourceApp<br>RUN apk add --no-cache gcc musl-dev libc-dev &amp;&amp; pip install pyinstaller<br>COPY ./sourceCode/sourceApp .<br>RUN pyinstaller --onefile app.py<br><br>FROM alpine:3.18.3<br>WORKDIR /sourceCode/sourceApp<br>COPY --from=builder /sourceCode/sourceApp/dist/app .<br>CMD ["./app"]</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>We create the Python code in the necessary path</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">multistagebuild</span><span class="o">/</span><span class="n">sourceCode</span>
<span class="err">!</span><span class="n">mkdir</span> <span class="n">multistagebuild</span><span class="o">/</span><span class="n">sourceCode</span><span class="o">/</span><span class="n">sourceApp</span>
<span class="err">!</span><span class="n">touch</span> <span class="n">multistagebuild</span><span class="o">/</span><span class="n">sourceCode</span><span class="o">/</span><span class="n">sourceApp</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">py</span>
<span class="err">!</span><span class="n">echo</span> <span class="s1">&#39;print(&quot;Hello from Alpine!&quot;)&#39;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">multistagebuild</span><span class="o">/</span><span class="n">sourceCode</span><span class="o">/</span><span class="n">sourceApp</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now compiling the image</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multistagebuild</span><span class="p">:</span><span class="n">alpine</span><span class="o">-</span><span class="mf">3.18.3</span> <span class="o">./</span><span class="n">multistagebuild</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Building 0.0s (0/0)                                          docker:default
[+] Building 0.0s (0/1)                                          docker:default
[+] Building 0.2s (3/5)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile                       0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 357B                                       0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/alpine:3.18.3           0.1s
 =&amp;gt; [internal] load metadata for docker.io/library/python:3.9.18-alpine    0.1s
 =&amp;gt; [auth] library/alpine:pull token for registry-1.docker.io              0.0s
[+] Building 0.3s (3/5)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile                       0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 357B                                       0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/alpine:3.18.3           0.2s
 =&amp;gt; [internal] load metadata for docker.io/library/python:3.9.18-alpine    0.2s
 =&amp;gt; [auth] library/alpine:pull token for registry-1.docker.io              0.0s
[+] Building 0.5s (4/6)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile                       0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 357B                                       0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/alpine:3.18.3           0.4s
...
 =&amp;gt; exporting to image                                                     0.1s
 =&amp;gt; =&amp;gt; exporting layers                                                    0.1s
 =&amp;gt; =&amp;gt; writing image sha256:8a22819145c6fee17e138e818610ccf46d7e13c786825  0.0s
 =&amp;gt; =&amp;gt; naming to docker.io/maximofn/multistagebuild:alpine-3.18.3          0.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>We run it</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">name</span> <span class="n">multi_stage_build</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multistagebuild</span><span class="p">:</span><span class="n">alpine</span><span class="o">-</span><span class="mf">3.18.3</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Hello from Alpine!
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>The image <code>maximofn/multistagebuild:alpine-3.18.3</code> only weighs 13.6 MB</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Difference between RUN, CMD and ENTRYPOINT">Difference between RUN, CMD and ENTRYPOINT<a class="anchor-link" href="#Difference between RUN, CMD and ENTRYPOINT">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<h4 id="RUN">RUN<a class="anchor-link" href="#RUN">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>The <code>RUN</code> command is the simplest; it just executes a command during the image build process. For example, if we want to install a package in the image, we do it using <code>RUN</code>.</p>
<p>Therefore, it is important, <code>RUN</code> is executed at the time of image compilation, not when the container is run.</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="CMD">CMD<a class="anchor-link" href="#CMD">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>The <code>CMD</code> command is the command that runs when the container starts. For example, if we want the container to run a command when it starts, we do this through <code>CMD</code>. For instance, if we have a Python application in a container, with <code>CMD</code> we can tell it to run the Python application when the container starts.</p>
<p>In this way, when the container is started, the Python application will be executed. That is, if we do <code>docker run &#x3C;image&#x3E;</code>, the Python application will be executed. However, <code>CMD</code> allows us to override the command that runs when the container starts, for example, if we do <code>docker run &#x3C;image&#x3E; bash</code>, <code>bash</code> will run instead of the Python application.</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="ENTRYPOINT">ENTRYPOINT<a class="anchor-link" href="#ENTRYPOINT">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>The <code>ENTRYPOINT</code> command is similar to the <code>CMD</code> command, but with a difference: <code>ENTRYPOINT</code> is not intended to be overwritten. This means that if we have a Python application in a container, with <code>ENTRYPOINT</code> we can specify that when the container runs, it should execute the Python application. However, if we run <code>docker run &#x3C;image&#x3E; bash</code>, the Python application will still run, not <code>bash</code>.</p>
<p>A very common use of <code>ENTRYPOINT</code> is when we want the container to be an executable, for example, if we want the container to be an executable version of Python that we don't have on our host, because we want to test the new version of Python that has been released, we can do</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
ENTRYPOINT ["python3"]
</code></pre></div>
<p>In this way, when the container is started, Python will be executed. That is, if we do <code>docker run &#x3C;image&#x3E;</code>, Python will be executed. But <code>ENTRYPOINT</code> allows us to override the command that runs when the container starts, for example, if we do <code>docker run &#x3C;image&#x3E; myapp.py</code>, it will execute <code>python3 myapp.py</code> inside the container. This way we can test our Python application in the new version of Python.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Changes in a Container">Changes in a Container<a class="anchor-link" href="#Changes in a Container">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>With <code>docker diff</code> we can see the differences between the container and the image, which is the same as the difference in the container from when it was created until now.</p>
<p>Let's run a container and inside we create a file</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">name</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">20.04</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">20.04</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@895a19aef124:/# touch file.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Now we can see the difference</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">diff</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">20.04</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>C /root
A /root/.bash_history
A /file.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p><code>A</code> means that it has been added, <code>C</code> means that it has been changed and <code>D</code> means that it has been deleted</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker in Docker">Docker in Docker<a class="anchor-link" href="#Docker in Docker">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Suppose we have containers that need to start or stop other containers. This is achieved in the following way</p>
<p>Since in Linux everything is a file and the host communicates with Docker through a socket, for Linux that socket is a file. So if we mount that socket as a file to the container, it will be able to communicate with Docker.</p>
</section>
<section class="section-block-markdown-cell">
<p>First, let's set up a container with Ubuntu</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">ubuntu</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">latest</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>144091e4a3325c9068064ff438f8865b40f944af5ce649c7156ca55a3453e423
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Let's set up the container that will be able to communicate with Docker by mounting the <code>/var/run/docker.sock</code> folder.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker run -it --rm --name main -v /var/run/docker.sock:/var/run/docker.sock docker:19.03.12<br>#</code></pre></div>
      </section>
<p>We have entered a container, and if we run <code>docker ps</code> inside it</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash"># docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES9afb778d6c20        docker:19.03.12     "docker-entrypoint.s…"   3 seconds ago       Up 2 seconds                            main<br>144091e4a332        ubuntu:latest       "tail -f /dev/null"      19 seconds ago      Up 18 seconds                           ubuntu</code></pre></div>
      </section>
<p>As we can see, inside Docker we can see the containers of the host</p>
</section>
<section class="section-block-markdown-cell">
<p>We can run a new container</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash"># docker run -d --name ubuntu_from_main ubuntu:latest tail -f /dev/null<br>This appears to be a hash value, not markdown text. As such, it doesn&#39;t require translation. If you have actual markdown text to translate, please provide it and I&#39;ll happily translate it for you.<br>/ #</code></pre></div>
      </section>
<p>And if we look at the containers again</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash"># docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES362654a72bb0        ubuntu:latest       "tail -f /dev/null"      3 seconds ago        Up 3 seconds                            ubuntu_from_main<br>9afb778d6c20        docker:19.03.12     "docker-entrypoint.s…"   About a minute ago   Up About a minute                       main<br>144091e4a332        ubuntu:latest       "tail -f /dev/null"      2 minutes ago        Up About a minute                       ubuntu</code></pre></div>
      </section>
<p>But if we now run a new terminal from the host, we will see the container created from inside the container.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE             COMMAND                  CREATED              STATUS              PORTS     NAMES
362654a72bb0   ubuntu:latest     &quot;tail -f /dev/null&quot;      About a minute ago   Up About a minute             ubuntu_from_main
9afb778d6c20   docker:19.03.12   &quot;docker-entrypoint.s…&quot;   3 minutes ago        Up 3 minutes                  main
144091e4a332   ubuntu:latest     &quot;tail -f /dev/null&quot;      3 minutes ago        Up 3 minutes                  ubuntu
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Everything we do from the <code>main</code> container will be reflected on the host.</p>
</section>
<section class="section-block-markdown-cell">
<p>This has the advantage that we can install programs in a container that has access to the host without having to install them on the host. For example <a href="https://github.com/wagoodman/dive">dive</a> is a tool for exploring containers, but if you don't want to install it on the host, you can install it in a container with access to the host, so from that <code>main</code> container you can explore the rest of the containers without having to install it on the host.</p>
</section>