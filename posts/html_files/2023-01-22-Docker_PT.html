<section class="section-block-markdown-cell">
<h1 id="Docker">Docker<a class="anchor-link" href="#Docker">¶</a></h1>
</section>
<section class="section-block-markdown-cell">
<blockquote>
<p>Aviso: Este post foi traduzido para o português usando um modelo de tradução automática. Por favor, me avise se encontrar algum erro.</p>
</blockquote>
</section>
<section class="section-block-markdown-cell">
<h2 id="Contentores">Contentores<a class="anchor-link" href="#Contentores">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Ola mundo">Olá mundo<a class="anchor-link" href="#Ola mundo">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Executar o primeiro contêiner do tipo Hello World com o comando <code>docker run hello-world</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;hello-world:latest&#x27; locally
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>latest: Pulling from library/hello-world

85e32844: Pull complete 457kB/2.457kBBDigest: sha256:dcba6daec718f547568c562956fa47e1b03673dd010fe6ee58ca806767031d1c
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
&#x20;&#x20;&#x20;&#x20;(amd64)
 3. The Docker daemon created a new container from that image which runs the
&#x20;&#x20;&#x20;&#x20;executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
&#x20;&#x20;&#x20;&#x20;to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como não temos o contêiner salvo localmente, o Docker o baixa do Docker Hub. Se agora voltarmos a executar o contêiner, já não aparecerá a primeira mensagem, na qual indica que está sendo baixado.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
&#x20;&#x20;&#x20;&#x20;(amd64)
 3. The Docker daemon created a new container from that image which runs the
&#x20;&#x20;&#x20;&#x20;executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
&#x20;&#x20;&#x20;&#x20;to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Para ver os contêineres que estão em execução, execute <code>docker ps</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como vemos não há nenhum contêiner aberto. Mas, se executarmos <code>docker ps -a</code> (<code>all</code>), veremos que sim aparecem.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
1efb51bbbf38   hello-world   &quot;/hello&quot;   10 seconds ago   Exited (0) 9 seconds ago              strange_thompson
5f5705e7603e   hello-world   &quot;/hello&quot;   15 seconds ago   Exited (0) 14 seconds ago             laughing_jang
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que aparecem dois contentores chamados <code>hello-world</code> que são os dois que executamos anteriormente. Portanto, cada vez que executamos o comando <code>run</code>, o Docker cria um novo contentor, não executa um que já exista.</p>
</section>
<section class="section-block-markdown-cell">
<p>Se quisermos ter mais informações sobre um dos dois contêineres, podemos executar <code>docker inspect &#x3C;id&#x3E;</code>, onde <code>&#x3C;id&#x3E;</code> corresponde à ID do contêiner que foi exibida na lista anterior.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">inspect</span> <span class="mi">1</span><span class="n">efb51bbbf38</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[
&#x20;&#x20;&#x20;&#x20;&#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Id&quot;: &quot;1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Created&quot;: &quot;2023-09-04T03:59:17.795499354Z&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Path&quot;: &quot;/hello&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Args&quot;: [],
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;State&quot;: &#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Status&quot;: &quot;exited&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Running&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Paused&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Restarting&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;OOMKilled&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Dead&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Pid&quot;: 0,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ExitCode&quot;: 0,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Error&quot;: &quot;&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;StartedAt&quot;: &quot;2023-09-04T03:59:18.406663026Z&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;FinishedAt&quot;: &quot;2023-09-04T03:59:18.406181184Z&quot;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Image&quot;: &quot;sha256:9c7a54a9a43cca047013b82af109fe963fde787f63f9e016fdc3384500c2823d&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/resolv.conf&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/hostname&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;HostsPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/hosts&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;LogPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e-json.log&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Name&quot;: &quot;/strange_thompson&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;...
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x7D;
]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como lembrar IDs é complicado para nós, o Docker atribui nomes aos contêineres para facilitar nossa vida. Assim, na lista anterior, a última coluna corresponde ao nome que o Docker atribuiu a cada contêiner, de modo que se agora executarmos <code>docker inspect &#x3C;name&#x3E;</code> obteremos as mesmas informações que com a ID.</p>
</section>
<section class="section-block-markdown-cell">
<p>Volto a executar <code>docker ps -a</code> para voltar a ver a lista</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND    CREATED         STATUS                     PORTS     NAMES
1efb51bbbf38   hello-world   &quot;/hello&quot;   2 minutes ago   Exited (0) 2 minutes ago             strange_thompson
5f5705e7603e   hello-world   &quot;/hello&quot;   2 minutes ago   Exited (0) 2 minutes ago             laughing_jang
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E agora eu executo <code>docker inspect &#x3C;name&#x3E;</code> para ver a informação do contêiner.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">inspect</span> <span class="n">strange_thompson</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[
&#x20;&#x20;&#x20;&#x20;&#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Id&quot;: &quot;1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Created&quot;: &quot;2023-09-04T03:59:17.795499354Z&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Path&quot;: &quot;/hello&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Args&quot;: [],
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;State&quot;: &#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Status&quot;: &quot;exited&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Running&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Paused&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Restarting&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;OOMKilled&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Dead&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Pid&quot;: 0,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ExitCode&quot;: 0,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Error&quot;: &quot;&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;StartedAt&quot;: &quot;2023-09-04T03:59:18.406663026Z&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;FinishedAt&quot;: &quot;2023-09-04T03:59:18.406181184Z&quot;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Image&quot;: &quot;sha256:9c7a54a9a43cca047013b82af109fe963fde787f63f9e016fdc3384500c2823d&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/resolv.conf&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/hostname&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;HostsPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/hosts&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;LogPath&quot;: &quot;/var/lib/docker/containers/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e/1efb51bbbf38917affd1b5871db8e658ebfe0b2efa5ead17545680b7866f682e-json.log&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Name&quot;: &quot;/strange_thompson&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;...
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x7D;
]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Mas por que com <code>docker ps</code> não vemos nenhum contêiner e com <code>docker ps -a</code> sim. Isso acontece porque <code>docker ps</code> só mostra os contêineres que estão em execução, enquanto <code>docker ps -a</code> mostra todos os contêineres, tanto os que estão em execução quanto os que estão desligados.</p>
</section>
<section class="section-block-markdown-cell">
<p>Podemos criar um contêiner atribuindo a ele um nome através do comando <code>docker run --name &#x3C;name&#x3E; hello-world</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">hello_world</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
&#x20;&#x20;&#x20;&#x20;(amd64)
 3. The Docker daemon created a new container from that image which runs the
&#x20;&#x20;&#x20;&#x20;executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
&#x20;&#x20;&#x20;&#x20;to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Isso será mais confortável para nós, pois poderemos controlar nós mesmos os nomes dos contêineres.</p>
</section>
<section class="section-block-markdown-cell">
<p>Se agora quisermos criar outro contêiner com o mesmo nome, não poderemos, porque o Docker não permite que se dupliquem os nomes dos contêineres. Desse modo, se quisermos renomear o contêiner, podemos usar o comando <code>docker rename &#x3C;old name&#x3E; &#x3C;new name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rename</span> <span class="n">hello_world</span> <span class="n">hello_world2</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora temos um monte de contêineres idênticos. Então, se quisermos remover algum, temos que usar o comando <code>docker rm &#x3C;id&#x3E;</code> ou <code>docker rm &#x3C;name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND    CREATED         STATUS                     PORTS     NAMES
f432c9c2ca21   hello-world   &quot;/hello&quot;   9 seconds ago   Exited (0) 8 seconds ago             hello_world2
1efb51bbbf38   hello-world   &quot;/hello&quot;   4 minutes ago   Exited (0) 4 minutes ago             strange_thompson
5f5705e7603e   hello-world   &quot;/hello&quot;   4 minutes ago   Exited (0) 4 minutes ago             laughing_jang
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">hello_world2</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>hello_world2
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se voltarmos a ver a lista de contêineres, o contêiner <code>hello_world2</code> já não estará mais lá.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND    CREATED         STATUS                     PORTS     NAMES
1efb51bbbf38   hello-world   &quot;/hello&quot;   5 minutes ago   Exited (0) 5 minutes ago             strange_thompson
5f5705e7603e   hello-world   &quot;/hello&quot;   5 minutes ago   Exited (0) 5 minutes ago             laughing_jang
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se quisermos apagar todos os contêineres, podemos fazer isso um a um, mas como é muito trabalhoso, podemos apagar todos usando o comando <code>docker container prune</code>. Este comando remove apenas os contêineres que estejam parados.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">container</span> <span class="n">prune</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>WARNING! This will remove all stopped containers.
Are you sure you want to continue? [y/N] y
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Docker pergunta se você tem certeza, e se você disser que sim, ele apaga todos. Se agora listar todos os contêineres, nenhum aparecerá.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="O modo interativo">O modo interativo<a class="anchor-link" href="#O modo interativo">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a executar um Ubuntu por meio do comando <code>docker run ubuntu</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;ubuntu:latest&#x27; locally
latest: Pulling from library/ubuntu

Digest: sha256:20fa2d7bb4de7723f542be5923b06c4d704370f0390e4ae9e1c833c8785644c1[1A
Status: Downloaded newer image for ubuntu:latest
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como vemos, agora demorou mais para baixar. Se listarmos os contêineres através do comando <code>docker ps</code>, veremos que não aparece o contêiner que acabamos de criar, ou seja, ele não está em execução.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Listamos agora todos os contêineres</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS                     PORTS     NAMES
da16b3a85178   ubuntu    &quot;bash&quot;    4 seconds ago   Exited (0) 3 seconds ago             hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que o estado do contêiner é <code>Exited (0)</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Se observa que o comando do contêiner é <code>bash</code> e junto ao estado <code>Exited (0)</code> indica que foi iniciado o Ubuntu, executou seu *bash*, terminou a execução e retornou 0. Isso acontece porque não foi especificada nenhuma tarefa para o bash do Ubuntu. Para resolver isso, agora vamos executar o contêiner com o comando <code>docker run -it ubuntu</code>, onde <code>it</code> indica que queremos executá-lo em modo interativo.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@5b633e9d838f:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora vemos que estamos dentro do bash do Ubuntu. Se executarmos o comando <code>cat /etc/lsb-release</code> podemos ver a distribuição do Ubuntu.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">root</span><span class="o">@</span><span class="mi">5</span><span class="n">b633e9d838f</span><span class="p">:</span><span class="o">/</span><span class="c1"># cat /etc/lsb-release</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=22.04
DISTRIB_CODENAME=jammy
DISTRIB_DESCRIPTION=&quot;Ubuntu 22.04.1 LTS&quot;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se abrirmos outra terminal e vermos a lista de contêineres, agora sim aparecerá o contêiner rodando Ubuntu</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS         PORTS     NAMES
5b633e9d838f   ubuntu    &quot;bash&quot;    3 minutes ago   Up 3 minutes             funny_mirzakhani
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos o contêiner com Ubuntu e em seu estado podemos ver <code>UP</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Se vemos agora a lista de todos os contentores, veremos que aparecem os dois contentores com Ubuntu, o primeiro desligado e o segundo que está em execução.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS                     PORTS     NAMES
5b633e9d838f   ubuntu    &quot;bash&quot;    3 minutes ago   Up 3 minutes                         funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;    3 minutes ago   Exited (0) 3 minutes ago             hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se voltarmos à terminal onde tínhamos o Ubuntu rodando dentro de um docker, se escrevermos <code>exit</code> sairemos do Ubuntu.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">root</span><span class="o">@</span><span class="mi">5</span><span class="n">b633e9d838f</span><span class="p">:</span><span class="o">/</span><span class="c1"># exit</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>exit
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se executarmos <code>docker ps</code> o contêiner já não aparece</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Mas se eu executar <code>docker ps -a</code> ele aparece. Isso significa que o contêiner foi desligado.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS                      PORTS     NAMES
5b633e9d838f   ubuntu    &quot;bash&quot;    4 minutes ago   Exited (0) 27 seconds ago             funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;    4 minutes ago   Exited (0) 4 minutes ago              hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Isso ocorre porque ao escrever <code>exit</code>, na verdade estamos escrevendo no console do bash do Ubuntu, o que significa que estamos encerrando o processo bash do Ubuntu.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Ciclo de vida de um conteiner">Ciclo de vida de um contêiner<a class="anchor-link" href="#Ciclo de vida de um conteiner">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Em Docker, quando o processo principal de um contêiner termina, o contêiner é desligado. Dentro de um contêiner podem ser executados vários processos, mas apenas quando o processo principal termina, o contêiner é desligado.</p>
<p>Portanto, se quisermos executar um contêiner que não pare quando um processo terminar, devemos fazer com que seu processo principal não termine. Neste caso, que o bash não termine.</p>
<p>Se quisermos executar um contêiner com Ubuntu, mas que não finalize quando o processo do Bash terminar, podemos fazer da seguinte maneira</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">d</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ce4d60427dcd4b326d15aa832b816c209761d6b4e067a016bb75bf9366c37054
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>O que fazemos é primeiro dar o nome <code>alwaysup</code>, em segundo lugar passar a opção <code>-d</code> (<code>detach</code>) para que o contêiner seja executado em segundo plano e por fim dizer o processo principal que queremos que seja executado no contêiner, que neste caso é <code>tail -f /dev/null</code> que equivale a um comando <code>nop</code></p>
<p>Isso nos retornará o ID do contêiner, mas não estaremos dentro do Ubuntu como acontecia antes.</p>
</section>
<section class="section-block-markdown-cell">
<p>Se agora vermos a lista de contêineres que estão em execução, aparecerá o contêiner que acabamos de criar.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS          PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   18 seconds ago   Up 17 seconds             alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como já temos um contêiner rodando sempre, podemos nos conectar a ele através do comando <code>exec</code>. Dizemos o nome ou a ID do contêiner e passamos o processo que queremos que seja executado. Além disso, passamos a opção <code>-it</code> para dizer que deve ser interativo.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">alwaysup</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@ce4d60427dcd:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora estamos de volta no Ubuntu. Se executarmos o comando <code>ps -aux</code>, podemos ver uma lista dos processos que estão sendo executados dentro do Ubuntu.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ps</span> <span class="o">-</span><span class="n">aux</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.0  0.0   2820  1048 ?        Ss   13:04   0:00 tail -f /dev/null
root           7  0.0  0.0   4628  3796 pts/0    Ss   13:04   0:00 bash
root          15  0.0  0.0   7060  1556 pts/0    R+   13:05   0:00 ps -aux
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos apenas três processos, o <code>ps -aux</code>, o <code>bash</code> e o <code>tail -f /dev/null</code></p>
<p>Este contêiner vai ficar sempre ligado enquanto o processo <code>tail -f /dev/null</code> estiver em execução.</p>
</section>
<section class="section-block-markdown-cell">
<p>Se sairmos do contêiner com o comando <code>exit</code> e executarmos o comando <code>docker ps</code> veremos que o contêiner continua ligado.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">exit</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>exit
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED         STATUS         PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   2 minutes ago   Up 2 minutes             alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Para poder finalizar o processo e poder desligar o contêiner, devemos usar o comando <code>docker stop &#x3C;name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">stop</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se agora listarmos os contêineres em execução, o contêiner com Ubuntu já não aparecerá.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E se listarmos todos os contêineres, aparece o contêiner com Ubuntu, e seu estado <code>Exited</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                            PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   14 minutes ago   Exited (137) About a minute ago             alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                19 minutes ago   Exited (0) 15 minutes ago                   funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                20 minutes ago   Exited (0) 20 minutes ago                   hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Também podemos pausar um contêiner por meio do comando <code>docker pause &#x3C;name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">d</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>8282eaf9dc3604fa94df206b2062287409cc92cbcd203f1a018742b5c171c9e4
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora nós pausamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">pause</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se voltarmos a ver todos os contêineres, vemos que o contêiner com Ubuntu está pausado.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                       PORTS     NAMES
8282eaf9dc36   ubuntu    &quot;tail -f /dev/null&quot;   41 seconds ago   Up 41 seconds (Paused)                 alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                19 minutes ago   Exited (0) 15 minutes ago              funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                20 minutes ago   Exited (0) 20 minutes ago              hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Contentores de uso unico">Contentores de uso único<a class="anchor-link" href="#Contentores de uso unico">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Se a hora de executar um contêiner, colocarmos a opção <code>--rm</code>, esse contêiner vai ser apagado quando terminar de ser executado.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">name</span> <span class="n">autoremove</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se agora vemos quais contêineres temos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que não está o contêiner que acabamos de criar</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Expor containers ao mundo externo">Expor containers ao mundo externo<a class="anchor-link" href="#Expor containers ao mundo externo">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a criar um novo contêiner com um servidor</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">proxy</span> <span class="n">nginx</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;nginx:latest&#x27; locally
latest: Pulling from library/nginx

f1ad4ce1: Pulling fs layer 
b079d0f8: Pulling fs layer 
5fbbebc6: Pulling fs layer 
ffdd25f4: Pulling fs layer 
32c8fba2: Pulling fs layer 
24b8ba39: Pull complete 393kB/1.393kBB[5ADigest: sha256:2888a97f7c7d498bbcc47ede1ad0f6ced07d72dfd181071dde051863f1f79d7b
Status: Downloaded newer image for nginx:latest
1a530e04f14be082811b72ea8b6ea5a95dad3037301ee8a1351a0108ff8d3b30
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Isso cria um servidor, vamos listar novamente os contêineres que estão em execução.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND                  CREATED        STATUS                  PORTS     NAMES
1a530e04f14b   nginx     &quot;/docker-entrypoint.…&quot;   1 second ago   Up Less than a second   80/tcp    proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora aparece uma nova coluna com a porta, e nos diz que o servidor que acabamos de criar está na porta <code>80</code> sob o protocolo <code>tcp</code>.</p>
<p>Se abrirmos um navegador e tentarmos nos conectar ao servidor através de <code>http://localhost:80</code>, não conseguiremos conectar. Isso acontece porque cada contêiner tem sua própria interface de rede. Ou seja, o servidor está ouvindo na porta <code>80</code> do contêiner, mas nós estamos tentando conectar à porta <code>80</code> do host.</p>
</section>
<section class="section-block-markdown-cell">
<p>Paramos o contêiner para relançá-lo de outra forma</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">stop</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se listarmos os contêineres, não aparece em execução</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>O apagamos para recriá-lo</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se listarmos todos os contêineres, já não está</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                       PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   19 minutes ago   Exited (137) 5 minutes ago             alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                24 minutes ago   Exited (0) 20 minutes ago              funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                24 minutes ago   Exited (0) 24 minutes ago              hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Para recriar o contêiner com o servidor e poder vê-lo do host, temos que usar a opção <code>-p</code> (<code>publish</code>), indicando em primeiro lugar a porta na qual queremos vê-la no host e em seguida a porta do contêiner, ou seja, <code>-p &#x3C;ip host&#x3E;:&#x3C;ip contêiner&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">proxy</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span><span class="p">:</span><span class="mi">80</span> <span class="n">nginx</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>c199235e42f76a30266f6e1af972e0a59811806eb3d3a9afdd873f6fa1785eae
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Listamos os contêineres</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                   NAMES
c199235e42f7   nginx     &quot;/docker-entrypoint.…&quot;   22 seconds ago   Up 21 seconds   0.0.0.0:8080-&amp;gt;80/tcp, :::8080-&amp;gt;80/tcp   proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que o porto do contentor é <code>0.0.0.0:8080-&#x3E;80/tcp</code>. Se agora formos a um navegador e introduzirmos <code>0.0.0.0:8080</code> poderemos aceder ao servidor do contentor</p>
</section>
<section class="section-block-markdown-cell">
<p>Ao listar os contêineres, na coluna <code>PORTS</code> indica <code>0.0.0.0:8080-&#x3E;80/tcp</code>, o que nos ajuda a ver a relação de portas</p>
</section>
<section class="section-block-markdown-cell">
<p>Para ver os logs do contêiner, através do comando <code>docker logs &#x3C;name&#x3E;</code> posso ver os registros do contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">logs</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2022/09/13 13:24:06 [notice] 1#1: using the &quot;epoll&quot; event method
2022/09/13 13:24:06 [notice] 1#1: nginx/1.23.1
2022/09/13 13:24:06 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6) 
2022/09/13 13:24:06 [notice] 1#1: OS: Linux 5.15.0-46-generic
2022/09/13 13:24:06 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2022/09/13 13:24:06 [notice] 1#1: start worker processes
2022/09/13 13:24:06 [notice] 1#1: start worker process 31
2022/09/13 13:24:06 [notice] 1#1: start worker process 32
2022/09/13 13:24:06 [notice] 1#1: start worker process 33
2022/09/13 13:24:06 [notice] 1#1: start worker process 34
2022/09/13 13:24:06 [notice] 1#1: start worker process 35
2022/09/13 13:24:06 [notice] 1#1: start worker process 36
2022/09/13 13:24:06 [notice] 1#1: start worker process 37
2022/09/13 13:24:06 [notice] 1#1: start worker process 38
2022/09/13 13:24:06 [notice] 1#1: start worker process 39
2022/09/13 13:24:06 [notice] 1#1: start worker process 40
2022/09/13 13:24:06 [notice] 1#1: start worker process 41
...
172.17.0.1 - - [13/Sep/2022:13:24:40 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://0.0.0.0:8080/&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\xE2\x19V$Zqi&#x27;\xD7\xFC[\x80\xEF\xBA\xE5\xC7\xE8\xF7&amp;amp;3nS\xEB\xC9\xEC\x91\xC2\xD8\xD1\x89\x9E\xBE \xC7?\xE1\xFA\x04a\x1C\xCE\x90\x0F\x8F\x98u\xE3/\xD8RfOH\xEC\x92+\x93\x5C\xBB\xB1\xBF\xD2m\xB09\x00 \xFA\xFA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03)\x9A\x8FbC\xD9m\xF1\x86\xEBd\x22\xCF\xC4E\x87#~L\xC1\x84\x7F\xB5\x91k\x98\xABl\xEE\x1E[0 \xD0\xD2`\x85\xC6\x8B\x85R\x8B\x87\xEAq&#x7B;P\xF2\xFB\xE2\xA8\x9DI\xF4tH\x99\x13\x10~\xCA1-|\x8E\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:26:28 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora posso ver todas as solicitações que foram feitas ao servidor. Mas se eu quiser ver os logs em tempo real, usando <code>docker logs -f &#x3C;name&#x3E;</code> posso fazer isso.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora posso ver os logs em tempo real. Para sair, pressione <code>CTRL+C</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Como pode chegar um momento em que haja muitos logs, se você quiser apenas os últimos logs, através da opção <code>--tail &#x3C;num&#x3E;</code> você pode ver os últimos <code>&#x3C;num&#x3E;</code> logs. Se adicionar a opção <code>-f</code> estaremos vendo sempre os últimos <code>&#x3C;num&#x3E;</code> logs.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">logs</span> <span class="o">--</span><span class="n">tail</span> <span class="mi">10</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>2022/09/13 13:24:06 [notice] 1#1: start worker process 41
2022/09/13 13:24:06 [notice] 1#1: start worker process 42
172.17.0.1 - - [13/Sep/2022:13:24:16 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\x01E\x14\x8E\xB6\x0BEg\xF3\xC9\x9A\x19\x9C\xCA\xEC\xA7y#3\x92\x05\x95\xDCQ\x07\x19\x1D\xEF\xEA$\xBF# \x0B\x83\xF7-,s\x1B!r\xEA|\xAE\xDF\xA1\x9DLZ\xAA4y\xB3t\xAB\xC0\xCE_\xB8\xE7\xFF&#x27;\xCF\x86\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x8A\x8A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:24:16 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03&#x7D;\xA9Dr&#x7B;\x8C;\x90z\x82\xAD\xBC\x8Az\xC2x\xDF\x1E\x9A\xE6l?\xA7\xE0DoK\x91&#x27;g\xBB\xB5 %\xBB\xFD\xD9\x82?\xDB\x80\xB3T\xF6cJ\xF7\xE5\xC2\xD2\x11\xBC\xA2\x1F\x90\x14\xA3\xEB\xBD=R\xBC\x83\x89\x85\x00 \xCA\xCA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:24:39 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
2022/09/13 13:24:40 [error] 34#34: *3 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 172.17.0.1, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;0.0.0.0:8080&quot;, referrer: &quot;http://0.0.0.0:8080/&quot;
172.17.0.1 - - [13/Sep/2022:13:24:40 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://0.0.0.0:8080/&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\xE2\x19V$Zqi&#x27;\xD7\xFC[\x80\xEF\xBA\xE5\xC7\xE8\xF7&amp;amp;3nS\xEB\xC9\xEC\x91\xC2\xD8\xD1\x89\x9E\xBE \xC7?\xE1\xFA\x04a\x1C\xCE\x90\x0F\x8F\x98u\xE3/\xD8RfOH\xEC\x92+\x93\x5C\xBB\xB1\xBF\xD2m\xB09\x00 \xFA\xFA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03)\x9A\x8FbC\xD9m\xF1\x86\xEBd\x22\xCF\xC4E\x87#~L\xC1\x84\x7F\xB5\x91k\x98\xABl\xEE\x1E[0 \xD0\xD2`\x85\xC6\x8B\x85R\x8B\x87\xEAq&#x7B;P\xF2\xFB\xE2\xA8\x9DI\xF4tH\x99\x13\x10~\xCA1-|\x8E\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
172.17.0.1 - - [13/Sep/2022:13:26:28 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se adicionarmos a opção <code>-t</code>, podemos ver a data e hora de cada log. Dessa forma, se tivermos um problema, podemos saber em que momento ele ocorreu.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">logs</span> <span class="o">--</span><span class="n">tail</span> <span class="o">-</span><span class="n">t</span> <span class="mi">10</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>2022-09-13T13:24:06.573362728Z 2022/09/13 13:24:06 [notice] 1#1: start worker process 41
2022-09-13T13:24:06.651127107Z 2022/09/13 13:24:06 [notice] 1#1: start worker process 42
2022-09-13T13:24:16.651160189Z 172.17.0.1 - - [13/Sep/2022:13:24:16 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\x01E\x14\x8E\xB6\x0BEg\xF3\xC9\x9A\x19\x9C\xCA\xEC\xA7y#3\x92\x05\x95\xDCQ\x07\x19\x1D\xEF\xEA$\xBF# \x0B\x83\xF7-,s\x1B!r\xEA|\xAE\xDF\xA1\x9DLZ\xAA4y\xB3t\xAB\xC0\xCE_\xB8\xE7\xFF&#x27;\xCF\x86\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x8A\x8A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
2022-09-13T13:24:16.116817914Z 172.17.0.1 - - [13/Sep/2022:13:24:16 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03&#x7D;\xA9Dr&#x7B;\x8C;\x90z\x82\xAD\xBC\x8Az\xC2x\xDF\x1E\x9A\xE6l?\xA7\xE0DoK\x91&#x27;g\xBB\xB5 %\xBB\xFD\xD9\x82?\xDB\x80\xB3T\xF6cJ\xF7\xE5\xC2\xD2\x11\xBC\xA2\x1F\x90\x14\xA3\xEB\xBD=R\xBC\x83\x89\x85\x00 \xCA\xCA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
2022-09-13T13:24:39.117398081Z 172.17.0.1 - - [13/Sep/2022:13:24:39 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
2022-09-13T13:24:39.117412408Z 2022/09/13 13:24:40 [error] 34#34: *3 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 172.17.0.1, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;0.0.0.0:8080&quot;, referrer: &quot;http://0.0.0.0:8080/&quot;
2022-09-13T13:24:40.117419389Z 172.17.0.1 - - [13/Sep/2022:13:24:40 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://0.0.0.0:8080/&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
2022-09-13T13:25:00.117434249Z 172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03\xE2\x19V$Zqi&#x27;\xD7\xFC[\x80\xEF\xBA\xE5\xC7\xE8\xF7&amp;amp;3nS\xEB\xC9\xEC\x91\xC2\xD8\xD1\x89\x9E\xBE \xC7?\xE1\xFA\x04a\x1C\xCE\x90\x0F\x8F\x98u\xE3/\xD8RfOH\xEC\x92+\x93\x5C\xBB\xB1\xBF\xD2m\xB09\x00 \xFA\xFA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93\x9A\x9A\x00\x00\x00\x00\x00\x0E\x00\x0C\x00\x00\x09localhost\x00\x17\x00\x00\xFF\x01\x00\x01\x00\x00&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
2022-09-13T13:25:00.223560881Z 172.17.0.1 - - [13/Sep/2022:13:25:00 +0000] &quot;\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03)\x9A\x8FbC\xD9m\xF1\x86\xEBd\x22\xCF\xC4E\x87#~L\xC1\x84\x7F\xB5\x91k\x98\xABl\xEE\x1E[0 \xD0\xD2`\x85\xC6\x8B\x85R\x8B\x87\xEAq&#x7B;P\xF2\xFB\xE2\xA8\x9DI\xF4tH\x99\x13\x10~\xCA1-|\x8E\x00 \xEA\xEA\x13\x01\x13\x02\x13\x03\xC0+\xC0/\xC0,\xC00\xCC\xA9\xCC\xA8\xC0\x13\xC0\x14\x00\x9C\x00\x9D\x00/\x005\x01\x00\x01\x93&quot; 400 157 &quot;-&quot; &quot;-&quot; &quot;-&quot;
2022-09-13T13:26:25.223596738Z 172.17.0.1 - - [13/Sep/2022:13:26:28 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot; &quot;-&quot;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Paramos e apagamos o contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">proxy</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>proxy
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                        PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   26 minutes ago   Exited (137) 13 minutes ago             alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                31 minutes ago   Exited (0) 27 minutes ago               funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                32 minutes ago   Exited (0) 32 minutes ago               hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Dados no Docker">Dados no Docker<a class="anchor-link" href="#Dados no Docker">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Montagens bind">Montagens bind<a class="anchor-link" href="#Montagens bind">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver os contêineres que temos parados</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                        PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   26 minutes ago   Exited (137) 13 minutes ago             alwaysup
5b633e9d838f   ubuntu    &quot;bash&quot;                31 minutes ago   Exited (0) 28 minutes ago               funny_mirzakhani
da16b3a85178   ubuntu    &quot;bash&quot;                32 minutes ago   Exited (0) 32 minutes ago               hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a apagar os dois do Ubuntu nos quais seu comando principal é o Bash e vamos deixar o que ficou como não operação.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">funny_mirzakhani</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>funny_mirzakhani
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">hardcore_kare</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>hardcore_kare
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS                        PORTS     NAMES
ce4d60427dcd   ubuntu    &quot;tail -f /dev/null&quot;   27 minutes ago   Exited (137) 14 minutes ago             alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a voltar a executar o contêiner do Ubuntu que deixamos, isso é feito através do comando <code>start</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">start</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Nós entramos novamente dentro de el</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">alwaysup</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@ce4d60427dcd:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>No contêiner, posso criar uma nova pasta chamada <code>dockerfolder</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerfolder</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se listarmos os arquivos, aparecerá a nova pasta</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bin  boot  dev  dockerfolder  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se sairmos do contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">exit</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>exit
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E o apagamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se listarmos todos os contêineres, o último que criamos já não aparece.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a fazer tudo de novo, mas primeiro vamos criar uma pasta no host na qual compartilharemos os dados com o contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que dentro da pasta não há nada</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora obtemos nosso caminho absoluto</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">pwd</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>/home/wallabot/Documentos/web/portafolio/posts
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Recriamos o contêiner, mas adicionando a opção <code>-v</code> (<code>bind mount</code>). Em seguida, adiciona-se o caminho absoluto da pasta do host e o caminho absoluto da pasta no contêiner, <code>-v &#x3C;host path&#x3E;:&#x3C;container path&#x3E;</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>4ede4512c293bdcc155e9c8e874dfb4a28e5163f4d5c7ddda24ad2863f28921b
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Entreamos no contentor, listamos os arquivos e já aparece a pasta que havíamos criado</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">alwaysup</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@4ede4512c293:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">root</span><span class="o">@</span><span class="mi">4</span><span class="n">ede4512c293</span><span class="p">:</span><span class="o">/</span><span class="c1"># ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bin   dev                    etc   lib    lib64   media  opt   root  sbin  sys  usr
boot  dockerContainerFolder  home  lib32  libx32  mnt    proc  run   srv   tmp  var
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ao diretório do contêiner que compartilhamos, criamos um arquivo e saímos do contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">root</span><span class="o">@</span><span class="mi">4</span><span class="n">ede4512c293</span><span class="p">:</span><span class="o">/</span><span class="c1"># cd dockerContainerFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">root</span><span class="o">@</span><span class="mi">4</span><span class="n">ede4512c293</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span><span class="c1"># touch bindFile.txt</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">root</span><span class="o">@</span><span class="mi">4</span><span class="n">ede4512c293</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span><span class="c1"># exit</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>exit
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver o que tem dentro da pasta compartida</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Mas ainda, se apagarmos o contêiner, o arquivo continua lá.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se eu criar novamente um contêiner compartilhando as pastas, todos os arquivos estarão no contêiner.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>6c021d37ea29d8b23fe5cd4968baa446085ae1756682f65340288b4c851c362d
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">alwaysup</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@6c021d37ea29:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">root</span><span class="o">@</span><span class="mi">6</span><span class="n">c021d37ea29</span><span class="p">:</span><span class="o">/</span><span class="c1"># ls dockerContainerFolder/</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt:/#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Eliminamos o contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Volumes">Volumes<a class="anchor-link" href="#Volumes">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Os volumes foram criados como uma evolução dos <code>bind mounts</code> para fornecer mais segurança. Podemos listar todos os volumes do Docker usando <code>docker volume ls</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>DRIVER    VOLUME NAME
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a criar um novo volume para o contêiner do Ubuntu, para isso usamos o comando <code>docker volume create &#x3C;nome_do_volume&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">volume</span> <span class="n">create</span> <span class="n">ubuntuVolume</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ubuntuVolume
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se listarmos os volumes novamente, aparecerá o que acabamos de criar.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>DRIVER    VOLUME NAME
local     ubuntuVolume
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>No entanto, não aparece como uma pasta no sistema de arquivos do host. Com <code>ls -d */</code> listamos todas as pastas</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="o">-</span><span class="n">d</span> <span class="o">*/</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockerHostFolder/  __pycache__/
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a voltar a criar um contêiner, mas agora o criamos com o volume que acabamos de criar com a opção <code>--mount</code>, indicando o volume fonte mediante <code>src=&#x3C;nome do volume&#x3E;</code> (se o volume não existisse, docker o criaria), a seguir o destino separado por uma <code>,</code>, <code>dst=&#x3C;caminho do contêiner&#x3E;</code>, ou seja <code>--mount src=&#x3C;nome do volume&#x3E;,dst=&#x3C;caminho do contêiner&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">--</span><span class="n">mount</span> <span class="n">src</span><span class="o">=</span><span class="n">ubuntuVolume</span><span class="p">,</span><span class="n">dst</span><span class="o">=/</span><span class="n">dockerVolumeFolder</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>42cdcddf4e46dc298a87b0570115e0b2fc900cb4c6db5eea22a61409b8cb271d
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Uma vez criado, podemos ver os volumes do contêiner usando o comando <code>inspect</code> e filtrando por <code>&#x27;{{.Mounts}}&#x27;</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker inspect --format &#39;&#123;&#123;.Mountns&#125;&#125;&#39; alwaysup<br>[<br>&#x20;&#x20;&#123;<br>&#x20;&#x20;&#x20;&#x20;volume ubuntuVolume /var/lib/docker/volumes/ubuntuVolume/_data /dockerVolumeFolder local z true<br>&#x20;&#x20;&#125;<br>]</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que o volume se chama <code>ubuntuVolume</code> e além disso podemos ver o caminho onde está armazenado, neste caso em <code>/var/lib/docker/volumes/ubuntuVolume/_data</code>. Fazemos o mesmo que antes, entramos no contêiner, criamos um arquivo no caminho do volume, saímos e vemos no host se foi criado.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it alwaysup bash<br>root@42cdcddf4e46:/# touch dockerVolumeFolder/volumeFile.txt<br>root@42cdcddf4e46:/# exit</code></pre></div>
      </section>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ sudo ls /var/lib/docker/volumes/ubuntuVolume/_data<br>volumeFile.txt</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>O arquivo está criado.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Inserir e extrair arquivos de um conteiner">Inserir e extrair arquivos de um contêiner<a class="anchor-link" href="#Inserir e extrair arquivos de um conteiner">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Primeiro vamos criar um arquivo que queremos copiar dentro de um contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Entramos no contêiner</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it alwaysup bash<br>root@42cdcddf4e46:/#</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Criamos uma nova pasta onde vamos copiar o arquivo e sair.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@42cdcddf4e46:/# mkdir folderToCopy<br>root@42cdcddf4e46:/# ls<br>bin  boot  dev  dockerVolumeFolder  etc  folderToCopy  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var<br>root@42cdcddf4e46:/# exit<br>sair</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Copiamos dentro do contêiner o arquivo por meio do comando <code>cp</code>, indicando o arquivo que **quero** copiar, o contêiner onde queremos copiá-lo e o caminho dentro do contêiner, <code>docker cp &#x3C;file&#x3E; &#x3C;container&#x3E;:&#x3C;container path&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">cp</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span> <span class="n">alwaysup</span><span class="p">:</span><span class="o">/</span><span class="n">folderToCopy</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Voltamos a entrar no contêiner e verificamos se o arquivo está lá.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it alwaysup bash<br>root@42cdcddf4e46:/# ls folderToCopy/<br>Parece que hay un malentendido. No has proporcionado el contenido de `text.txt` para que pueda traducirlo. Por favor, comparte el texto markdown que deseas traducir al portugués.</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Sair do contêiner</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">/# sair<br>saída</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Agora vamos extrair o arquivo do contêiner e salvá-lo no host com outro nome. Para isso, usamos novamente o comando <code>cp</code>, mas indicando agora o contêiner, o caminho do arquivo no contêiner e o caminho e nome que queremos que o arquivo tenha no host, <code>docker cp &#x3C;container&#x3E;:&#x3C;caminho_do_arquivo_no_docker&#x3E; &#x3C;caminho_do_arquivo_no_host&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">cp</span> <span class="n">alwaysup</span><span class="p">:</span><span class="o">/</span><span class="n">folderToCopy</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">fileExtract</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que está no host</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt  fileExtract.txt  text.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Embora o contêiner esteja parado, também é possível copiar arquivos.</p>
</section>
<section class="section-block-markdown-cell">
<p>Por último, apagamos o contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Imagens">Imagens<a class="anchor-link" href="#Imagens">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Conceitos fundamentais">Conceitos fundamentais<a class="anchor-link" href="#Conceitos fundamentais">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>As imagens são os arquivos ("modelos") com toda a configuração para criar um contêiner. Cada vez que criamos um contêiner, ele é criado a partir de uma imagem. Quando criávamos contêineres novos, a primeira vez aparecia uma mensagem dizendo que não tínhamos a imagem e que iria baixá-la. No Docker Hub existem muitas imagens com todo tipo de máquinas, mas para um ambiente de desenvolvimento muito específico podemos criar nosso próprio modelo para passá-lo a alguém e trabalhar em um contêiner com a mesma configuração que o nosso.</p>
</section>
<section class="section-block-markdown-cell">
<p>Podemos ver todas as imagens que temos salvas no nosso computador através do comando <code>docker image ls</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
nginx         latest    2d389e545974   8 hours ago     142MB
ubuntu        latest    2dc39ba059dc   11 days ago     77.8MB
hello-world   latest    feb5d9fea6a5   11 months ago   13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Podemos ver os tamanhos, e podemos ver como a de <code>nginx</code> ocupa muito e por isso demorou mais para baixar do que as outras.</p>
</section>
<section class="section-block-markdown-cell">
<p>Outra coluna que podemos ver é a de <code>TAG</code>, isso indica a versão da imagem. Em todas está escrito <code>latest</code>, o que significa que é a mais recente. Isso significa que, no momento do download, baixamos a última versão disponível no Docker Hub. Isso não é ideal em um ambiente de desenvolvimento, pois podemos baixar uma imagem do Ubuntu sem especificar a versão, por exemplo, a 20.04. Mas depois de algum tempo, alguém pode querer desenvolver com você e baixar essa imagem, mas como a versão não foi especificada, será baixada novamente a mais recente, que no caso pode ser a 22.04. Isso pode levar a problemas e fazer com que algo funcione para uma pessoa e não para a outra.</p>
</section>
<section class="section-block-markdown-cell">
<p>Podemos ver todas as imagens que há no Docker Hub indo a <code>https://hub.docker.com/</code>. Lá você poderá buscar a imagem que melhor se adapte ao projeto que quiser fazer. Se navegarmos até a imagem do Ubuntu, por exemplo, podemos ver as versões (<code>tags</code>) das imagens.</p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a baixar, **mas não executar** uma imagem. Para isso usamos o comando <code>docker pull &#x3C;hub&#x3E; &#x3C;image name&#x3E;:&#x3C;tag&#x3E;</code>. Se não indicarmos o hub, ele será baixado do docker hub por padrão, mas podemos indicar outro, por exemplo um privado da nossa organização. Também, se não indicarmos o tag, por padrão baixará a última versão.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">pull</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">20.04</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>20.04: Pulling from library/ubuntu

Digest: sha256:35ab2bf57814e9ff49e365efd5a5935b6915eede5c7f8581e9e1b85e0eecbe16[1A
Status: Downloaded newer image for ubuntu:20.04
docker.io/library/ubuntu:20.04
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se voltarmos a listar as imagens, veremos que agora temos duas imagens do Ubuntu, uma com o tag <code>20.04</code> e outra com o tag <code>latest</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
nginx         latest    2d389e545974   8 hours ago     142MB
ubuntu        latest    2dc39ba059dc   11 days ago     77.8MB
ubuntu        20.04     a0ce5a295b63   11 days ago     72.8MB
hello-world   latest    feb5d9fea6a5   11 months ago   13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Criar imagens através de Dockerfile">Criar imagens através de <code>Dockerfile</code><a class="anchor-link" href="#Criar imagens através de Dockerfile">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Criamos um diretório no host chamado <code>dockerImages</code> para trabalhar nele.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Criamos um arquivo <code>Dockerfile</code> com o qual criaremos uma imagem</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerImages</span><span class="o">/</span><span class="n">Dockerfile</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Abrimos o arquivo criado com nosso editor preferido e escrevemos o seguinte:</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu:latest
</code></pre></div>
<p>Isso diz ao Docker para criar a imagem a partir da imagem <code>latest</code> do Ubuntu.</p>
</section>
<section class="section-block-markdown-cell">
<p>A seguir, escrevemos um comando que será executado em tempo de compilação</p>
<div class='highlight'><pre><code class="language-Dockerfile">RUN touch /test.txt
</code></pre></div>
<p>Isso significa que quando o <code>Dockerfile</code> for compilado, esse comando será executado, mas não quando o contêiner da imagem for executado.</p>
</section>
<section class="section-block-markdown-cell">
<p>No final o <code>Dockerfile</code> fica assim:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile">FROM ubuntu:latest<br>RUN touch /test.txt</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Compilamos o <code>Dockerfile</code> através do comando <code>build</code>, com a opção <code>-t</code> podemos dar-lhe um <code>tag</code>. Por último, é necessário indicar a rota do contexto de <code>build</code>, mais tarde explicaremos isso.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/2 : FROM ubuntu:latest
 ---&amp;gt; 2dc39ba059dc
Step 2/2 : RUN touch /test.txt
 ---&amp;gt; Using cache
 ---&amp;gt; a78cf3ea16d8
Successfully built a78cf3ea16d8
Successfully tagged ubuntu:test

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como podemos ver, a compilação ocorre em 2 etapas, cada uma possui uma <code>id</code>, cada uma dessas <code>id</code>s são camadas da imagem, isso também será abordado posteriormente.</p>
<p>Voltamos a ver as imagens que temos salvias no nosso computador e aparece a que acabamos de criar</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
ubuntu        test      a78cf3ea16d8   8 minutes ago   77.8MB
nginx         latest    2d389e545974   8 hours ago     142MB
ubuntu        latest    2dc39ba059dc   11 days ago     77.8MB
ubuntu        20.04     a0ce5a295b63   11 days ago     72.8MB
hello-world   latest    feb5d9fea6a5   11 months ago   13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Executamos o contêiner a partir da imagem que acabamos de criar</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker run -it ubuntu:test<br>root@b57b9d4eedeb:/#</code></pre></div>
      </section>
<p>Entramos no bash do contêiner. Como dissemos, o comando RUN é executado durante a compilação da imagem, portanto, o arquivo que pedimos para ser criado deve estar em nosso contêiner.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@b57b9d4eedeb:/# ls<br>bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  test.txt  tmp  usr  var</code></pre></div>
      </section>
<p>É importante entender que esse arquivo foi criado quando a imagem foi construída, ou seja, a imagem do contêiner já possui esse arquivo. Ele não é criado quando o contêiner é iniciado.</p>
<p>Saimos do contêiner</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@b57b9d4eedeb:/# exit<br>saída</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Já que já temos uma imagem, poderíamos enviá-la para o hub do Docker, mas vamos listar as imagens novamente antes disso.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY    TAG       IMAGE ID       CREATED          SIZE
ubuntu        test      a78cf3ea16d8   20 minutes ago   77.8MB
nginx         latest    2d389e545974   8 hours ago      142MB
ubuntu        latest    2dc39ba059dc   11 days ago      77.8MB
ubuntu        20.04     a0ce5a295b63   11 days ago      72.8MB
hello-world   latest    feb5d9fea6a5   11 months ago    13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se vê, está nos dizendo que a imagem que acabamos de criar pertence ao repositório do Ubuntu, mas nós não temos acesso ao repositório do Ubuntu, então no Docker Hub precisamos criar uma conta para poder enviar a imagem ao nosso repositório. No meu caso, meu repositório se chama <code>maximofn</code>, então altero o repositório da imagem usando o comando <code>tag</code>, indicando a imagem que queremos mudar de repositório e o novo repositório. No novo repositório, geralmente indica-se o nome do repositório seguido do tipo de imagem e o tag, no meu caso <code>maximofn/ubuntu:test</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">tag</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se agora listarmos as imagens novamente</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY        TAG       IMAGE ID       CREATED          SIZE
ubuntu            test      a78cf3ea16d8   24 minutes ago   77.8MB
maximofn/ubuntu   test      a78cf3ea16d8   24 minutes ago   77.8MB
nginx             latest    2d389e545974   8 hours ago      142MB
ubuntu            latest    2dc39ba059dc   11 days ago      77.8MB
ubuntu            20.04     a0ce5a295b63   11 days ago      72.8MB
hello-world       latest    feb5d9fea6a5   11 months ago    13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora devemos fazer login no Docker Hub para poder enviar a imagem, para isso usamos o comando <code>login</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker login<br>Faça login com seu Docker ID para enviar e receber imagens do Docker Hub. Se você não tiver um Docker ID, vá até https://hub.docker.com para criar um.<br>Nome de usuário: maximofn<br>Senha:<br><br>Login bem-sucedido</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Agora podemos fazer o upload da imagem através do comando <code>push</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">push</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The push refers to repository [docker.io/maximofn/ubuntu]

06994357: Preparing 
06994357: Pushed  from library/ubuntu test: digest: sha256:318d83fc3c35ff930d695b0dc1c5ad1b0ea54e1ec6e3478b8ca85c05fd793c4e size: 735
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Ele apenas carregou a primeira camada, a segunda, como usei a partir da imagem do Ubuntu, o que faz é colocar um ponteiro para essa imagem para não ter camadas carregadas mais de uma vez.</p>
</section>
<section class="section-block-markdown-cell">
<p>Deve-se ter em conta que este repositório é público, portanto não deve enviar imagens com dados sensíveis. Além disso, se uma imagem não tiver uso em 6 meses, ela será excluída.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="O sistema de camadas">O sistema de camadas<a class="anchor-link" href="#O sistema de camadas">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Com o comando <code>history</code> podemos ver as camadas de uma imagem. Se formos ver as camadas da imagem que acabamos de criar, usamos <code>docker history ubuntu:test</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">history</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>IMAGE          CREATED        CREATED BY                                      SIZE      COMMENT
a78cf3ea16d8   3 minutes ago  /bin/sh -c touch /test.txt                      0B        
2dc39ba059dc   12 days ago    /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B        
&amp;lt;missing&amp;gt;      12 days ago    /bin/sh -c #(nop) ADD file:a7268f82a86219801…   77.8MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que a primeira camada tem o comando que introduzimos no <code>Dockerfile</code>, além de dizer que foi criada há 3 minutos. No entanto, o resto das camadas foram criadas há 12 dias, e são as camadas da imagem do Ubuntu na qual nos baseamos.</p>
</section>
<section class="section-block-markdown-cell">
<p>Ao <code>Dockerfile</code> que criamos anteriormente adicionamos a linha</p>
<div class='highlight'><pre><code class="language-docker">RUN rm /test.txt
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>No final o <code>Dockerfile</code> fica assim:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile">FROM ubuntu:latest<br>RUN touch /test.txt<br>RUN rm /test.txt</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Se recompilarmos, veremos o que acontece</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM ubuntu:latest
 ---&amp;gt; 2dc39ba059dc
Step 2/3 : RUN touch /test.txt
 ---&amp;gt; Using cache
 ---&amp;gt; a78cf3ea16d8
Step 3/3 : RUN rm /test.txt
 ---&amp;gt; Running in c2e6887f2025
Removing intermediate container c2e6887f2025
 ---&amp;gt; 313243a9b573
Successfully built 313243a9b573
Successfully tagged ubuntu:test

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como podemos ver, há uma camada adicional com a nova linha que adicionamos. Se voltarmos a ver as camadas da imagem com <code>history</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">history</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>IMAGE          CREATED              CREATED BY                                      SIZE      COMMENT
313243a9b573   About a minute ago   /bin/sh -c rm /test.txt                         0B        
a78cf3ea16d8   3 minutes ago        /bin/sh -c touch /test.txt                      0B        
2dc39ba059dc   12 days ago          /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B        
&amp;lt;missing&amp;gt;      12 days ago          /bin/sh -c #(nop) ADD file:a7268f82a86219801…   77.8MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que as primeiras camadas são iguais às de antes e adicionou uma nova camada com o novo comando</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Pesquisa no Docker Hub">Pesquisa no Docker Hub<a class="anchor-link" href="#Pesquisa no Docker Hub">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Não é necessário entrar na página do Docker Hub para procurar imagens, isso pode ser feito diretamente da terminal. Para isso, usamos o comando <code>docker search &#x3C;nome da imagem&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">search</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>NAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
ubuntu                           Ubuntu is a Debian-based Linux operating sys…   16425     [OK]       
websphere-liberty                WebSphere Liberty multi-architecture images …   297       [OK]       
open-liberty                     Open Liberty multi-architecture images based…   62        [OK]       
neurodebian                      NeuroDebian provides neuroscience research s…   104       [OK]       
ubuntu-debootstrap               DEPRECATED; use &quot;ubuntu&quot; instead                52        [OK]       
ubuntu-upstart                   DEPRECATED, as is Upstart (find other proces…   115       [OK]       
ubuntu/nginx                     Nginx, a high-performance reverse proxy &amp;amp; we…   98                   
ubuntu/squid                     Squid is a caching proxy for the Web. Long-t…   66                   
ubuntu/cortex                    Cortex provides storage for Prometheus. Long…   4                    
ubuntu/apache2                   Apache, a secure &amp;amp; extensible open-source HT…   60                   
ubuntu/kafka                     Apache Kafka, a distributed event streaming …   35                   
ubuntu/mysql                     MySQL open source fast, stable, multi-thread…   53                   
ubuntu/bind9                     BIND 9 is a very flexible, full-featured DNS…   62                   
ubuntu/prometheus                Prometheus is a systems and service monitori…   51                   
ubuntu/zookeeper                 ZooKeeper maintains configuration informatio…   12                   
ubuntu/postgres                  PostgreSQL is an open source object-relation…   31                   
ubuntu/redis                     Redis, an open source key-value store. Long-…   19                   
ubuntu/grafana                   Grafana, a feature rich metrics dashboard &amp;amp; …   9                    
ubuntu/memcached                 Memcached, in-memory keyvalue store for smal…   5                    
ubuntu/dotnet-aspnet             Chiselled Ubuntu runtime image for ASP.NET a…   11                   
ubuntu/dotnet-deps               Chiselled Ubuntu for self-contained .NET &amp;amp; A…   11                   
ubuntu/prometheus-alertmanager   Alertmanager handles client alerts from Prom…   9                    
ubuntu/dotnet-runtime            Chiselled Ubuntu runtime image for .NET apps…   10                   
ubuntu/cassandra                 Cassandra, an open source NoSQL distributed …   2                    
ubuntu/telegraf                  Telegraf collects, processes, aggregates &amp;amp; w…   4
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Uso do Docker para criar aplicacoes">Uso do Docker para criar aplicações<a class="anchor-link" href="#Uso do Docker para criar aplicacoes">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Exposicao de portas">Exposição de portas<a class="anchor-link" href="#Exposicao de portas">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Antes vimos como podíamos vincular um porta de um contêiner a uma porta do computador (<code>-p 8080:80</code>). Mas para que isso seja possível, na hora de criar a imagem é preciso expor a porta, isso se faz adicionando ao Dockerfile a linha <code>EXPOSE &#x3C;port&#x3E;</code>, no caso anterior</p>
<div class='highlight'><pre><code class="language-docker">EXPOSE 80
</code></pre></div>
<p>Ou usar imagens como base que já tenham portas expostas</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Reutilizacao do cache de camadas ao compilar">Reutilização do cache de camadas ao compilar<a class="anchor-link" href="#Reutilizacao do cache de camadas ao compilar">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Quando compilamos uma imagem, se alguma das camadas que definimos já foram compiladas antes, o Docker detecta e as usa, não as recompila. Se recompilarmos a imagem que definimos no <code>Dockerfile</code>, agora levará muito pouco tempo, pois todas as camadas já estão compiladas e o Docker não as recompila.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM ubuntu:latest
 ---&amp;gt; 2dc39ba059dc
Step 2/3 : RUN touch /test.txt
 ---&amp;gt; Using cache
 ---&amp;gt; a78cf3ea16d8
Step 3/3 : RUN rm /test.txt
 ---&amp;gt; Using cache
 ---&amp;gt; 313243a9b573
Successfully built 313243a9b573
Successfully tagged ubuntu:test

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Na segunda e terceira camada aparece o texto <code>Using cache</code></p>
<p>Como isso é um caderno Jupyter, ao executar as células ele fornece a informação do tempo que elas levam para serem executadas. Da última vez que compilei a imagem, demorou 1,4 segundos, enquanto agora levou 0,5 segundos.</p>
</section>
<section class="section-block-markdown-cell">
<p>Mas se agora eu mudar o Dockerfile, e na primeira linha, onde dizia que estávamos baseados na versão mais recente do Ubuntu, mudamos para a versão 20.04</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:20.04
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>No final o <code>Dockerfile</code> fica assim:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile">FROM ubuntu:20.04<br>RUN touch /test.txt<br>RUN rm /test.txt</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Se recompilarmos, levará muito mais tempo.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">test</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM ubuntu:20.04
 ---&amp;gt; a0ce5a295b63
Step 2/3 : RUN touch /test.txt
 ---&amp;gt; Running in a40fe8df2c0d
Removing intermediate container a40fe8df2c0d
 ---&amp;gt; 0bb9b452c11f
Step 3/3 : RUN rm /test.txt
 ---&amp;gt; Running in 2e14919f3685
Removing intermediate container 2e14919f3685
 ---&amp;gt; fdc248fa833b
Successfully built fdc248fa833b
Successfully tagged ubuntu:test

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Demorou 1,9 segundos e o texto <code>Using cache</code> não aparece mais.</p>
</section>
<section class="section-block-markdown-cell">
<p>Ao alterar a primeira camada, o Docker recompila todas as camadas. Isso pode ser um problema porque, durante o desenvolvimento de código, pode ocorrer o seguinte caso</p>
<ul>
  <li>Desenvolvemos o código em nosso computador</li>
  <li>Ao construir a imagem, copiamos todo o código do nosso computador para o contêiner</li>
  <li>Em seguida, pedimos à imagem para instalar as bibliotecas necessárias</li>
</ul>
<p>Isso pode fazer com que ao alterar qualquer parte do código, ao ter que recompilar a imagem, a camada na qual as bibliotecas são instaladas precise ser recompilada novamente, pois uma camada anterior foi alterada.</p>
</section>
<section class="section-block-markdown-cell">
<p>Para resolver isso, a ideia seria que na hora de criar a imagem, primeiro peçamos que se instalem as bibliotecas e depois que se copie o código do nosso computador para o contêiner. Assim, cada vez que alterarmos o código e recompilarmos a imagem, apenas será recompilada a camada em que se copia o código, portanto, a compilação será mais rápida</p>
</section>
<section class="section-block-markdown-cell">
<p>Você pode pensar que é melhor compartilhar uma pasta entre o host e o contêiner (<code>bind mount</code>) onde teremos o código e assim não será necessário recompilar a imagem toda vez que alterarmos o código. E a resposta é que é verdade, coloquei apenas este exemplo porque é muito fácil de entender, mas é para ilustrar que na hora de criar imagens é preciso pensar bem de forma que, se for necessário recompilá-la, recompile o menor número possível de camadas.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Escrever corretamente um Dockerfile">Escrever corretamente um Dockerfile<a class="anchor-link" href="#Escrever corretamente um Dockerfile">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Como vimos, o Docker não recompila as camadas de um Dockerfile se já as tiver compilado anteriormente, portanto, as carrega do cache. Vamos ver como deve ser a forma correta de escrever um Dockerfile para aproveitar isso.</p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a partir deste Dockerfile para ir comentando possíveis correções</p>
<div class='highlight'><pre><code class="language-Dockerfile">DE ubuntu
COPY ./sourceCode /sourceCode
RUN apt-get update
RUN apt-get install -y python3 ssh
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
<p>Como pode ser visto, parte-se de uma imagem do Ubuntu, copia-se a pasta com o código, atualizam-se os repositórios, instala-se o Python, instala-se também o SSH e executa-se a aplicação.</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="Copiar o codigo antes da execucao">Copiar o código antes da execução<a class="anchor-link" href="#Copiar o codigo antes da execucao">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Como dissem antes, se primeiro copiarmos o código e depois instalarmos o Python, cada vez que fizermos uma mudança no código e compilarmos a imagem, ela será compilada inteira, mas se copiarmos o código após instalar o Python, cada vez que alterarmos o código e compilarmos a imagem, apenas compilará a partir da cópia do código e não reinstalará o Python, por isso o Dockerfile deveria ficar assim</p>
<div class='highlight'><pre><code class="language-Dockerfile">DE ubuntu
RUN apt-get update
RUN apt-get install -y python3 ssh
COPY ./sourceCode /sourceCode
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Copiar apenas o codigo necessario">Copiar apenas o código necessário<a class="anchor-link" href="#Copiar apenas o codigo necessario">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Estamos copiando a pasta com todo o código, mas talvez dentro temos código que não precisamos, por isso é necessário copiar apenas o código que realmente precisamos para a aplicação, desta forma a imagem ocupará menos memória. De modo que o Dockerfile ficaria assim</p>
<div class='highlight'><pre><code class="language-Dockerfile">DE ubuntu
RUN apt-get update
RUN apt-get install -y python3 ssh
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Atualizar repositorios e instalar python na mesma linha">Atualizar repositórios e instalar python na mesma linha<a class="anchor-link" href="#Atualizar repositorios e instalar python na mesma linha">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Estamos atualizando os repositórios em uma linha e em outra instalando python3.</p>
<div class='highlight'><pre><code class="language-Dockerfile">DE ubuntu
RUN apt-get update &amp;&amp; apt-get install -y python3 ssh
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Nao instalar ssh">Não instalar ssh<a class="anchor-link" href="#Nao instalar ssh">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Havíamos instalado ssh na imagem para poder depurar em caso de precisar, mas isso faz com que a imagem ocupe mais memória. Em caso de precisarmos depurar, deveríamos entrar no contêiner, instalar ssh e, em seguida, depurar. Por isso, removemos a instalação do ssh.</p>
<div class='highlight'><pre><code class="language-Dockerfile">DE ubuntu
RUN apt-get update &amp;&amp; apt-get install -y python3
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Usar --no-install-recommends">Usar <code>--no-install-recommends</code><a class="anchor-link" href="#Usar --no-install-recommends">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Quando instalamos algo no Ubuntu, ele instala pacotes recomendados, mas que não precisamos, por isso a imagem ocupa mais espaço. Então, para evitá-lo, adicionamos à instalação <code>--no-install-recommends</code></p>
<div class='highlight'><pre><code class="language-Dockerfile">DE ubuntu
RUN apt-get update &amp;&amp; apt-get install -y python3 --no-install-recommends
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Apagar lista de repositorios atualizados">Apagar lista de repositórios atualizados<a class="anchor-link" href="#Apagar lista de repositorios atualizados">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Nós atualizamos a lista de repositórios e instalamos o python, mas uma vez feito, já não precisamos da lista de repositórios atualizados, pois tudo o que farão é aumentar o tamanho da imagem, então os removemos após instalar o python e na mesma linha.</p>
<div class='highlight'><pre><code class="language-Dockerfile">DE ubuntu
RUN apt-get update &amp;&amp; apt-get install -y python3 --no-install-recommends &amp;&amp; rm -rf /var/lib/apt/lists/*
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Usar uma imagem de Python">Usar uma imagem de Python<a class="anchor-link" href="#Usar uma imagem de Python">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Tudo o que fizemos para atualizar a lista de pacotes e instalar o Python não é necessário, já que existem imagens do Python baseadas no Ubuntu, que com certeza seguiram boas práticas e podem até ter feito melhor do que nós, além de ter sido escaneada em busca de vulnerabilidades pelo Docker Hub. Portanto, removemos tudo isso e partimos de uma imagem do Python.</p>
<div class='highlight'><pre><code class="language-Dockerfile">DE python
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Especificar a imagem do Python">Especificar a imagem do Python<a class="anchor-link" href="#Especificar a imagem do Python">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Ao não especificar a imagem do Python, está sendo baixada a última, mas dependendo de quando você construir o contêiner, pode ser baixada uma ou outra, por isso é necessário adicionar a tag com a versão do Python desejada.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Escolher uma tag pequena">Escolher uma tag pequena<a class="anchor-link" href="#Escolher uma tag pequena">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Escolhemos a tag <code>3.9.18</code>, mas essa versão do Python tem um monte de bibliotecas que provavelmente não precisamos, então podemos usar as versões <code>3.9.18-slim</code> que têm muitas menos bibliotecas instaladas, ou a versão <code>3.9.18-alpine</code> que é uma versão do Python baseada no Alpine e não no Ubuntu. O Alpine é uma distribuição Linux muito leve que tem muito poucos pacotes instalados e que costuma ser usada bastante em contêineres Docker para ocupar muito pouco espaço.</p>
<p>A imagem de python <code>3.9.18</code> ocupa 997 MB, a <code>3.9.18-slim</code> ocupa 126 MB e a <code>3.9.18-alpine</code> ocupa 47,8 MB</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
COPY ./sourceCode/sourceApp /sourceCode/sourceApp
CMD ["python3", "/sourceCode/sourceApp/app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Indique o workspace">Indique o workspace<a class="anchor-link" href="#Indique o workspace">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Em vez de indicar o caminho da imagem <code>/sourceCode/sourceApp</code>, estabelecemos que esse caminho seja o workspace da imagem. Assim, quando copiarmos o código ou executarmos a aplicação, não é necessário indicar o caminho.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
WORKDIR /sourceCode/sourceApp
COPY ./sourceCode/sourceApp .
CMD ["python3", "app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Indique o workspace">Indique o workspace<a class="anchor-link" href="#Indique o workspace">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Em vez de indicar o caminho da imagem <code>/sourceCode/sourceApp</code>, estabelecemos que esse caminho seja o workspace da imagem. Assim, quando copiarmos o código ou executarmos a aplicação, não é necessário indicar o caminho.</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
WORKDIR /sourceCode/sourceApp
COPY ./sourceCode/sourceApp .
CMD ["python3", "app.py"]
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Código compartilhado em uma pasta bind mount">Código compartilhado em uma pasta <code>bind mount</code><a class="anchor-link" href="#Código compartilhado em uma pasta bind mount">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Havíamos criado uma pasta chamada <code>dockerHostFolder</code> na qual havíamos compartilhado arquivos entre o host e um contêiner. Dentro, além disso, deveriam haver três arquivos.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="n">dockerHostFolder</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bindFile.txt  fileExtract.txt  text.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos aproveitar o arquivo <code>text.txt</code> para ver isso. Vamos ver o que há dentro de <code>text.txt</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cat</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Não há saída, o arquivo está vazio. Vamos criar novamente um contêiner do Ubuntu compartilhando a pasta <code>dockerHostFolder</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">alwaysup</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">dockerContainerFolder</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>24adbded61f507cdf7f192eb5e246e43ee3ffafc9944b7c57918eb2d547dff19
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que o contêiner está rodando</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS          PORTS     NAMES
24adbded61f5   ubuntu    &quot;tail -f /dev/null&quot;   16 seconds ago   Up 15 seconds             alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Entramos no contêiner, vemos que está <code>text.txt</code> e que está vazio</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it alwaysup bash<br>root@24adbded61f5:/# ls dockerContainerFolder/<br>bindFile.txt  fileExtract.txt  text.txt<br>root@24adbded61f5:/# cat dockerContainerFolder/text.txt<br>root@24adbded61f5:/#</code></pre></div>
      </section>
<p>Agora abrimos no host o arquivo <code>text.txt</code> com o editor de textos que quisermos, escrevemos <code>Hola mundo</code> e salvamos. Se agora vemos o que há dentro do arquivo no contêiner, veremos o mesmo texto.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@24adbded61f5:/# cat dockerContainerFolder/text.txt<br>Olá mundo</code></pre></div>
      </section>
<p>Agora editamos o arquivo no contêiner e saímos do contêiner</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@24adbded61f5:/# echo olá contêiner &gt; dockerContainerFolder/text.txt<br>root@24adbded61f5:/# cat dockerContainerFolder/text.txt<br>olá contêiner<br>root@24adbded61f5:/# exit<br>saída</code></pre></div>
      </section>
<p>Se olharmos para o arquivo no host, veremos o texto que escrevemos no contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cat</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>hola contenedor
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Apagamos o contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">alwaysup</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>alwaysup
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Conectar contentores por rede">Conectar contentores por rede<a class="anchor-link" href="#Conectar contentores por rede">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Em caso de quisermos ter vários contêineres rodando e querermos que eles se comuniquem, podemos fazer com que se comuniquem por rede. O Docker nos dá a possibilidade de fazer isso através de suas redes virtuais.</p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver quais redes o Docker tem através do comando <code>docker network ls</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>NETWORK ID     NAME      DRIVER    SCOPE
de6e8b7b737e   bridge    bridge    local
da1f5f6fccc0   host      host      local
d3b0d93993c0   none      null      local
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que por padrão o Docker tem três redes</p>
<ul>
  <li>bridge: Está por retrocompatibilidade com versões anteriores, mas não deveríamos usá-la mais</li>
  <li>host: É a rede do host</li>
  <li>none: Esta é a opção que devemos usar se quisermos que um contêiner não tenha acesso à internet</li>
</ul>
</section>
<section class="section-block-markdown-cell">
<p>Podemos criar novas redes às quais outros contêineres possam se conectar, para isso usamos o comando <code>docker network create &#x3C;name&#x3E;</code>, para que outros contêineres possam se conectar também devemos adicionar a opção <code>--attachable</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="o">--</span><span class="n">attachable</span> <span class="n">myNetwork</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>2f6f3ddbfa8642e9f6819aa0965c16339e9e910be7bcf56ebb718fcac324cc27
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Podemos inspecioná-la através do comando <code>docker network inspect &#x3C;name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">inspect</span> <span class="n">myNetwork</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[
&#x20;&#x20;&#x20;&#x20;&#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Name&quot;: &quot;myNetwork&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Id&quot;: &quot;2f6f3ddbfa8642e9f6819aa0965c16339e9e910be7bcf56ebb718fcac324cc27&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Created&quot;: &quot;2022-09-14T15:20:08.539830161+02:00&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Scope&quot;: &quot;local&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Driver&quot;: &quot;bridge&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;EnableIPv6&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;IPAM&quot;: &#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Driver&quot;: &quot;default&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Options&quot;: &#x7B;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Config&quot;: [
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Subnet&quot;: &quot;172.18.0.0/16&quot;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Gateway&quot;: &quot;172.18.0.1&quot;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;]
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Internal&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Attachable&quot;: true,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Ingress&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ConfigFrom&quot;: &#x7B;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Network&quot;: &quot;&quot;
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;ConfigOnly&quot;: false,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Containers&quot;: &#x7B;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Options&quot;: &#x7B;&#x7D;,
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&quot;Labels&quot;: &#x7B;&#x7D;
&#x20;&#x20;&#x20;&#x20;&#x7D;
]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora temos que criar dois contêineres para que eles possam se comunicar.</p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a criar um novo contêiner, que chamaremos de <code>container1</code>, com uma pasta compartilhada e que dentro dele se chamará <code>folder1</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">container1</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">folder1</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>a5fca8ba1e4ff0a67002f8f1b8cc3cd43185373c2a7e295546f774059ad8dd1a
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora criamos outro contêiner, chamado <code>container2</code>, com outra pasta compartilhada, mas que se chame <code>folder2</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">container2</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">v</span> <span class="o">~/</span><span class="n">Documentos</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">portafolio</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">dockerHostFolder</span><span class="p">:</span><span class="o">/</span><span class="n">folder2</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>6c8dc18315488ef686f7548516c19b3d716728dd8a173cdb889ec0dd082232f9
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos os contêineres rodando e vemos que estão os dois</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED         STATUS         PORTS     NAMES
6c8dc1831548   ubuntu    &quot;tail -f /dev/null&quot;   3 seconds ago   Up 2 seconds             container2
a5fca8ba1e4f   ubuntu    &quot;tail -f /dev/null&quot;   4 seconds ago   Up 3 seconds             container1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora temos que conectar os contêineres à rede, para isso usamos o comando <code>docker network connect &#x3C;network name&#x3E; &#x3C;container name&#x3E;</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">connect</span> <span class="n">myNetwork</span> <span class="n">container1</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">connect</span> <span class="n">myNetwork</span> <span class="n">container2</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Para verificar que foram conectados corretamente, podemos inspecionar a rede, mas filtrando pelos contêineres conectados.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker network inspect --format &#39;&#123;&#123;.Containers&#125;&#125;&#39; myNetwork<br>mapa<br>[<br>6c8dc18315488ef686f7548516c19b3d716728dd8a173cdb889ec0dd082232f9:<br>&#123;<br>container2<br>f828d211e894f7a5a992ce41a2a0def8e2424e9737fb4e1485fc09cc2d607b69<br>02:42:ac:12:00:03<br>172.18.0.3/16<br>&#125;<br>a5fca8ba1e4ff0a67002f8f1b8cc3cd43185373c2a7e295546f774059ad8dd1a:<br>&#123;<br>container1<br>cff762e6286ebc169804b2a675bbff904102de796751d367c18d4b490c994c45<br>02:42:ac:12:00:02<br>172.18.0.2/16<br>&#125;<br>]</code></pre></div>
      </section>
<p>Como podemos ver o contentor <code>container1</code> tem o IP <code>172.18.0.2</code> e o contentor <code>container2</code> tem o IP <code>172.18.0.3</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Entramos no contêiner <code>container1</code> e instalamos <code>ping</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it container1 bash<br>root@a5fca8ba1e4f:/# apt update<br>...<br>root@a5fca8ba1e4f:/# apt install iputils-ping<br>Claro, por favor proporciona el texto markdown que deseas que traduzca al portugés.<br>root@a5fca8ba1e4f:/#</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Entramos no contêiner <code>container2</code> e instalamos <code>ping</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it container2 bash<br>root@a5fca8ba1e4f:/# apt update<br>...<br>root@a5fca8ba1e4f:/# apt install iputils-ping<br>...<br>root@a5fca8ba1e4f:/#</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Agora do contêiner <code>container1</code> fazemos um ping ao IP <code>172.18.0.3</code>, que pertence ao contêiner <code>container2</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@a5fca8ba1e4f:/# ping 172.18.0.3<br>PING 172.18.0.3 (172.18.0.3) 56(84) bytes de dados.<br>64 bytes de 172.18.0.3: icmp_seq=1 ttl=64 tempo=0.115 ms<br>64 bytes de 172.18.0.3: icmp_seq=2 ttl=64 time=0.049 ms<br>64 bytes de 172.18.0.3: icmp_seq=3 ttl=64 tempo=0.056 ms<br>64 bytes de 172.18.0.3: icmp_seq=4 ttl=64 tempo=0,060 ms<br>^C<br>--- estatísticas do ping para 172.18.0.3 ---<br>4 pacotes transmitidos, 4 recebidos, 0% de perda de pacotes, tempo 3068ms<br>rtt min/avg/max/mdev = 0,049/0,070/0,115/0,026 ms</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>E do contêiner <code>container2</code> fazemos um ping ao IP <code>172.18.0.2</code>, que pertence ao contêiner <code>container1</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@6c8dc1831548:/# ping 172.18.0.2<br>PING 172.18.0.2 (172.18.0.2) 56(84) bytes de dados.<br>64 bytes de 172.18.0.2: icmp_seq=1 ttl=64 time=0.076 ms<br>64 bytes de 172.18.0.2: icmp_seq=2 ttl=64 time=0.045 ms<br>64 bytes de 172.18.0.2: icmp_seq=3 ttl=64 time=0.049 ms<br>64 bytes de 172.18.0.2: icmp_seq=4 ttl=64 time=0.051 ms<br>^C<br>--- estatísticas de ping para 172.18.0.2 ---<br>4 pacotes transmitidos, 4 recebidos, 0% de perda de pacotes, tempo 3074ms<br>rtt min/avg/max/mdev = 0,045/0,055/0,076/0,012 ms</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Mas há uma coisa melhor que nos permite fazer com o Docker: se eu não souber o IP do contêiner ao qual quero me conectar, em vez de escrever seu IP, posso escrever seu nome.</p>
</section>
<section class="section-block-markdown-cell">
<p>Agora, do contêiner <code>container1</code>, fazemos um ping ao IP de <code>container2</code>.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@a5fca8ba1e4f:/# ping container2<br>PING container2 (172.18.0.3) 56(84) bytes de dados.<br>64 bytes de container2.myNetwork (172.18.0.3): icmp_seq=1 ttl=64 time=0.048 ms<br>64 bytes de container2.myNetwork (172.18.0.3): icmp_seq=2 ttl=64 time=0.050 ms<br>64 bytes de container2.myNetwork (172.18.0.3): icmp_seq=3 ttl=64 time=0,052 ms<br>64 bytes de container2.myNetwork (172.18.0.3): icmp_seq=4 ttl=64 tempo=0,053 ms<br>^C<br>--- estatísticas do ping do container2 ---<br>4 pacotes transmitidos, 4 recebidos, 0% de perda de pacotes, tempo 3071ms<br>rtt min/avg/max/mdev = 0,048/0,050/0,053/0,002 ms</code></pre></div>
      </section>
<p>Como vemos, o Docker sabe que o IP do contêiner <code>container2</code> é a <code>172.18.0.3</code></p>
</section>
<section class="section-block-markdown-cell">
<p>E do contêiner <code>container2</code> fazemos um ping ao IP de <code>container1</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@6c8dc1831548:/# ping container1<br>PING container1 (172.18.0.2) 56(84) bytes de dados.<br>64 bytes de container1.myNetwork (172.18.0.2): icmp_seq=1 ttl=64 tempo=0.051 ms<br>64 bytes de container1.myNetwork (172.18.0.2): icmp_seq=2 ttl=64 time=0.058 ms<br>64 bytes de container1.myNetwork (172.18.0.2): icmp_seq=3 ttl=64 time=0,052 ms<br>64 bytes de container1.myNetwork (172.18.0.2): icmp_seq=4 ttl=64 time=0,056 ms<br>^C<br>--- estatísticas do container1 ping ---<br>4 pacotes transmitidos, 4 recebidos, 0% de perda de pacotes, tempo 3057ms<br>rtt min/avg/max/mdev = 0,051/0,054/0,058/0,003 ms</code></pre></div>
      </section>
<p>Como vemos, o Docker sabe que o IP do contêiner <code>container1</code> é a <code>172.18.0.2</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Saimos dos contêineres e os apagamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">container1</span> <span class="n">container2</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>container1
container2
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Apagamos também a rede que criamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">rm</span> <span class="n">myNetwork</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>myNetwork
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Uso de GPUs">Uso de GPUs<a class="anchor-link" href="#Uso de GPUs">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Para poder usar as GPUs do host dentro dos contêineres Docker, é necessário seguir os passos descritos na página de instalação do <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">Nvidia container toolkit</a>.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Configurar o repositorio e a chave GPG">Configurar o repositório e a chave GPG<a class="anchor-link" href="#Configurar o repositorio e a chave GPG">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Temos que configurar o repositório do <code>nvidia container toolkit</code> e a chave GPG. Para isso, execute o seguinte comando no terminal:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">distribuição=$(. /etc/os-release;echo $ID$VERSION_ID) \<br>&amp;&amp; curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \<br>&amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \<br>sed &#39;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#39; | \<br>sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<h3 id="Instalação do nvidia container toolkit">Instalação do <code>nvidia container toolkit</code><a class="anchor-link" href="#Instalação do nvidia container toolkit">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Uma vez atualizamos o repositório e a chave, atualizamos os repositórios por meio do comando</p>
<div class='highlight'><pre><code class="language-bash">sudo apt update
</code></pre></div>
<p>E instalamos <code>nvidia container toolkit</code></p>
<div class='highlight'><pre><code class="language-bash">sudo apt install -y nvidia-docker2
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Reinicio do Docker">Reinício do Docker<a class="anchor-link" href="#Reinicio do Docker">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Uma vez que tenhamos terminado, temos que reiniciar o demônio do Docker através de</p>
<div class='highlight'><pre><code class="language-bash">sudo systemctl restart docker
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Uso de GPUs">Uso de GPUs<a class="anchor-link" href="#Uso de GPUs">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Agora que configuramos o Docker para poder usar as GPUs do host dentro dos contêineres, podemos testá-lo através da opção <code>--gpus all</code>. Se houver mais de uma GPU e quiser usar apenas 1, seria necessário especificá-la, mas por enquanto aqui explicamos apenas como usar todas.</p>
</section>
<section class="section-block-markdown-cell">
<p>Criamos um contêiner que não será executado em segundo plano, mas sim irá executar o comando <code>nvidia-smi</code> para que possamos verificar se ele tem acesso às GPUs.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">container_gpus</span> <span class="o">--</span><span class="n">gpus</span> <span class="nb">all</span> <span class="n">ubuntu</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;ubuntu:latest&#x27; locally
latest: Pulling from library/ubuntu

6a12be2b: Pull complete .54MB/29.54MBBDigest: sha256:aabed3296a3d45cede1dc866a24476c4d7e093aa806263c27ddaadbdce3c1054
Status: Downloaded newer image for ubuntu:latest
Mon Sep  4 07:10:36 2023       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 510.39.01    Driver Version: 510.39.01    CUDA Version: 11.6     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Quadro T1000        On   | 00000000:01:00.0 Off |                  N/A |
| N/A   44C    P0    15W /  N/A |      9MiB /  4096MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|    0   N/A  N/A      2545      G                                       4MiB |
|    0   N/A  N/A      3421      G                                       4MiB |
+-----------------------------------------------------------------------------+
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Apagamos o contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">doker</span> <span class="n">rm</span> <span class="n">container_gpus</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Docker compose">Docker compose<a class="anchor-link" href="#Docker compose">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose vs docker-compose">Docker compose vs docker-compose<a class="anchor-link" href="#Docker compose vs docker-compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p><code>docker-compose</code> foi uma ferramenta criada para ajudar no mantenimiento de imagens e contêineres, e era necessário instalá-la separadamente do Docker. No entanto, o Docker incorporou essa funcionalidade em suas últimas versões, e agora não é mais necessário instalá-la separadamente. Para usá-la, em vez de usar o comando <code>docker-compose</code>, você deve usar o comando <code>docker compose</code>. Em muitos lugares, você encontrará informações usando <code>docker-compose</code>, mas ao instalar o Docker, o <code>docker compose</code> já virá instalado, portanto tudo que podia ser feito com <code>docker-compose</code> é compatível com <code>docker compose</code>.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose">Docker compose<a class="anchor-link" href="#Docker compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Docker Compose é uma ferramenta do Docker que faz tudo o que vimos até agora, mas nos economizando tempo e esforço. Editando um arquivo <code>.yml</code>, podemos dizer ao Docker Compose para criar todos os contêineres que quisermos.</p>
<p>Para usar uma vez não haverá muita diferença entre escrever todos os comandos que vimos antes ou escrever o arquivo <code>.yml</code>, mas quando quiser ter a mesma configuração de contêineres funcionando novamente, basta chamar o arquivo <code>.yml</code> e ele recriará toda a configuração.</p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a criar uma pasta onde armazenaremos os arquivos do Docker Compose</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerComposeFiles</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Criamos o arquivo .yml dentro</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerComposeFiles</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Um arquivo Docker Compose deve começar com a versão</p>
<div class='highlight'><pre><code class="language-json">versão: "&lt;v.v&gt;"
</code></pre></div>
<p>No momento de escrever isso, a última versão é a <code>3.8</code> então escrevemos essa</p>
</section>
<section class="section-block-markdown-cell">
<p>*docker-compose.yml*:</p>
<div class='highlight'><pre><code class="language-json">versão: "3.8"
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>A seguir estão indicados os serviços, que são os contentores. Em cada serviço tem de especificar a imagem e, além disso, podem ser adicionados outros parâmetros como portas, variáveis de ambiente, etc.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">serviços:<br>container1:<br>image: ubuntu<br>    <br>container2:<br>image: ubuntu</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>O <code>docker-compose.yml</code> ficaria assim:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">versão: "3.8"<br><br>serviços:<br>container1:<br>imagem: ubuntu<br>    <br>container2:<br>image: ubuntu</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Uma vez que temos criado o arquivo, em seu caminho, podemos executar tudo através do comando <code>docker compose up</code>, mas adicionando a opção <code>-d</code> faremos com que ele rode em segundo plano.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 1/0
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠋ Container dockercomposefiles-container2-1  Creating                     0.0s
 ⠋ Container dockercomposefiles-container1-1  Creating                     0.0s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠙ Container dockercomposefiles-container2-1  Creating                     0.1s
 ⠙ Container dockercomposefiles-container1-1  Creating                     0.1s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.2s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.2s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.3s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.3s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.4s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.4s
[+] Running 1/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.5s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.5s
[+] Running 2/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Started                      0.5s
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.6s
[+] Running 3/3
 ⠿ Network dockercomposefiles_default         Created                      0.1s
 ⠿ Container dockercomposefiles-container2-1  Started                      0.5s
 ⠿ Container dockercomposefiles-container1-1  Started                      0.7s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se podemos observar, ele criou dois contentores <code>dockercomposefiles-container1-1</code> e <code>dockercomposefiles-container2-1</code> e a rede que os conecta <code>dockercomposefiles_default</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a apagar os dois contêineres</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">dockercomposefiles</span><span class="o">-</span><span class="n">container1</span><span class="o">-</span><span class="mi">1</span> <span class="n">dockercomposefiles</span><span class="o">-</span><span class="n">container2</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container1-1
dockercomposefiles-container2-1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E apagamos a rede que foi criada</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">rm</span> <span class="n">dockercomposefiles_default</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles_default
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos tentar fazer o que fizemos anteriormente com o que sabemos até agora. Vamos criar uma nova imagem que venha com <code>ping</code> instalado.</p>
<p>*Arquivo Dockerfile*:</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:20.04
RUN apt update
RUN apt install iputils-ping -y
</code></pre></div>
<p>E a compilamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span> <span class="o">./</span><span class="n">dockerImages</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM ubuntu:20.04
 ---&amp;gt; a0ce5a295b63
Step 2/3 : RUN apt update
 ---&amp;gt; Running in 3bd5278d39b4

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Get:1 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]
Get:2 http://archive.ubuntu.com/ubuntu focal InRelease [265 kB]
Get:3 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [898 kB]
Get:4 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]
Get:5 http://archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]
Get:6 http://archive.ubuntu.com/ubuntu focal/universe amd64 Packages [11.3 MB]
Get:7 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [2133 kB]
Get:8 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [27.5 kB]
Get:9 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [1501 kB]
Get:10 http://archive.ubuntu.com/ubuntu focal/main amd64 Packages [1275 kB]
Get:11 http://archive.ubuntu.com/ubuntu focal/restricted amd64 Packages [33.4 kB]
Get:12 http://archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [177 kB]
Get:13 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [2594 kB]
Get:14 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [1613 kB]
Get:15 http://archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [30.2 kB]
Get:16 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [1200 kB]
Get:17 http://archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [27.4 kB]
...
Successfully built c3d32aa9de02
Successfully tagged ubuntu:ping

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Verificamos que foi criado</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY        TAG       IMAGE ID       CREATED              SIZE
ubuntu            ping      c3d32aa9de02   About a minute ago   112MB
maximofn/ubuntu   test      a78cf3ea16d8   25 hours ago         77.8MB
nginx             latest    2d389e545974   33 hours ago         142MB
ubuntu            latest    2dc39ba059dc   12 days ago          77.8MB
ubuntu            20.04     a0ce5a295b63   12 days ago          72.8MB
hello-world       latest    feb5d9fea6a5   11 months ago        13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Mudamos o tag</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">tag</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY        TAG       IMAGE ID       CREATED              SIZE
ubuntu            ping      c3d32aa9de02   About a minute ago   112MB
maximofn/ubuntu   ping      c3d32aa9de02   About a minute ago   112MB
maximofn/ubuntu   test      c3d32aa9de02   About a minute ago   112MB
nginx             latest    2d389e545974   33 hours ago         142MB
ubuntu            latest    2dc39ba059dc   12 days ago          77.8MB
ubuntu            20.04     a0ce5a295b63   12 days ago          72.8MB
hello-world       latest    feb5d9fea6a5   11 months ago        13.3kB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Editamos o arquivo Docker Compose para que utilize as imagens que acabamos de criar</p>
<p>*docker-compose.yml*:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">versão: "3.8"<br><br>serviços:<br>container1:<br>image: maximofn/ubuntu:ping<br><br>container2:<br>image: maximofn/ubuntu:ping</code></pre></div>
      </section>
<p>E além disso, dizemos para executar uma não operação</p>
<p>O <code>docker-compose.yml</code> ficaria assim:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">versão: "3.8"<br><br>serviços:<br>container1:<br>imagem: ubuntu<br>command: tail -f /dev/null<br><br>container2:<br>imagem: ubuntu<br>command: tail -f /dev/null</code></pre></div>
      </section>
<p>O levantamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 0/0
 ⠋ Container dockercomposefiles-container1-1  Recreate                     0.1s
 ⠋ Container dockercomposefiles-container2-1  Recreate                     0.1s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠙ Container dockercomposefiles-container2-1  Recreate                     0.2s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠹ Container dockercomposefiles-container2-1  Recreate                     0.3s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠸ Container dockercomposefiles-container2-1  Recreate                     0.4s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠼ Container dockercomposefiles-container2-1  Recreate                     0.5s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠴ Container dockercomposefiles-container2-1  Recreate                     0.6s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠦ Container dockercomposefiles-container2-1  Recreate                     0.7s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠧ Container dockercomposefiles-container2-1  Recreate                     0.8s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠇ Container dockercomposefiles-container2-1  Recreate                     0.9s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠏ Container dockercomposefiles-container2-1  Recreate                     1.0s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠋ Container dockercomposefiles-container2-1  Recreate                     1.1s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠙ Container dockercomposefiles-container2-1  Recreate                     1.2s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠹ Container dockercomposefiles-container2-1  Recreate                     1.3s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
 ⠸ Container dockercomposefiles-container2-1  Recreate                     1.4s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Recreated                    0.1s
...
[+] Running 2/2
 ⠿ Container dockercomposefiles-container1-1  Started                     10.8s
 ⠿ Container dockercomposefiles-container2-1  Started                     10.9s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container1-1  Started                     10.8s
 ⠿ Container dockercomposefiles-container2-1  Started                     10.9s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos os contêineres que estão rodando</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE                  COMMAND               CREATED          STATUS          PORTS     NAMES
935939e5a75d   maximofn/ubuntu:ping   &quot;tail -f /dev/null&quot;   15 seconds ago   Up 13 seconds             dockercomposefiles-container2-1
f9138d7064dd   maximofn/ubuntu:ping   &quot;tail -f /dev/null&quot;   25 seconds ago   Up 13 seconds             dockercomposefiles-container1-1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Os dois contêineres estão em execução, agora vamos entrar em um deles e tentar fazer <code>ping</code> no outro.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker exec -it dockercomposefiles-container1-1 bash<br>root@f9138d7064dd:/# ping dockercomposefiles-container2-1<br>PING dockercomposefiles-container2-1 (172.21.0.3) 56(84) bytes de dados.<br>64 bytes de dockercomposefiles-container2-1.dockercomposefiles_default (172.21.0.3): icmp_seq=1 ttl=64 tempo=0,110 ms<br>64 bytes de dockercomposefiles-container2-1.dockercomposefiles_default (172.21.0.3): icmp_seq=2 ttl=64 time=0.049 ms<br>64 bytes de dockercomposefiles-container2-1.dockercomposefiles_default (172.21.0.3): icmp_seq=3 ttl=64 time=0.049 ms<br>64 bytes de dockercomposefiles-container2-1.dockercomposefiles_default (172.21.0.3): icmp_seq=4 ttl=64 tempo=0,075 ms<br>^C<br>--- estatísticas do ping do container2-1 do dockercomposefiles ---<br>4 pacotes transmitidos, 4 recebidos, 0% de perda de pacotes, tempo 3068ms<br>rtt min/avg/max/mdev = 0,049/0,070/0,110/0,025 ms</code></pre></div>
      </section>
<p>Como vemos, podemos fazer <code>ping</code>, criamos a imagem com <code>ping</code> instalado. Além disso, no docker-compose fizemos com que seja executada uma operação nula para que os contêineres continuem em execução.</p>
</section>
<section class="section-block-markdown-cell">
<p>Apagamos os dois contêineres e a rede que criamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">dockercomposefiles</span><span class="o">-</span><span class="n">container1</span><span class="o">-</span><span class="mi">1</span> <span class="n">dockercomposefiles</span><span class="o">-</span><span class="n">container2</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container1-1
dockercomposefiles-container2-1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">rm</span> <span class="n">dockercomposefiles_default</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles_default
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Como o Docker Compose nomeia os conteineres">Como o Docker Compose nomeia os contêineres<a class="anchor-link" href="#Como o Docker Compose nomeia os conteineres">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Se nós observarmos, os contêineres criados pelo Docker se chamam <code>dockercomposefiles-container1-1</code> e <code>dockercomposefiles-container2-1</code>. Isso ocorre porque a pasta em que está o arquivo do Docker Compose está dentro de uma pasta chamada <code>dockerComposeFiles</code>, por isso a primeira parte do nome dos contêineres é <code>dockercomposefiles</code>, seguida pelo nome do serviço que demos no arquivo do Docker Compose (<code>container1</code> e <code>container2</code>) e, por fim, um número para poder criar mais se necessário.</p>
<p>O mesmo ocorre com o nome da rede que foi criada <code>dockercomposefiles_default</code></p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Logs no docker compose">Logs no docker compose<a class="anchor-link" href="#Logs no docker compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Vamos agora a mudar o arquivo Docker Compose, nas linhas em que tínhamos <code>command: tail -f /dev/null</code>, vamos colocar <code>command: ping 0.0.0.0</code></p>
<p>E além disso, dizemos para ele executar uma não operação.</p>
<p>O <code>docker-compose.yml</code> ficaria assim:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">versão: "3.8"<br><br>serviços:<br>container1:<br>imagem: ubuntu<br>comando: ping 0.0.0.0<br><br>container2:<br>imagem: ubuntu<br>comando: ping 0.0.0.0</code></pre></div>
      </section>
<p>Isso fazemos para que cada contêiner esteja enviando o ping constantemente, assim simulamos alguns logs</p>
<p>Se executarmos novamente o docker compose</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 0/0
 ⠋ Container dockercomposefiles-container1-1  Recreate                     0.1s
 ⠋ Container dockercomposefiles-container2-1  Recreate                     0.1s
[+] Running 0/2
 ⠙ Container dockercomposefiles-container1-1  Recreate                     0.2s
 ⠙ Container dockercomposefiles-container2-1  Recreate                     0.2s
[+] Running 0/2
 ⠹ Container dockercomposefiles-container1-1  Recreate                     0.3s
 ⠹ Container dockercomposefiles-container2-1  Recreate                     0.3s
[+] Running 0/2
 ⠸ Container dockercomposefiles-container1-1  Recreate                     0.4s
 ⠸ Container dockercomposefiles-container2-1  Recreate                     0.4s
[+] Running 0/2
 ⠼ Container dockercomposefiles-container1-1  Recreate                     0.5s
 ⠼ Container dockercomposefiles-container2-1  Recreate                     0.5s
[+] Running 0/2
 ⠴ Container dockercomposefiles-container1-1  Recreate                     0.6s
 ⠴ Container dockercomposefiles-container2-1  Recreate                     0.6s
[+] Running 0/2
 ⠦ Container dockercomposefiles-container1-1  Recreate                     0.7s
 ⠦ Container dockercomposefiles-container2-1  Recreate                     0.7s
[+] Running 0/2
 ⠧ Container dockercomposefiles-container1-1  Recreate                     0.8s
 ⠧ Container dockercomposefiles-container2-1  Recreate                     0.8s
[+] Running 0/2
...
 ⠿ Container dockercomposefiles-container1-1  Starting                    11.0s
 ⠿ Container dockercomposefiles-container2-1  Started                     11.0s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container1-1  Started                     11.1s
 ⠿ Container dockercomposefiles-container2-1  Started                     11.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora podemos ver os logs dos dois contêineres através do comando <code>docker compose logs</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">logs</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container2-1  | PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.042 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.025 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.022 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.030 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.021 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.021 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.030 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=8 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=9 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=10 ttl=64 time=0.026 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=11 ttl=64 time=0.028 ms
dockercomposefiles-container1-1  | PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=12 ttl=64 time=0.027 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=13 ttl=64 time=0.039 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=14 ttl=64 time=0.035 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=15 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=16 ttl=64 time=0.036 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=17 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=18 ttl=64 time=0.036 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=19 ttl=64 time=0.032 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=20 ttl=64 time=0.032 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=21 ttl=64 time=0.033 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=22 ttl=64 time=0.034 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.037 ms
...
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=214 ttl=64 time=0.015 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=215 ttl=64 time=0.021 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=216 ttl=64 time=0.020 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=217 ttl=64 time=0.049 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como vemos, podemos ver os logs dos dois contêineres, mas no caso de querer ver apenas os de um, podemos especificar o **nome do serviço**</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">logs</span> <span class="n">container1</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container1-1  | PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.037 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.025 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.023 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.031 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.034 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.033 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.034 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=8 ttl=64 time=0.022 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=9 ttl=64 time=0.032 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=10 ttl=64 time=0.029 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=11 ttl=64 time=0.031 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=12 ttl=64 time=0.024 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=13 ttl=64 time=0.029 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=14 ttl=64 time=0.032 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=15 ttl=64 time=0.033 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=16 ttl=64 time=0.034 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=17 ttl=64 time=0.028 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=18 ttl=64 time=0.034 ms
...
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=332 ttl=64 time=0.027 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=333 ttl=64 time=0.030 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=334 ttl=64 time=0.033 ms
dockercomposefiles-container1-1  | 64 bytes from 127.0.0.1: icmp_seq=335 ttl=64 time=0.036 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">logs</span> <span class="n">container2</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>dockercomposefiles-container2-1  | PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.042 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.025 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.022 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.030 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.021 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.021 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.030 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=8 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=9 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=10 ttl=64 time=0.026 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=11 ttl=64 time=0.028 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=12 ttl=64 time=0.027 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=13 ttl=64 time=0.039 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=14 ttl=64 time=0.035 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=15 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=16 ttl=64 time=0.036 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=17 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=18 ttl=64 time=0.036 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=19 ttl=64 time=0.032 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=20 ttl=64 time=0.032 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=21 ttl=64 time=0.033 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=22 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=23 ttl=64 time=0.035 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=24 ttl=64 time=0.037 ms
...
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=340 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=341 ttl=64 time=0.033 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=342 ttl=64 time=0.034 ms
dockercomposefiles-container2-1  | 64 bytes from 127.0.0.1: icmp_seq=343 ttl=64 time=0.036 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se quisermos ver os logs continuamente, podemos adicionar a opção <code>-f</code>: <code>docker compose logs -f &#x3C;service name&#x3E;</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Se eu criei um docker compose com mais de dois serviços, quando se quiser ver os logs de vários serviços basta adicionar mais nomes ao comando, <code>docker compose logs &#x3C;nome serviço 1&#x3E; &#x3C;nome serviço 2&#x3E; ...</code></p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Exec servicos">Exec serviços<a class="anchor-link" href="#Exec servicos">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Como vimos, através do comando <code>exec</code> podemos entrar em um contêiner indicando o nome do contêiner, o comando que se deseja executar e a opção <code>-it</code>. Com Docker Compose isso é mais simples, pois apenas é necessário o nome do serviço e o comando, mas não é necessária a opção <code>-it</code>, já que o Docker Compose assume essa opção por padrão.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker compose exec container1 bash<br>root@a7cf282fe66c:/#</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<h3 id="Parando docker compose">Parando docker compose<a class="anchor-link" href="#Parando docker compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Quando terminamos de trabalhar, com um único comando (<code>stop</code>), o Docker Compose para tudo, não é necessário parar um a um cada contêiner.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">stop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 0/0
 ⠋ Container dockercomposefiles-container2-1  Stopping                     0.1s
 ⠋ Container dockercomposefiles-container1-1  Stopping                     0.1s
[+] Running 0/2
 ⠙ Container dockercomposefiles-container2-1  Stopping                     0.2s
 ⠙ Container dockercomposefiles-container1-1  Stopping                     0.2s
[+] Running 0/2
 ⠹ Container dockercomposefiles-container2-1  Stopping                     0.3s
 ⠹ Container dockercomposefiles-container1-1  Stopping                     0.3s
[+] Running 0/2
 ⠸ Container dockercomposefiles-container2-1  Stopping                     0.4s
 ⠸ Container dockercomposefiles-container1-1  Stopping                     0.4s
[+] Running 0/2
 ⠼ Container dockercomposefiles-container2-1  Stopping                     0.5s
 ⠼ Container dockercomposefiles-container1-1  Stopping                     0.5s
[+] Running 0/2
 ⠴ Container dockercomposefiles-container2-1  Stopping                     0.6s
 ⠴ Container dockercomposefiles-container1-1  Stopping                     0.6s
[+] Running 0/2
 ⠦ Container dockercomposefiles-container2-1  Stopping                     0.7s
 ⠦ Container dockercomposefiles-container1-1  Stopping                     0.7s
[+] Running 0/2
 ⠧ Container dockercomposefiles-container2-1  Stopping                     0.8s
 ⠧ Container dockercomposefiles-container1-1  Stopping                     0.8s
...
[+] Running 1/2
 ⠿ Container dockercomposefiles-container2-1  Stopped                     10.4s
 ⠸ Container dockercomposefiles-container1-1  Stopping                    10.4s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container2-1  Stopped                     10.4s
 ⠿ Container dockercomposefiles-container1-1  Stopped                     10.4s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como se pode ver, o Docker Compose parou os dois contêineres, mas não os excluiu, nem excluiu a rede.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE                  COMMAND          CREATED          STATUS                        PORTS     NAMES
1e6c1dd9adb2   maximofn/ubuntu:ping   &quot;ping 0.0.0.0&quot;   16 minutes ago   Exited (137) 25 seconds ago             dockercomposefiles-container2-1
a7cf282fe66c   maximofn/ubuntu:ping   &quot;ping 0.0.0.0&quot;   16 minutes ago   Exited (137) 25 seconds ago             dockercomposefiles-container1-1
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">network</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>NETWORK ID     NAME                         DRIVER    SCOPE
13cc632147f3   bridge                       bridge    local
d4a2f718cd83   dockercomposefiles_default   bridge    local
da1f5f6fccc0   host                         host      local
d3b0d93993c0   none                         null      local
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose como ferramenta de desenvolvimento">Docker compose como ferramenta de desenvolvimento<a class="anchor-link" href="#Docker compose como ferramenta de desenvolvimento">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Assim como vimos antes, para poder desenvolver, o ideal seria compartilhar a pasta que tem o código com o serviço. Isso com docker compose se faz adicionando a etiqueta <code>volumes</code> ao arquivo docker compose. Primeiro temos que adicionar a rota da pasta onde está o código no host e depois a rota no contêiner.</p>
<p>*docker-compose.yml*:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">versão: "3.8"<br><br>serviços:<br>container1:<br>image: ubuntu<br>comando: ping 0.0.0.0<br>volumes:<br>- ../dockerHostFolder/:/dockerContainerFolder<br><br>container2:<br>image: ubuntu<br>comando: ping 0.0.0.0</code></pre></div>
      </section>
<p>Como se pode ver, o caminho da pasta do host coloquei relativo</p>
<p>Se subirmos o Docker Compose</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 1/0
 ⠋ Container dockercomposefiles-container1-1  Recreate                     0.1s
 ⠿ Container dockercomposefiles-container2-1  Created                      0.0s
[+] Running 0/2
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.2s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.2s
[+] Running 0/2
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.3s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.3s
[+] Running 0/2
 ⠿ Container dockercomposefiles-container1-1  Starting                     0.4s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.4s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container1-1  Started                      0.5s
 ⠿ Container dockercomposefiles-container2-1  Starting                     0.5s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container1-1  Started                      0.5s
 ⠿ Container dockercomposefiles-container2-1  Started                      0.6s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se entrarmos no contêiner, podemos ver o que há dentro do arquivo text.txt</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker compose exec container1 bash<br>root@c8aae9d619d3:/# ls dockerContainerFolder/<br>bindFile.txt  fileExtract.txt  text.txt<br>root@c8aae9d619d3:/# cat dockerContainerFolder/text.txt<br>olá contêiner</code></pre></div>
      </section>
<p>Se agora o abrirmos no host, escrevemos <code>hola host</code> e voltamos a ver no contêiner</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@c8aae9d619d3:/# cat dockerContainerFolder/text.txt<br>olá host</code></pre></div>
      </section>
<p>E agora ao contrário, se o modificarmos no contêiner</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">root@c8aae9d619d3:/# echo olá compose &gt; dockerContainerFolder/text.txt<br>root@c8aae9d619d3:/# exit<br>sair</code></pre></div>
      </section>
<p>Se o vemos do host, devemos obter <code>hola compose</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cat</span> <span class="n">dockerHostFolder</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>hola compose
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Exposicao de portas no docker compose">Exposição de portas no docker compose<a class="anchor-link" href="#Exposicao de portas no docker compose">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Também podemos configurar as portas no arquivo do Docker Compose, através da etiqueta <code>ports</code>, indicando a porta do host e em seguida o IP do serviço</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">portos:<br>- &lt;porta do host&gt;:&lt;porta do serviço&gt;</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose em equipe - docker override">Docker compose em equipe - docker override<a class="anchor-link" href="#Docker compose em equipe - docker override">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Se formos um grupo de pessoas desenvolvendo com Docker e Docker Compose, é provável que muitas pessoas estejam alterando o arquivo Docker Compose, o que pode fazer com que não se sincronizem bem e haja conflitos.</p>
<p>Para resolver isso, o Docker oferece uma ferramenta chamada Docker Override. Dessa forma, pode haver um arquivo Docker Compose base e cada um pode modificá-lo por meio do Docker Override.</p>
<p>Para fazer isso, agora temos que criar um arquivo chamado <code>docker-compose.override.yml</code> que será o que poderemos editar</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerComposeFiles</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se agora tentarmos subir o Docker Compose, vamos receber um erro.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Top-level object must be a mapping
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E isso porque o Docker Compose detectou que há um arquivo chamado <code>docker-compose.override.yml</code> e que está vazio, então vamos editá-lo. O arquivo <code>docker-compose.override.yml</code> serve para editar o arquivo <code>docker-compose.yml</code>, então, se quisermos fazer uma alteração no serviço <code>container2</code> para adicionar um volume, escreveríamos assim o arquivo <code>docker-compose.override.yml</code></p>
<p>*docker-compose.override.yml*:</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-json">versão: "3.8"<br><br>serviços:<br>container2:<br>volumes:<br>- ../dockerHostFolder/:/dockerOverrideFolder</code></pre></div>
      </section>
<p>Note que a pasta compartida no serviço foi chamada de <code>dockerOverrideFolder</code>, então vamos iniciar o docker compose e verificar se vemos essa pasta no contêiner <code>container2</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 1/0
 ⠋ Container dockercomposefiles-container2-1  Recreate                     0.1s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠙ Container dockercomposefiles-container2-1  Recreate                     0.2s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠹ Container dockercomposefiles-container2-1  Recreate                     0.3s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠸ Container dockercomposefiles-container2-1  Recreate                     0.4s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠼ Container dockercomposefiles-container2-1  Recreate                     0.5s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠴ Container dockercomposefiles-container2-1  Recreate                     0.6s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠦ Container dockercomposefiles-container2-1  Recreate                     0.7s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 1/2
 ⠧ Container dockercomposefiles-container2-1  Recreate                     0.8s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
...
[+] Running 1/2
 ⠿ Container dockercomposefiles-container2-1  Starting                    10.8s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container2-1  Started                     10.8s
 ⠿ Container dockercomposefiles-container1-1  Running                      0.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que levou 10 segundos para iniciar o serviço <code>container2</code>, isso se deve ao fato de estar aplicando as alterações.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker compose exec container2 bash<br>root@d8777a4e611a:/# ls dockerOverrideFolder/<br>bindFile.txt  fileExtract.txt  text.txt<br>root@d8777a4e611a:/# cat dockerOverrideFolder/text.txt<br>olá compose<br>root@d8777a4e611a:/# exit<br>saída</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Descemos o Compose e apagamos os contêineres e a rede criada</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">dockerComposeFiles</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">compose</span> <span class="n">down</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Running 0/0
 ⠋ Container dockercomposefiles-container2-1  Stopping                     0.1s
 ⠋ Container dockercomposefiles-container1-1  Stopping                     0.1s
[+] Running 0/2
 ⠙ Container dockercomposefiles-container2-1  Stopping                     0.2s
 ⠙ Container dockercomposefiles-container1-1  Stopping                     0.2s
[+] Running 0/2
 ⠹ Container dockercomposefiles-container2-1  Stopping                     0.3s
 ⠹ Container dockercomposefiles-container1-1  Stopping                     0.3s
[+] Running 0/2
 ⠸ Container dockercomposefiles-container2-1  Stopping                     0.4s
 ⠸ Container dockercomposefiles-container1-1  Stopping                     0.4s
[+] Running 0/2
 ⠼ Container dockercomposefiles-container2-1  Stopping                     0.5s
 ⠼ Container dockercomposefiles-container1-1  Stopping                     0.5s
[+] Running 0/2
 ⠴ Container dockercomposefiles-container2-1  Stopping                     0.6s
 ⠴ Container dockercomposefiles-container1-1  Stopping                     0.6s
[+] Running 0/2
 ⠦ Container dockercomposefiles-container2-1  Stopping                     0.7s
 ⠦ Container dockercomposefiles-container1-1  Stopping                     0.7s
[+] Running 0/2
 ⠧ Container dockercomposefiles-container2-1  Stopping                     0.8s
 ⠧ Container dockercomposefiles-container1-1  Stopping                     0.8s
...
 ⠸ Container dockercomposefiles-container2-1  Stopping                    10.4s
 ⠸ Container dockercomposefiles-container1-1  Stopping                    10.4s
[+] Running 1/2
 ⠿ Container dockercomposefiles-container2-1  Removed                     10.4s
 ⠿ Container dockercomposefiles-container1-1  Removing                    10.5s
[+] Running 2/2
 ⠿ Container dockercomposefiles-container2-1  Removed                     10.4s
 ⠿ Container dockercomposefiles-container1-1  Removed                     10.5s
 ⠋ Network dockercomposefiles_default         Removing                     0.1s
[+] Running 3/3
 ⠿ Container dockercomposefiles-container2-1  Removed                     10.4s
 ⠿ Container dockercomposefiles-container1-1  Removed                     10.5s
 ⠿ Network dockercomposefiles_default         Removed                      0.2s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Neste caso, apenas com <code>down</code> o Docker Compose parou e removeu tudo, pois, como podemos ver nos contêineres e na rede, está escrito <code>Removed</code></p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker compose reiniciar">Docker compose reiniciar<a class="anchor-link" href="#Docker compose reiniciar">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Ao escrever um docker compose, podemos adicionar a tag <code>restart</code> para que, se o contêiner cair, ele seja reiniciado automaticamente.</p>
<div class='highlight'><pre><code class="language-json">restart: sempre
</code></pre></div>
<p>Desta forma, se o contêiner cair, ele será reiniciado automaticamente. Se quisermos que ele seja reiniciado apenas um número de vezes, podemos adicionar a opção <code>on-failure</code>.</p>
<div class='highlight'><pre><code class="language-json">restart: on-failure:&lt;número&gt;
</code></pre></div>
<p>Agora o contêiner será reiniciado um número de vezes, mas se cair mais vezes, não será reiniciado. Se quisermos que seja reiniciado sempre, podemos adicionar a opção <code>unless-stopped</code>.</p>
<div class='highlight'><pre><code class="language-json">restart: unless-stopped
</code></pre></div>
<p>Agora o contêiner será reiniciado sempre, a menos que seja parado manualmente.</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="Docker avancado">Docker avançado<a class="anchor-link" href="#Docker avancado">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Gerenciar ambiente de trabalho">Gerenciar ambiente de trabalho<a class="anchor-link" href="#Gerenciar ambiente de trabalho">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<h4 id="Remocao de conteineres desligados">Remoção de contêineres desligados<a class="anchor-link" href="#Remocao de conteineres desligados">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Depois de um tempo desenvolvendo, podemos ter vários contêineres desligados, mas armazenados no computador. Isso acaba ocupando memória, então com <code>docker container prune</code> podemos eliminar todos os que estão parados.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS                      PORTS     NAMES
effcee24f54a   ubuntu    &quot;bash&quot;    37 seconds ago   Exited (0) 36 seconds ago             musing_rosalind
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker container prune<br>AVISO! Isso removerá todos os contêineres parados.<br>Tem certeza de que deseja continuar? [s/N] s<br>Contêineres Excluídos:<br>effcee24f54aab22e34fdea2465b3b7af132d8c627e5432ba3e915a370876977<br><br>Espaço total recuperado: 0B</code></pre></div>
      </section>
<p>Neste caso, economizamos 0 bytes, mas no deixar contêineres desligados após muito desenvolvimento com certeza resultará em maior economia de memória.</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="Exclusao de todos os conteineres">Exclusão de todos os contêineres<a class="anchor-link" href="#Exclusao de todos os conteineres">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Em caso de ter contêineres em execução, podemos eliminar todos os contêineres por meio de outro comando</p>
<p>O comando <code>docker ps -q</code> nos retorna o ID de todos os contêineres, portanto, com o comando <code>docker rm -f $(docker ps -aq)</code> pararemos e apagaremos todos.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>c22516186ef7e3561fb1ad0d508a914857dbc61274a218f297c4d80b1fc33863
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED              STATUS              PORTS     NAMES
c22516186ef7   ubuntu    &quot;tail -f /dev/null&quot;   About a minute ago   Up About a minute             agitated_knuth
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">aq</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>c22516186ef7
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h4 id="Exclusao de tudo">Exclusão de tudo<a class="anchor-link" href="#Exclusao de tudo">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Como vimos, o Docker também cria redes, imagens, volumes, etc, então com o comando <code>docker system prune</code> podemos apagar todos os contêineres parados, todas as redes que não estejam sendo usadas por pelo menos um contêiner, as imagens duplicadas, e o que estiver duplicado no cache de compilação.</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker system prune<br>AVISO! Isso removerá:<br>- todos os contêineres parados<br>- todas as redes não utilizadas por pelo menos um contêiner<br>- todas as imagens pendentes<br>- todos os caches de construção pendentes<br><br>Tem certeza de que deseja continuar? [s/N] s<br>Espaço total recuperado: 0B</code></pre></div>
      </section>
<p>Assim como antes, não se economizou muito espaço, mas após muito tempo desenvolvendo, a economia será considerável.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Uso de recursos do host por parte dos conteineres">Uso de recursos do host por parte dos contêineres<a class="anchor-link" href="#Uso de recursos do host por parte dos conteineres">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Por exemplo, ao criar um contêiner, podemos limitar a RAM que o host pode usar através da opção <code>--memory</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">memory</span> <span class="mi">1</span><span class="n">g</span> <span class="n">ubuntu</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>d84888eafe531831ef8915d2270422365adec02678122bf59580e2da782e6972
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Mas com <code>docker ps</code> não temos acesso aos recursos que o contêiner está consumindo.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE     COMMAND               CREATED          STATUS          PORTS     NAMES
d84888eafe53   ubuntu    &quot;tail -f /dev/null&quot;   35 seconds ago   Up 34 seconds             musing_ritchie
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Para isso temos o comando <code>docker stats</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker stats<br>ID DO CONTAINER   NOME             CPU %     USO DE MEMÓRIA / LIMITE   MEM %     REDE I/O       BLOCO I/O   PIDS<br>d84888eafe53   musing_ritchie   0,00%     540KiB / 1GiB       0,05%     5,62kB / 0B   0B / 0B     1</code></pre></div>
      </section>
<p>Isso é muito útil se quisermos simular um ambiente com um limite de RAM</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Parando conteineres corretamente: SHELL vs EXEC">Parando contêineres corretamente: SHELL vs EXEC<a class="anchor-link" href="#Parando conteineres corretamente: SHELL vs EXEC">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Como explicamos, quando atribuímos um processo a um contêiner, quando esse processo termina, o contêiner para, mas às vezes podemos nos deparar com problemas com isso. Vamos criar uma nova pasta chamada Dockerfile_loop</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">Dockerfile_loop</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora vamos a criar um arquivo chamado <code>loop.sh</code> dentro de <code>Dockerfile_loop</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">Dockerfile_loop</span><span class="o">/</span><span class="n">loop</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E vamos a escrever o seguinte dentro de <code>loop.sh</code></p>
<div class='highlight'><pre><code class="language-shell">#!/usr/bin/env bash
trap "exit 0" SIGTERM
while true; do :; done
</code></pre></div>
<p>Se eu executar este script no host, ele será executado até que eu insira <code>CTRL+C</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">./loop<br>^C</code></pre></div>
      </section>
<p>Por favor, forneça o texto em markdown que você gostaria que eu traduzisse para o português.</p>
</section>
<section class="section-block-markdown-cell">
<p>Agora vamos a criar um arquivo <code>Dockerfile</code> dentro de <code>Dockerfile_loop</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">Dockerfile_loop</span><span class="o">/</span><span class="n">Dockerfile</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>*Arquivo Dockerfile*:</p>
<div class='highlight'><pre><code class="language-docker">DE ubuntu:trusty
COPY ["loop.sh", "/"]
CMD /loop.sh
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a criar uma imagem baseada no Ubuntu que copia o script para dentro e o executa, e o script é executado até receber o sinal <code>SIGTERM</code> do sistema operacional. Compilamos a imagem</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span> <span class="o">./</span><span class="n">Dockerfile_loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  3.072kB
Step 1/3 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/3 : COPY [&quot;loop.sh&quot;, &quot;/&quot;]
 ---&amp;gt; 89f2bbd25a88
Step 3/3 : CMD /loop.sh
 ---&amp;gt; Running in ff52569c35fd
Removing intermediate container ff52569c35fd
 ---&amp;gt; feb091e4efa3
Successfully built feb091e4efa3
Successfully tagged ubuntu:loop

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Executamos o contêiner</p>
<div class='highlight'><pre><code class="language-bash">docker run -d --name looper ubuntu:loop bash
</code></pre></div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">looper</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>8a28f8cc9892213c4e0603dfdde320edf52c091b82c60510083549a391cd6645
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Verificamos e vemos que o contêiner está rodando</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND                 CREATED         STATUS         PORTS     NAMES
8a28f8cc9892   ubuntu:loop   &quot;/bin/sh -c /loop.sh&quot;   4 seconds ago   Up 3 seconds             looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Tentamos parar o contêiner com <code>docker stop looper</code>. O Docker stop tenta parar o contêiner enviando-lhe o sinal <code>SIGTERM</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="err">!</span><span class="n">docker</span> <span class="n">stop</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
CPU times: user 89.2 ms, sys: 21.7 ms, total: 111 ms
Wall time: 10.6 s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Isso levou cerca de 10 segundos para parar, quando deveria ser imediato. Isso aconteceu porque <code>stop</code> enviou o sinal <code>SIGTERM</code> para parar o contêiner, mas como ele não parava, depois de um tempo enviou um <code>SIGKILL</code> para forçar a parada. Vamos ver o que acontece se listarmos os contêineres.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND                 CREATED          STATUS                       PORTS     NAMES
8a28f8cc9892   ubuntu:loop   &quot;/bin/sh -c /loop.sh&quot;   23 seconds ago   Exited (137) 2 seconds ago             looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Podemos ver que o sinal de <code>Exited</code> é <code>137</code>, isso equivale a SIGKILL, ou seja, o Docker teve que forçar o desligamento.</p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a apagar o contêiner e a executá-lo novamente</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">looper</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>84bc37f944d270be5f84a952968db2b8cf5372c61146d29383468198ceed18fd
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se agora tentarmos parar o contêiner com <code>docker kill looper</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="err">!</span><span class="n">docker</span> <span class="n">kill</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
CPU times: user 9.1 ms, sys: 857 µs, total: 9.96 ms
Wall time: 545 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que o tempo são cerca de 500 ms, ou seja, o Docker o parou em um momento enviando a ordem <code>SIGKILL</code>. Porque <code>kill</code> não envia <code>SIGTERM</code> e se em um tempo não foi parado o contêiner, ele envia <code>SIGKILL</code>, o que faz é enviar <code>SIGKILL</code> desde o início.</p>
<p>Se vemos os contêineres, vemos que o sinal de saída é o mesmo, <code>137</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND                 CREATED         STATUS                       PORTS     NAMES
84bc37f944d2   ubuntu:loop   &quot;/bin/sh -c /loop.sh&quot;   6 seconds ago   Exited (137) 2 seconds ago             looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Esta não é a maneira correta de desligar um contêiner, pois quando quisermos desligá-lo, deveríamos fazer isso através do sinal <code>SIGTERM</code>, para que ele possa terminar de processar o que estivesse fazendo e então se desligue.</p>
</section>
<section class="section-block-markdown-cell">
<p>Se apagarmos o contêiner e o reexecutarmos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">looper</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>b9d9f370cc0de7569eb09d0a85cd67e8ea6babc0754a517ccba5c5057f5cc50e
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se agora olharmos para os processos que estão sendo executados dentro do contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="n">looper</span> <span class="n">ps</span> <span class="o">-</span><span class="n">ef</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>UID          PID    PPID  C STIME TTY          TIME CMD
root           1       0  0 14:05 ?        00:00:00 /bin/sh -c /loop.sh
root           7       1 93 14:05 ?        00:00:02 bash /loop.sh
root           8       0  0 14:05 ?        00:00:00 ps -ef
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Na verdade o processo principal, o 1, não é <code>/loop.sh</code> mas sim <code>/bin/sh -c /loop.sh</code>, ou seja, é um processo filho do <code>shell</code>. Portanto, quando a sinal <code>SIGTERM</code> chegava ao <code>shell</code>, este não a encaminhava para seus processos filhos, por isso ela não chegava a <code>loop.sh</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Para que isso não aconteça, é necessário alterar o <code>Dockerfile</code> para o seguinte:</p>
<p>*Arquivo Dockerfile*:</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:trusty
COPY ["loop.sh", "/"]
CMD ["/loop.sh"]    # antes era CMD /loop.sh
</code></pre></div>
<p>Esta forma se chama <code>exec form</code>, enquanto a anterior se chama <code>shell form</code>. Na forma anterior, o processo é executado como um filho do <code>shell</code>, enquanto na forma <code>exec form</code> executa diretamente o processo que indicarmos. Então, apagamos o contêiner, recompilamos e reiniciamos o contêiner com a imagem.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span> <span class="o">./</span><span class="n">Dockerfile_loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  3.072kB
Step 1/3 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/3 : COPY [&quot;loop.sh&quot;, &quot;/&quot;]
 ---&amp;gt; Using cache
 ---&amp;gt; 89f2bbd25a88
Step 3/3 : CMD [&quot;/loop.sh&quot;]
 ---&amp;gt; Running in 6b8d92fcd57c
Removing intermediate container 6b8d92fcd57c
 ---&amp;gt; 35a7bb2b1892
Successfully built 35a7bb2b1892
Successfully tagged ubuntu:loop

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">looper</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">loop</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>850ae70c071426850b28428ac60dcbf875c6d35d9b7cc66c17cf391a23392965
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora vejo os processos dentro do contêiner.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">exec</span> <span class="n">looper</span> <span class="n">ps</span> <span class="o">-</span><span class="n">ef</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>UID          PID    PPID  C STIME TTY          TIME CMD
root           1       0 88 14:14 ?        00:00:02 bash /loop.sh
root           7       0  0 14:14 ?        00:00:00 ps -ef
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora vejo que o processo principal, o 1, é <code>/loop.sh</code></p>
<p>Se agora eu tentar parar o contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="err">!</span><span class="n">docker</span> <span class="n">stop</span> <span class="n">looper</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>looper
CPU times: user 989 µs, sys: 7.55 ms, total: 8.54 ms
Wall time: 529 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que demora mais. Vejamos o código com o qual parou.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE         COMMAND      CREATED              STATUS                      PORTS     NAMES
850ae70c0714   ubuntu:loop   &quot;/loop.sh&quot;   About a minute ago   Exited (0) 33 seconds ago             looper
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Contentores executaveis">Contentores executáveis<a class="anchor-link" href="#Contentores executaveis">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Se quisermos um binário que rode como um executável, no <code>dockerfile</code> é preciso especificar o comando em <code>ENTRYPOINT</code> e os parâmetros do comando em <code>CMD</code>, vamos ver isso.</p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a criar uma nova pasta onde guardaremos o <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dockerfile_ping</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora criamos um Dockerfile dentro</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dockerfile_ping</span><span class="o">/</span><span class="n">Dockerfile</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Escrevemos dentro do Dockerfile o seguinte</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:trusty
ENTRYPOINT [ "/bin/ping", "-c", "3" ]
CMD [ "localhost" ]
</code></pre></div>
<p>Compilamos a imagem</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span> <span class="o">./</span><span class="n">dockerfile_ping</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  3.072kB
Step 1/3 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/3 : ENTRYPOINT [ &quot;/bin/ping&quot;, &quot;-c&quot;, &quot;3&quot; ]
 ---&amp;gt; Using cache
 ---&amp;gt; 1cebcfb542b1
Step 3/3 : CMD [ &quot;localhost&quot; ]
 ---&amp;gt; Using cache
 ---&amp;gt; 04ddc3de52a2
Successfully built 04ddc3de52a2
Successfully tagged ubuntu:ping

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se agora executarmos a imagem sem passar um parâmetro, o contêiner fará um ping a si mesmo</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">ping_localhost</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.041 ms
64 bytes from localhost (127.0.0.1): icmp_seq=2 ttl=64 time=0.058 ms
64 bytes from localhost (127.0.0.1): icmp_seq=3 ttl=64 time=0.054 ms

--- localhost ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2027ms
rtt min/avg/max/mdev = 0.041/0.051/0.058/0.007 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Mas se passarmos um parâmetro agora, ele fará ping no endereço que dissermos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">ping_google</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">ping</span> <span class="n">google</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>PING google.com (216.58.209.78) 56(84) bytes of data.
64 bytes from waw02s06-in-f14.1e100.net (216.58.209.78): icmp_seq=1 ttl=111 time=3.93 ms
64 bytes from waw02s06-in-f14.1e100.net (216.58.209.78): icmp_seq=2 ttl=111 time=6.80 ms
64 bytes from waw02s06-in-f14.1e100.net (216.58.209.78): icmp_seq=3 ttl=111 time=6.92 ms

--- google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 3.930/5.886/6.920/1.383 ms
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Apagamos os contêineres</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">ping_localhost</span> <span class="n">ping_google</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ping_localhost
ping_google
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="O contexto de build">O contexto de <code>build</code><a class="anchor-link" href="#O contexto de build">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a criar uma pasta chamada <code>dockerfile_contexto</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">dokerfile_contexto</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora criamos nela dois arquivos: um <code>test.txt</code> e o <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dokerfile_contexto</span><span class="o">/</span><span class="n">Dockerfile</span> <span class="n">dokerfile_contexto</span><span class="o">/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Modificamos o Dockerfile e colocamos o seguinte</p>
<div class='highlight'><pre><code class="language-docker">FROM ubuntu:trusty
COPY [".", "/"]
</code></pre></div>
<p>Isso vai fazer com que tudo o que está na pasta onde se encontra o <code>Dockerfile</code> seja copiado para dentro da imagem. Compilamos a imagem.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">contexto</span> <span class="o">./</span><span class="n">dokerfile_contexto</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon   2.56kB
Step 1/2 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/2 : COPY [&quot;.&quot;, &quot;/&quot;]
 ---&amp;gt; 3ab79fdce389
Successfully built 3ab79fdce389
Successfully tagged ubuntu:contexto

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver o que tem dentro do contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">ls</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">contexto</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Dockerfile
bin
boot
dev
etc
home
lib
lib64
media
mnt
opt
proc
root
run
sbin
srv
sys
text.txt
tmp
usr
var
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como vemos está o arquivo <code>text.txt</code>. Mas é possível que dentro da pasta que está no mesmo diretório que o <code>Dockerfile</code> haja arquivos ou pastas que não queremos que sejam copiados para a imagem, por qualquer razão, então assim como no git temos o <code>.gitignore</code>, no docker temos o <code>.dockerignore</code>, onde colocamos os arquivos ou pastas que não queremos que sejam levados em conta na hora de compilar.</p>
<p>Então criamos um arquivo <code>.dockerignore</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">touch</span> <span class="n">dokerfile_contexto</span><span class="o">/.</span><span class="n">dockerignore</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E dentro adicionamos o <code>text.txt</code>, e de passo o <code>Dockerfile</code> que não precisamos dentro da imagem</p>
<p>*.dockerignore*:</p>
<div class='highlight'><pre><code class="language-Dockerfile">Dockerfile
Parece que hay un malentendido. El archivo `text.txt` no foi fornecido. Por favor, forneça o conteúdo do arquivo em formato markdown para que eu possa traduzi-lo.
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>Apagamos o contêiner que tínhamos criado, recompilamos e vemos o que há dentro do contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ls
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">contexto</span> <span class="o">./</span><span class="n">dokerfile_contexto</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Sending build context to Docker daemon  3.072kB
Step 1/2 : FROM ubuntu:trusty
 ---&amp;gt; 13b66b487594
Step 2/2 : COPY [&quot;.&quot;, &quot;/&quot;]
 ---&amp;gt; 7a6689546da4
Successfully built 7a6689546da4
Successfully tagged ubuntu:contexto

Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">ls</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">contexto</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>bin
boot
dev
etc
home
lib
lib64
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que agora não estão nem <code>Dockerfile</code> nem <code>text.txt</code>. Apagamos o contentor.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">rm</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ls
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Construcao em multiplas etapas">Construção em múltiplas etapas<a class="anchor-link" href="#Construcao em multiplas etapas">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>No final de um desenvolvimento, não queremos que todo o código esteja na imagem que vai ser enviada para produção.</p>
<p>Podemos dividir o <code>dockerfile</code> em dois, por exemplo, o <code>developer.Dockerfile</code> e o <code>production.Dockerfile</code>, onde no desenvolvimento haverá mais coisas do que na produção. Na hora de compilá-los, através da opção <code>-f</code> escolhemos o <code>dockerfile</code> que queremos usar</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">docker build -t &lt;tag&gt; -f developer.Dockerfile<br>docker build -t &lt;tag&gt; -f production.Dockerfile</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Mas para não ter que criar dois arquivos <code>Dockerfile</code>, o Docker criou os <code>multi stage builds</code>. Com um único <code>Dockerfile</code> vamos resolver o problema.</p>
</section>
<section class="section-block-markdown-cell">
<p>Criamos a pasta onde vamos salvar o <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">docker_multi_stage</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E dentro criamos o arquivo <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_stage</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">touch</span> <span class="n">Dockerfile</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Editamos o arquivo, inserindo o seguinte</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile"># Etapa 1: Gerar o executável com Python baseado em Alpine<br>FROM python:3.9-alpine como build-stage<br>WORKDIR /app<br># Instalar dependências para PyInstaller<br>RUN apk add --no-cache gcc musl-dev libc-dev<br># Gerar hello.py<br>RUN echo &#39;print("Olá do Alpine!")&#39; &gt; hello.py<br># Instalar PyInstaller<br>RUN pip install pyinstaller<br># Usar PyInstaller para criar um executável independente<br>RUN pyinstaller --onefile hello.py<br><br># Etapa 2: Executar o executável em uma imagem do Alpine<br>FROM alpine:latest<br>WORKDIR /app<br># Copiar o executável da etapa de build<br>COPY --from=build-stage /app/dist/hello .<br># Comando padrão para executar o executável<br>CMD ["./hello"]</code></pre></div>
      </section>
<p>Como se pode ver, o <code>Dockerfile</code> está dividido em duas partes. De um lado, trabalhamos sobre a imagem <code>python:3.9-alpine</code>, que é chamada de <code>build-stage</code>. Do outro lado, trabalhamos sobre a imagem <code>alpine:latest</code>, que é uma imagem de Linux muito leve e é utilizada muito em produção.</p>
<p>O compilamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multistagebuild</span><span class="p">:</span><span class="n">latest</span> <span class="o">./</span><span class="n">docker_multi_stage</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Building 0.0s (0/2)                                          docker:default
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Building 0.2s (4/6)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile                       0.0s
 =&amp;gt; =&amp;gt; transferring dockerfile: 722B                                       0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.0s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/alpine:latest           0.1s
 =&amp;gt; [internal] load metadata for docker.io/library/python:3.9-alpine       0.1s
...
 =&amp;gt; CACHED [stage-1 3/3] COPY --from=build-stage /app/dist/hello .         0.0s
 =&amp;gt; exporting to image                                                     0.0s
 =&amp;gt; =&amp;gt; exporting layers                                                    0.0s
 =&amp;gt; =&amp;gt; writing image sha256:7fb090d1495d00e892118b6bc3c03400b63a435fd4703  0.0s
 =&amp;gt; =&amp;gt; naming to docker.io/maximofn/multistagebuild:latest                 0.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se agora olharmos para as imagens que temos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY                 TAG       IMAGE ID       CREATED         SIZE
maximofn/multistagebuild   latest    7fb090d1495d   8 minutes ago   13.6MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos baixar a imagem do Python para ver quanto ela pesa</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">pull</span> <span class="n">python</span><span class="p">:</span><span class="mf">3.9</span><span class="o">-</span><span class="n">alpine</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>3.9-alpine: Pulling from library/python

a8db6415: Already exists 
d5e70e42: Already exists 
3fe96417: Already exists 
aa4dddbb: Already exists 
518be9f7: Already exists Digest: sha256:6e508b43604ff9a81907ec17405c9ad5c13664e45a5affa2206af128818c7486
Status: Downloaded newer image for python:3.9-alpine
docker.io/library/python:3.9-alpine
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY                 TAG          IMAGE ID       CREATED         SIZE
maximofn/multistagebuild   latest       7fb090d1495d   9 minutes ago   13.6MB
python                     3.9-alpine   6946662f018b   9 days ago      47.8MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Podemos ver que enquanto nossa imagem pesa apenas 13,6 MB, a de Python com a qual foi construído o aplicativo pesa 47,8 MB. Portanto, podemos tirar duas conclusões: com a primeira imagem, a de Python, foi construído o aplicativo, gerou-se o executável e esse executável é o que usamos na segunda imagem, a de Alpine. Além disso, podemos ver que, embora a primeira imagem usada seja a de Python, ela não é baixada no nosso sistema, já que tivemos que baixá-la nós mesmos.</p>
</section>
<section class="section-block-markdown-cell">
<p>Então só resta testá-lo.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">name</span> <span class="n">multi_stage_build</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multistagebuild</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Hello from Alpine!
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Funciona!</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Builds multi arquitetura">Builds multi arquitetura<a class="anchor-link" href="#Builds multi arquitetura">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Suponhamos que queremos fazer uma imagem que possa ser executada em um computador e em uma Raspberry. O computador provavelmente terá um micro com arquitetura AMD64, enquanto a Raspberry tem um micro com arquitetura ARM. Portanto, não podemos criar a mesma imagem para os dois. Ou seja, quando criamos uma imagem, a criamos com um <code>Dockerfile</code> que geralmente começa assim</p>
<div class='highlight'><pre><code class="language-Dockerfile">DE ...
</code></pre></div>
<p>Portanto, o <code>Dockerfile</code> da imagem do computador poderia começar assim</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM ubuntu:latest
</code></pre></div>
<p>Enquanto o da Raspberry poderia começar assim</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM arm64v8/ubuntu:latest
</code></pre></div>
</section>
<section class="section-block-markdown-cell">
<p>Teríamos que criar dois arquivos <code>Dockerfile</code>, compilá-los e no computador usar uma imagem e na raspberry usar outra.</p>
</section>
<section class="section-block-markdown-cell">
<p>Para evitar ter que ver a arquitetura do computador e ver qual imagem temos que usar, o Docker cria os <code>manifest</code>, que como seu nome indica é um manifesto que indica, com base na arquitetura de micro que tenhamos, usa uma imagem ou outra.</p>
</section>
<section class="section-block-markdown-cell">
<p>Então vamos ver como fazer isso</p>
</section>
<section class="section-block-markdown-cell">
<p>Em primeiro lugar, criamos uma pasta onde vamos criar nossos arquivos <code>Dockerfile</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">docker_multi_arch</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora criamos os dois Dockerfiles</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_arch</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">touch</span> <span class="n">Dockerfile_arm64</span> <span class="n">Dockerfile_amd64</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Escrevemos o <code>Dockerfile</code> para AMD64</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_arch</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">echo</span> <span class="s2">&quot;FROM ubuntu:20.04&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Dockerfile_amd64</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">echo</span> <span class="s2">&quot;CMD echo &#39;Hello from amd64&#39;&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Dockerfile_amd64</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_arch</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">echo</span> <span class="s2">&quot;FROM arm64v8/ubuntu:latest&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Dockerfile_arm</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">echo</span> <span class="s2">&quot;CMD echo &#39;Hello from ARM&#39;&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Dockerfile_arm</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora combinamos as duas imagens</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">cd</span> <span class="n">docker_multi_arch</span> <span class="o">&amp;</span></span><span class="o">&amp;</span> <span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">arm</span> <span class="o">-</span><span class="n">f</span> <span class="n">Dockerfile_arm</span> <span class="o">.</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Building 0.0s (0/1)                                          docker:default
[+] Building 0.2s (2/3)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile_amd64                 0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 89B                                        0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/ubuntu:20.04            0.1s
[+] Building 0.3s (2/3)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile_amd64                 0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 89B                                        0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/ubuntu:20.04            0.2s
[+] Building 0.5s (2/3)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile_amd64                 0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 89B                                        0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/ubuntu:20.04            0.4s
[+] Building 0.6s (2/3)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile_amd64                 0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 89B                                        0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/ubuntu:20.04            0.5s
...
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load build definition from Dockerfile_arm                   0.0s
 =&amp;gt; =&amp;gt; transferring dockerfile: 94B                                        0.0s
 =&amp;gt; [internal] load metadata for docker.io/arm64v8/ubuntu:latest           1.8s
 =&amp;gt; [auth] arm64v8/ubuntu:pull token for registry-1.docker.io              0.0s
 =&amp;gt; CACHED [1/1] FROM docker.io/arm64v8/ubuntu:latest@sha256:94d12db896d0  0.0s
 =&amp;gt; exporting to image                                                     0.0s
 =&amp;gt; =&amp;gt; exporting layers                                                    0.0s
 =&amp;gt; =&amp;gt; writing image sha256:a9732c1988756dc8e836fd96e5c9512e349c97ea5af46  0.0s
 =&amp;gt; =&amp;gt; naming to docker.io/maximofn/multiarch:arm                          0.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver se temos as duas imagens compiladas</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>REPOSITORY           TAG       IMAGE ID       CREATED       SIZE
maximofn/multiarch   arm       a9732c198875   4 weeks ago   69.2MB
maximofn/multiarch   amd64     5b612c83025f   6 weeks ago   72.8MB
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que compilamos as duas imagens. Para poder criar um manifesto, primeiro temos que enviar as imagens para o Docker Hub, então as enviamos.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">push</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">amd64</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The push refers to repository [docker.io/maximofn/multiarch]

82bdeb5f: Mounted from library/ubuntu amd64: digest: sha256:30e820f2a11a24ad4d8fb624ae485f7c1bcc299e8cfc72c88adce1acd0447e1d size: 529
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">push</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">arm</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The push refers to repository [docker.io/maximofn/multiarch]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>
eda53374: Layer already exists arm: digest: sha256:6ec5a0752d49d3805061314147761bf25b5ff7430ce143adf34b70d4eda15fb8 size: 529
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se eu for ao meu Docker Hub posso ver que minha imagem <code>maximofn/multiarch</code> tem os tags <code>amd64</code> e <code>arm</code></p>
<img src="https://images.maximofn.com/docker_multi_arch_tags.webp" alt="docker_multi_arch_tags">
</section>
<section class="section-block-markdown-cell">
<p>Agora vamos a criar o <code>manifest</code> baseado nestas duas imagens</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">manifest</span> <span class="n">create</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">amd64</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">arm</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Created manifest list docker.io/maximofn/multiarch:latest
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Uma vez criado, temos que indicar as arquiteturas das CPUs a que corresponde cada uma.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">manifest</span> <span class="n">annotate</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">amd64</span> <span class="o">--</span><span class="n">os</span> <span class="n">linux</span> <span class="o">--</span><span class="n">arch</span> <span class="n">amd64</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">manifest</span> <span class="n">annotate</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">arm64</span> <span class="o">--</span><span class="n">os</span> <span class="n">linux</span> <span class="o">--</span><span class="n">arch</span> <span class="n">arm64</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>manifest for image maximofn/multiarch:arm64 does not exist in maximofn/multiarch:latest
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Uma vez criado e anotado, podemos enviar o <code>manifest</code> para o Docker Hub</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">manifest</span> <span class="n">push</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>sha256:1ea28e9a04867fe0e0d8b0efa455ce8e4e29e7d9fd4531412b75dbd0325e9304
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se eu olhar novamente os tags da minha imagem <code>maximofn/multiarch</code>, também vejo o de <code>latest</code></p>
<img src="https://images.maximofn.com/docker_multi_arch_tags_manifest.webp" alt="docker_multi_arch_tags_manifest">
</section>
<section class="section-block-markdown-cell">
<p>Agora, tanto se eu quiser usar minha imagem de uma máquina com CPU AMD64 ou CPU ARM ao fazer <code>FROM maximofn/multiarch:latest</code>, o Docker verificará a arquitetura da CPU e baixará o tag <code>amd64</code> ou o tag <code>arm</code>. Vamos ver isso, se do meu computador eu executar a imagem obtenho</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multiarch</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Unable to find image &#x27;maximofn/multiarch:latest&#x27; locally
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>latest: Pulling from maximofn/multiarch
Digest: sha256:7cef0de10f7fa2b3b0dca0fbf398d1f48af17a0bbc5b9beca701d7c427c9fd84
Status: Downloaded newer image for maximofn/multiarch:latest
Hello from amd64
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como não a tem, baixa-a</p>
</section>
<section class="section-block-markdown-cell">
<p>Se eu me conectar agora via ssh a uma Raspberry Pi e tentar o mesmo, obtenho</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">raspberrry@raspberrypi:~ $ docker run maximofn/multiarch:latest<br>Impossível encontrar a imagem &#39;maximofn/multiarch:latest&#39; localmente<br>latest: Pulling from maximofn/multiarch<br>Digesto: sha256:1ea28e9a04867fe0e0d8b0efa455ce8e4e29e7d9fd4531412b75dbd0325e9304<br>Status: Baixada a imagem mais recente para maximofn/multiarch:latest<br>Olá do ARM</code></pre></div>
      </section>
<p>Aparece <code>Hello from ARM</code> pois o Raspberry Pi possui um microprocessador com arquitetura ARM</p>
</section>
<section class="section-block-markdown-cell">
<p>Como pode ser visto, cada máquina baixou a imagem de que precisava.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Escrita correta de Dockerfiles avancados">Escrita correta de Dockerfiles avançados<a class="anchor-link" href="#Escrita correta de Dockerfiles avancados">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Já vimos a maneira de escrever Dockerfiles corretamente, mas há uma coisa a mais que podemos fazer agora que conhecemos o multi-stage build e é criar um contêiner para criar o executável e outro menor para executá-lo.</p>
<p>Chegamos à conclusão de que um bom Dockerfile poderia ser este</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
WORKDIR /sourceCode/sourceApp
COPY ./sourceCode/sourceApp .
CMD ["python3", "app.py"]
</code></pre></div>
<p>Vamos a criar agora um executável em um contêiner builder e em outro menor o executamos</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-dockerfile">FROM python:3.9.18-alpine como builder<br>WORKDIR /sourceCode/sourceApp<br>RUN apk add --no-cache gcc musl-dev libc-dev &amp;&amp; pip install pyinstaller<br>COPY ./sourceCode/sourceApp .<br>RUN pyinstaller --onefile app.py<br><br>DE alpine:3.18.3<br>WORKDIR /sourceCode/sourceApp<br>COPY --from=builder /sourceCode/sourceApp/dist/app .<br>CMD ["./app"]</code></pre></div>
      </section>
</section>
<section class="section-block-markdown-cell">
<p>Criamos o código Python no caminho necessário</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="n">multistagebuild</span><span class="o">/</span><span class="n">sourceCode</span>
<span class="err">!</span><span class="n">mkdir</span> <span class="n">multistagebuild</span><span class="o">/</span><span class="n">sourceCode</span><span class="o">/</span><span class="n">sourceApp</span>
<span class="err">!</span><span class="n">touch</span> <span class="n">multistagebuild</span><span class="o">/</span><span class="n">sourceCode</span><span class="o">/</span><span class="n">sourceApp</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">py</span>
<span class="err">!</span><span class="n">echo</span> <span class="s1">&#39;print(&quot;Hello from Alpine!&quot;)&#39;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">multistagebuild</span><span class="o">/</span><span class="n">sourceCode</span><span class="o">/</span><span class="n">sourceApp</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora compilando a imagem</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multistagebuild</span><span class="p">:</span><span class="n">alpine</span><span class="o">-</span><span class="mf">3.18.3</span> <span class="o">./</span><span class="n">multistagebuild</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>[+] Building 0.0s (0/0)                                          docker:default
[+] Building 0.0s (0/1)                                          docker:default
[+] Building 0.2s (3/5)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile                       0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 357B                                       0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/alpine:3.18.3           0.1s
 =&amp;gt; [internal] load metadata for docker.io/library/python:3.9.18-alpine    0.1s
 =&amp;gt; [auth] library/alpine:pull token for registry-1.docker.io              0.0s
[+] Building 0.3s (3/5)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile                       0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 357B                                       0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/alpine:3.18.3           0.2s
 =&amp;gt; [internal] load metadata for docker.io/library/python:3.9.18-alpine    0.2s
 =&amp;gt; [auth] library/alpine:pull token for registry-1.docker.io              0.0s
[+] Building 0.5s (4/6)                                          docker:default
 =&amp;gt; [internal] load build definition from Dockerfile                       0.1s
 =&amp;gt; =&amp;gt; transferring dockerfile: 357B                                       0.0s
 =&amp;gt; [internal] load .dockerignore                                          0.1s
 =&amp;gt; =&amp;gt; transferring context: 2B                                            0.0s
 =&amp;gt; [internal] load metadata for docker.io/library/alpine:3.18.3           0.4s
...
 =&amp;gt; exporting to image                                                     0.1s
 =&amp;gt; =&amp;gt; exporting layers                                                    0.1s
 =&amp;gt; =&amp;gt; writing image sha256:8a22819145c6fee17e138e818610ccf46d7e13c786825  0.0s
 =&amp;gt; =&amp;gt; naming to docker.io/maximofn/multistagebuild:alpine-3.18.3          0.0s
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>A executamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">name</span> <span class="n">multi_stage_build</span> <span class="n">maximofn</span><span class="o">/</span><span class="n">multistagebuild</span><span class="p">:</span><span class="n">alpine</span><span class="o">-</span><span class="mf">3.18.3</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Hello from Alpine!
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>A imagem <code>maximofn/multistagebuild:alpine-3.18.3</code> só pesa 13,6 MB</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Diferenca entre RUN, CMD e ENTRYPOINT">Diferença entre RUN, CMD e ENTRYPOINT<a class="anchor-link" href="#Diferenca entre RUN, CMD e ENTRYPOINT">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<h4 id="EXECUTAR">EXECUTAR<a class="anchor-link" href="#EXECUTAR">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>O comando <code>RUN</code> é o mais simples, ele apenas executa um comando no momento da compilação da imagem. Por exemplo, se quisermos instalar um pacote na imagem, fazemos isso através do <code>RUN</code>.</p>
<p>Portanto, é importante, <code>RUN</code> é executado no momento da compilação da imagem, não quando o contêiner é executado.</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="CMD">CMD<a class="anchor-link" href="#CMD">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>O comando <code>CMD</code> é o comando que é executado quando o contêiner é iniciado. Por exemplo, se quisermos que o contêiner execute um comando ao ser iniciado, fazemos isso através do <code>CMD</code>. Por exemplo, se tivermos uma aplicação Python em um contêiner, com <code>CMD</code> podemos indicar que, quando o contêiner for iniciado, ele execute a aplicação Python.</p>
<p>Desta forma, quando o contêiner for iniciado, a aplicação Python será executada. Isso significa que, se fizermos <code>docker run &#x3C;image&#x3E;</code>, a aplicação Python será executada. No entanto, <code>CMD</code> nos permite sobrescrever o comando que é executado ao iniciar o contêiner, por exemplo, se fizermos <code>docker run &#x3C;image&#x3E; bash</code>, o <code>bash</code> será executado em vez da aplicação Python.</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="ENTRYPOINT">ENTRYPOINT<a class="anchor-link" href="#ENTRYPOINT">¶</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>O comando <code>ENTRYPOINT</code> é similar ao comando <code>CMD</code>, mas com uma diferença: o <code>ENTRYPOINT</code> não está destinado a ser sobrescrito. Isso significa que, se tivermos uma aplicação Python em um contêiner, podemos usar <code>ENTRYPOINT</code> para indicar que, quando o contêiner for executado, ele execute a aplicação Python. No entanto, se fizermos <code>docker run &#x3C;image&#x3E; bash</code>, será executada a aplicação Python, não o <code>bash</code>.</p>
<p>Um uso muito comum de <code>ENTRYPOINT</code> é quando queremos que o contêiner seja um executável, por exemplo, se quisermos que o contêiner seja um executável de uma versão do Python que não temos em nosso host, porque, por exemplo, queremos testar a nova versão do Python que foi lançada podemos fazer</p>
<div class='highlight'><pre><code class="language-Dockerfile">FROM python:3.9.18-alpine
ENTRYPOINT ["python3"]
</code></pre></div>
<p>Desta forma, quando o contêiner for iniciado, o Python será executado. Isso significa que, se fizermos <code>docker run &#x3C;image&#x3E;</code>, o Python será executado. Mas <code>ENTRYPOINT</code> nos permite sobrescrever o comando que é executado ao iniciar o contêiner, por exemplo, se fizermos <code>docker run &#x3C;image&#x3E; myapp.py</code>, será executado <code>python3 myapp.py</code> dentro do contêiner. Assim podemos testar nossa aplicação Python na nova versão do Python.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Mudancas em um conteiner">Mudanças em um contêiner<a class="anchor-link" href="#Mudancas em um conteiner">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Com <code>docker diff</code> podemos ver as diferenças entre o contêiner e a imagem, o que é o mesmo que a diferença no contêiner desde sua criação até agora.</p>
<p>Vamos a executar um contêiner e dentro criamos um arquivo</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">name</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">20.04</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">20.04</span> <span class="n">bash</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>root@895a19aef124:/# touch file.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora podemos ver a diferença</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">diff</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">20.04</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>C /root
A /root/.bash_history
A /file.txt
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p><code>A</code> significa que foi adicionado, <code>C</code> significa que foi alterado e <code>D</code> significa que foi excluído.</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="Docker no Docker">Docker no Docker<a class="anchor-link" href="#Docker no Docker">¶</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Suponhamos que temos contêineres que precisam iniciar ou desligar outros contêineres. Isso é feito da seguinte maneira</p>
<p>Dado que no Linux tudo é um arquivo e o host se comunica com o Docker por meio de um socket. Portanto, para o Linux, esse socket é um arquivo. Então, se montarmos esse socket como um arquivo no contêiner, ele poderá se comunicar com o Docker.</p>
</section>
<section class="section-block-markdown-cell">
<p>Primeiro vamos a montar um contêiner com Ubuntu</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">ubuntu</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">latest</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>144091e4a3325c9068064ff438f8865b40f944af5ce649c7156ca55a3453e423
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a montar o contêiner que vai poder se comunicar com o Docker montando a pasta <code>/var/run/docker.sock</code></p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash">$ docker run -it --rm --name main -v /var/run/docker.sock:/var/run/docker.sock docker:19.03.12<br>/ #</code></pre></div>
      </section>
<p>Entramos em um contêiner, e se executarmos <code>docker ps</code> dentro dele</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash"># docker ps<br>ID DO CONTÊINER     IMAGEM              COMANDO                  CRIADO              STATUS              PORTAS              NOMES<br>9afb778d6c20        docker:19.03.12     "docker-entrypoint.s…"   3 segundos atrás    Up 2 segundos                            main<br>144091e4a332        ubuntu:latest       "tail -f /dev/null"      19 segundos atrás   Up 18 segundos                          ubuntu</code></pre></div>
      </section>
<p>Como podemos ver, dentro do Docker podemos ver os contêineres do host</p>
</section>
<section class="section-block-markdown-cell">
<p>Podemos executar um novo contêiner</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash"># docker run -d --name ubuntu_from_main ubuntu:latest tail -f /dev/null<br>362654a72bb0fb047c13968707a6f16b87fed7ce051eb5c1a146b15828589a1a<br>/ #</code></pre></div>
      </section>
<p>E se voltarmos a ver os contêineres</p>
<section class="section-block-markdown-cell">
      <div class='highlight'><pre><code class="language-bash"># docker ps<br>ID DO CONTAINER     IMAGEM              COMANDO                  CRIADO               STATUS              PORTAS              NOMES<br>362654a72bb0        ubuntu:latest       "tail -f /dev/null"      3 segundos atrás     Up 3 segundos                            ubuntu_from_main<br>9afb778d6c20        docker:19.03.12     "docker-entrypoint.s…"   Há um minuto         Up Há um minuto                           main<br>144091e4a332        ubuntu:latest       "tail -f /dev/null"      2 minutos atrás      Up Há cerca de um minuto                       ubuntu</code></pre></div>
      </section>
<p>Mas se agora executarmos uma nova terminal do host, veremos o contêiner criado a partir de dentro do contêiner</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="err">!</span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>CONTAINER ID   IMAGE             COMMAND                  CREATED              STATUS              PORTS     NAMES
362654a72bb0   ubuntu:latest     &quot;tail -f /dev/null&quot;      About a minute ago   Up About a minute             ubuntu_from_main
9afb778d6c20   docker:19.03.12   &quot;docker-entrypoint.s…&quot;   3 minutes ago        Up 3 minutes                  main
144091e4a332   ubuntu:latest     &quot;tail -f /dev/null&quot;      3 minutes ago        Up 3 minutes                  ubuntu
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Tudo o que fizermos a partir do contêiner <code>main</code> será refletido no host</p>
</section>
<section class="section-block-markdown-cell">
<p>Isso tem a vantagem de podermos instalar programas em um contêiner que tem acesso ao host para não ter que instalá-los no host. Por exemplo, <a href="https://github.com/wagoodman/dive">dive</a> é uma ferramenta para explorar contêineres, mas se você não quiser instalá-la no host, pode instalá-la em um contêiner com acesso ao host, assim, a partir desse contêiner <code>main</code>, você pode explorar o resto dos contêineres sem ter que instalá-la no host.</p>
</section>