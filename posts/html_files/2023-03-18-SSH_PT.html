<section class="section-block-markdown-cell">
<h1 id="SSH">SSH<a class="anchor-link" href="#SSH">¬∂</a></h1>
</section>
<section class="section-block-markdown-cell">
<h2 id="Introdu%C3%A7%C3%A3o-hist%C3%B3rica">Introdu√ß√£o hist√≥rica<a class="anchor-link" href="#Introdu%C3%A7%C3%A3o-hist%C3%B3rica">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Este caderno foi traduzido automaticamente para torn√°-lo acess√≠vel a mais pessoas, por favor me avise se voc√™ vir algum erro de digita√ß√£o..</p>
<p>Nos primeiros tempos da Internet, o protocolo "rede" foi criado para poder se comunicar entre v√°rios computadores, mas tinha o problema de n√£o ser criptografado, de modo que qualquer um que se atravessasse no caminho poderia ler a comunica√ß√£o sem qualquer problema, por isso foi criado o "SSH" (Secure Shell).</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="SSH-criptografia"><code>SSH</code> criptografia<a class="anchor-link" href="#SSH-criptografia">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>O sistema de codifica√ß√£o <code>SSH</code> funciona com base em uma chave p√∫blica/chave privada, de modo que se a comunica√ß√£o for criptografada com uma das duas chaves, ela s√≥ poder√° ser descriptografada pela outra chave.</p>
<p>E por que existe uma chave p√∫blica e uma chave privada? A chave p√∫blica √© aquela que voc√™ d√° a todos e a chave privada √© aquela que s√≥ voc√™ tem que possuir.</p>
<p>Portanto, se voc√™ quiser se comunicar com outro computador por <code>SSH</code>, primeiro voc√™ lhes d√° sua chave p√∫blica, depois voc√™ criptografa a mensagem com sua chave privada e eles s√≥ podem decodificar a mensagem com a chave p√∫blica que voc√™ deu para o outro computador.</p>
<p>O mesmo acontece ao contr√°rio, se o outro computador quiser lhe enviar uma mensagem, ele a codifica com sua chave p√∫blica e s√≥ pode decodific√°-la com a chave privada que s√≥ voc√™ tem.</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="SSH-requisitos"><code>SSH</code> requisitos<a class="anchor-link" href="#SSH-requisitos">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Servi%C3%A7o-SSH%23%23">Servi√ßo <code>SSH</code>##<a class="anchor-link" href="#Servi%C3%A7o-SSH%23%23">¬∂</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Para utilizar o <code>SSH</code> voc√™ precisa ter um servi√ßo <code>SSH</code>. No <code>Linux</code> ele normalmente j√° est√° instalado, mas se n√£o estiver, voc√™ pode instal√°-lo atrav√©s de</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>apt<span class="w"> </span>install<span class="w"> </span>openssh-server
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Durante o processo de instala√ß√£o, voc√™ ser√° solicitado a definir o fuso hor√°rio.</p>
</section>
<section class="section-block-markdown-cell">
<p>Em seguida, levantamos o servi√ßo</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>ssh
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Cliente-SSH%23%23">Cliente <code>SSH</code>##<a class="anchor-link" href="#Cliente-SSH%23%23">¬∂</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Uma vez que voc√™ tenha o servi√ßo que precisa, embora em "Linux" ele geralmente vem instalado, mas se n√£o o tiver, voc√™ pode instal√°-lo atrav√©s de</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>apt<span class="w"> </span>install<span class="w"> </span>openssh-client
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="SSH-conex%C3%A3o"><code>SSH</code> conex√£o<a class="anchor-link" href="#SSH-conex%C3%A3o">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Para conectar via <code>SSH</code> voc√™ precisa entrar com o comando <code>ssh &lt;user&gt;@&lt;ip&gt;</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>root@172.17.0.1
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The authenticity of host '172.17.0.1 (172.17.0.1)' can't be established.
ECDSA key fingerprint is SHA256:M+qsqSC4HiYztm1ij8iDkh9KHJz+pxrTm9GTZIf2N9k.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como voc√™ pode ver, a primeira vez que ele pergunta se voc√™ quer salvar a "impress√£o digital", isto √© para que se da pr√≥xima vez que voc√™ se conectar √† mesma m√°quina (√† mesma chave p√∫blica) se a "impress√£o digital" tiver mudado, voc√™ tenha cuidado, pois pode haver algo perigoso, como eles fazerem um hack naquela m√°quina.</p>
<p>Se dependermos de "sim", entramos em "sim".</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>root@172.17.0.1
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The authenticity of host '172.17.0.1 (172.17.0.1)' can't be established.
ECDSA key fingerprint is SHA256:M+qsqSC4HiYztm1ij8iDkh9KHJz+pxrTm9GTZIf2N9k.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '172.17.0.1' (ECDSA) to the list of known hosts.
root@172.17.0.1's password:
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Em seguida, a m√°quina √† qual nos conectamos nos pede a senha, n√≥s a introduzimos e estaremos dentro da m√°quina.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>root@172.17.0.1
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>The authenticity of host '172.17.0.1 (172.17.0.1)' can't be established.
ECDSA key fingerprint is SHA256:M+qsqSC4HiYztm1ij8iDkh9KHJz+pxrTm9GTZIf2N9k.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '172.17.0.1' (ECDSA) to the list of known hosts.
root@172.17.0.1's password: 
Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.15.0-58-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

1 device has a firmware upgrade available.
Run `fwupdmgr get-upgrades` for more information.


 * Introducing Expanded Security Maintenance for Applications.
   Receive updates to over 25,000 software packages with your
   Ubuntu Pro subscription. Free for personal use.

     https://ubuntu.com/pro

Se pueden aplicar 0 actualizaciones de forma inmediata.

Your Hardware Enablement Stack (HWE) is supported until April 2025.
Last login: Thu Dec  1 16:32:23 2022 from 127.0.0.1
root@172.17.0.1:~$
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Conex%C3%A3o-sem-senha">Conex√£o sem senha<a class="anchor-link" href="#Conex%C3%A3o-sem-senha">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Como vimos, quando nos conectamos √©-nos pedida a senha da m√°quina de destino, mas se for uma m√°quina √† qual vamos nos conectar a muito, podemos faz√™-lo de modo que n√£o nos seja pedida a senha toda vez que quisermos nos conectar.</p>
</section>
<section class="section-block-markdown-cell">
<p>Para eles, primeiro geramos uma chave <code>ssh</code> utilizando <code>ssh-keygen</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh-keygen
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa
Your public key has been saved in /root/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:4HxRXkVkcK5kNXNyzakfQ6t8a24wRGCUYz4s5KL5ZEc root@e108f6f395b3
The key's randomart image is:
+---[RSA 3072]----+
|          o+==@.=|
|         +.= * Oo|
|      . + = = + .|
|     o o E * + + |
|      = S . = o o|
|     o + .   = o |
|      + .     + .|
|       .       + |
|              +. |
+----[SHA256]-----+
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como podemos ver, primeiro ele nos pergunta onde queremos salvar a chave, se n√£o entrarmos nada, ele a salva no caminho padr√£o. E depois uma frase para gerar a chave, ** se voc√™ escrever uma frase voc√™ deve sempre lembrar-se dela***. Tamb√©m se voc√™ escrever uma frase, ela pedir√° por ela toda vez que tentar acessar a chave, ent√£o toda vez que quisermos acessar a m√°quina atrav√©s do <code>SSH</code>, ela n√£o pedir√° a senha da m√°quina, mas pedir√° por esta frase. Ent√£o voc√™ escolhe se n√£o digitar uma frase para que ela nunca a pe√ßa, ou se voc√™ a digitar e sempre a digitar√°.</p>
</section>
<section class="section-block-markdown-cell">
<p>Em seguida, pedimos √† m√°quina remota que salve nossa chave utilizando <code>ssh-copy-id &lt;user&gt;@&lt;id&gt;:</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh-copy-id<span class="w"> </span>root@172.17.0.1:
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@172.17.0.1's password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'root@172.17.0.1'"
and check to make sure that only the key(s) you wanted were added.

root@103b6040196a:/# ssh root@172.17.0.1
Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.15.0-58-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

4 devices have a firmware upgrade available.
Run `fwupdmgr get-upgrades` for more information.


58 updates can be applied immediately.
41 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable

New release '22.04.1 LTS' available.
Run 'do-release-upgrade' to upgrade to it.

Your Hardware Enablement Stack (HWE) is supported until April 2025.
Last login: Thu Feb  2 08:05:48 2023 from 172.17.0.2
(base) root@172.17.0.1:~$
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Utilize-o-terminal-remoto-via-SSH.">Utilize o terminal remoto via <code>SSH</code>.<a class="anchor-link" href="#Utilize-o-terminal-remoto-via-SSH.">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Talvez n√£o precisemos entrar na m√°quina remota porque s√≥ precisamos executar um √∫nico comando, para que possamos utilizar remotamente seu terminal adicionando a bandeira <code>-t' ao comando</code>SSH', ou seja, por `ssh -t <user>@<id> <command/>``.</id></user></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-t<span class="w"> </span>root@172.17.0.1<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">4</span><span class="w"> </span>google.com
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>PING google.com (172.217.168.174) 56(84) bytes of data.
64 bytes from mad07s10-in-f14.1e100.net (172.217.168.174): icmp_seq=1 ttl=111 time=2.94 ms
64 bytes from mad07s10-in-f14.1e100.net (172.217.168.174): icmp_seq=2 ttl=111 time=2.55 ms
64 bytes from mad07s10-in-f14.1e100.net (172.217.168.174): icmp_seq=3 ttl=111 time=2.78 ms
64 bytes from mad07s10-in-f14.1e100.net (172.217.168.174): icmp_seq=4 ttl=111 time=2.69 ms

--- google.com ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3005ms
rtt min/avg/max/mdev = 2.550/2.739/2.940/0.142 ms
Connection to 172.17.0.1 closed.
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Como voc√™ pode ver, o comando √© realizado na m√°quina remota e quando termina, a √∫ltima linha nos diz que a conex√£o est√° fechada.</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="Proxy-SSH">Proxy <code>SSH</code><a class="anchor-link" href="#Proxy-SSH">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Se voc√™ estiver navegando em um lugar que n√£o seja muito seguro, ou em um lugar que tenha um proxy que n√£o lhe permita acessar algumas portas, voc√™ pode navegar atrav√©s do proxy de outra m√°quina utilizando <code>SSH</code>, isto pode ser feito adicionando a bandeira <code>-D</code> e a porta que voc√™ deseja conectar ao proxy remoto, como a porta para o <code>tcp/ip</code> √© <code>9999</code> o comando poderia parecer `ssh -D 9999 <user>@<id>``.</id></user></p>
</section>
<section class="section-block-markdown-cell">
<p>Para que isto pare√ßa melhor, antes de eu executar isto eu recebo meu IP desonesto</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>curl<span class="w"> </span>ifconfig.me
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>188.127.184.59</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Eu agora uso o proxy de um servidor web que eu instalei</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-D<span class="w"> </span><span class="m">9999</span><span class="w"> </span>root@194.62.99.222
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed Feb 22 06:08:51 AM UTC 2023

  System load:           0.02978515625
  Usage of /:            11.7% of 24.53GB
  Memory usage:          33%
  Swap usage:            0%
  Processes:             89
  Users logged in:       0
  IPv4 address for eth0: 194.62.99.222
  IPv4 address for eth1: 10.7.0.168
  IPv6 address for eth2: 2a04:3542:8000:1000:d48a:cbff:fefb:5b1


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update

Last login: Wed Feb 22 06:02:35 2023 from 188.127.184.59
root@server1:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Alterar as configura√ß√µes de proxy do meu computador</p>
<p><img alt="proxy ssh" src="https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/proxy_ssh.webp"/></p>
</section>
<section class="section-block-markdown-cell">
<p>Agora eu olho novamente para meu IP p√∫blico, mas tomando o proxy rec√©m-configurado</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>curl<span class="w"> </span>-x<span class="w"> </span>socks5h://localhost:9999<span class="w"> </span>ifconfig.me
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>194.62.99.222</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que obtemos o IP p√∫blico do servidor</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="Interface-gr%C3%A1fica-de-usu%C3%A1rio-remota-via-SSH.">Interface gr√°fica de usu√°rio remota via <code>SSH</code>.<a class="anchor-link" href="#Interface-gr%C3%A1fica-de-usu%C3%A1rio-remota-via-SSH.">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>No linux a interface g≈ïafica √© um servidor, portanto, podemos aproveitar isso e executar programas com interfaces gr√°ficas que est√£o em uma m√°quina remota sobre <code>SSH</code>, utilizando a bandeira <code>-X</code>. O comando seria `ssh -X <user>@<id>``.</id></user></p>
</section>
<section class="section-block-markdown-cell">
<p>Primeiro fa√ßo login em meu servidor e instalo 'xeyes' utilizando 'sudo apt install x11-apps' e depois o executo remotamente a partir de meu computador.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-X<span class="w"> </span>root@194.62.99.222
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

Last login: Wed Feb 22 06:39:52 2023 from 188.127.184.59
/usr/bin/xauth:  file /root/.Xauthority does not exist
root@server1:~sudo apt install x11-apps
root@server1:~#xeyes
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora em meu computador a janela "olhos" se abre, mas n√£o est√° rodando no meu computador.</p>
<p><img alt="xeyes" src="https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/xeyes.webp"/></p>
</section>
<section class="section-block-markdown-cell">
<h2 id="T%C3%BAnel-SSH">T√∫nel <code>SSH</code><a class="anchor-link" href="#T%C3%BAnel-SSH">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Como disse, criei um servidor ao qual tenho acesso ssh.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>root@194.62.99.222
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

Last login: Wed Feb 22 06:40:58 2023 from 188.127.184.59
root@server1:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E tamb√©m montei um segundo servidor do qual tenho acesso a partir do <code>servidor1</code>, mas sem acesso a partir do meu computador.</p>
</section>
<section class="section-block-markdown-cell">
<p>Tento ent√£o acessar o `server2' a partir do meu computador e descubro que n√£o posso.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>root@194.62.99.235
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>ssh: connect to host 194.62.99.235 port 22: Connection timed out
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E ent√£o eu tento acessar o <code>server2</code> do <code>server1</code> e vejo que posso.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>root@server1:~#<span class="w"> </span>ssh<span class="w"> </span>root@10.7.2.228
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

Last login: Wed Feb 22 06:59:01 2023 from 10.7.0.168
root@server2:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Ent√£o o que criamos √© um t√∫nel do meu computador para o <code>server2</code> at√© o <code>server1</code>, para isso utilizamos a bandeira <code>-L</code>. Para criar o t√∫nel voc√™ tem que indicar o porto de seu computador onde voc√™ vai criar o t√∫nel, depois o <code>IP</code> de destino do t√∫nel, o porto pelo qual o t√∫nel ir√° passar e finalmente o dispositivo que ir√° criar o t√∫nel. Pareceria assim</p>
<p>"bash
ssh -L &lt;HOST PORT&gt;:&lt;DEST IP&gt;:&lt;TUNNEL PORT&gt; &lt;TUNNEL CREATOR USER&gt;@&lt;TUNNEL CREATOR IP&gt;</p>
<pre><code>
Vejamos com meu exemplo, tenho o "servidor1" com um "IP p√∫blico" que podemos chamar de "ip_pub1" ao qual tenho acesso via "SSH" e um "IP privado" que podemos chamar de "ip_priv1" que est√° dentro da mesma rede do "servidor2". E eu tenho o `server2` com um `IP` p√∫blico que podemos chamar de `ip_pub2` que n√£o tenho acesso via `SSH` e um `IP` privado que podemos chamar de `ip_priv2` que est√° dentro da mesma rede que o `server1`.

Primeiro eu crio o t√∫nel

"bash
ssh -L host_port:ip_priv2:22 root@ip_pub1
</code></pre>
<p>Eu criei um t√∫nel para o <code>IP</code> privado do <code>server2</code> via o <code>IP</code> p√∫blico do <code>server1</code>.</p>
<p>Finalmente, para conectar ao "servidor2", eu me conecto atrav√©s do "localhost" e do porto de hospedagem que declarei no t√∫nel.</p>
<p>"bash
ssh -p 2020 root@localhost</p>
<pre><code>
</code></pre>
</section>
<section class="section-block-markdown-cell">
<p>Vejamos na realidade, os "IP's" dos meus servidores s√£o</p>
<ul>
<li>'servidor1':<ul>
<li>IP p√∫blico: <code>194.62.99.222</code>.</li>
</ul>
*IP privado <code>IP</code>: <code>10.7.0.168</code>.</li>
<li>'servidor2':<ul>
<li>IP p√∫blico: `194.62.99.235'.</li>
</ul>
*IP privado <code>IP</code>: <code>10.7.2.228</code>.</li>
</ul>
<p>Primeiro eu crio o t√∫nel</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-L<span class="w"> </span><span class="m">2020</span>:10.7.2.228:22<span class="w"> </span>root@194.62.99.222
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed Feb 22 11:13:39 AM UTC 2023

  System load:           0.0
  Usage of /:            13.3% of 24.53GB
  Memory usage:          36%
  Swap usage:            0%
  Processes:             91
  Users logged in:       1
  IPv4 address for eth0: 194.62.99.222
  IPv4 address for eth1: 10.7.0.168
  IPv6 address for eth2: 2a04:3542:8000:1000:d48a:cbff:fefb:5b1


101 updates can be applied immediately.
60 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable


Last login: Wed Feb 22 09:29:52 2023 from 188.127.184.59
]0;root@server1: ~<span class="ansi-green-intense-fg ansi-bold">root@server1</span>:<span class="ansi-blue-intense-fg ansi-bold">~</span># ^C

]0;root@server1: ~<span class="ansi-green-intense-fg ansi-bold">root@server1</span>:<span class="ansi-blue-intense-fg ansi-bold">~</span># </pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Com o t√∫nel criado, agora posso me conectar ao <code>server2</code> a partir do meu computador.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-p<span class="w"> </span><span class="m">2020</span><span class="w"> </span>root@localhost
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed Feb 22 11:14:15 AM UTC 2023

  System load:           0.0
  Usage of /:            13.3% of 24.53GB
  Memory usage:          33%
  Swap usage:            0%
  Processes:             90
  Users logged in:       0
  IPv4 address for eth0: 194.62.99.235
  IPv4 address for eth1: 10.7.2.228
  IPv6 address for eth2: 2a04:3542:8000:1000:d48a:cbff:fefb:7f47

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

101 updates can be applied immediately.
60 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable


Last login: Wed Feb 22 11:14:16 2023 from 10.7.0.168
]0;root@server2: ~<span class="ansi-green-intense-fg ansi-bold">root@server2</span>:<span class="ansi-blue-intense-fg ansi-bold">~</span># ^C

]0;root@server2: ~<span class="ansi-green-intense-fg ansi-bold">root@server2</span>:<span class="ansi-blue-intense-fg ansi-bold">~</span># </pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Conex%C3%A3o-reversa">Conex√£o reversa<a class="anchor-link" href="#Conex%C3%A3o-reversa">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Vamos supor novamente que eu quero me conectar ao 'servidor2', mas agora eu n√£o posso, por qualquer raz√£o, fazer um t√∫nel a partir do 'servidor1'. O que podemos fazer √© criar uma conex√£o reversa a partir de outro servidor.</p>
<p>Suponha que eu tenha um terceiro servidor, chamado <code>server3</code>, que √© acess√≠vel por <code>SSH</code> de ambos os lados, ou seja, tanto eu do meu computador quanto o <code>server2</code> temos acesso. Assim, se pudermos acessar fisicamente o <code>server2</code>, uma conex√£o reversa pode ser feita do <code>server2</code> para o <code>server3</code>.</p>
<pre><code>ssh -R &amp;ltserver3port&amp;gt:localhost:22 root@&amp;ltIPserver3&amp;gt
</code></pre>
<p>Com isso, o que eu fiz foi permitir uma conex√£o do "servidor3" ao "servidor2" (o que n√£o era poss√≠vel antes), atrav√©s do "localhost" e do "servidor3port" do "servidor3".</p>
<p>Agora do meu computador posso me conectar ao "servidor3" e do "servidor3" podemos nos conectar ao "servidor2" por meio de</p>
<p>"bash
ssh -p &lt;server3port&gt; root@localhost</p>
<pre><code>
</code></pre>
</section>
<section class="section-block-markdown-cell">
<p>Vamos dar uma olhada nos dados dos meus servidores</p>
<ul>
<li>'servidor2':<ul>
<li>IP p√∫blico: `194.62.99.235'.</li>
</ul>
</li>
<li>Servidor3:<ul>
<li>IP p√∫blico: `194.62.96.236'.</li>
</ul>
</li>
</ul>
</section>
<section class="section-block-markdown-cell">
<p>Primeiro fa√ßo a conex√£o inversa do <code>servidor2</code> para o <code>servidor3</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>root@server2:~#<span class="w"> </span>ssh<span class="w"> </span>-R<span class="w"> </span><span class="m">2020</span>:localhost:22<span class="w"> </span>root@194.62.96.236
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

Last login: Wed Feb 22 15:25:58 2023 from 188.127.184.59
root@server3:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora eu me conecto ao <code>server3</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>root@194.62.96.236
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

Last login: Wed Feb 22 15:12:19 2023 from 188.127.184.59
root@server3:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E agora que estou no 'servidor3', me conecto ao 'servidor2'.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>root@server3:~#<span class="w"> </span>ssh<span class="w"> </span>-p<span class="w"> </span><span class="m">2020</span><span class="w"> </span>root@localhost
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

Last login: Wed Feb 22 15:12:07 2023 from 188.127.184.59
root@server2:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Sucesso! Atrav√©s do meu computador n√£o posso me conectar diretamente ao "servidor2", mas ao me conectar ao "servidor3" consegui acessar o "servidor2" gra√ßas √† conex√£o inversa que fiz do "servidor2" para o "servidor3".</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="Saltar">Saltar<a class="anchor-link" href="#Saltar">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Finalmente, outra maneira de fazer o login no "servidor2" √© fazer o login no "servidor1" e depois do "servidor1" fazer o login no "servidor2". Mas isto √© um pouco complicado, porque primeiro voc√™ tem que fazer uma conex√£o <code>SSH</code> ao <code>server1</code> e depois outra ao <code>server2</code>, ent√£o para fazer tudo de uma s√≥ vez voc√™ pode usar a bandeira <code>-J</code> (<code>jump</code>), ou seja, <code>ssh -J server1 server2</code> seria <code>ssh -J server1 server2</code>.</p>
</section>
<section class="section-block-markdown-cell">
<p>Resumem, primeiro far√≠amos <code>ssh root@194.62.99.222</code> e depois <code>ssh root@10.7.2.228</code> (j√° que dentro do <code>server1</code> nos conectamos ao <code>server2</code> atrav√©s do <code>IP</code> privado).</p>
<p>Assim, poder√≠amos fazer tudo de uma s√≥ vez, fazendo <code>ssh -J root@194.62.99.222 root@10.7.2.228</code></p>
<p>Vamos tentar</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-J<span class="w"> </span>root@194.62.99.222<span class="w"> </span>root@10.7.2.228
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

Last login: Fri Feb 24 06:46:11 2023 from 10.7.0.168
root@server2:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Fomos capazes de fazer os saltos!</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="Arquivo-de-configura%C3%A7%C3%A3o-SSH-do-usu%C3%A1rio">Arquivo de configura√ß√£o <code>SSH</code> do usu√°rio<a class="anchor-link" href="#Arquivo-de-configura%C3%A7%C3%A3o-SSH-do-usu%C3%A1rio">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<h3 id="Dispositivos-com-pseud%C3%B4nimos">Dispositivos com pseud√¥nimos<a class="anchor-link" href="#Dispositivos-com-pseud%C3%B4nimos">¬∂</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Em cada computador h√° um arquivo de configura√ß√£o para o <code>SSH</code> que normalmente est√° localizado na pasta do usu√°rio.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre># Read more about SSH config files: https://linux.die.net/man/5/ssh_config
Host 192.168.1.138
    HostName 192.168.1.138
    User maximo.fernandez
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Neste arquivo eu salvei o usu√°rio e o ip de alguns dos dispositivos aos quais costumo me conectar para n√£o ter que preencher tudo sozinho. Vamos ver isso com os servidores que tenho</p>
<p>Meu servidor <code>server1</code> tem o usu√°rio <code>root</code> e o IP <code>194.62.99.222</code>, ent√£o eu o adiciono √† lista</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Host server1\n    HostName 194.62.99.222\n    User root"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos dar uma outra olhada em como o arquivo de configura√ß√£o se tornou</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre># Read more about SSH config files: https://linux.die.net/man/5/ssh_config
Host 192.168.1.138
    HostName 192.168.1.138
    User maximo.fernandez

Host server1
    HostName 194.62.99.222
    User root
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora que o adicionamos para conectar ao <code>server1</code>, s√≥ precisamos fazer o <code>ssh server1</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>server1<span class="w"> </span>
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

Last login: Fri Feb 24 05:18:59 2023 from 188.127.184.59
root@server1:~# 
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Proxy">Proxy<a class="anchor-link" href="#Proxy">¬∂</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Como j√° vimos, acrescentando a bandeira '-D &lt;port&gt;' poder√≠amos mudar o procurador. Para deixar isto gravado no arquivo de configura√ß√£o, basta adicionar a linha <code>DynamicForward &amp;ltport&amp;gt</code> ao host que estamos salvando.</p>
</section>
<section class="section-block-markdown-cell">
<p>Repetindo o exemplo anterior onde utilizamos o <code>server1</code> como proxy para a porta <code>tcp/ip</code> (<code>9999</code>), o arquivo de configura√ß√£o ficaria assim</p>
<pre><code>Host proxyServer1
    HostName 194.62.99.222
    Raiz do usu√°rio
    DynamicForward 9999
</code></pre>
<p>N√≥s adicionamos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Host proxyServer1\n    HostName 194.62.99.222\n    User root\n    DynamicForward 9999"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver como √© o arquivo de configura√ß√£o</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre># Read more about SSH config files: https://linux.die.net/man/5/ssh_config
Host 192.168.1.138
    HostName 192.168.1.138
    User maximo.fernandez

Host server1
    HostName 194.62.99.222
    User root
Host proxyServer1
    HostName 194.62.99.222
    User root
    DynamicForward 9999
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Eu recebo meu <code>IP</code> p√∫blico'.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>curl<span class="w"> </span>ifconfig.me
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>188.127.184.59</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Eu me conecto ao servidor proxy</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>proxyServer1<span class="w"> </span>
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

Last login: Fri Feb 24 05:42:32 2023 from 188.127.184.59
root@server1:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Alterar as configura√ß√µes de proxy do meu computador</p>
<p><img alt="proxy ssh" src="https://pub-fb664c455eca46a2ba762a065ac900f7.r2.dev/proxy_ssh.webp"/></p>
</section>
<section class="section-block-markdown-cell">
<p>Vejo meu <code>IP</code> p√∫blico novamente, mas tomando o proxy rec√©m-configurado</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>curl<span class="w"> </span>-x<span class="w"> </span>socks5h://localhost:9999<span class="w"> </span>ifconfig.me
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>194.62.99.222</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que obtemos o IP p√∫blico do servidor</p>
</section>
<section class="section-block-markdown-cell">
<h3 id="T%C3%BAnel-SSH">T√∫nel SSH<a class="anchor-link" href="#T%C3%BAnel-SSH">¬∂</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Se, como antes, eu quero criar um t√∫nel para o <code>server2</code> via <code>server1</code>, antes t√≠nhamos que fazer <code>ssh &amp;ltHOST PORT&amp;gt:&amp;ltDEST IP&amp;gt:&amp;ltTUNNEL PORT&amp;gt &amp;ltTUNNEL CREATOR USER&amp;gt@&amp;ltTUNNEL CREATOR IP&amp;gt</code>, agora temos que adicionar a linha</p>
<p>"bash
LocalForward &lt;localhost&gt;:&lt;HOST PORT&gt; &lt;DEST IP&gt;:&lt;TUNNEL PORT&gt;</p>
<pre><code>
</code></pre>
</section>
<section class="section-block-markdown-cell">
<p>Ou seja, o arquivo de configura√ß√£o ficaria assim</p>
<pre><code>Host tunelToServer2
    HostName 194.62.99.222
    Raiz do usu√°rio
    LocalForward 127.0.0.0.1.1:2020 10.7.2.228:22
</code></pre>
</section>
<section class="section-block-markdown-cell">
<p>Mas como isso n√£o est√° muito claro, vamos olhar para isso em termos concretos</p>
<ul>
<li>'servidor1':<ul>
<li>IP p√∫blico: <code>194.62.99.222</code>.</li>
</ul>
*IP privado <code>IP</code>: <code>10.7.0.168</code>.</li>
<li>'servidor2':<ul>
<li>IP p√∫blico: `194.62.99.235'.</li>
</ul>
*IP privado <code>IP</code>: <code>10.7.2.228</code>.</li>
</ul>
<p>Anteriormente, o comando era</p>
<p>"bash
ssh -L 2020:10.7.2.228:22 root@194.62.99.222</p>
<pre><code>
Portanto, o arquivo de configura√ß√£o tem que ser parecido com o seguinte

</code></pre>
<p>Host tunelToServer2
    HostName 194.62.99.222
    Raiz do usu√°rio
    LocalForward 127.0.0.0.1.1:2020 10.7.2.228:22</p>
<pre><code>
Vamos ver se funciona
</code></pre>
</section>
<section class="section-block-markdown-cell">
<p>Adicionamos a nova configura√ß√£o</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Host tunelToServer2\n    HostName 194.62.99.222\n    User root\n    LocalForward 127.0.0.1:2020 10.7.2.228:22"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver como √© o arquivo de configura√ß√£o</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre># Read more about SSH config files: https://linux.die.net/man/5/ssh_config
Host 192.168.1.138
    HostName 192.168.1.138
    User maximo.fernandez

Host server1
    HostName 194.62.99.222
    User root
Host proxyServer1
    HostName 194.62.99.222
    User root
    DynamicForward 9999
Host tunelToServer2
    HostName 194.62.99.222
    User root
    LocalForward 127.0.0.1:2020 10.7.2.228:22
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Criamos o t√∫nel</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>tunelToServer2<span class="w"> </span>
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

Last login: Fri Feb 24 06:02:20 2023 from 188.127.184.59
root@server1:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora estamos tentando nos conectar ao <code>server2</code> a partir do meu computador.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-p<span class="w"> </span><span class="m">2020</span><span class="w"> </span>root@localhost
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

Last login: Fri Feb 24 06:02:36 2023 from 10.7.0.168
root@server2:~# 
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Feito! Mas podemos tornar tudo um pouco mais limpo, podemos adicionar esta √∫ltima conex√£o ao arquivo de configura√ß√£o</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Host server2ByTunel\n    HostName localhost\n    User root\n    Port 2020"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver como √© o arquivo de configura√ß√£o</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre># Read more about SSH config files: https://linux.die.net/man/5/ssh_config
Host 192.168.1.138
    HostName 192.168.1.138
    User maximo.fernandez

Host server1
    HostName 194.62.99.222
    User root
Host proxyServer1
    HostName 194.62.99.222
    User root
    DynamicForward 9999
Host tunelToServer2
    HostName 194.62.99.222
    User root
    LocalForward 127.0.0.1:2020 10.7.2.228:22
Host server2ByTunel
    HostName localhost
    User root
    Port 2020
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora conectamos novamente ao <code>server2</code> a partir do meu computador, atrav√©s do t√∫nel, mas com a √∫ltima configura√ß√£o, acabamos de salvar.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>server2ByTunel<span class="w"> </span>
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

Last login: Fri Feb 24 06:13:33 2023 from 10.7.0.168
root@server2:~# 
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Em resumo, com tudo o que fizemos, podemos criar o t√∫nel para o <code>server2</code> com o comando <code>ssh tunnelToServer2</code> e depois conectar ao <code>server2</code> com o comando <code>ssh server2ByTunel</code>.</p>
<p>Impressionante!</p>
</section>
<section class="section-block-markdown-cell">
<h4 id="Conex%C3%A3o-reversa">Conex√£o reversa<a class="anchor-link" href="#Conex%C3%A3o-reversa">¬∂</a></h4>
</section>
<section class="section-block-markdown-cell">
<p>Lembramos que agora nosso problema era que n√£o pod√≠amos nos conectar ao "servidor2" atrav√©s do t√∫nel do "servidor1". Ent√£o, criando uma conex√£o reversa do "servidor2" (temos algu√©m no "servidor2" que pode fazer essa conex√£o reversa, ou n√≥s mesmos a deixamos feita antes de sairmos) para um "servidor3", do meu computador eu posso me conectar ao "servidor3" e depois me conectar ao "servidor2".</p>
</section>
<section class="section-block-markdown-cell">
<p>Primeiro temos que fazer a conex√£o inversa do <code>servidor2</code> para o <code>servidor3</code>. Isto poderia ser feito com um comando</p>
<p>"bash
ssh -R &lt;server3port&gt;:localhost:22 root@&lt;IPserver3&gt;</p>
<pre><code>
Ou salvar a conex√£o no arquivo de configura√ß√£o, adicionando

</code></pre>
<p>Host reverseToServer3
    HostName &lt;IPserver3&gt;
    Raiz do usu√°rio
    RemoteForward &lt;server3port&gt; localhost:22</p>
<pre><code>
E fazer a conex√£o inversa por

"bash
ssh reverseToServer3
</code></pre>
</section>
<section class="section-block-markdown-cell">
<p>Como isso n√£o facilita a compreens√£o, vamos analis√°-lo com dados concretos.</p>
<ul>
<li>'servidor2':<ul>
<li>IP p√∫blico: `194.62.99.235'.</li>
</ul>
</li>
<li>Servidor3:<ul>
<li>IP p√∫blico: `194.62.96.236'.</li>
</ul>
</li>
</ul>
<p>Para fazer a conex√£o inversa, voc√™ teria que usar o comando</p>
<p>"bash
ssh -R 2020:localhost:22 root@194.62.96.236</p>
<pre><code>
Ou salvar a seguinte configura√ß√£o

"bash
Host reverseToServer3
    HostName 194.62.96.236
    Raiz do usu√°rio
    RemoteForward 2020 localhost:22
</code></pre>
<p>E conectar via</p>
<p>"bash
ssh reverseToServer3</p>
<pre><code>
</code></pre>
</section>
<section class="section-block-markdown-cell">
<p>Ent√£o eu salvo a configura√ß√£o no servidor 2 e fa√ßo a conex√£o.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>root@server2:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Host reverseToServer3\n    HostName 194.62.96.236\n    User root\n    RemoteForward 2020 localhost:22"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver o que tem sido bem guardado</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>root@server2:~#<span class="w"> </span>cat<span class="w"> </span>.ssh/config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>
Host reverseToServer3
    HostName 194.62.96.236
    User root
    RemoteForward 2020 localhost:22
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Eu fa√ßo a conex√£o inversa</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>root@server2:~#<span class="w"> </span>ssh<span class="w"> </span>reverseToServer3<span class="w"> </span>
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

Last login: Wed Feb 22 15:26:18 2023 from 194.62.99.235
root@server3:~# 
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h3 id="Saltar">Saltar<a class="anchor-link" href="#Saltar">¬∂</a></h3>
</section>
<section class="section-block-markdown-cell">
<p>Como dissemos, fizemos saltos utilizando a bandeira <code>-J</code>, de modo que com o comando <code>ssh -J root@194.62.99.222 root@10.7.2.228</code> pudemos nos conectar ao <code>server2</code>.</p>
</section>
<section class="section-block-markdown-cell">
<p>H√° duas op√ß√µes para configurar o arquivo de configura√ß√£o</p>
</section>
<section class="section-block-markdown-cell">
<p>A primeira √© que, como j√° temos o <code>server1</code> salvo no arquivo de configura√ß√£o, apenas adicionamos o <code>server2</code>.</p>
<p>"bash
Servidor anfitri√£o2
    HostName 10.7.2.228
    Raiz do usu√°rio</p>
<pre><code>
E ent√£o poder√≠amos nos conectar via

"bash
ssh -J server1 server2
</code></pre>
<p>Vamos experimentar</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Host server2\n    HostName 10.7.2.228\n    User root\n"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos o arquivo de configura√ß√£o</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre># Read more about SSH config files: https://linux.die.net/man/5/ssh_config
Host 192.168.1.138
    HostName 192.168.1.138
    User maximo.fernandez

Host server1
    HostName 194.62.99.222
    User root
Host proxyServer1
    HostName 194.62.99.222
    User root
    DynamicForward 9999
Host tunelToServer2
    HostName 194.62.99.222
    User root
    LocalForward 127.0.0.1:2020 10.7.2.228:22
Host server2ByTunel
    HostName localhost
    User root
    Port 2020
Host server2
    HostName 10.7.2.228
    User root

</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora nos conectamos atrav√©s dos saltos</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-J<span class="w"> </span>server1<span class="w"> </span>server2
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

Last login: Fri Feb 24 12:05:16 2023 from 10.7.0.168
root@server2:~#
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Esta tem sido a primeira op√ß√£o, para salvar cada servidor e configurar o l√∫pulo, mas uma segunda op√ß√£o √© salvar todos os l√∫pulos em uma √∫nica configura√ß√£o, que seria parecida com esta</p>
<p>"bash
Host server2jumping
    HostName 10.7.2.228
    Raiz do usu√°rio
    ProxyJump root@194.62.99.222</p>
<pre><code>
Tudo o que seria necess√°rio agora √© se conectar via

</code></pre>
<p>ssh server2jumping</p>
<pre><code>
Vamos tentar
</code></pre>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Host server2jumping\n    HostName 10.7.2.228\n    User root\n    ProxyJump root@194.62.99.222"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos dar uma olhada no arquivo de configura√ß√£o</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre># Read more about SSH config files: https://linux.die.net/man/5/ssh_config
Host 192.168.1.138
    HostName 192.168.1.138
    User maximo.fernandez

Host server1
    HostName 194.62.99.222
    User root
Host proxyServer1
    HostName 194.62.99.222
    User root
    DynamicForward 9999
Host tunelToServer2
    HostName 194.62.99.222
    User root
    LocalForward 127.0.0.1:2020 10.7.2.228:22
Host server2ByTunel
    HostName localhost
    User root
    Port 2020
Host server2
    HostName 10.7.2.228
    User root
Host server2jumping
    HostName 10.7.2.228
    User root
    ProxyJump root@194.62.99.222
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora tentamos conectar</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>server2jumping
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

Last login: Fri Feb 24 12:06:22 2023 from 10.7.0.168
root@server2:~# 
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Sistema-SSH-arquivo-de-configura%C3%A7%C3%A3o">Sistema <code>SSH</code> arquivo de configura√ß√£o<a class="anchor-link" href="#Sistema-SSH-arquivo-de-configura%C3%A7%C3%A3o">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Anteriormente vimos o arquivo de configura√ß√£o <code>SSH</code> do usu√°rio, onde salvamos configura√ß√µes de m√°quinas onde quer√≠amos nos conectar via <code>SSH</code>, mas existe outro arquivo de configura√ß√£o <code>SSH</code> mas neste caso do sistema, que est√° localizado em <code>/etc/ssh/ssh_config</code>, vamos dar uma olhada nele.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>/etc/ssh/sshd_config
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>#	$OpenBSD: sshd_config,v 1.103 2018/04/09 20:41:22 tj Exp $

# This is the sshd server system-wide configuration file.  See
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options override the
# default value.

Include /etc/ssh/sshd_config.d/*.conf

#Port 22
#AddressFamily any
#ListenAddress 0.0.0.0
#ListenAddress ::

#HostKey /etc/ssh/ssh_host_rsa_key
#HostKey /etc/ssh/ssh_host_ecdsa_key
#HostKey /etc/ssh/ssh_host_ed25519_key

# Ciphers and keying
#RekeyLimit default none

# Logging
#SyslogFacility AUTH
#LogLevel INFO

# Authentication:

#LoginGraceTime 2m
#PermitRootLogin prohibit-password
#StrictModes yes
#MaxAuthTries 6
#MaxSessions 10

#PubkeyAuthentication yes

# Expect .ssh/authorized_keys2 to be disregarded by default in future.
#AuthorizedKeysFile	.ssh/authorized_keys .ssh/authorized_keys2

#AuthorizedPrincipalsFile none

#AuthorizedKeysCommand none
#AuthorizedKeysCommandUser nobody

# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
#HostbasedAuthentication no
# Change to yes if you don't trust ~/.ssh/known_hosts for
# HostbasedAuthentication
#IgnoreUserKnownHosts no
# Don't read the user's ~/.rhosts and ~/.shosts files
#IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!
#PasswordAuthentication yes
#PermitEmptyPasswords no

# Change to yes to enable challenge-response passwords (beware issues with
# some PAM modules and threads)
ChallengeResponseAuthentication no

# Kerberos options
#KerberosAuthentication no
#KerberosOrLocalPasswd yes
#KerberosTicketCleanup yes
#KerberosGetAFSToken no

# GSSAPI options
#GSSAPIAuthentication no
#GSSAPICleanupCredentials yes
#GSSAPIStrictAcceptorCheck yes
#GSSAPIKeyExchange no

# Set this to 'yes' to enable PAM authentication, account processing,
# and session processing. If this is enabled, PAM authentication will
# be allowed through the ChallengeResponseAuthentication and
# PasswordAuthentication.  Depending on your PAM configuration,
# PAM authentication via ChallengeResponseAuthentication may bypass
# the setting of "PermitRootLogin without-password".
# If you just want the PAM account and session checks to run without
# PAM authentication, then enable this but set PasswordAuthentication
# and ChallengeResponseAuthentication to 'no'.
UsePAM yes

#AllowAgentForwarding yes
#AllowTcpForwarding yes
#GatewayPorts no
X11Forwarding yes
#X11DisplayOffset 10
#X11UseLocalhost yes
#PermitTTY yes
PrintMotd no
#PrintLastLog yes
#TCPKeepAlive yes
#PermitUserEnvironment no
#Compression delayed
#ClientAliveInterval 0
#ClientAliveCountMax 3
#UseDNS no
#PidFile /var/run/sshd.pid
#MaxStartups 10:30:100
#PermitTunnel no
#ChrootDirectory none
#VersionAddendum none

# no default banner path
#Banner none

# Allow client to pass locale environment variables
AcceptEnv LANG LC_*

# override default of no subsystems
Subsystem	sftp	/usr/lib/openssh/sftp-server

# Example of overriding settings on a per-user basis
#Match User anoncvs
#	X11Forwarding no
#	AllowTcpForwarding no
#	PermitTTY no
#	ForceCommand cvs server
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Com este arquivo podemos mudar a configura√ß√£o de como funciona o <code>SSH</code> em nosso computador. Por exemplo, podemos ver uma linha comentada que diz</p>
<p>"bash</p>
<h1 id="Port-22">Port 22<a class="anchor-link" href="#Port-22">¬∂</a></h1><pre><code>
Se o descomentarmos e mudarmos o n√∫mero 'SSH', ele n√£o ir√° mais para a porta 22, que √© sua porta padr√£o, e ir√° para o n√∫mero da porta especificada ali.
</code></pre>
</section>
<section class="section-block-markdown-cell">
<h2 id="C%C3%B3pia-de-arquivos-por-%60SSH">C√≥pia de arquivos por `SSH<a class="anchor-link" href="#C%C3%B3pia-de-arquivos-por-%60SSH">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Podemos copiar arquivos sobre <code>SSH</code> utilizando o comando <code>scp</code> (c√≥pia segura), para o qual a sintaxe √©</p>
<p>"bash
scp &lt;path arquivo local&gt; &lt;user&gt;@&lt;IP&gt;:&lt;path para salvar&gt;</p>
<pre><code>
o

"bash
scp &amp;ltuser&amp;gt@&amp;&amp;&amp;ltip&amp;gt:&amp;ltpath para arquivo remoto&amp;gt &amp;ltpath para salvar&amp;gt
</code></pre>
<p>A primeira maneira copia um arquivo de nosso computador para outro computador e a segunda maneira copia um arquivo de outro computador para o nosso</p>
</section>
<section class="section-block-markdown-cell">
<p>Por exemplo, vamos fazer um <code>ls</code> de <code>servidor1</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-t<span class="w"> </span>server1<span class="w"> </span><span class="s2">"ls"</span>
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>snap
Connection to 194.62.99.222 closed.
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vejamos o que temos reservado para que possamos passar para voc√™.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre> 2021-02-11-Introduccion-a-Python.ipynb         html_files
 2021-04-23-Calculo-matricial-con-Numpy.ipynb   html.ipynb
 2021-06-15-Manejo-de-datos-con-Pandas.ipynb    introduccion_python
 2022-09-12-Introduccion-a-la-terminal.ipynb    mi_paquete_de_python
 2023-01-22-Docker.ipynb		        movies.csv
 2023-02-01-Bash-scripting.ipynb	        movies.dat
 2023-02-04-Blip-2.ipynb		        notebooks_translated
 2023-XX-XX-SSH.ipynb			        __pycache__
 california_housing_train.csv		        scripts_bash
 command-line-cheat-sheet.pdf		        ssh.ipynb
 CSS.ipynb				        test.ipynb
'Expresiones regulares.ipynb'
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos enviar o arquivo <code>html.ipynb</code> para o servidor, pois ocupa pouco espa√ßo.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>scp<span class="w"> </span>html.ipynb<span class="w"> </span>server1:/root/
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>html.ipynb                                    100%   14KB 229.0KB/s   00:00    
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos ver novamente o que est√° dentro do <code>server1</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-t<span class="w"> </span>server1<span class="w"> </span><span class="s2">"ls"</span>
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>html.ipynb  snap
Connection to 194.62.99.222 closed.
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Foi copiado</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="Sincroniza%C3%A7%C3%A3o-de-arquivos-via-SSH-%23%23-Sincroniza%C3%A7%C3%A3o-de-arquivos-via-SSH-%23%23-Sincroniza%C3%A7%C3%A3o-de-arquivos-via-SSH-%23%23-Sincroniza%C3%A7%C3%A3o-de-arquivos-via-%60SSH">Sincroniza√ß√£o de arquivos via <code>SSH</code> ## Sincroniza√ß√£o de arquivos via <code>SSH</code> ## Sincroniza√ß√£o de arquivos via <code>SSH</code> ## Sincroniza√ß√£o de arquivos via `SSH<a class="anchor-link" href="#Sincroniza%C3%A7%C3%A3o-de-arquivos-via-SSH-%23%23-Sincroniza%C3%A7%C3%A3o-de-arquivos-via-SSH-%23%23-Sincroniza%C3%A7%C3%A3o-de-arquivos-via-SSH-%23%23-Sincroniza%C3%A7%C3%A3o-de-arquivos-via-%60SSH">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>O mal do comando <code>scp</code> √© que se algo acontece no meio da c√≥pia e voc√™ n√£o termina de copiar o arquivo, quando voc√™ tenta novamente tem que come√ßar do zero, isto √© especialmente um problema com arquivos muito grandes.</p>
</section>
<section class="section-block-markdown-cell">
<p>Para contornar isso voc√™ pode utilizar o <code>rsync</code>, a sintaxe √©</p>
<p>"bash
rsync --parcial --progress --rsh=ssh <caminho arquivo="" local=""> &lt;usu√°rio&gt;@<ip>:<caminho para="" salvar="">:<caminho para="" salvar="">&gt;.</caminho></caminho></ip></caminho></p>
<pre><code>
o

"bash
rsync --parcial --progress --rsh=ssh &lt;usu√°rio&gt;@&lt;ip&gt;:&lt;caminho para arquivo remoto&gt; &lt;caminho para salvar&gt;
</code></pre>
<p>Como antes, a primeira maneira copia um arquivo de nosso computador para outro computador e a segunda maneira, de outro computador para o nosso. A bandeira "parcial" √© para indicar que arquivos parcialmente copiados s√£o salvos, ou seja, se a c√≥pia √© parada antes de ser conclu√≠da, o que foi copiado √© mantido. A bandeira de "progresso" √© para indicar o progresso da c√≥pia. A bandeira <code>--rsh=ssh</code> deve indicar que a transfer√™ncia do arquivo √© feita sobre a bandeira <code>SSH</code>.</p>
</section>
<section class="section-block-markdown-cell">
<p>Passamos um arquivo</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>rsync<span class="w"> </span>--partial<span class="w"> </span>--progress<span class="w"> </span>-rsh<span class="o">=</span>ssh<span class="w"> </span><span class="m">2021</span>-06-15-Manejo-de-datos-con-Pandas.ipynb<span class="w">  </span>server1:/root/
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>sending incremental file list
2021-06-15-Manejo-de-datos-con-Pandas.ipynb
        608.34K 100%  197.78MB/s    0:00:00 (xfr#1, to-chk=0/1)
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E vemos se foi copiado</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-t<span class="w"> </span>server1<span class="w"> </span><span class="s2">"ls"</span>
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>2021-06-15-Manejo-de-datos-con-Pandas.ipynb  html.ipynb  snap
Connection to 194.62.99.222 closed.
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Montar-pastas-remotas-em-pastas-locais">Montar pastas remotas em pastas locais<a class="anchor-link" href="#Montar-pastas-remotas-em-pastas-locais">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Caso queiramos ter uma pasta de outra m√°quina como se estivesse em nosso computador, temos de uasr <code>sshfs</code>.</p>
<p>Primeiro precisa ser instalado por</p>
<p>"bash
sudo apt install sshfs</p>
<pre><code>
E uma vez instalado, ele √© usado com a sintaxe

"bash
sshfs &amp;ltuser&amp;gt@&amp;&amp;&amp;ltip&amp;gt:&amp;ltremote path&amp;gt &amp;ltlocal path to mount&amp;gt
</code></pre>
</section>
<section class="section-block-markdown-cell">
<p>Vamos montar a pasta <code>/root' do</code>servidor1', mas para isso vamos primeiro criar uma pasta na qual vamos mont√°-la.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>mkdir<span class="w"> </span>server1folder
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Podemos ver que n√£o h√° nada dentro da pasta que montamos.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls<span class="w"> </span>server1folder
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora montamos a pasta do servidor</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!!</span>sshfs<span class="w"> </span>server1:/root/<span class="w"> </span>server1folder
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Voltamos para ver o que est√° dentro</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls<span class="w"> </span>server1folder
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>2021-06-15-Manejo-de-datos-con-Pandas.ipynb  html.ipynb  snap
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Quando n√£o quisermos mais ter a pasta montada, podemos desmont√°-la por 'fusermount -u server1folder'.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!!</span>fusermount<span class="w"> </span>-u<span class="w"> </span>server1folder
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Olhamos novamente para o que est√° dentro para ver que n√£o h√° nada.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls<span class="w"> </span>server1folder
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Depurando-a-conex%C3%A3o-%60SSH">Depurando a conex√£o `SSH<a class="anchor-link" href="#Depurando-a-conex%C3%A3o-%60SSH">¬∂</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Podemos depurar a conex√£o <code>SSH</code> adicionando <code>-v</code>, at√© <code>-vvvv</code> √† conex√£o, quanto mais <code>v</code>s adicionarmos, maior ser√° o n√≠vel de informa√ß√£o.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>ssh<span class="w"> </span>-v<span class="w"> </span>server1
</pre></div>
</div>
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>OpenSSH_8.2p1 Ubuntu-4ubuntu0.5, OpenSSL 1.1.1f  31 Mar 2020
debug1: Reading configuration data /home/wallabot/.ssh/config
debug1: /home/wallabot/.ssh/config line 6: Applying options for server1
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: /etc/ssh/ssh_config line 19: include /etc/ssh/ssh_config.d/*.conf matched no files
debug1: /etc/ssh/ssh_config line 21: Applying options for *
debug1: Connecting to 194.62.99.222 [194.62.99.222] port 22.
debug1: Connection established.
debug1: identity file /home/wallabot/.ssh/id_rsa type 0
debug1: identity file /home/wallabot/.ssh/id_rsa-cert type -1
debug1: identity file /home/wallabot/.ssh/id_dsa type -1
debug1: identity file /home/wallabot/.ssh/id_dsa-cert type -1
debug1: identity file /home/wallabot/.ssh/id_ecdsa type -1
debug1: identity file /home/wallabot/.ssh/id_ecdsa-cert type -1
debug1: identity file /home/wallabot/.ssh/id_ecdsa_sk type -1
debug1: identity file /home/wallabot/.ssh/id_ecdsa_sk-cert type -1
debug1: identity file /home/wallabot/.ssh/id_ed25519 type -1
debug1: identity file /home/wallabot/.ssh/id_ed25519-cert type -1
debug1: identity file /home/wallabot/.ssh/id_ed25519_sk type -1
debug1: identity file /home/wallabot/.ssh/id_ed25519_sk-cert type -1
debug1: identity file /home/wallabot/.ssh/id_xmss type -1
debug1: identity file /home/wallabot/.ssh/id_xmss-cert type -1
debug1: Local version string SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5
debug1: Remote protocol version 2.0, remote software version OpenSSH_8.9p1 Ubuntu-3
debug1: match: OpenSSH_8.9p1 Ubuntu-3 pat OpenSSH* compat 0x04000000
debug1: Authenticating to 194.62.99.222:22 as 'root'
debug1: SSH2_MSG_KEXINIT sent
debug1: SSH2_MSG_KEXINIT received
debug1: kex: algorithm: curve25519-sha256
debug1: kex: host key algorithm: ecdsa-sha2-nistp256
debug1: kex: server-&gt;client cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none
debug1: kex: client-&gt;server cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none
debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
debug1: Server host key: ecdsa-sha2-nistp256 SHA256:jwpQt2a69LQcuvvYPPKL32bBwTi1Je/ZmUdr4zEiD1Y
debug1: Host '194.62.99.222' is known and matches the ECDSA host key.
debug1: Found key in /home/wallabot/.ssh/known_hosts:14
debug1: rekey out after 134217728 blocks
debug1: SSH2_MSG_NEWKEYS sent
debug1: expecting SSH2_MSG_NEWKEYS
debug1: SSH2_MSG_NEWKEYS received
debug1: rekey in after 134217728 blocks
debug1: Will attempt key: /home/wallabot/.ssh/id_rsa RSA SHA256:ID3HcrbyPBGjFx/qeiJK50eqihLGrpDVu02oRSyKGh4 agent
debug1: Will attempt key: wallabot@wallabot RSA SHA256:Qlq6hXbToInW+efEK666BFT26EeUSpBhzcqxTLrDBpQ agent
debug1: Will attempt key: /home/wallabot/.ssh/id_dsa 
debug1: Will attempt key: /home/wallabot/.ssh/id_ecdsa 
debug1: Will attempt key: /home/wallabot/.ssh/id_ecdsa_sk 
debug1: Will attempt key: /home/wallabot/.ssh/id_ed25519 
debug1: Will attempt key: /home/wallabot/.ssh/id_ed25519_sk 
debug1: Will attempt key: /home/wallabot/.ssh/id_xmss 
debug1: SSH2_MSG_EXT_INFO received
debug1: kex_input_ext_info: server-sig-algs=&lt;ssh-ed25519,sk-ssh-ed25519@openssh.com,ssh-rsa,rsa-sha2-256,rsa-sha2-512,ssh-dss,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,sk-ecdsa-sha2-nistp256@openssh.com,webauthn-sk-ecdsa-sha2-nistp256@openssh.com&gt;
debug1: kex_input_ext_info: publickey-hostbound@openssh.com (unrecognised)
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug1: Authentications that can continue: publickey
debug1: Next authentication method: publickey
debug1: Offering public key: /home/wallabot/.ssh/id_rsa RSA SHA256:ID3HcrbyPBGjFx/qeiJK50eqihLGrpDVu02oRSyKGh4 agent
debug1: Authentications that can continue: publickey
debug1: Offering public key: wallabot@wallabot RSA SHA256:Qlq6hXbToInW+efEK666BFT26EeUSpBhzcqxTLrDBpQ agent
debug1: Server accepts key: wallabot@wallabot RSA SHA256:Qlq6hXbToInW+efEK666BFT26EeUSpBhzcqxTLrDBpQ agent
debug1: Authentication succeeded (publickey).
Authenticated to 194.62.99.222 ([194.62.99.222]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Remote: /root/.ssh/authorized_keys:1: key options: agent-forwarding port-forwarding pty user-rc x11-forwarding
debug1: Remote: /root/.ssh/authorized_keys:1: key options: agent-forwarding port-forwarding pty user-rc x11-forwarding
debug1: Sending environment.
debug1: Sending env LANG = es_ES.UTF-8
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-60-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Feb 24 01:25:10 PM UTC 2023

  System load:           0.0
  Usage of /:            15.2% of 24.53GB
  Memory usage:          34%
  Swap usage:            0%
  Processes:             89
  Users logged in:       0
  IPv4 address for eth0: 194.62.99.222
  IPv4 address for eth1: 10.7.0.168
  IPv6 address for eth2: 2a04:3542:8000:1000:d48a:cbff:fefb:5b1

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

43 updates can be applied immediately.
To see these additional updates run: apt list --upgradable


Last login: Fri Feb 24 13:10:05 2023 from 188.127.184.59
]0;root@server1: ~<span class="ansi-green-intense-fg ansi-bold">root@server1</span>:<span class="ansi-blue-intense-fg ansi-bold">~</span># ^C

]0;root@server1: ~<span class="ansi-green-intense-fg ansi-bold">root@server1</span>:<span class="ansi-blue-intense-fg ansi-bold">~</span># </pre>
</div>
</div>
</div>
</section>
