<p>
	<!-- Custom stylesheet, it must be in the same directory as the html file -->
	<!-- Loading mathjax macro --><!-- Load mathjax --><!-- MathJax configuration -->
<p>
<style>
	/* Media query para pantallas grandes */
	@media screen and (min-width: 1000px) {
		.container {
			flex-wrap: nowrap;
			display: flex;
			justify-content: space-between;
			height: 100vh; /* altura del viewport */
		}
		
		.indice {
			width: 25%; /* Ancho del índice en pantallas grandes */
			border-right: 1px solid #ccc;
			max-height: calc(100vh - 40px); /* Ajustar según tus necesidades. Aquí estamos restando el doble del padding para mantener todo visible */
			padding: 20px;
			box-sizing: border-box;
			overflow-y: auto; /* desplazamiento vertical cuando sea necesario */
		}
		
		.contenido {
			width: 70%; /* Ancho del contenido en pantallas grandes */
			max-height: calc(100vh - 40px); /* Ajustar según tus necesidades. Aquí estamos restando el doble del padding para mantener todo visible */
			padding: 20px;
			box-sizing: border-box;
			overflow-y: auto; /* desplazamiento vertical cuando sea necesario */
		}
	}
</style>
<!-- Open div notebook -->
<div id="notebook" class="border-box-sizing" tabindex="-1">
	<!-- Open div notebook container -->
	<div id="notebook-container" class="container">
		<!-- Open div indice -->
		<div class="indice">
			<!-- Open div index header -->
			<div class="cell border-box-sizing text_cell rendered">
				<h2 class="prompt input_prompt">
					<span style="
					color: var(--darkreader-text--heading-color, var(--darkreader-text--heading-2-color,
					var(--darkreader-text--headings-color)));
					font-family: var(--fontFamily); font-size: var(--fontSize);
					font-style: var(--fontStyle, inherit);
					font-weight: var(--fontWeight);
					letter-spacing: var(--letterSpacing);
					text-transform: var(--textTransform);
					background-color: transparent;
					--darkreader-inline-color: var(--darkreader-text--darkreader-text--heading-color,
					var(--darkreader-text--darkreader-text--heading-2-color, var(--darkreader-text--darkreader-text--headings-color)));
					--darkreader-inline-bgcolor: transparent;"
					data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">
						Índice
					</span>
					<a class="anchor-link" style="
					font-family: var(--fontFamily);
					font-size: var(--fontSize);
					font-style: var(--fontStyle, inherit);
					font-weight: var(--fontWeight);
					letter-spacing: var(--letterSpacing);
					text-transform: var(--textTransform);
					background-color: transparent;
					--darkreader-inline-bgcolor: transparent;"
					href="#Índice" data-darkreader-inline-bgcolor="">
					</a>
				</h2>
			<!-- Close div index header -->
			</div>
			<!-- Index body -->
			<div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Mistura-de-especialistas-(MoE)-index">
									<a class="anchor-link" href="#Mistura-de-especialistas-(MoE)">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Mistura de especialistas (MoE)</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Usando-o-Mixtral-8x7b-na-nuvem-index">
									<a class="anchor-link" href="#Usando-o-Mixtral-8x7b-na-nuvem">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Usando o Mixtral-8x7b na nuvem</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Uso-do-Mixtral-8x7b-no-bate-papo-huggingface-index">
									<a class="anchor-link" href="#Uso-do-Mixtral-8x7b-no-bate-papo-huggingface">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Uso do Mixtral-8x7b no bate-papo huggingface</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Usando-o-Mixtral-8x7b-no-Perplexity-Labs-index">
									<a class="anchor-link" href="#Usando-o-Mixtral-8x7b-no-Perplexity-Labs">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Usando o Mixtral-8x7b no Perplexity Labs</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Usando-o-Mixtral-8x7b-localmente-por-meio-da-API-huggingface-index">
									<a class="anchor-link" href="#Usando-o-Mixtral-8x7b-localmente-por-meio-da-API-huggingface">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Usando o Mixtral-8x7b localmente por meio da API huggingface</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
			</div>
		<!-- Close div indice -->
		</div>
 
		<!-- Content -->
		<div class="contenido">
		<div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><a href="https://colab.research.google.com/github/maximofn/portafolio/blob/main/posts/notebooks_translated/2023-12-30-Mixtral-8x7B_PT.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h1 id="Mixtral-8x7B-MoE">
								<a class="anchor-link" href="#Mixtral-8x7B-MoE">
									<p style="margin-left: 0px">Mixtral-8x7B MoE</p>
								</a>
							</h1>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Para mim, a melhor descrição do <code><b>mixtral-8x7b</b></code> é a seguinte imagem</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2023/12/mixtral-gemini.webp" alt="mixtral-gemini"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Entre o lançamento do <code><b>gemini</b></code> e o lançamento do <code><b>mixtra-8x7b</b></code>, houve uma diferença de apenas alguns dias. Nos dois primeiros dias após o lançamento do <code><b>gemini</b></code> houve muita conversa sobre esse modelo, mas assim que o <code><b>mixtral-8x7b</b></code> foi lançado, o <code><b>gemini</b></code> foi completamente esquecido e toda a comunidade estava falando sobre o <code><b>mixtral-8x7b</b></code>.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">E não é de se admirar que, analisando seus benchmarks, podemos ver que ele está no nível de modelos como o <code><b>llama2-70B</b></code> e o <code><b>GPT3.5</b></code>, mas com a diferença de que, enquanto o <code><b>mixtral-8x7b</b></code> tem apenas 46,7B de parâmetros, o <code><b>llama2-70B</b></code> tem 70B e o <code><b>GPT3.5</b></code> tem 175B.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="https://mistral.ai/images/news/mixtral-of-experts/overview.png" alt="mixtral benchmarks"></p></p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Este caderno foi traduzido automaticamente para torná-lo acessível a mais pessoas, por favor me avise se você vir algum erro de digitação..</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">## Número de parâmetros</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Como o nome sugere, <code><b>mixtral-8x7b</b></code> é um conjunto de 8 modelos de parâmetros 7B, portanto, poderíamos pensar que ele tem 56B parâmetros (7Bx8), mas não tem. Como [Andrej Karpathy] (https://twitter.com/karpathy/status/1734251375163511203) explica, somente os blocos <code><b>Feed forward</b></code> dos transformadores são multiplicados por 8, o restante dos parâmetros é compartilhado entre os 8 modelos. Portanto, no final, o modelo tem 46,7 bilhões de parâmetros.</p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h2 id="Mistura-de-especialistas-(MoE)">
								<a class="anchor-link" href="#Mistura-de-especialistas-(MoE)">
									<p style="margin-left: 10px">Mistura de especialistas (MoE)</p>
								</a>
							</h2>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Conforme mencionado, o modelo é um conjunto de 8 modelos 7B de parâmetros, daí a sigla <code><b>MoE</b></code>, que significa <code><b>Mixture of Experts</b></code>. Cada um dos 8 modelos é treinado de forma independente, mas quando a inferência é feita, um roteador decide a saída de qual modelo deve ser usado.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">A imagem a seguir mostra a arquitetura de um <code><b>Transformer</b></code>.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2023/12/transformer-scaled.webp" alt="transformer"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Se você não sabe, o importante é que essa arquitetura consiste em um codificador e um decodificador.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2023/12/transformer-encoder-decoder.webp" alt="transformer-encoder-decoder"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Os LLMs são modelos somente de decodificador, portanto, não têm um codificador. Você pode ver que na arquitetura há três módulos de atenção, um deles realmente conecta o codificador ao decodificador. Mas como os LLMs não têm um codificador, não há necessidade do módulo de atenção que conecta o decodificador e o decodificador.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2023/12/transformer-decoder.webp" alt="transformer-decoder"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Agora que sabemos como é a arquitetura de um LLM, podemos ver como é a arquitetura do <code><b>mixtral-8x7b</b></code>. Na imagem a seguir, podemos ver a arquitetura do modelo</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Arquitetura do MoE] (http://maximofn.com/wp-content/uploads/2023/12/MoE_architecture-scaled.webp)</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Como você pode ver, a arquitetura consiste em um decodificador <code><b>Transformer</b></code> de 7B parâmetros, sendo que apenas a camada <code><b>Feed forward</b></code> consiste em 8 camadas <code><b>Feed forward</b></code> com um roteador que escolhe qual das 8 camadas <code><b>Feed forward</b></code> deve ser usada. Na imagem acima, são mostradas apenas quatro camadas <code><b>Feed forward</b></code>, o que deve ter sido feito para simplificar o diagrama, mas, na realidade, existem 8 camadas <code><b>Feed forward</b></code>. Você também pode ver dois caminhos para duas palavras diferentes, a palavra <code><b>More</b></code> e a palavra <code><b>Parameters</b></code> e como o roteador escolhe qual <code><b>Feed forward</b></code> usar para cada palavra.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Observando a arquitetura, podemos entender por que o modelo tem 46,7 bilhões de parâmetros e não 56 bilhões. Como dissemos, apenas os blocos <code><b>Feed forward</b></code> são multiplicados por 8, o restante dos parâmetros é compartilhado entre os 8 modelos.</p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h2 id="Usando-o-Mixtral-8x7b-na-nuvem">
								<a class="anchor-link" href="#Usando-o-Mixtral-8x7b-na-nuvem">
									<p style="margin-left: 10px">Usando o Mixtral-8x7b na nuvem</p>
								</a>
							</h2>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Infelizmente, usar o <code><b>mixtral-8x7b</b></code> localmente é complicado, pois os requisitos de hardware são os seguintes</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"> <em> float32: VRAM > 180 GB, ou seja, como cada parâmetro ocupa 4 bytes, precisamos de 46,7B </em> 4 = 186,8 GB de VRAM apenas para armazenar o modelo, mais a VRAM necessária para armazenar os dados de entrada e saída.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"> <em> float16: VRAM > 90 GB, nesse caso, cada parâmetro ocupa 2 bytes, portanto, precisamos de 46,7B </em> 2 = 93,4 GB de VRAM apenas para armazenar o modelo, além da VRAM necessária para armazenar os dados de entrada e saída.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"> <em> 8 bits: VRAM > 45 GB, aqui cada parâmetro ocupa 1 byte, portanto, precisamos de 46,7B </em> 1 = 46,7 GB de VRAM apenas para armazenar o modelo, além da VRAM necessária para armazenar os dados de entrada e saída.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"> <em> 4 bits: VRAM > 23 GB, aqui cada parâmetro ocupa 0,5 bytes, portanto, precisamos de 46,7B </em> 0,5 = 23,35 GB de VRAM apenas para armazenar o modelo, além da VRAM necessária para armazenar os dados de entrada e saída.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Precisamos de GPUs muito potentes para executá-lo, mesmo quando usamos o modelo quantizado de 4 bits.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Portanto, a maneira mais fácil de usar o <code><b>Mixtral-8x7B</b></code> é usá-lo já implantado na nuvem. Encontrei vários locais onde você pode usá-lo</p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h3 id="Uso-do-Mixtral-8x7b-no-bate-papo-huggingface">
								<a class="anchor-link" href="#Uso-do-Mixtral-8x7b-no-bate-papo-huggingface">
									<p style="margin-left: 20px">Uso do Mixtral-8x7b no bate-papo huggingface</p>
								</a>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">O primeiro está no [huggingface chat] (https://huggingface.co/chat). Para usá-lo, clique na roda dentada dentro da caixa <code><b>Current Model</b></code> e selecione <code><b>Mistral AI - Mixtral-8x7B</b></code>. Uma vez selecionado, você pode começar a conversar com o modelo.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2023/12/huggingface_chat_01.webp" alt="huggingface_chat_01"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Uma vez lá dentro, selecione <code><b>mistralai/Mixtral-8x7B-Instruct-v0.1</b></code> e, por fim, clique no botão <code><b>Activate</b></code>. Agora podemos testar o modelo</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2023/12/huggingface_chat_02.webp" alt="huggingface_chat_02"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Como você pode ver, perguntei a ele em espanhol o que é "MoE" e ele me explicou.</p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h3 id="Usando-o-Mixtral-8x7b-no-Perplexity-Labs">
								<a class="anchor-link" href="#Usando-o-Mixtral-8x7b-no-Perplexity-Labs">
									<p style="margin-left: 20px">Usando o Mixtral-8x7b no Perplexity Labs</p>
								</a>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Outra opção é usar o [Perplexity Labs] (https://labs.perplexity.ai/). Uma vez lá dentro, selecione <code><b>mixtral-8x7b-instruct</b></code> em um menu suspenso no canto inferior direito.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2023/12/perplexity_labs.webp" alt="perplexity_labs"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Como você pode ver, eu também perguntei a ele em espanhol o que é <code><b>MoE</b></code> e ele me explicou.</p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h2 id="Usando-o-Mixtral-8x7b-localmente-por-meio-da-API-huggingface">
								<a class="anchor-link" href="#Usando-o-Mixtral-8x7b-localmente-por-meio-da-API-huggingface">
									<p style="margin-left: 10px">Usando o Mixtral-8x7b localmente por meio da API huggingface</p>
								</a>
							</h2>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Uma maneira de usá-lo localmente, independentemente dos recursos de HW que você tenha, é por meio da API huggingface. Para fazer isso, você precisa instalar a biblioteca huggingface <code><b>huggingface-hub</b></code>.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span>%</span><span style="color: #6b97e8;">pip</span> <span style="color: #6b97e8;">install</span> <span style="color: #6b97e8;">huggingface</span><span>-</span><span style="color: #6b97e8;">hub</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Aqui está uma implementação com o <code><b>gradio</b></code>.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">huggingface_hub</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">InferenceClient</span></p>
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">gradio</span> <span style="color: #a04cc1;">as</span> <span style="color: #4fcd7d;">gr</span></p>
<p></p>
<p><span style="color: #6b97e8;">client</span> <span>=</span> <span style="color: #6b97e8;">InferenceClient</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;mistralai/Mixtral-8x7B-Instruct-v0.1&quot;</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">format_prompt</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">message</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">history</span><span style="color: #e3e11d;">):</span></p>
<p>  <span style="color: #6b97e8;">prompt</span> <span>=</span> <span style="color: #7e7a34;">&quot;&lt;s&gt;&quot;</span></p>
<p>  <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">user_prompt</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">bot_response</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">history</span><span style="color: #e3e11d;">:</span></p>
<p>    <span style="color: #6b97e8;">prompt</span> <span>+=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;[INST] </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">user_prompt</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> [/INST]&quot;</span></p>
<p>    <span style="color: #6b97e8;">prompt</span> <span>+=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot; </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">bot_response</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&lt;/s&gt; &quot;</span></p>
<p>  <span style="color: #6b97e8;">prompt</span> <span>+=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;[INST] </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">message</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> [/INST]&quot;</span></p>
<p>  <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">prompt</span></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">generate</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">prompt</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">history</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">system_prompt</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">temperature</span><span>=</span><span style="color: #a09e19;">0.9</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_new_tokens</span><span>=</span><span style="color: #7e7a38;">256</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_p</span><span>=</span><span style="color: #a09e19;">0.95</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">repetition_penalty</span><span>=</span><span style="color: #a09e19;">1.0</span><span style="color: #e3e11d;">,):</span></p>
<p>    <span style="color: #6b97e8;">temperature</span> <span>=</span> <span style="color: #dfd84a;">float</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">temperature</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">temperature</span> <span>&lt;</span> <span style="color: #a09e19;">1e-2</span><span style="color: #e3e11d;">:</span></p>
<p>        <span style="color: #6b97e8;">temperature</span> <span>=</span> <span style="color: #a09e19;">1e-2</span></p>
<p>    <span style="color: #6b97e8;">top_p</span> <span>=</span> <span style="color: #dfd84a;">float</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">top_p</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>    <span style="color: #6b97e8;">generate_kwargs</span> <span>=</span> <span style="color: #dfd84a;">dict</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">temperature</span><span>=</span><span style="color: #6b97e8;">temperature</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_new_tokens</span><span>=</span><span style="color: #6b97e8;">max_new_tokens</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_p</span><span>=</span><span style="color: #6b97e8;">top_p</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">repetition_penalty</span><span>=</span><span style="color: #6b97e8;">repetition_penalty</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">do_sample</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">42</span><span style="color: #e3e11d;">,)</span></p>
<p></p>
<p>    <span style="color: #6b97e8;">formatted_prompt</span> <span>=</span> <span style="color: #6b97e8;">format_prompt</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">system_prompt</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">, </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">prompt</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">history</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">stream</span> <span>=</span> <span style="color: #6b97e8;">client</span><span>.</span><span style="color: #6b97e8;">text_generation</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">formatted_prompt</span><span style="color: #e3e11d;">,</span> <span>**</span><span style="color: #6b97e8;">generate_kwargs</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">stream</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">details</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_full_text</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #7e7a34;">&quot;&quot;</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">response</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">stream</span><span style="color: #e3e11d;">:</span></p>
<p>        <span style="color: #6b97e8;">output</span> <span>+=</span> <span style="color: #6b97e8;">response</span><span>.</span><span style="color: #6b97e8;">token</span><span>.</span><span style="color: #6b97e8;">text</span></p>
<p>        <span style="color: #a04cc1;">yield</span> <span style="color: #6b97e8;">output</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">output</span></p>
<p></p>
<p><span style="color: #6b97e8;">additional_inputs</span><span>=</span><span style="color: #e3e11d;">[</span></p>
<p>    <span style="color: #6b97e8;">gr</span><span>.</span><span style="color: #6b97e8;">Textbox</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">label</span><span>=</span><span style="color: #7e7a34;">&quot;System Prompt&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_lines</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">interactive</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,),</span></p>
<p>    <span style="color: #6b97e8;">gr</span><span>.</span><span style="color: #6b97e8;">Slider</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">label</span><span>=</span><span style="color: #7e7a34;">&quot;Temperature&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">value</span><span>=</span><span style="color: #a09e19;">0.9</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">minimum</span><span>=</span><span style="color: #a09e19;">0.0</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">maximum</span><span>=</span><span style="color: #a09e19;">1.0</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">step</span><span>=</span><span style="color: #a09e19;">0.05</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">interactive</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">info</span><span>=</span><span style="color: #7e7a34;">&quot;Higher values produce more diverse outputs&quot;</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">gr</span><span>.</span><span style="color: #6b97e8;">Slider</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">label</span><span>=</span><span style="color: #7e7a34;">&quot;Max new tokens&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">value</span><span>=</span><span style="color: #7e7a38;">256</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">minimum</span><span>=</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">maximum</span><span>=</span><span style="color: #7e7a38;">1048</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">step</span><span>=</span><span style="color: #7e7a38;">64</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">interactive</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">info</span><span>=</span><span style="color: #7e7a34;">&quot;The maximum numbers of new tokens&quot;</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">gr</span><span>.</span><span style="color: #6b97e8;">Slider</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">label</span><span>=</span><span style="color: #7e7a34;">&quot;Top-p (nucleus sampling)&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">value</span><span>=</span><span style="color: #a09e19;">0.90</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">minimum</span><span>=</span><span style="color: #a09e19;">0.0</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">maximum</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">step</span><span>=</span><span style="color: #a09e19;">0.05</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">interactive</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">info</span><span>=</span><span style="color: #7e7a34;">&quot;Higher values sample more low-probability tokens&quot;</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">gr</span><span>.</span><span style="color: #6b97e8;">Slider</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">label</span><span>=</span><span style="color: #7e7a34;">&quot;Repetition penalty&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">value</span><span>=</span><span style="color: #a09e19;">1.2</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">minimum</span><span>=</span><span style="color: #a09e19;">1.0</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">maximum</span><span>=</span><span style="color: #a09e19;">2.0</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">step</span><span>=</span><span style="color: #a09e19;">0.05</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">interactive</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">info</span><span>=</span><span style="color: #7e7a34;">&quot;Penalize repeated tokens&quot;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #6b97e8;">gr</span><span>.</span><span style="color: #6b97e8;">ChatInterface</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">fn</span><span>=</span><span style="color: #6b97e8;">generate</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">chatbot</span><span>=</span><span style="color: #6b97e8;">gr</span><span>.</span><span style="color: #6b97e8;">Chatbot</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">show_label</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">show_share_button</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">show_copy_button</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">likeable</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">layout</span><span>=</span><span style="color: #7e7a34;">&quot;panel&quot;</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">additional_inputs</span><span>=</span><span style="color: #6b97e8;">additional_inputs</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">title</span><span>=</span><span style="color: #7e7a34;">&quot;Mixtral 46.7B&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">concurrency_limit</span><span>=</span><span style="color: #7e7a38;">20</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">launch</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">show_api</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Mixtral-8x7B huggingface API](http://maximofn.com/wp-content/uploads/2023/12/Mixtral-8x7B_huggingface_API-scaled.webp)</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	<!-- Close class contenido -->
	</div>
<!-- Close div notebook container -->
</div>
<!-- Close div notebook -->
</div>
