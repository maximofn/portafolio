<section class="section-block-markdown-cell">
<h1 id="tokenizador BPE">tokenizador BPE<a class="anchor-link" href="#tokenizador BPE">¶</a></h1>
</section>
<section class="section-block-markdown-cell">
<blockquote>
<p>Aviso: Este post foi traduzido para o português usando um modelo de tradução automática. Por favor, me avise se encontrar algum erro.</p>
</blockquote>
</section>
<section class="section-block-markdown-cell">
<p>O tokenizador <code>BPE</code> (Byte Pair Encoding - codificação de pares de bytes) é um algoritmo de compressão de dados que é usado para criar um vocabulário de subpalavras a partir de um corpus de texto. Este algoritmo se baseia na frequência dos pares de bytes no texto. Ele se popularizou porque foi utilizado como tokenizador por LLMs como GPT, GPT-2, RoBERTa, BART e DeBERTa</p>
</section>
<section class="section-block-markdown-cell">
<h2 id="Algoritmo de treinamento">Algoritmo de treinamento<a class="anchor-link" href="#Algoritmo de treinamento">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Suponhamos que temos um corpus de texto que contém apenas as seguintes palavras <code>hug, pug, pun, bun e hugs</code>, o primeiro passo consiste em criar um vocabulário com todos os caracteres presentes no corpus, no nosso caso será <code>b, g, h, n, p, s, u</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">corpus_words</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hug&quot;</span><span class="p">,</span> <span class="s2">&quot;pug&quot;</span><span class="p">,</span> <span class="s2">&quot;pun&quot;</span><span class="p">,</span> <span class="s2">&quot;bun&quot;</span><span class="p">,</span> <span class="s2">&quot;hugs&quot;</span><span class="p">]</span>
<span class="w"> </span>
<span class="c1"># Concatenate all the words in the corpus</span>
<span class="n">initial_corpus_tokens</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">corpus_words</span><span class="p">:</span>
<span class="w">    </span><span class="n">initial_corpus_tokens</span> <span class="o">+=</span> <span class="n">word</span>
<span class="w"> </span>
<span class="c1"># Convert the concatenated string to a set of tokens to get unique tokens</span>
<span class="n">initial_corpus_tokens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">initial_corpus_tokens</span><span class="p">)</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corpus words: </span><span class="si">{</span><span class="n">corpus_words</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial corpus tokens: </span><span class="si">{</span><span class="n">initial_corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of initial corpus tokens: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">initial_corpus_tokens</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Corpus words: [&#x27;hug&#x27;, &#x27;pug&#x27;, &#x27;pun&#x27;, &#x27;bun&#x27;, &#x27;hugs&#x27;]
Initial corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
Number of initial corpus tokens: 7
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora suponhamos que este é o nosso corpus de frases, é um corpus inventado, não faz sentido.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;hug hug hug pun pun bun hugs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hug hug pug pug pun pun hugs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hug hug pug pug pun pun pun pun hugs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;pug pun pun pun bun hugs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hug hug hug pun bun bun hugs&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a contar o número de vezes que cada palavra aparece no corpus, para verificar que o que havíamos colocado anteriormente está correto.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">num_hug</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_pug</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_pun</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_bun</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_hugs</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w"> </span>
<span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
<span class="w">    </span><span class="n">words</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;hug&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_hug</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span><span class="k">elif</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;pug&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_pug</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span><span class="k">elif</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;pun&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_pun</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span><span class="k">elif</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;bun&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_bun</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span><span class="k">elif</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;hugs&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_hugs</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of hug: </span><span class="si">{</span><span class="n">num_hug</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of pug: </span><span class="si">{</span><span class="n">num_pug</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of pun: </span><span class="si">{</span><span class="n">num_pun</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of bun: </span><span class="si">{</span><span class="n">num_bun</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of hugs: </span><span class="si">{</span><span class="n">num_hugs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Number of hug: 10
Number of pug: 5
Number of pun: 12
Number of bun: 4
Number of hugs: 5
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Tudo o que havíamos contado está bem, podemos continuar.</p>
</section>
<section class="section-block-markdown-cell">
<p>Vamos a criar um dicionário com os tokens de cada palavra e o número de vezes que ela aparece no corpus</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">dict_tokens_by_word_appearance</span> <span class="o">=</span> <span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;hug&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_hug</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;hug&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;pug&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_pug</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;pug&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;pun&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_pun</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;pun&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;bun&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_bun</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;bun&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;hugs&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_hugs</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;hugs&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="p">}</span>
<span class="w"> </span>
<span class="n">dict_tokens_by_word_appearance</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>&#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;]&#x7D;,
 &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;]&#x7D;,
 &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;]&#x7D;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora vamos a procurar o par de tokens consecutivos que mais vezes aparece no dicionário</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">dict_keys</span> <span class="o">=</span> <span class="n">dict_tokens_by_word_appearance</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="w"> </span>
<span class="n">list_consecutive_tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dict_keys</span><span class="p">):</span>
<span class="w">    </span><span class="c1"># Get the tokens of the word</span>
<span class="w">    </span><span class="n">number_of_toneks_of_word</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;tokens&quot;</span><span class="p">])</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># Get consecituve tokens</span>
<span class="w">    </span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_toneks_of_word</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="c1"># Get consecutive tokens</span>
<span class="w">        </span><span class="n">consecutive_tokens</span> <span class="o">=</span> <span class="n">dict_tokens_by_word_appearance</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">dict_tokens_by_word_appearance</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="w">        </span><span class="c1"># Append the consecutive tokens to the list the number of times the word appears</span>
<span class="w">        </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
<span class="w">            </span><span class="n">list_consecutive_tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">consecutive_tokens</span><span class="p">)</span>
<span class="c1"># Print the list of consecutive tokens</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List of consecutive tokens: </span><span class="si">{</span><span class="n">list_consecutive_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="c1"># Get consecutive tokens with maximum frequency</span>
<span class="n">dict_consecutive_tokens</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_consecutive_tokens</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Check if the token is already in the dictionary</span>
<span class="w">    </span><span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">dict_consecutive_tokens</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Increment the count of the token</span>
<span class="w">        </span><span class="n">dict_consecutive_tokens</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1"># If the token is not in the dictionary</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Add the token to the dictionary</span>
<span class="w">        </span><span class="n">dict_consecutive_tokens</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Print the dictionary of consecutive tokens</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dictionary of consecutive tokens: </span><span class="si">{</span><span class="n">dict_consecutive_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="c1"># Get the consecutive token with maximum frequency</span>
<span class="n">max_consecutive_token</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Get the token with maximum frequency</span>
<span class="w">    </span><span class="n">consecutive_token</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dict_consecutive_tokens</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dict_consecutive_tokens</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># Check if the token is already in the list of tokens</span>
<span class="w">    </span><span class="k">if</span> <span class="n">consecutive_token</span> <span class="ow">in</span> <span class="n">initial_corpus_tokens</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Remove token from the dictionary</span>
<span class="w">        </span><span class="n">dict_consecutive_tokens</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">consecutive_token</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># If the token is not in the list of tokens</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Assign the token to the max_consecutive_token</span>
<span class="w">        </span><span class="n">max_consecutive_token</span> <span class="o">=</span> <span class="n">consecutive_token</span>
<span class="w">        </span><span class="k">break</span>
<span class="w"> </span>
<span class="c1"># Print the consecutive token with maximum frequency</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consecutive token with maximum frequency: </span><span class="si">{</span><span class="n">max_consecutive_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>List of consecutive tokens: [&#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;bu&#x27;, &#x27;bu&#x27;, &#x27;bu&#x27;, &#x27;bu&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;un&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;hu&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;ug&#x27;, &#x27;gs&#x27;, &#x27;gs&#x27;, &#x27;gs&#x27;, &#x27;gs&#x27;, &#x27;gs&#x27;]
Dictionary of consecutive tokens: &#x7B;&#x27;hu&#x27;: 15, &#x27;ug&#x27;: 20, &#x27;pu&#x27;: 17, &#x27;un&#x27;: 16, &#x27;bu&#x27;: 4, &#x27;gs&#x27;: 5&#x7D;
Consecutive token with maximum frequency: ug
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Obtivemos o par de tokens que mais vezes aparece. Vamos encapsular isso em uma função, pois vamos utilizá-la mais vezes.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_consecutive_tokens_with_max_frequency</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">list_corpus_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="n">dict_keys</span> <span class="o">=</span> <span class="n">dict_tokens_by_word_appearance</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="w"> </span>
<span class="w">    </span><span class="n">list_consecutive_tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dict_keys</span><span class="p">):</span>
<span class="w">        </span><span class="c1"># Get the tokens of the word</span>
<span class="w">        </span><span class="n">number_of_toneks_of_word</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;tokens&quot;</span><span class="p">])</span>
<span class="w"> </span>
<span class="w">        </span><span class="c1"># Get consecituve tokens</span>
<span class="w">        </span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_toneks_of_word</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">            </span><span class="c1"># Get consecutive tokens</span>
<span class="w">            </span><span class="n">consecutive_tokens</span> <span class="o">=</span> <span class="n">dict_tokens_by_word_appearance</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">dict_tokens_by_word_appearance</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;tokens&quot;</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="w">            </span><span class="c1"># Append the consecutive tokens to the list</span>
<span class="w">            </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
<span class="w">                </span><span class="n">list_consecutive_tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">consecutive_tokens</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># Get consecutive tokens with maximum frequency</span>
<span class="w">    </span><span class="n">dict_consecutive_tokens</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_consecutive_tokens</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Check if the token is already in the dictionary</span>
<span class="w">        </span><span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">dict_consecutive_tokens</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Increment the count of the token</span>
<span class="w">            </span><span class="n">dict_consecutive_tokens</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span>
<span class="w">        </span><span class="c1"># If the token is not in the dictionary</span>
<span class="w">        </span><span class="k">else</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Add the token to the dictionary</span>
<span class="w">            </span><span class="n">dict_consecutive_tokens</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># Get the consecutive token with maximum frequency</span>
<span class="w">    </span><span class="n">max_consecutive_token</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Get the token with maximum frequency</span>
<span class="w">        </span><span class="n">consecutive_token</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dict_consecutive_tokens</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dict_consecutive_tokens</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">        </span><span class="c1"># Check if the token is already in the list of tokens</span>
<span class="w">        </span><span class="k">if</span> <span class="n">consecutive_token</span> <span class="ow">in</span> <span class="n">list_corpus_tokens</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Remove token from the dictionary</span>
<span class="w">            </span><span class="n">dict_consecutive_tokens</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">consecutive_token</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">        </span><span class="c1"># If the token is not in the list of tokens</span>
<span class="w">        </span><span class="k">else</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Assign the token to the max_consecutive_token</span>
<span class="w">            </span><span class="n">max_consecutive_token</span> <span class="o">=</span> <span class="n">consecutive_token</span>
<span class="w">            </span><span class="k">break</span>
<span class="w"> </span>
<span class="w">    </span><span class="k">return</span> <span class="n">max_consecutive_token</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Verificamos que obtemos o mesmo que antes</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">max_consecutive_token</span> <span class="o">=</span> <span class="n">get_consecutive_tokens_with_max_frequency</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">initial_corpus_tokens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consecutive token with maximum frequency: </span><span class="si">{</span><span class="n">max_consecutive_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Consecutive token with maximum frequency: ug
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que sim.</p>
</section>
<section class="section-block-markdown-cell">
<p>Agora nosso corpus de tokens pode ser modificado adicionando o token <code>ug</code></p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># new_corpus_tokens = initial_corpus_tokens + max_consecutive_token</span>
<span class="n">new_corpus_tokens</span> <span class="o">=</span> <span class="n">initial_corpus_tokens</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">new_corpus_tokens</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">)</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial corpus tokens: </span><span class="si">{</span><span class="n">initial_corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New corpus tokens: </span><span class="si">{</span><span class="n">new_corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Initial corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Colocamos isso também em uma função</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_new_corpus_tokens</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">,</span> <span class="n">initial_corpus_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="n">new_corpus_tokens</span> <span class="o">=</span> <span class="n">initial_corpus_tokens</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="w">    </span><span class="n">new_corpus_tokens</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span> <span class="n">new_corpus_tokens</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Voltaremos a verificar que obtemos o mesmo resultado de antes</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">new_corpus_tokens</span> <span class="o">=</span> <span class="n">get_new_corpus_tokens</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">,</span> <span class="n">initial_corpus_tokens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial corpus tokens: </span><span class="si">{</span><span class="n">initial_corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New corpus tokens: </span><span class="si">{</span><span class="n">new_corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Initial corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Vemos que sim.</p>
</section>
<section class="section-block-markdown-cell">
<p>Agora vamos a modificar o dicionário no qual aparecem as palavras, os tokens e o número de vezes que aparecem com o novo token</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="w"> </span>
<span class="n">dict_keys</span> <span class="o">=</span> <span class="n">dict_tokens_by_word_appearance</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">dict_tokens_by_word_appearance_tmp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">)</span>
<span class="w"> </span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict_keys</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Check if the new token is in the word</span>
<span class="w">    </span><span class="k">if</span> <span class="n">max_consecutive_token</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token </span><span class="si">{</span><span class="n">max_consecutive_token</span><span class="si">}</span><span class="s2"> is in the word </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">        </span><span class="c1"># Add the new token to the word tokens</span>
<span class="w">        </span><span class="n">dict_tokens_by_word_appearance_tmp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;tokens&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New tokens of the word </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">dict_tokens_by_word_appearance_tmp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial tokens by word appearance: </span><span class="si">{</span><span class="n">dict_tokens_by_word_appearance</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New tokens by word appearance: &quot;</span><span class="p">)</span>
<span class="n">dict_tokens_by_word_appearance_tmp</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Token ug is in the word hug
New tokens of the word hug: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;]
Token ug is in the word pug
New tokens of the word pug: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;]
Token ug is in the word hugs
New tokens of the word hugs: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;]
Initial tokens by word appearance: &#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;]&#x7D;, &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;]&#x7D;, &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;, &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;, &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;]&#x7D;&#x7D;
New tokens by word appearance:
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>&#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;]&#x7D;,
 &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;]&#x7D;,
 &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;]&#x7D;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Colocamos isso em uma função</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">update_tokens_by_word_appearance</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">max_consecutive_token</span><span class="p">):</span>
<span class="w">    </span><span class="n">dict_tokens_by_word_appearance_tmp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">dict_keys</span> <span class="o">=</span> <span class="n">dict_tokens_by_word_appearance_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="w"> </span>
<span class="w">    </span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict_keys</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Check if the new token is in the word</span>
<span class="w">        </span><span class="k">if</span> <span class="n">max_consecutive_token</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Add the new token to the word tokens</span>
<span class="w">            </span><span class="n">dict_tokens_by_word_appearance_tmp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;tokens&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="k">return</span> <span class="n">dict_tokens_by_word_appearance_tmp</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Verificamos que está correto.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">dict_tokens_by_word_appearance</span> <span class="o">=</span> <span class="n">update_tokens_by_word_appearance</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">max_consecutive_token</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New tokens by word appearance: &quot;</span><span class="p">)</span>
<span class="n">dict_tokens_by_word_appearance</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>New tokens by word appearance:
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>&#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;]&#x7D;,
 &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;]&#x7D;,
 &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;]&#x7D;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Em resumo, na primeira iteração passamos de um corpus de tokens <code>s, g, h, u, n, p, b</code> para o novo corpus de tokens <code>h, u, n, p, s, g, b, ug</code></p>
</section>
<section class="section-block-markdown-cell">
<p>Agora realizamos uma segunda iteração, obtemos o par de tokens consecutivos que mais vezes aparecem no dicionário</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">max_consecutive_token</span> <span class="o">=</span> <span class="n">get_consecutive_tokens_with_max_frequency</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">new_corpus_tokens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consecutive token with maximum frequency: </span><span class="si">{</span><span class="n">max_consecutive_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Consecutive token with maximum frequency: pu
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Obtemos o novo corpus de tokens</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">corpus_tokens</span> <span class="o">=</span> <span class="n">get_new_corpus_tokens</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">,</span> <span class="n">new_corpus_tokens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial corpus tokens: </span><span class="si">{</span><span class="n">new_corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New corpus tokens: </span><span class="si">{</span><span class="n">corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Initial corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;&#x7D;
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>E obtém-se o novo dicionário no qual aparecem as palavras, os tokens e o número de vezes que aparecem.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">dict_tokens_by_word_appearance</span> <span class="o">=</span> <span class="n">update_tokens_by_word_appearance</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">max_consecutive_token</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New tokens by word appearance: &quot;</span><span class="p">)</span>
<span class="n">dict_tokens_by_word_appearance</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>New tokens by word appearance:
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>&#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;]&#x7D;,
 &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;]&#x7D;,
 &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;]&#x7D;,
 &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;]&#x7D;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora podemos continuar até ter um corpus de tokens com o tamanho desejado, vamos criar um corpus de 15 tokens.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">len_corpus_tokens</span> <span class="o">=</span> <span class="mi">15</span>
<span class="w"> </span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">len_corpus_tokens</span><span class="p">:</span>
<span class="w">    </span><span class="n">max_consecutive_token</span> <span class="o">=</span> <span class="n">get_consecutive_tokens_with_max_frequency</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">corpus_tokens</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consecutive token with maximum frequency: </span><span class="si">{</span><span class="n">max_consecutive_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># If there are no more consecutive tokens break the loop</span>
<span class="w">    </span><span class="k">if</span> <span class="n">max_consecutive_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="k">break</span>
<span class="w"> </span>
<span class="w">    </span><span class="n">corpus_tokens</span> <span class="o">=</span> <span class="n">get_new_corpus_tokens</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">,</span> <span class="n">corpus_tokens</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New corpus tokens: </span><span class="si">{</span><span class="n">corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="n">dict_tokens_by_word_appearance</span> <span class="o">=</span> <span class="n">update_tokens_by_word_appearance</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">max_consecutive_token</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New tokens by word appearance: </span><span class="si">{</span><span class="n">dict_tokens_by_word_appearance</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Consecutive token with maximum frequency: un
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New tokens by word appearance: &#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;]&#x7D;, &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;]&#x7D;, &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;]&#x7D;&#x7D;

Consecutive token with maximum frequency: hu
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;hu&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New tokens by word appearance: &#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;, &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;]&#x7D;, &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;&#x7D;

Consecutive token with maximum frequency: gug
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;hu&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;, &#x27;gug&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New tokens by word appearance: &#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;, &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;]&#x7D;, &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;&#x7D;

Consecutive token with maximum frequency: ughu
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;hu&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;, &#x27;gug&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;ughu&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New tokens by word appearance: &#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;, &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;]&#x7D;, &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;&#x7D;

Consecutive token with maximum frequency: npu
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;hu&#x27;, &#x27;n&#x27;, &#x27;npu&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;, &#x27;gug&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;ughu&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New tokens by word appearance: &#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;, &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;]&#x7D;, &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;&#x7D;

Consecutive token with maximum frequency: puun
New corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;hu&#x27;, &#x27;n&#x27;, &#x27;npu&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;, &#x27;gug&#x27;, &#x27;puun&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;ughu&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New tokens by word appearance: &#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;, &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;ug&#x27;, &#x27;pu&#x27;]&#x7D;, &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;un&#x27;]&#x7D;, &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;, &#x27;ug&#x27;, &#x27;hu&#x27;]&#x7D;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Agora que vimos como é treinado o tokenizador BPE, vamos treiná-lo do zero para consolidar os conhecimentos.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">corpus_words</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hug&quot;</span><span class="p">,</span> <span class="s2">&quot;pug&quot;</span><span class="p">,</span> <span class="s2">&quot;pun&quot;</span><span class="p">,</span> <span class="s2">&quot;bun&quot;</span><span class="p">,</span> <span class="s2">&quot;hugs&quot;</span><span class="p">]</span>
<span class="w"> </span>
<span class="c1"># Concatenate all the words in the corpus</span>
<span class="n">initial_corpus_tokens</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">corpus_words</span><span class="p">:</span>
<span class="w">    </span><span class="n">initial_corpus_tokens</span> <span class="o">+=</span> <span class="n">word</span>
<span class="w"> </span>
<span class="c1"># Convert the concatenated string to a set of tokens to get unique tokens</span>
<span class="n">corpus_tokens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">initial_corpus_tokens</span><span class="p">)</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corpus words: </span><span class="si">{</span><span class="n">corpus_words</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial corpus tokens: </span><span class="si">{</span><span class="n">corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of initial corpus tokens: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Corpus words: [&#x27;hug&#x27;, &#x27;pug&#x27;, &#x27;pun&#x27;, &#x27;bun&#x27;, &#x27;hugs&#x27;]
Initial corpus tokens: &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
Number of initial corpus tokens: 7
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;hug hug hug pun pun bun hugs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hug hug pug pug pun pun hugs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hug hug pug pug pun pun pun pun hugs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;pug pun pun pun bun hugs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hug hug hug pun bun bun hugs&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="w"> </span>
<span class="n">num_hug</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_pug</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_pun</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_bun</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_hugs</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w"> </span>
<span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
<span class="w">    </span><span class="n">words</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;hug&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_hug</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span><span class="k">elif</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;pug&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_pug</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span><span class="k">elif</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;pun&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_pun</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span><span class="k">elif</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;bun&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_bun</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w">        </span><span class="k">elif</span> <span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;hugs&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">num_hugs</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="w"> </span>
<span class="n">dict_tokens_by_word_appearance</span> <span class="o">=</span> <span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;hug&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_hug</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;hug&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;pug&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_pug</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;pug&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;pun&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_pun</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;pun&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;bun&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_bun</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;bun&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;hugs&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_hugs</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">character</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">&quot;hugs&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">},</span>
<span class="p">}</span>
<span class="w"> </span>
<span class="n">dict_tokens_by_word_appearance</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>&#x7B;&#x27;hug&#x27;: &#x7B;&#x27;count&#x27;: 10, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;]&#x7D;,
 &#x27;pug&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;g&#x27;]&#x7D;,
 &#x27;pun&#x27;: &#x7B;&#x27;count&#x27;: 12, &#x27;tokens&#x27;: [&#x27;p&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;bun&#x27;: &#x7B;&#x27;count&#x27;: 4, &#x27;tokens&#x27;: [&#x27;b&#x27;, &#x27;u&#x27;, &#x27;n&#x27;]&#x7D;,
 &#x27;hugs&#x27;: &#x7B;&#x27;count&#x27;: 5, &#x27;tokens&#x27;: [&#x27;h&#x27;, &#x27;u&#x27;, &#x27;g&#x27;, &#x27;s&#x27;]&#x7D;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Treinamos desde zero até obter um corpus de 15 tokens</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">len_corpus_tokens</span> <span class="o">=</span> <span class="mi">15</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial corpus tokens: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">)</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">len_corpus_tokens</span><span class="p">:</span>
<span class="w">    </span><span class="n">max_consecutive_token</span> <span class="o">=</span> <span class="n">get_consecutive_tokens_with_max_frequency</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">corpus_tokens</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># If there are no more consecutive tokens break the loop</span>
<span class="w">    </span><span class="k">if</span> <span class="n">max_consecutive_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="k">break</span>
<span class="w"> </span>
<span class="w">    </span><span class="n">corpus_tokens</span> <span class="o">=</span> <span class="n">get_new_corpus_tokens</span><span class="p">(</span><span class="n">max_consecutive_token</span><span class="p">,</span> <span class="n">corpus_tokens</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="n">dict_tokens_by_word_appearance</span> <span class="o">=</span> <span class="n">update_tokens_by_word_appearance</span><span class="p">(</span><span class="n">dict_tokens_by_word_appearance</span><span class="p">,</span> <span class="n">max_consecutive_token</span><span class="p">)</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New corpus tokens: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">)</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">corpus_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Initial corpus tokens: (7) &#x7B;&#x27;p&#x27;, &#x27;n&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
New corpus tokens: (15) &#x7B;&#x27;p&#x27;, &#x27;hu&#x27;, &#x27;n&#x27;, &#x27;npu&#x27;, &#x27;pu&#x27;, &#x27;un&#x27;, &#x27;gug&#x27;, &#x27;puun&#x27;, &#x27;u&#x27;, &#x27;s&#x27;, &#x27;h&#x27;, &#x27;ughu&#x27;, &#x27;ug&#x27;, &#x27;g&#x27;, &#x27;b&#x27;&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Tokenizacao">Tokenização<a class="anchor-link" href="#Tokenizacao">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Se quisermos tokenizar agora, primeiro teríamos que criar um vocabulário, ou seja, atribuir a cada token um ID.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="n">vocab</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vocabulary: &quot;</span><span class="p">)</span>
<span class="n">vocab</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Vocabulary:
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>&#x7B;&#x27;p&#x27;: 0,
 &#x27;hu&#x27;: 1,
 &#x27;sug&#x27;: 2,
 &#x27;npu&#x27;: 3,
 &#x27;ugpu&#x27;: 4,
 &#x27;gug&#x27;: 5,
 &#x27;u&#x27;: 6,
 &#x27;ug&#x27;: 7,
 &#x27;ughu&#x27;: 8,
 &#x27;n&#x27;: 9,
 &#x27;pu&#x27;: 10,
 &#x27;un&#x27;: 11,
 &#x27;puun&#x27;: 12,
 &#x27;s&#x27;: 13,
 &#x27;h&#x27;: 14,
 &#x27;gs&#x27;: 15,
 &#x27;g&#x27;: 16,
 &#x27;b&#x27;: 17&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Colocamos isso em uma função</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_vocabulary</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="n">vocab</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">):</span>
<span class="w">        </span><span class="n">vocab</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="w">    </span><span class="k">return</span> <span class="n">vocab</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Verificamos que está correto.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="n">get_vocabulary</span><span class="p">(</span><span class="n">corpus_tokens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vocabulary: &quot;</span><span class="p">)</span>
<span class="n">vocab</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Vocabulary:
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>&#x7B;&#x27;p&#x27;: 0,
 &#x27;hu&#x27;: 1,
 &#x27;sug&#x27;: 2,
 &#x27;npu&#x27;: 3,
 &#x27;ugpu&#x27;: 4,
 &#x27;gug&#x27;: 5,
 &#x27;u&#x27;: 6,
 &#x27;ug&#x27;: 7,
 &#x27;ughu&#x27;: 8,
 &#x27;n&#x27;: 9,
 &#x27;pu&#x27;: 10,
 &#x27;un&#x27;: 11,
 &#x27;puun&#x27;: 12,
 &#x27;s&#x27;: 13,
 &#x27;h&#x27;: 14,
 &#x27;gs&#x27;: 15,
 &#x27;g&#x27;: 16,
 &#x27;b&#x27;: 17&#x7D;
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Se quisermos tokenizar a palavra <code>bug</code>, podemos fazer</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s1">&#39;bug&#39;</span>
<span class="w"> </span>
<span class="c1"># Get the maximum length of tokens</span>
<span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum length of tokens: </span><span class="si">{</span><span class="n">max_len</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="c1"># Create a empty list of tokens</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Flag to check if the token is found</span>
<span class="w">    </span><span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># Iterate over the maximum length of tokens from max_len to 0</span>
<span class="w">    </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="c1"># Get the prefix of the word</span>
<span class="w">        </span><span class="n">prefix</span> <span class="o">=</span> <span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prefix: </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">        </span><span class="c1"># Check if the prefix is in the vocabulary</span>
<span class="w">        </span><span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">:</span>
<span class="w">            </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;prefix </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> is in the vocabulary&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<span class="w">            </span><span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="w">            </span><span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1"># if not found:</span>
<span class="w">    </span><span class="c1">#     tokens.append(&#39;&amp;lt;UNK&amp;gt;&#39;)</span>
<span class="w">    </span><span class="c1">#     word = word[1:]</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tokens: </span><span class="si">{</span><span class="n">tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Maximum length of tokens: 4
Prefix: bug
Prefix: bug
Prefix: bu
Prefix: b
prefix b is in the vocabulary
Prefix: ug
prefix ug is in the vocabulary
Tokens: [&#x27;b&#x27;, &#x27;ug&#x27;]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Mas se quisermos tokenizar a palavra <code>mug</code>, não poderíamos, pois o caractere <code>m</code> não está no vocabulário. Para isso, a tokenizamos com o token <code>&#x3C;UNK&#x3E;</code>.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s1">&#39;mug&#39;</span>
<span class="w"> </span>
<span class="c1"># Get the maximum length of tokens</span>
<span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum length of tokens: </span><span class="si">{</span><span class="n">max_len</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="c1"># Create a empty list of tokens</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Flag to check if the token is found</span>
<span class="w">    </span><span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># Iterate over the maximum length of tokens from max_len to 0</span>
<span class="w">    </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="c1"># Get the prefix of the word</span>
<span class="w">        </span><span class="n">prefix</span> <span class="o">=</span> <span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prefix: </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">        </span><span class="c1"># Check if the prefix is in the vocabulary</span>
<span class="w">        </span><span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">:</span>
<span class="w">            </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;prefix </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> is in the vocabulary&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<span class="w">            </span><span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="w">            </span><span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
<span class="w">            </span><span class="k">break</span>
<span class="w"> </span>
<span class="w">    </span><span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
<span class="w">        </span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&amp;lt;UNK&amp;gt;&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="w"> </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tokens: </span><span class="si">{</span><span class="n">tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Maximum length of tokens: 4
Prefix: mug
Prefix: mug
Prefix: mu
Prefix: m
Prefix: ug
prefix ug is in the vocabulary
Tokens: [&#x27;&amp;lt;UNK&amp;gt;&#x27;, &#x27;ug&#x27;]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Colocamos isso em uma função</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tokenize_word</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">vocab</span><span class="p">):</span>
<span class="w">    </span><span class="c1"># Get the maximum length of tokens</span>
<span class="w">    </span><span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">)</span>
<span class="w"> </span>
<span class="w">    </span><span class="c1"># Create a empty list of tokens</span>
<span class="w">    </span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Flag to check if the token is found</span>
<span class="w">        </span><span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w"> </span>
<span class="w">        </span><span class="c1"># Iterate over the maximum length of tokens from max_len to 0</span>
<span class="w">        </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">            </span><span class="c1"># Get the prefix of the word</span>
<span class="w">            </span><span class="n">prefix</span> <span class="o">=</span> <span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
<span class="w"> </span>
<span class="w">            </span><span class="c1"># Check if the prefix is in the vocabulary</span>
<span class="w">            </span><span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">:</span>
<span class="w">                </span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<span class="w">                </span><span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="w">                </span><span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
<span class="w">                </span><span class="k">break</span>
<span class="w"> </span>
<span class="w">        </span><span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
<span class="w">            </span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&amp;lt;UNK&amp;gt;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="w"> </span>
<span class="w">    </span><span class="k">return</span> <span class="n">tokens</span>
</pre></div>
</div>
</section>
<section class="section-block-markdown-cell">
<p>Verificamos que está correto.</p>
</section>
<section class="section-block-code-cell-">
<div class="input-code">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tokenization of the word &#39;bug&#39;: </span><span class="si">{</span><span class="n">tokenize_word</span><span class="p">(</span><span class="s1">&#39;bug&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vocab</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tokenization of the word &#39;mug&#39;: </span><span class="si">{</span><span class="n">tokenize_word</span><span class="p">(</span><span class="s1">&#39;mug&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vocab</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="section-block-code-cell-">
<div class="output-wrapper">
<div class="output-area">
<div class="prompt"></div>
<div class="output-subarea-output-stream-output-stdout-output-text">
<pre>Tokenization of the word &#x27;bug&#x27;: [&#x27;b&#x27;, &#x27;ug&#x27;]
Tokenization of the word &#x27;mug&#x27;: [&#x27;&amp;lt;UNK&amp;gt;&#x27;, &#x27;ug&#x27;]
</pre>
</div>
</div>
</div>
</section>
<section class="section-block-markdown-cell">
<h2 id="Visualizador de tokens">Visualizador de tokens<a class="anchor-link" href="#Visualizador de tokens">¶</a></h2>
</section>
<section class="section-block-markdown-cell">
<p>Agora que sabemos como funciona um tokenizador BPE, vamos ver através do visualizador <a href="https://huggingface.co/spaces/Xenova/the-tokenizer-playground">the-tokenizer-playground</a> como ficariam os tokens de qualquer frase.</p>
</section>
<section class="section-block-markdown-cell">
<iframe>
<p>src="https://xenova-the-tokenizer-playground.static.hf.space"</p>
<p>frameborder="0"</p>
<p>width="850"</p>
<p>altura="450"</p>
<blockquote>
<p></iframe></p>
</blockquote>
</section>