<p>
	<!-- Custom stylesheet, it must be in the same directory as the html file -->
	<!-- Loading mathjax macro --><!-- Load mathjax --><!-- MathJax configuration -->
<p>
<style>
	/* Media query para pantallas grandes */
	@media screen and (min-width: 1000px) {
		.container {
			flex-wrap: nowrap;
			display: flex;
			justify-content: space-between;
			height: 100vh; /* altura del viewport */
		}
		
		.indice {
			width: 25%; /* Ancho del √≠ndice en pantallas grandes */
			border-right: 1px solid #ccc;
			max-height: calc(100vh - 40px); /* Ajustar seg√∫n tus necesidades. Aqu√≠ estamos restando el doble del padding para mantener todo visible */
			padding: 20px;
			box-sizing: border-box;
			overflow-y: auto; /* desplazamiento vertical cuando sea necesario */
		}
		
		.contenido {
			width: 70%; /* Ancho del contenido en pantallas grandes */
			max-height: calc(100vh - 40px); /* Ajustar seg√∫n tus necesidades. Aqu√≠ estamos restando el doble del padding para mantener todo visible */
			padding: 20px;
			box-sizing: border-box;
			overflow-y: auto; /* desplazamiento vertical cuando sea necesario */
		}
	}
</style>
<!-- Open div notebook -->
<div id="notebook" class="border-box-sizing" tabindex="-1">
	<!-- Open div notebook container -->
	<div id="notebook-container" class="container">
		<!-- Open div indice -->
		<div class="indice">
			<!-- Open div index header -->
			<div class="cell border-box-sizing text_cell rendered">
				<h2 class="prompt input_prompt">
					<span style="
					color: var(--darkreader-text--heading-color, var(--darkreader-text--heading-2-color,
					var(--darkreader-text--headings-color)));
					font-family: var(--fontFamily); font-size: var(--fontSize);
					font-style: var(--fontStyle, inherit);
					font-weight: var(--fontWeight);
					letter-spacing: var(--letterSpacing);
					text-transform: var(--textTransform);
					background-color: transparent;
					--darkreader-inline-color: var(--darkreader-text--darkreader-text--heading-color,
					var(--darkreader-text--darkreader-text--heading-2-color, var(--darkreader-text--darkreader-text--headings-color)));
					--darkreader-inline-bgcolor: transparent;"
					data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">
						√çndice
					</span>
					<a class="anchor-link" style="
					font-family: var(--fontFamily);
					font-size: var(--fontSize);
					font-style: var(--fontStyle, inherit);
					font-weight: var(--fontWeight);
					letter-spacing: var(--letterSpacing);
					text-transform: var(--textTransform);
					background-color: transparent;
					--darkreader-inline-bgcolor: transparent;"
					href="#√çndice" data-darkreader-inline-bgcolor="">
					</a>
				</h2>
			<!-- Close div index header -->
			</div>
			<!-- Index body -->
			<div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Login-index">
									<a class="anchor-link" href="#Login">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Login</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Dataset-index">
									<a class="anchor-link" href="#Dataset">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Dataset</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Tokenizer-index">
									<a class="anchor-link" href="#Tokenizer">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Tokenizer</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Model-index">
									<a class="anchor-link" href="#Model">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Model</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Trainer-index">
									<a class="anchor-link" href="#Trainer">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Trainer</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Evaluation-index">
									<a class="anchor-link" href="#Evaluation">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Evaluation</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Publish-the-model-index">
									<a class="anchor-link" href="#Publish-the-model">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Publish the model</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Model-use-index">
									<a class="anchor-link" href="#Model-use">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Model use</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Fine-tuning-for-text-generation-with-Hugging-Face-index">
									<a class="anchor-link" href="#Fine-tuning-for-text-generation-with-Hugging-Face">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Fine tuning for text generation with Hugging Face</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Login-index">
									<a class="anchor-link" href="#Login">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Login</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Dataset-index">
									<a class="anchor-link" href="#Dataset">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Dataset</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Tokenizer-index">
									<a class="anchor-link" href="#Tokenizer">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Tokenizer</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Model-index">
									<a class="anchor-link" href="#Model">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Model</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Training-index">
									<a class="anchor-link" href="#Training">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Training</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Evaluation-index">
									<a class="anchor-link" href="#Evaluation">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Evaluation</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Publish-the-model-index">
									<a class="anchor-link" href="#Publish-the-model">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Publish the model</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Model-use-index">
									<a class="anchor-link" href="#Model-use">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Model use</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Fine-tuning-for-text-classification-with-Pytorch-index">
									<a class="anchor-link" href="#Fine-tuning-for-text-classification-with-Pytorch">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Fine tuning for text classification with Pytorch</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Dataset-index">
									<a class="anchor-link" href="#Dataset">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Dataset</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Tokenizer-index">
									<a class="anchor-link" href="#Tokenizer">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Tokenizer</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Model-index">
									<a class="anchor-link" href="#Model">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Model</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Device-index">
									<a class="anchor-link" href="#Device">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Device</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Pytorch-Dataset-index">
									<a class="anchor-link" href="#Pytorch-Dataset">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Pytorch Dataset</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Pytorch-Dataloader-index">
									<a class="anchor-link" href="#Pytorch-Dataloader">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Pytorch Dataloader</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Metric-index">
									<a class="anchor-link" href="#Metric">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Metric</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Optimizer-index">
									<a class="anchor-link" href="#Optimizer">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Optimizer</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Training-index">
									<a class="anchor-link" href="#Training">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Training</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Model-use-index">
									<a class="anchor-link" href="#Model-use">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Model use</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Fine-tuning-for-text-generation-with-Pytorch-index">
									<a class="anchor-link" href="#Fine-tuning-for-text-generation-with-Pytorch">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Fine tuning for text generation with Pytorch</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Dataset-index">
									<a class="anchor-link" href="#Dataset">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Dataset</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Tokenizer-index">
									<a class="anchor-link" href="#Tokenizer">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Tokenizer</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Model-index">
									<a class="anchor-link" href="#Model">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Model</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Device-index">
									<a class="anchor-link" href="#Device">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Device</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Pytorch-Dataset-index">
									<a class="anchor-link" href="#Pytorch-Dataset">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Pytorch Dataset</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Pytorch-Dataloader-index">
									<a class="anchor-link" href="#Pytorch-Dataloader">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Pytorch Dataloader</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Optimizer-index">
									<a class="anchor-link" href="#Optimizer">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Optimizer</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Training-index">
									<a class="anchor-link" href="#Training">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Training</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Model-use-index">
									<a class="anchor-link" href="#Model-use">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Model use</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
			</div>
		<!-- Close div indice -->
		</div>
 
		<!-- Content -->
		<div class="contenido">
		<div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><a href="https://colab.research.google.com/github/maximofn/portafolio/blob/main/posts/notebooks_translated/2024-07-14-Fine-tuning-SLM_EN.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h1 id="Fine-tuning-SMLs-with-Hugging-Face">
								<a class="anchor-link" href="#Fine-tuning-SMLs-with-Hugging-Face">
									<p style="margin-left: 0px">Fine tuning SMLs with Hugging Face</p>
								</a>
							</h1>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">In this post we are going to see how to fine tune small language models, we are going to see how to fine tune text classification and text generation. First we are going to see how to do it with the Hugging Face libraries, since Hugging Face has become a very important player in the AI ecosystem right now.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">But although Hugging Face libraries are very important and useful, it is very important to know how the training is actually done and what is going on underneath, so let's repeat the training for classification and text generation but with Pytorch</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">This notebook has been automatically translated to make it accessible to more people, please let me know if you see any typos.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">## Fine tuning for text classification with Hugging Face</p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h3 id="Login">
								<a class="anchor-link" href="#Login">
									<p style="margin-left: 20px">Login</p>
								</a>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">To be able to upload the training result to the hub we must first log in, for this we need a token</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">To create a token, go to the <a href="https://huggingface.co/settings/tokens" target="_blank">setings/tokens</a> page of your account, you will see something like this</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2024/03/User-Access-Token-dark.png" alt="User-Access-Token-dark"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Click on <code><b>New token</b></code> and a window will appear to create a new token.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2024/03/new-token-dark.png" alt="new-token-dark"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">We name the token and create it with the <code><b>write</b></code> role, or with the <code><b>Fine-grained</b></code> role, which allows us to select exactly what permissions the token will have.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Once created, we copy and paste it below</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">huggingface_hub</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">notebook_login</span></p>
<p><span style="color: #6b97e8;">notebook_login</span><span style="color: #e3e11d;">()</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h3 id="Dataset">
								<a class="anchor-link" href="#Dataset">
									<p style="margin-left: 20px">Dataset</p>
								</a>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Now we download a dataset, in this case we are going to download one of reviews from <a href="https://huggingface.co/datasets/mteb/amazon_reviews_multi" target="_blank">Amazon</a></p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">datasets</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load_dataset</span></p>
<p></p>
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">load_dataset</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;mteb/amazon_reviews_multi&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #7e7a34;">&quot;en&quot;</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Let's take a look at it</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text'],</p><p>        num_rows: 200000</p><p>    })</p><p>    validation: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text'],</p><p>        num_rows: 5000</p><p>    })</p><p>    test: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text'],</p><p>        num_rows: 5000</p><p>    })</p><p>})</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">We see that you have a training set with 200,000 samples, a validation set with 5,000 samples and a test set with 5,000 samples.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Let's see an example of the training set</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">random</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">randint</span></p>
<p></p>
<p><span style="color: #6b97e8;">idx</span> <span>=</span> <span style="color: #6b97e8;">randint</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">])</span> <span>-</span> <span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">]</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>{'id': 'en_0907914',</p><p> 'text': 'Mixed with fir it‚Äôs passable\n\nNot the scent I had hoped for . Love the scent of cedar, but this one missed',</p><p> 'label': 3,</p><p> 'label_text': '3'}</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">We see that it has the review in the <code><b>text</b></code> field and the score given by the user in the <code><b>label</b></code> field.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">As we are going to make a text classification model, we need to know how many classes we are going to have</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">num_classes</span> <span>=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">unique</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">num_classes</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>5</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">We are going to have 5 classes, now we are going to see the minimum value of these classes to know if the score starts at 0 or 1. For this we use the <code><b>unique</b></code> method</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span><span>.</span><span style="color: #6b97e8;">unique</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>{'train': [0, 1, 2, 3, 4],</p><p> 'validation': [0, 1, 2, 3, 4],</p><p> 'test': [0, 1, 2, 3, 4]}</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">The minimum value will be 0</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">To train, the labels have to be in a field called <code><b>labels</b></code>, while in our dataset it is in a field called <code><b>label</b></code>, so we create the new field <code><b>lables</b></code> with the same value as <code><b>label</b></code>.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">We create a function that does what we want</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">set_labels</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;labels&#39;</span><span style="color: #e3e11d;">]</span> <span>=</span> <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">example</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">We apply the function to the dataset</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">set_labels</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Let's see how the dataset looks like</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">]</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>{'id': 'en_0907914',</p><p> 'text': 'Mixed with fir it‚Äôs passable\n\nNot the scent I had hoped for . Love the scent of cedar, but this one missed',</p><p> 'label': 3,</p><p> 'label_text': '3',</p><p> 'labels': 3}</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h3 id="Tokenizer">
								<a class="anchor-link" href="#Tokenizer">
									<p style="margin-left: 20px">Tokenizer</p>
								</a>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">As in the dataset we have the reviews in text, we need to tokenize them in order to put the tokens into the model.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span></p>
<p></p>
<p><span style="color: #6b97e8;">checkpoint</span> <span>=</span> <span style="color: #7e7a34;">&quot;openai-community/gpt2&quot;</span></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Now we create a function to tokenize the text. We are going to make it so that all sentences have the same length, so that the tokenizer will truncate when necessary and add padding tokens when necessary. We also tell it to return pytorch tensors.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">We make the length of each statement 768 tokens because we are using the small GPT2 model, which as we saw in the <a href="https://maximofn.com/gpt2/#Arquitectura" target="_blank">GPT2</a> post has an embedding dimension of 768 tokens.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;text&quot;</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">padding</span><span>=</span><span style="color: #7e7a34;">&quot;max_length&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">truncation</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_length</span><span>=</span><span style="color: #7e7a38;">768</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Let's try tokenizing a text</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">])</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_text output_error">
								<pre style="margin-left: 60px; line-height: 0%;"><p><span style="color:red">---------------------------------------------------------------------------</span></p><p><span style="color:red">ValueError</span>                                Traceback (most recent call last)</p><p>Cell <span style="color:green">In[11], line 1</span></p><p><span style="color:green">----&gt; 1</span> tokens [38;5;241m=[39m tokenize_function(dataset[[38;5;124m'[39m[38;5;124mtrain[39m[38;5;124m'[39m][idx])</p><p></p><p>Cell <span style="color:green">In[10], line 2</span>, in tokenize_function<span style="color:blue">(examples)</span></p><p><span style="color:green"><b>      1</b></span> [38;5;28;01mdef[39;00m [38;5;21mtokenize_function[39m(examples):</p><p><span style="color:green">----&gt; 2</span>     [38;5;28;01mreturn[39;00m tokenizer(examples[[38;5;124m"[39m[38;5;124mtext[39m[38;5;124m"[39m], padding[38;5;241m=[39m[38;5;124m"[39m[38;5;124mmax_length[39m[38;5;124m"[39m, truncation[38;5;241m=[39m[38;5;28;01mTrue[39;00m, max_length[38;5;241m=[39m[38;5;241m768[39m, return_tensors[38;5;241m=[39m[38;5;124m"[39m[38;5;124mpt[39m[38;5;124m"[39m)</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:2883</span>, in PreTrainedTokenizerBase.__call__<span style="color:blue">(self, text, text_pair, text_target, text_pair_target, add_special_tokens, padding, truncation, max_length, stride, is_split_into_words, pad_to_multiple_of, return_tensors, return_token_type_ids, return_attention_mask, return_overflowing_tokens, return_special_tokens_mask, return_offsets_mapping, return_length, verbose, **kwargs)</span></p><p><span style="color:green"><b>   2881</b></span>     [38;5;28;01mif[39;00m [38;5;129;01mnot[39;00m [38;5;28mself[39m[38;5;241m.[39m_in_target_context_manager:</p><p><span style="color:green"><b>   2882</b></span>         [38;5;28mself[39m[38;5;241m.[39m_switch_to_input_mode()</p><p><span style="color:green">-&gt; 2883</span>     encodings [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_call_one(text[38;5;241m=[39mtext, text_pair[38;5;241m=[39mtext_pair, [38;5;241m*[39m[38;5;241m*[39mall_kwargs)</p><p><span style="color:green"><b>   2884</b></span> [38;5;28;01mif[39;00m text_target [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m:</p><p><span style="color:green"><b>   2885</b></span>     [38;5;28mself[39m[38;5;241m.[39m_switch_to_target_mode()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:2989</span>, in PreTrainedTokenizerBase._call_one<span style="color:blue">(self, text, text_pair, add_special_tokens, padding, truncation, max_length, stride, is_split_into_words, pad_to_multiple_of, return_tensors, return_token_type_ids, return_attention_mask, return_overflowing_tokens, return_special_tokens_mask, return_offsets_mapping, return_length, verbose, **kwargs)</span></p><p><span style="color:green"><b>   2969</b></span>     [38;5;28;01mreturn[39;00m [38;5;28mself[39m[38;5;241m.[39mbatch_encode_plus(</p><p><span style="color:green"><b>   2970</b></span>         batch_text_or_text_pairs[38;5;241m=[39mbatch_text_or_text_pairs,</p><p><span style="color:green"><b>   2971</b></span>         add_special_tokens[38;5;241m=[39madd_special_tokens,</p><p><span style="color:green">   (...)</span></p><p><span style="color:green"><b>   2986</b></span>         [38;5;241m*[39m[38;5;241m*[39mkwargs,</p><p><span style="color:green"><b>   2987</b></span>     )</p><p><span style="color:green"><b>   2988</b></span> [38;5;28;01melse[39;00m:</p><p><span style="color:green">-&gt; 2989</span>     [38;5;28;01mreturn[39;00m [38;5;28mself[39m[38;5;241m.[39mencode_plus(</p><p><span style="color:green"><b>   2990</b></span>         text[38;5;241m=[39mtext,</p><p><span style="color:green"><b>   2991</b></span>         text_pair[38;5;241m=[39mtext_pair,</p><p><span style="color:green"><b>   2992</b></span>         add_special_tokens[38;5;241m=[39madd_special_tokens,</p><p><span style="color:green"><b>   2993</b></span>         padding[38;5;241m=[39mpadding,</p><p><span style="color:green"><b>   2994</b></span>         truncation[38;5;241m=[39mtruncation,</p><p><span style="color:green"><b>   2995</b></span>         max_length[38;5;241m=[39mmax_length,</p><p><span style="color:green"><b>   2996</b></span>         stride[38;5;241m=[39mstride,</p><p><span style="color:green"><b>   2997</b></span>         is_split_into_words[38;5;241m=[39mis_split_into_words,</p><p><span style="color:green"><b>   2998</b></span>         pad_to_multiple_of[38;5;241m=[39mpad_to_multiple_of,</p><p><span style="color:green"><b>   2999</b></span>         return_tensors[38;5;241m=[39mreturn_tensors,</p><p><span style="color:green"><b>   3000</b></span>         return_token_type_ids[38;5;241m=[39mreturn_token_type_ids,</p><p><span style="color:green"><b>   3001</b></span>         return_attention_mask[38;5;241m=[39mreturn_attention_mask,</p><p><span style="color:green"><b>   3002</b></span>         return_overflowing_tokens[38;5;241m=[39mreturn_overflowing_tokens,</p><p><span style="color:green"><b>   3003</b></span>         return_special_tokens_mask[38;5;241m=[39mreturn_special_tokens_mask,</p><p><span style="color:green"><b>   3004</b></span>         return_offsets_mapping[38;5;241m=[39mreturn_offsets_mapping,</p><p><span style="color:green"><b>   3005</b></span>         return_length[38;5;241m=[39mreturn_length,</p><p><span style="color:green"><b>   3006</b></span>         verbose[38;5;241m=[39mverbose,</p><p><span style="color:green"><b>   3007</b></span>         [38;5;241m*[39m[38;5;241m*[39mkwargs,</p><p><span style="color:green"><b>   3008</b></span>     )</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:3053</span>, in PreTrainedTokenizerBase.encode_plus<span style="color:blue">(self, text, text_pair, add_special_tokens, padding, truncation, max_length, stride, is_split_into_words, pad_to_multiple_of, return_tensors, return_token_type_ids, return_attention_mask, return_overflowing_tokens, return_special_tokens_mask, return_offsets_mapping, return_length, verbose, **kwargs)</span></p><p><span style="color:green"><b>   3032</b></span> [38;5;250m[39m[38;5;124;03m"""[39;00m</p><p><span style="color:green"><b>   3033</b></span> [38;5;124;03mTokenize and prepare for the model a sequence or a pair of sequences.[39;00m</p><p><span style="color:green"><b>   3034</b></span> </p><p><span style="color:green">   (...)</span></p><p><span style="color:green"><b>   3049</b></span> [38;5;124;03m        method).[39;00m</p><p><span style="color:green"><b>   3050</b></span> [38;5;124;03m"""[39;00m</p><p><span style="color:green"><b>   3052</b></span> [38;5;66;03m# Backward compatibility for 'truncation_strategy', 'pad_to_max_length'[39;00m</p><p><span style="color:green">-&gt; 3053</span> padding_strategy, truncation_strategy, max_length, kwargs [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_get_padding_truncation_strategies(</p><p><span style="color:green"><b>   3054</b></span>     padding[38;5;241m=[39mpadding,</p><p><span style="color:green"><b>   3055</b></span>     truncation[38;5;241m=[39mtruncation,</p><p><span style="color:green"><b>   3056</b></span>     max_length[38;5;241m=[39mmax_length,</p><p><span style="color:green"><b>   3057</b></span>     pad_to_multiple_of[38;5;241m=[39mpad_to_multiple_of,</p><p><span style="color:green"><b>   3058</b></span>     verbose[38;5;241m=[39mverbose,</p><p><span style="color:green"><b>   3059</b></span>     [38;5;241m*[39m[38;5;241m*[39mkwargs,</p><p><span style="color:green"><b>   3060</b></span> )</p><p><span style="color:green"><b>   3062</b></span> [38;5;28;01mreturn[39;00m [38;5;28mself[39m[38;5;241m.[39m_encode_plus(</p><p><span style="color:green"><b>   3063</b></span>     text[38;5;241m=[39mtext,</p><p><span style="color:green"><b>   3064</b></span>     text_pair[38;5;241m=[39mtext_pair,</p><p><span style="color:green">   (...)</span></p><p><span style="color:green"><b>   3080</b></span>     [38;5;241m*[39m[38;5;241m*[39mkwargs,</p><p><span style="color:green"><b>   3081</b></span> )</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:2788</span>, in PreTrainedTokenizerBase._get_padding_truncation_strategies<span style="color:blue">(self, padding, truncation, max_length, pad_to_multiple_of, verbose, **kwargs)</span></p><p><span style="color:green"><b>   2786</b></span> [38;5;66;03m# Test if we have a padding token[39;00m</p><p><span style="color:green"><b>   2787</b></span> [38;5;28;01mif[39;00m padding_strategy [38;5;241m!=[39m PaddingStrategy[38;5;241m.[39mDO_NOT_PAD [38;5;129;01mand[39;00m ([38;5;28mself[39m[38;5;241m.[39mpad_token [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m [38;5;129;01mor[39;00m [38;5;28mself[39m[38;5;241m.[39mpad_token_id [38;5;241m&lt;[39m [38;5;241m0[39m):</p><p><span style="color:green">-&gt; 2788</span>     [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(</p><p><span style="color:green"><b>   2789</b></span>         [38;5;124m"[39m[38;5;124mAsking to pad but the tokenizer does not have a padding token. [39m[38;5;124m"[39m</p><p><span style="color:green"><b>   2790</b></span>         [38;5;124m"[39m[38;5;124mPlease select a token to use as `pad_token` `(tokenizer.pad_token = tokenizer.eos_token e.g.)` [39m[38;5;124m"[39m</p><p><span style="color:green"><b>   2791</b></span>         [38;5;124m"[39m[38;5;124mor add a new pad token via `tokenizer.add_special_tokens([39m[38;5;124m{[39m[38;5;124m'[39m[38;5;124mpad_token[39m[38;5;124m'[39m[38;5;124m: [39m[38;5;124m'[39m[38;5;124m[PAD][39m[38;5;124m'[39m[38;5;124m})`.[39m[38;5;124m"[39m</p><p><span style="color:green"><b>   2792</b></span>     )</p><p><span style="color:green"><b>   2794</b></span> [38;5;66;03m# Check that we will truncate to a multiple of pad_to_multiple_of if both are provided[39;00m</p><p><span style="color:green"><b>   2795</b></span> [38;5;28;01mif[39;00m (</p><p><span style="color:green"><b>   2796</b></span>     truncation_strategy [38;5;241m!=[39m TruncationStrategy[38;5;241m.[39mDO_NOT_TRUNCATE</p><p><span style="color:green"><b>   2797</b></span>     [38;5;129;01mand[39;00m padding_strategy [38;5;241m!=[39m PaddingStrategy[38;5;241m.[39mDO_NOT_PAD</p><p><span style="color:green">   (...)</span></p><p><span style="color:green"><b>   2800</b></span>     [38;5;129;01mand[39;00m (max_length [38;5;241m%[39m pad_to_multiple_of [38;5;241m!=[39m [38;5;241m0[39m)</p><p><span style="color:green"><b>   2801</b></span> ):</p><p></p><p><span style="color:red">ValueError</span>: Asking to pad but the tokenizer does not have a padding token. Please select a token to use as `pad_token` `(tokenizer.pad_token = tokenizer.eos_token e.g.)` or add a new pad token via `tokenizer.add_special_tokens({'pad_token': '[PAD]'})`.</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">We get an error because the GPT2 tokenizer does not have a token for padding and asks us to assign one, it also suggests us to do <code><b>tokenizer.pad_token = tokenizer.eos_token</b></code>, so we do it</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">We test again the tokenization function</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">shape</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([1, 768]), torch.Size([1, 768]))</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Now that we have checked that the function tokenizes well, we apply this function to the dataset, but we also apply it in batches so that it runs faster</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"></p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">We also take advantage of this and eliminate the columns we do not need</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;text&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;id&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;label_text&#39;</span><span style="color: #e3e11d;">])</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Now let's see how the dataset looks like</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text', 'labels'],</p><p>        num_rows: 200000</p><p>    })</p><p>    validation: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text', 'labels'],</p><p>        num_rows: 5000</p><p>    })</p><p>    test: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text', 'labels'],</p><p>        num_rows: 5000</p><p>    })</p><p>})</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">We can see that we have the fields 'labels', 'input_ids' and 'attention_mask', which is what we are interested in training</p>
					</div>
				</div>
			</div>
		</div>
		<!-- Open div header -->
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<h3 id="Model">
							<a class="anchor-link" href="#Model">
								<p style="margin-left: 20px">Model</p>
							</a>
						</h3>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">We instantiate a model for sequence classification and we indicate the number of classes we have</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">num_labels</span><span>=</span><span style="color: #6b97e8;">num_classes</span><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>Some weights of GPT2ForSequenceClassification were not initialized from the model checkpoint at openai-community/gpt2 and are newly initialized: ['score.weight']</p><p>You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">It tells us that the weights of the <code><b>score</b></code> layer have been initialized randomly and that we have to retrain them, let's see why this happens</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">The GPT2 model would look like this</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span></p>
<p></p>
<p><span style="color: #6b97e8;">casual_model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">While the GPT2 model for generating text is as follows</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Let's take a look at its architecture</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">casual_model</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>GPT2LMHeadModel(</p><p>  (transformer): GPT2Model(</p><p>    (wte): Embedding(50257, 768)</p><p>    (wpe): Embedding(1024, 768)</p><p>    (drop): Dropout(p=0.1, inplace=False)</p><p>    (h): ModuleList(</p><p>      (0-11): 12 x GPT2Block(</p><p>        (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>        (attn): GPT2Attention(</p><p>          (c_attn): Conv1D()</p><p>          (c_proj): Conv1D()</p><p>          (attn_dropout): Dropout(p=0.1, inplace=False)</p><p>          (resid_dropout): Dropout(p=0.1, inplace=False)</p><p>        )</p><p>        (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>        (mlp): GPT2MLP(</p><p>          (c_fc): Conv1D()</p><p>          (c_proj): Conv1D()</p><p>          (act): NewGELUActivation()</p><p>          (dropout): Dropout(p=0.1, inplace=False)</p><p>        )</p><p>      )</p><p>    )</p><p>    (ln_f): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>  )</p><p>  (lm_head): Linear(in_features=768, out_features=50257, bias=False)</p><p>)</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">And now the architecture of the model we are going to use to classify the reviews</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">model</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>GPT2ForSequenceClassification(</p><p>  (transformer): GPT2Model(</p><p>    (wte): Embedding(50257, 768)</p><p>    (wpe): Embedding(1024, 768)</p><p>    (drop): Dropout(p=0.1, inplace=False)</p><p>    (h): ModuleList(</p><p>      (0-11): 12 x GPT2Block(</p><p>        (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>        (attn): GPT2Attention(</p><p>          (c_attn): Conv1D()</p><p>          (c_proj): Conv1D()</p><p>          (attn_dropout): Dropout(p=0.1, inplace=False)</p><p>          (resid_dropout): Dropout(p=0.1, inplace=False)</p><p>        )</p><p>        (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>        (mlp): GPT2MLP(</p><p>          (c_fc): Conv1D()</p><p>          (c_proj): Conv1D()</p><p>          (act): NewGELUActivation()</p><p>          (dropout): Dropout(p=0.1, inplace=False)</p><p>        )</p><p>      )</p><p>    )</p><p>    (ln_f): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>  )</p><p>  (score): Linear(in_features=768, out_features=5, bias=False)</p><p>)</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">There are two things to mention here</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"></p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"> + The first is that in both, the first layer has dimensions of 50257x768, which corresponds to 50257 possible tokens of the GPT2 vocabulary and 768 dimensions of the embedding, so we have done well to tokenize the reviews with a size of 768 tokens.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"> + The second is that the <code><b>casual</b></code> model (the text generation model) has at the end a <code><b>Linear</b></code> layer that generates 50257 values, that is, it is in charge of predicting the next token and gives a value to each possible token. While the classification model has a <code><b>Linear</b></code> layer that only generates 5 values, one for each class, which will give us the probability that the review belongs to each class.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"></p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">That is why we got the message that the weights of the <code><b>score</b></code> layer had been initialized randomly, because the transformers library has removed the <code><b>Linear</b></code> layer of 768x50257 and added a <code><b>Linear</b></code> layer of 768x5, it has initialized it with random values and we have to train it for our particular problem.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">We delete the casual model, because we are not going to use it.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">del</span> <span style="color: #6b97e8;">casual_model</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<!-- Open div header -->
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<h3 id="Trainer">
							<a class="anchor-link" href="#Trainer">
								<p style="margin-left: 20px">Trainer</p>
							</a>
						</h3>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Let's now configure the training arguments</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">TrainingArguments</span></p>
<p></p>
<p><span style="color: #6b97e8;">metric_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;accuracy&quot;</span></p>
<p><span style="color: #6b97e8;">model_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;GPT2-small-finetuned-amazon-reviews-en-classification&quot;</span></p>
<p><span style="color: #6b97e8;">LR</span> <span>=</span> <span style="color: #a09e19;">2e-5</span></p>
<p><span style="color: #6b97e8;">BS_TRAIN</span> <span>=</span> <span style="color: #7e7a38;">28</span></p>
<p><span style="color: #6b97e8;">BS_EVAL</span> <span>=</span> <span style="color: #7e7a38;">40</span></p>
<p><span style="color: #6b97e8;">EPOCHS</span> <span>=</span> <span style="color: #7e7a38;">3</span></p>
<p><span style="color: #6b97e8;">WEIGHT_DECAY</span> <span>=</span> <span style="color: #a09e19;">0.01</span></p>
<p></p>
<p><span style="color: #6b97e8;">training_args</span> <span>=</span> <span style="color: #6b97e8;">TrainingArguments</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">save_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">learning_rate</span><span>=</span><span style="color: #6b97e8;">LR</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_train_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_TRAIN</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_eval_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_EVAL</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">num_train_epochs</span><span>=</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">weight_decay</span><span>=</span><span style="color: #6b97e8;">WEIGHT_DECAY</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">lr_scheduler_type</span><span>=</span><span style="color: #7e7a34;">&quot;cosine&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">warmup_ratio</span> <span>=</span> <span style="color: #a09e19;">0.1</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">fp16</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">load_best_model_at_end</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">metric_for_best_model</span><span>=</span><span style="color: #6b97e8;">metric_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">push_to_hub</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Define a metric for the validation dataloader</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">numpy</span> <span style="color: #a04cc1;">as</span> <span style="color: #4fcd7d;">np</span></p>
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">evaluate</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load</span></p>
<p></p>
<p><span style="color: #6b97e8;">metric</span> <span>=</span> <span style="color: #6b97e8;">load</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;accuracy&quot;</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">compute_metrics</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">eval_pred</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">eval_pred</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">predictions</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #6b97e8;">eval_pred</span></p>
<p>    <span style="color: #6b97e8;">predictions</span> <span>=</span> <span style="color: #6b97e8;">np</span><span>.</span><span style="color: #6b97e8;">argmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">predictions</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">axis</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">metric</span><span>.</span><span style="color: #6b97e8;">compute</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">predictions</span><span>=</span><span style="color: #6b97e8;">predictions</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">references</span><span>=</span><span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">We now define the trainer</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">Trainer</span></p>
<p></p>
<p><span style="color: #6b97e8;">trainer</span> <span>=</span> <span style="color: #6b97e8;">Trainer</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">training_args</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">train_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">],</span></p>
<p>    <span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;validation&#39;</span><span style="color: #e3e11d;">],</span></p>
<p>    <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">compute_metrics</span><span>=</span><span style="color: #6b97e8;">compute_metrics</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">We train</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_text output_error">
							<pre style="margin-left: 60px; line-height: 0%;"><p><span style="color:red">---------------------------------------------------------------------------</span></p><p><span style="color:red">ValueError</span>                                Traceback (most recent call last)</p><p>Cell <span style="color:green">In[21], line 1</span></p><p><span style="color:green">----&gt; 1</span> trainer[38;5;241m.[39mtrain()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:1876</span>, in Trainer.train<span style="color:blue">(self, resume_from_checkpoint, trial, ignore_keys_for_eval, **kwargs)</span></p><p><span style="color:green"><b>   1873</b></span> [38;5;28;01mtry[39;00m:</p><p><span style="color:green"><b>   1874</b></span>     [38;5;66;03m# Disable progress bars when uploading models during checkpoints to avoid polluting stdout[39;00m</p><p><span style="color:green"><b>   1875</b></span>     hf_hub_utils[38;5;241m.[39mdisable_progress_bars()</p><p><span style="color:green">-&gt; 1876</span>     [38;5;28;01mreturn[39;00m inner_training_loop(</p><p><span style="color:green"><b>   1877</b></span>         args[38;5;241m=[39margs,</p><p><span style="color:green"><b>   1878</b></span>         resume_from_checkpoint[38;5;241m=[39mresume_from_checkpoint,</p><p><span style="color:green"><b>   1879</b></span>         trial[38;5;241m=[39mtrial,</p><p><span style="color:green"><b>   1880</b></span>         ignore_keys_for_eval[38;5;241m=[39mignore_keys_for_eval,</p><p><span style="color:green"><b>   1881</b></span>     )</p><p><span style="color:green"><b>   1882</b></span> [38;5;28;01mfinally[39;00m:</p><p><span style="color:green"><b>   1883</b></span>     hf_hub_utils[38;5;241m.[39menable_progress_bars()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:2178</span>, in Trainer._inner_training_loop<span style="color:blue">(self, batch_size, args, resume_from_checkpoint, trial, ignore_keys_for_eval)</span></p><p><span style="color:green"><b>   2175</b></span>     rng_to_sync [38;5;241m=[39m [38;5;28;01mTrue[39;00m</p><p><span style="color:green"><b>   2177</b></span> step [38;5;241m=[39m [38;5;241m-[39m[38;5;241m1[39m</p><p><span style="color:green">-&gt; 2178</span> [38;5;28;01mfor[39;00m step, inputs [38;5;129;01min[39;00m [38;5;28menumerate[39m(epoch_iterator):</p><p><span style="color:green"><b>   2179</b></span>     total_batched_samples [38;5;241m+[39m[38;5;241m=[39m [38;5;241m1[39m</p><p><span style="color:green"><b>   2181</b></span>     [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39margs[38;5;241m.[39minclude_num_input_tokens_seen:</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/accelerate/data_loader.py:454</span>, in DataLoaderShard.__iter__<span style="color:blue">(self)</span></p><p><span style="color:green"><b>    452</b></span> [38;5;66;03m# We iterate one batch ahead to check when we are at the end[39;00m</p><p><span style="color:green"><b>    453</b></span> [38;5;28;01mtry[39;00m:</p><p><span style="color:green">--&gt; 454</span>     current_batch [38;5;241m=[39m [38;5;28mnext[39m(dataloader_iter)</p><p><span style="color:green"><b>    455</b></span> [38;5;28;01mexcept[39;00m [38;5;167;01mStopIteration[39;00m:</p><p><span style="color:green"><b>    456</b></span>     [38;5;28;01myield[39;00m</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/torch/utils/data/dataloader.py:631</span>, in _BaseDataLoaderIter.__next__<span style="color:blue">(self)</span></p><p><span style="color:green"><b>    628</b></span> [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39m_sampler_iter [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m:</p><p><span style="color:green"><b>    629</b></span>     [38;5;66;03m# TODO(https://github.com/pytorch/pytorch/issues/76750)[39;00m</p><p><span style="color:green"><b>    630</b></span>     [38;5;28mself[39m[38;5;241m.[39m_reset()  [38;5;66;03m# type: ignore[call-arg][39;00m</p><p><span style="color:green">--&gt; 631</span> data [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_next_data()</p><p><span style="color:green"><b>    632</b></span> [38;5;28mself[39m[38;5;241m.[39m_num_yielded [38;5;241m+[39m[38;5;241m=[39m [38;5;241m1[39m</p><p><span style="color:green"><b>    633</b></span> [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39m_dataset_kind [38;5;241m==[39m _DatasetKind[38;5;241m.[39mIterable [38;5;129;01mand[39;00m \</p><p><span style="color:green"><b>    634</b></span>         [38;5;28mself[39m[38;5;241m.[39m_IterableDataset_len_called [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m [38;5;129;01mand[39;00m \</p><p><span style="color:green"><b>    635</b></span>         [38;5;28mself[39m[38;5;241m.[39m_num_yielded [38;5;241m&gt;[39m [38;5;28mself[39m[38;5;241m.[39m_IterableDataset_len_called:</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/torch/utils/data/dataloader.py:675</span>, in _SingleProcessDataLoaderIter._next_data<span style="color:blue">(self)</span></p><p><span style="color:green"><b>    673</b></span> [38;5;28;01mdef[39;00m [38;5;21m_next_data[39m([38;5;28mself[39m):</p><p><span style="color:green"><b>    674</b></span>     index [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_next_index()  [38;5;66;03m# may raise StopIteration[39;00m</p><p><span style="color:green">--&gt; 675</span>     data [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_dataset_fetcher[38;5;241m.[39mfetch(index)  [38;5;66;03m# may raise StopIteration[39;00m</p><p><span style="color:green"><b>    676</b></span>     [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39m_pin_memory:</p><p><span style="color:green"><b>    677</b></span>         data [38;5;241m=[39m _utils[38;5;241m.[39mpin_memory[38;5;241m.[39mpin_memory(data, [38;5;28mself[39m[38;5;241m.[39m_pin_memory_device)</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py:54</span>, in _MapDatasetFetcher.fetch<span style="color:blue">(self, possibly_batched_index)</span></p><p><span style="color:green"><b>     52</b></span> [38;5;28;01melse[39;00m:</p><p><span style="color:green"><b>     53</b></span>     data [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mdataset[possibly_batched_index]</p><p><span style="color:green">---&gt; 54</span> [38;5;28;01mreturn[39;00m [38;5;28mself[39m[38;5;241m.[39mcollate_fn(data)</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/data/data_collator.py:271</span>, in DataCollatorWithPadding.__call__<span style="color:blue">(self, features)</span></p><p><span style="color:green"><b>    270</b></span> [38;5;28;01mdef[39;00m [38;5;21m__call__[39m([38;5;28mself[39m, features: List[Dict[[38;5;28mstr[39m, Any]]) [38;5;241m-[39m[38;5;241m&gt;[39m Dict[[38;5;28mstr[39m, Any]:</p><p><span style="color:green">--&gt; 271</span>     batch [38;5;241m=[39m pad_without_fast_tokenizer_warning(</p><p><span style="color:green"><b>    272</b></span>         [38;5;28mself[39m[38;5;241m.[39mtokenizer,</p><p><span style="color:green"><b>    273</b></span>         features,</p><p><span style="color:green"><b>    274</b></span>         padding[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mpadding,</p><p><span style="color:green"><b>    275</b></span>         max_length[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mmax_length,</p><p><span style="color:green"><b>    276</b></span>         pad_to_multiple_of[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mpad_to_multiple_of,</p><p><span style="color:green"><b>    277</b></span>         return_tensors[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mreturn_tensors,</p><p><span style="color:green"><b>    278</b></span>     )</p><p><span style="color:green"><b>    279</b></span>     [38;5;28;01mif[39;00m [38;5;124m"[39m[38;5;124mlabel[39m[38;5;124m"[39m [38;5;129;01min[39;00m batch:</p><p><span style="color:green"><b>    280</b></span>         batch[[38;5;124m"[39m[38;5;124mlabels[39m[38;5;124m"[39m] [38;5;241m=[39m batch[[38;5;124m"[39m[38;5;124mlabel[39m[38;5;124m"[39m]</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/data/data_collator.py:66</span>, in pad_without_fast_tokenizer_warning<span style="color:blue">(tokenizer, *pad_args, **pad_kwargs)</span></p><p><span style="color:green"><b>     63</b></span> tokenizer[38;5;241m.[39mdeprecation_warnings[[38;5;124m"[39m[38;5;124mAsking-to-pad-a-fast-tokenizer[39m[38;5;124m"[39m] [38;5;241m=[39m [38;5;28;01mTrue[39;00m</p><p><span style="color:green"><b>     65</b></span> [38;5;28;01mtry[39;00m:</p><p><span style="color:green">---&gt; 66</span>     padded [38;5;241m=[39m tokenizer[38;5;241m.[39mpad([38;5;241m*[39mpad_args, [38;5;241m*[39m[38;5;241m*[39mpad_kwargs)</p><p><span style="color:green"><b>     67</b></span> [38;5;28;01mfinally[39;00m:</p><p><span style="color:green"><b>     68</b></span>     [38;5;66;03m# Restore the state of the warning.[39;00m</p><p><span style="color:green"><b>     69</b></span>     tokenizer[38;5;241m.[39mdeprecation_warnings[[38;5;124m"[39m[38;5;124mAsking-to-pad-a-fast-tokenizer[39m[38;5;124m"[39m] [38;5;241m=[39m warning_state</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:3299</span>, in PreTrainedTokenizerBase.pad<span style="color:blue">(self, encoded_inputs, padding, max_length, pad_to_multiple_of, return_attention_mask, return_tensors, verbose)</span></p><p><span style="color:green"><b>   3297</b></span> [38;5;66;03m# The model's main input name, usually `input_ids`, has be passed for padding[39;00m</p><p><span style="color:green"><b>   3298</b></span> [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39mmodel_input_names[[38;5;241m0[39m] [38;5;129;01mnot[39;00m [38;5;129;01min[39;00m encoded_inputs:</p><p><span style="color:green">-&gt; 3299</span>     [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(</p><p><span style="color:green"><b>   3300</b></span>         [38;5;124m"[39m[38;5;124mYou should supply an encoding or a list of encodings to this method [39m[38;5;124m"[39m</p><p><span style="color:green"><b>   3301</b></span>         [38;5;124mf[39m[38;5;124m"[39m[38;5;124mthat includes [39m[38;5;132;01m{[39;00m[38;5;28mself[39m[38;5;241m.[39mmodel_input_names[[38;5;241m0[39m][38;5;132;01m}[39;00m[38;5;124m, but you provided [39m[38;5;132;01m{[39;00m[38;5;28mlist[39m(encoded_inputs[38;5;241m.[39mkeys())[38;5;132;01m}[39;00m[38;5;124m"[39m</p><p><span style="color:green"><b>   3302</b></span>     )</p><p><span style="color:green"><b>   3304</b></span> required_input [38;5;241m=[39m encoded_inputs[[38;5;28mself[39m[38;5;241m.[39mmodel_input_names[[38;5;241m0[39m]]</p><p><span style="color:green"><b>   3306</b></span> [38;5;28;01mif[39;00m required_input [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m [38;5;129;01mor[39;00m ([38;5;28misinstance[39m(required_input, Sized) [38;5;129;01mand[39;00m [38;5;28mlen[39m(required_input) [38;5;241m==[39m [38;5;241m0[39m):</p><p></p><p><span style="color:red">ValueError</span>: You should supply an encoding or a list of encodings to this method that includes input_ids, but you provided ['label', 'labels']</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We get an error again because the model does not have a padding token assigned, so as with the tokenizer we assign it to it</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We recreate the trainer arguments with the new model, which now has a padding token, the trainer and train again.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">training_args</span> <span>=</span> <span style="color: #6b97e8;">TrainingArguments</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">save_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">learning_rate</span><span>=</span><span style="color: #6b97e8;">LR</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_train_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_TRAIN</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_eval_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_EVAL</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">num_train_epochs</span><span>=</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">weight_decay</span><span>=</span><span style="color: #6b97e8;">WEIGHT_DECAY</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">lr_scheduler_type</span><span>=</span><span style="color: #7e7a34;">&quot;cosine&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">warmup_ratio</span> <span>=</span> <span style="color: #a09e19;">0.1</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">fp16</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">load_best_model_at_end</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">metric_for_best_model</span><span>=</span><span style="color: #6b97e8;">metric_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">push_to_hub</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">logging_dir</span><span>=</span><span style="color: #7e7a34;">&quot;./runs&quot;</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
<p></p>
<p><span style="color: #6b97e8;">trainer</span> <span>=</span> <span style="color: #6b97e8;">Trainer</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">training_args</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">train_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">],</span></p>
<p>    <span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;validation&#39;</span><span style="color: #e3e11d;">],</span></p>
<p>    <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">compute_metrics</span><span>=</span><span style="color: #6b97e8;">compute_metrics</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Now that we have seen that all is well, we can train.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>TrainOutput(global_step=21429, training_loss=0.7846888848762739, metrics={'train_runtime': 26367.7801, 'train_samples_per_second': 22.755, 'train_steps_per_second': 0.813, 'total_flos': 2.35173445632e+17, 'train_loss': 0.7846888848762739, 'epoch': 3.0})</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Evaluation">
						<a class="anchor-link" href="#Evaluation">
							<p style="margin-left: 20px">Evaluation</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Once trained we evaluate on the test dataset</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">evaluate</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;test&#39;</span><span style="color: #e3e11d;">])</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>{'eval_loss': 0.7973636984825134,</p><p> 'eval_accuracy': 0.6626,</p><p> 'eval_runtime': 76.3016,</p><p> 'eval_samples_per_second': 65.529,</p><p> 'eval_steps_per_second': 1.638,</p><p> 'epoch': 3.0}</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Publish-the-model">
						<a class="anchor-link" href="#Publish-the-model">
							<p style="margin-left: 20px">Publish the model</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Now that we have our model trained, we can share it with the world, so first we create a model card.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">create_model_card</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">And now we can publish it. As the first thing we have done is to log in with the huggingface hub, we can upload it to our hub without any problem.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">push_to_hub</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Model-use">
						<a class="anchor-link" href="#Model-use">
							<p style="margin-left: 20px">Model use</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We clean as much as possible</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">gc</span></p>
<p></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">clear_hardwares</span><span style="color: #e3e11d;">():</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">clear_autocast_cache</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">ipc_collect</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">empty_cache</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">gc</span><span>.</span><span style="color: #6b97e8;">collect</span><span style="color: #e3e11d;">()</span></p>
<p></p>
<p></p>
<p><span style="color: #6b97e8;">clear_hardwares</span><span style="color: #e3e11d;">()</span></p>
<p><span style="color: #6b97e8;">clear_hardwares</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">As we have uploaded the model to our hub we can download it and use it.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">pipeline</span></p>
<p></p>
<p><span style="color: #6b97e8;">user</span> <span>=</span> <span style="color: #7e7a34;">&quot;maximofn&quot;</span></p>
<p><span style="color: #6b97e8;">checkpoints</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">user</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">/</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">model_name</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span></p>
<p><span style="color: #6b97e8;">task</span> <span>=</span> <span style="color: #7e7a34;">&quot;text-classification&quot;</span></p>
<p><span style="color: #6b97e8;">classifier</span> <span>=</span> <span style="color: #6b97e8;">pipeline</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">task</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">model</span><span>=</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Now if we want to return the probability of all classes, we simply use the classifier we just instantiated, with the parameter <code><b>top_k=None</b></code>.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #6b97e8;">classifier</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;I love this product&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_k</span><span>=</span><span style="color: #7f6e38;">None</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">labels</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>[{'label': 'LABEL_4', 'score': 0.8253807425498962},</p><p> {'label': 'LABEL_3', 'score': 0.15411493182182312},</p><p> {'label': 'LABEL_2', 'score': 0.013907806016504765},</p><p> {'label': 'LABEL_0', 'score': 0.003939222544431686},</p><p> {'label': 'LABEL_1', 'score': 0.0026572425849735737}]</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">If we only want the class with the highest probability we do the same but with the parameter <code><b>top_k=1</b></code>.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">label</span> <span>=</span> <span style="color: #6b97e8;">classifier</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;I love this product&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_k</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">label</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>[{'label': 'LABEL_4', 'score': 0.8253807425498962}]</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">And if we want n classes we do the same but with the parameter <code><b>top_k=n</b></code>.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">two_labels</span> <span>=</span> <span style="color: #6b97e8;">classifier</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;I love this product&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_k</span><span>=</span><span style="color: #7e7a38;">2</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">two_labels</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>[{'label': 'LABEL_4', 'score': 0.8253807425498962},</p><p> {'label': 'LABEL_3', 'score': 0.15411493182182312}]</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We can also test the model with Automodel and AutoTokenizer.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span></p>
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">model_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;GPT2-small-finetuned-amazon-reviews-en-classification&quot;</span></p>
<p><span style="color: #6b97e8;">user</span> <span>=</span> <span style="color: #7e7a34;">&quot;maximofn&quot;</span></p>
<p><span style="color: #6b97e8;">checkpoint</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">user</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">/</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">model_name</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span></p>
<p><span style="color: #6b97e8;">num_classes</span> <span>=</span> <span style="color: #7e7a38;">5</span></p>
<p></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">num_labels</span><span>=</span><span style="color: #6b97e8;">num_classes</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">half</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">eval</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;cuda&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">encode</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;I love this product&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #a04cc1;">with</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">no_grad</span><span style="color: #e3e11d;">():</span></p>
<p>    <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokens</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">logits</span> <span>=</span> <span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">logits</span></p>
<p><span style="color: #6b97e8;">lables</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">softmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">dim</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">cpu</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">numpy</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">tolist</span><span style="color: #e3e11d;">()</span></p>
<p><span style="color: #6b97e8;">lables</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">]</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>[0.003963470458984375,</p><p> 0.0026721954345703125,</p><p> 0.01397705078125,</p><p> 0.154541015625,</p><p> 0.82470703125]</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">If you want to test the model further you can see it in <a href="https://huggingface.co/Maximofn/GPT2-small-finetuned-amazon-reviews-en-classification" target="_blank">Maximofn/GPT2-small-finetuned-amazon-reviews-en-classification</a></p>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h2 id="Fine-tuning-for-text-generation-with-Hugging-Face">
						<a class="anchor-link" href="#Fine-tuning-for-text-generation-with-Hugging-Face">
							<p style="margin-left: 10px">Fine tuning for text generation with Hugging Face</p>
						</a>
					</h2>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">To make sure I don't have VRAM memory problems, I reboot the notebook.</p>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Login">
						<a class="anchor-link" href="#Login">
							<p style="margin-left: 20px">Login</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">In order to upload the training result to the hub we must first log in, for this we need a token</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">To create a token, go to the <a href="https://huggingface.co/settings/tokens" target="_blank">setings/tokens</a> page of your account, you will see something like this</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2024/03/User-Access-Token-dark.png" alt="User-Access-Token-dark"></p></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Click on <code><b>New token</b></code> and a window will appear to create a new token.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2024/03/new-token-dark.png" alt="new-token-dark"></p></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We name the token and create it with the <code><b>write</b></code> role, or with the <code><b>Fine-grained</b></code> role, which allows us to select exactly what permissions the token will have.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Once created, we copy and paste it below</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">huggingface_hub</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">notebook_login</span></p>
<p><span style="color: #6b97e8;">notebook_login</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Dataset">
						<a class="anchor-link" href="#Dataset">
							<p style="margin-left: 20px">Dataset</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Let's use a dataset of <a href="https://huggingface.co/datasets/Maximofn/short-jokes-dataset" target="_blank">English jokes</a></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">datasets</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load_dataset</span></p>
<p></p>
<p><span style="color: #6b97e8;">jokes</span> <span>=</span> <span style="color: #6b97e8;">load_dataset</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;Maximofn/short-jokes-dataset&quot;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">jokes</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['ID', 'Joke'],</p><p>        num_rows: 231657</p><p>    })</p><p>})</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Let's take a look at it</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">jokes</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['ID', 'Joke'],</p><p>        num_rows: 231657</p><p>    })</p><p>})</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We see that it is a single training set of more than 200 thousand jokes. So later we will have to divide it into training and evaluation.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Let's see a sample</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">random</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">randint</span></p>
<p></p>
<p><span style="color: #6b97e8;">idx</span> <span>=</span> <span style="color: #6b97e8;">randint</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">])</span> <span>-</span> <span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">]</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>{'ID': 198387,</p><p> 'Joke': 'My hot dislexic co-worker said she had an important massage to give me in her office... When I got there, she told me it can wait until I put on some clothes.'}</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We see that it has an ID of the joke that does not interest us at all and the joke itself.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">In case you have low GPU memory I will make a subset of the dataset, choose the percentage of jokes you want to use.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percent_of_train_dataset</span> <span>=</span> <span style="color: #7e7a38;">1</span>    <span style="color: #7f6e38;"># If you want 50% of the dataset, set this to 0.5</span></p>
<p></p>
<p><span style="color: #6b97e8;">subset_dataset</span> <span>=</span> <span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percent_of_train_dataset</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #6b97e8;">subset_dataset</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>Dataset({</p><p>    features: ['ID', 'Joke'],</p><p>    num_rows: 231657</p><p>})</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We now divide the subset into a training set and a validation set.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percent_of_train_dataset</span> <span>=</span> <span style="color: #a09e19;">0.90</span></p>
<p></p>
<p><span style="color: #6b97e8;">split_dataset</span> <span>=</span> <span style="color: #6b97e8;">subset_dataset</span><span>.</span><span style="color: #6b97e8;">train_test_split</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_size</span><span>=</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_dataset</span><span>.</span><span style="color: #6b97e8;">num_rows</span> <span>*</span> <span style="color: #6b97e8;">percent_of_train_dataset</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">19</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">validation_test_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;test&quot;</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #6b97e8;">split_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_test_dataset</span><span>.</span><span style="color: #6b97e8;">train_test_split</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_size</span><span>=</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_test_dataset</span><span>.</span><span style="color: #6b97e8;">num_rows</span> <span>*</span> <span style="color: #a09e19;">0.5</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">19</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;test&quot;</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Size of the train set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Size of the validation set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Size of the test set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>Size of the train set: 208491. Size of the validation set: 11583. Size of the test set: 11583</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Tokenizer">
						<a class="anchor-link" href="#Tokenizer">
							<p style="margin-left: 20px">Tokenizer</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Instantiate the tokenizer. We instantiate the padding token of the tokenizer so that it does not give us error as before.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span></p>
<p></p>
<p><span style="color: #6b97e8;">checkpoints</span> <span>=</span> <span style="color: #7e7a34;">&quot;openai-community/gpt2&quot;</span></p>
<p></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">padding_side</span> <span>=</span> <span style="color: #7e7a34;">&quot;right&quot;</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We are going to add two new tokens for joke start and joke end to have more control</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">new_tokens</span> <span>=</span> <span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;&lt;SJ&gt;&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;&lt;EJ&gt;&#39;</span><span style="color: #e3e11d;">]</span>   <span style="color: #7f6e38;"># Start and end of joke tokens</span></p>
<p></p>
<p><span style="color: #6b97e8;">num_added_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">add_tokens</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">new_tokens</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Added </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">num_added_tokens</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> tokens&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>Added 2 tokens</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We create a function to add the new tokens to the sentences</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">joke_column</span> <span>=</span> <span style="color: #7e7a34;">&quot;Joke&quot;</span></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">format_joke</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">]</span> <span>=</span> <span style="color: #8d783e;">&#39;&lt;SJ&gt; &#39;</span> <span>+</span> <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;Joke&#39;</span><span style="color: #e3e11d;">]</span> <span>+</span> <span style="color: #8d783e;">&#39; &lt;EJ&gt;&#39;</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">example</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Select the columns we do not need</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">remove_columns</span> <span>=</span> <span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">column</span> <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">column</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">column_names</span> <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">column</span> <span>!=</span> <span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">remove_columns</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>['ID']</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Format the dataset and delete the columns that are not needed</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">test_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">test_dataset</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>(Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 208491</p><p> }),</p><p> Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 11583</p><p> }),</p><p> Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 11583</p><p> }))</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Now we create a function to tokenize the jokes</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">padding</span><span>=</span><span style="color: #7e7a34;">&quot;max_length&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">truncation</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_length</span><span>=</span><span style="color: #7e7a38;">768</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We tokenize the dataset and delete the column with the text</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">test_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">test_dataset</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>(Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 208491</p><p> }),</p><p> Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 11583</p><p> }),</p><p> Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 11583</p><p> }))</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Model">
						<a class="anchor-link" href="#Model">
							<p style="margin-left: 20px">Model</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Now we instantiate the model for text generation and assign the end of string token to the pading token</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We see the size of the model vocabulary</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">vocab_size</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">vocab_size</span></p>
<p><span style="color: #6b97e8;">vocab_size</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>50257</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">It has 50257 tokens, which is the size of the GPT2 vocabulary. But since we said that we were going to create two new tokens with the start of joke and the end of joke, we added them to the model</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">resize_token_embeddings</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">))</span></p>
<p></p>
<p><span style="color: #6b97e8;">new_vocab_size</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">vocab_size</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Old vocab size: </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">vocab_size</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. New vocab size: </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">new_vocab_size</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Added </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">new_vocab_size</span><span style="color: #7f6e38;"> </span><span>-</span><span style="color: #7f6e38;"> </span><span style="color: #6b97e8;">vocab_size</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> tokens&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>Old vocab size: 50257. New vocab size: 50259. Added 2 tokens</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Two new tokens have been added</p>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Training">
						<a class="anchor-link" href="#Training">
							<p style="margin-left: 20px">Training</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We configure the training parameters</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">TrainingArguments</span></p>
<p></p>
<p><span style="color: #6b97e8;">metric_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;accuracy&quot;</span></p>
<p><span style="color: #6b97e8;">model_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;GPT2-small-finetuned-Maximofn-short-jokes-dataset-casualLM&quot;</span></p>
<p><span style="color: #6b97e8;">output_dir</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;./training_results&quot;</span></p>
<p><span style="color: #6b97e8;">LR</span> <span>=</span> <span style="color: #a09e19;">2e-5</span></p>
<p><span style="color: #6b97e8;">BS_TRAIN</span> <span>=</span> <span style="color: #7e7a38;">28</span></p>
<p><span style="color: #6b97e8;">BS_EVAL</span> <span>=</span> <span style="color: #7e7a38;">32</span></p>
<p><span style="color: #6b97e8;">EPOCHS</span> <span>=</span> <span style="color: #7e7a38;">3</span></p>
<p><span style="color: #6b97e8;">WEIGHT_DECAY</span> <span>=</span> <span style="color: #a09e19;">0.01</span></p>
<p><span style="color: #6b97e8;">WARMUP_STEPS</span> <span>=</span> <span style="color: #7e7a38;">100</span></p>
<p></p>
<p><span style="color: #6b97e8;">training_args</span> <span>=</span> <span style="color: #6b97e8;">TrainingArguments</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">save_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">learning_rate</span><span>=</span><span style="color: #6b97e8;">LR</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_train_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_TRAIN</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_eval_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_EVAL</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">warmup_steps</span><span>=</span><span style="color: #6b97e8;">WARMUP_STEPS</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">num_train_epochs</span><span>=</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">weight_decay</span><span>=</span><span style="color: #6b97e8;">WEIGHT_DECAY</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">lr_scheduler_type</span><span>=</span><span style="color: #7e7a34;">&quot;cosine&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">warmup_ratio</span> <span>=</span> <span style="color: #a09e19;">0.1</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">fp16</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">load_best_model_at_end</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #7f6e38;"># metric_for_best_model=metric_name,</span></p>
<p>    <span style="color: #6b97e8;">push_to_hub</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Now we do not use <code><b>metric_for_best_model</b></code>, after defining the trainer we explain why</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We define the trainer</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">Trainer</span></p>
<p></p>
<p><span style="color: #6b97e8;">trainer</span> <span>=</span> <span style="color: #6b97e8;">Trainer</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">training_args</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">train_dataset</span><span>=</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #7f6e38;"># compute_metrics=compute_metrics,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">In this case we do not pass a <code><b>compute_metrics</b></code> function, if it is not passed, during the evaluation the <code><b>loss</b></code> will be used to evaluate the model. That is why when defining the arguments we do not define <code><b>metric_for_best_model</b></code>, because we are not going to use a metric to evaluate the model, but the <code><b>loss</b></code>.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">We train</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_text output_error">
						<pre style="margin-left: 60px; line-height: 0%;"><p><span style="color:red">---------------------------------------------------------------------------</span></p><p><span style="color:red">ValueError</span>                                Traceback (most recent call last)</p><p>Cell <span style="color:green">In[19], line 1</span></p><p><span style="color:green">----&gt; 1</span> trainer[38;5;241m.[39mtrain()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:1885</span>, in Trainer.train<span style="color:blue">(self, resume_from_checkpoint, trial, ignore_keys_for_eval, **kwargs)</span></p><p><span style="color:green"><b>   1883</b></span>         hf_hub_utils[38;5;241m.[39menable_progress_bars()</p><p><span style="color:green"><b>   1884</b></span> [38;5;28;01melse[39;00m:</p><p><span style="color:green">-&gt; 1885</span>     [38;5;28;01mreturn[39;00m inner_training_loop(</p><p><span style="color:green"><b>   1886</b></span>         args[38;5;241m=[39margs,</p><p><span style="color:green"><b>   1887</b></span>         resume_from_checkpoint[38;5;241m=[39mresume_from_checkpoint,</p><p><span style="color:green"><b>   1888</b></span>         trial[38;5;241m=[39mtrial,</p><p><span style="color:green"><b>   1889</b></span>         ignore_keys_for_eval[38;5;241m=[39mignore_keys_for_eval,</p><p><span style="color:green"><b>   1890</b></span>     )</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:2216</span>, in Trainer._inner_training_loop<span style="color:blue">(self, batch_size, args, resume_from_checkpoint, trial, ignore_keys_for_eval)</span></p><p><span style="color:green"><b>   2213</b></span>     [38;5;28mself[39m[38;5;241m.[39mcontrol [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mcallback_handler[38;5;241m.[39mon_step_begin(args, [38;5;28mself[39m[38;5;241m.[39mstate, [38;5;28mself[39m[38;5;241m.[39mcontrol)</p><p><span style="color:green"><b>   2215</b></span> [38;5;28;01mwith[39;00m [38;5;28mself[39m[38;5;241m.[39maccelerator[38;5;241m.[39maccumulate(model):</p><p><span style="color:green">-&gt; 2216</span>     tr_loss_step [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mtraining_step(model, inputs)</p><p><span style="color:green"><b>   2218</b></span> [38;5;28;01mif[39;00m (</p><p><span style="color:green"><b>   2219</b></span>     args[38;5;241m.[39mlogging_nan_inf_filter</p><p><span style="color:green"><b>   2220</b></span>     [38;5;129;01mand[39;00m [38;5;129;01mnot[39;00m is_torch_xla_available()</p><p><span style="color:green"><b>   2221</b></span>     [38;5;129;01mand[39;00m (torch[38;5;241m.[39misnan(tr_loss_step) [38;5;129;01mor[39;00m torch[38;5;241m.[39misinf(tr_loss_step))</p><p><span style="color:green"><b>   2222</b></span> ):</p><p><span style="color:green"><b>   2223</b></span>     [38;5;66;03m# if loss is nan or inf simply add the average of previous logged losses[39;00m</p><p><span style="color:green"><b>   2224</b></span>     tr_loss [38;5;241m+[39m[38;5;241m=[39m tr_loss [38;5;241m/[39m ([38;5;241m1[39m [38;5;241m+[39m [38;5;28mself[39m[38;5;241m.[39mstate[38;5;241m.[39mglobal_step [38;5;241m-[39m [38;5;28mself[39m[38;5;241m.[39m_globalstep_last_logged)</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:3238</span>, in Trainer.training_step<span style="color:blue">(self, model, inputs)</span></p><p><span style="color:green"><b>   3235</b></span>     [38;5;28;01mreturn[39;00m loss_mb[38;5;241m.[39mreduce_mean()[38;5;241m.[39mdetach()[38;5;241m.[39mto([38;5;28mself[39m[38;5;241m.[39margs[38;5;241m.[39mdevice)</p><p><span style="color:green"><b>   3237</b></span> [38;5;28;01mwith[39;00m [38;5;28mself[39m[38;5;241m.[39mcompute_loss_context_manager():</p><p><span style="color:green">-&gt; 3238</span>     loss [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mcompute_loss(model, inputs)</p><p><span style="color:green"><b>   3240</b></span> [38;5;28;01mdel[39;00m inputs</p><p><span style="color:green"><b>   3241</b></span> torch[38;5;241m.[39mcuda[38;5;241m.[39mempty_cache()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:3282</span>, in Trainer.compute_loss<span style="color:blue">(self, model, inputs, return_outputs)</span></p><p><span style="color:green"><b>   3280</b></span> [38;5;28;01melse[39;00m:</p><p><span style="color:green"><b>   3281</b></span>     [38;5;28;01mif[39;00m [38;5;28misinstance[39m(outputs, [38;5;28mdict[39m) [38;5;129;01mand[39;00m [38;5;124m"[39m[38;5;124mloss[39m[38;5;124m"[39m [38;5;129;01mnot[39;00m [38;5;129;01min[39;00m outputs:</p><p><span style="color:green">-&gt; 3282</span>         [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(</p><p><span style="color:green"><b>   3283</b></span>             [38;5;124m"[39m[38;5;124mThe model did not return a loss from the inputs, only the following keys: [39m[38;5;124m"[39m</p><p><span style="color:green"><b>   3284</b></span>             [38;5;124mf[39m[38;5;124m"[39m[38;5;132;01m{[39;00m[38;5;124m'[39m[38;5;124m,[39m[38;5;124m'[39m[38;5;241m.[39mjoin(outputs[38;5;241m.[39mkeys())[38;5;132;01m}[39;00m[38;5;124m. For reference, the inputs it received are [39m[38;5;132;01m{[39;00m[38;5;124m'[39m[38;5;124m,[39m[38;5;124m'[39m[38;5;241m.[39mjoin(inputs[38;5;241m.[39mkeys())[38;5;132;01m}[39;00m[38;5;124m.[39m[38;5;124m"[39m</p><p><span style="color:green"><b>   3285</b></span>         )</p><p><span style="color:green"><b>   3286</b></span>     [38;5;66;03m# We don't use .loss here since the model may return tuples instead of ModelOutput.[39;00m</p><p><span style="color:green"><b>   3287</b></span>     loss [38;5;241m=[39m outputs[[38;5;124m"[39m[38;5;124mloss[39m[38;5;124m"[39m] [38;5;28;01mif[39;00m [38;5;28misinstance[39m(outputs, [38;5;28mdict[39m) [38;5;28;01melse[39;00m outputs[[38;5;241m0[39m]</p><p></p><p><span style="color:red">ValueError</span>: The model did not return a loss from the inputs, only the following keys: logits,past_key_values. For reference, the inputs it received are input_ids,attention_mask.</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">As we can see, it gives us an error, it tells us that the model does not return the value of the loss, which is key to be able to train, let's see why.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">First, let's see what an example of the dataset looks like.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">idx</span> <span>=</span> <span style="color: #6b97e8;">randint</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">)</span> <span>-</span> <span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">sample</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">sample</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>{'input_ids': [50257,</p><p>  4162,</p><p>  750,</p><p>  262,</p><p>  18757,</p><p>  6451,</p><p>  2245,</p><p>  2491,</p><p>  30,</p><p>  4362,</p><p>  340,</p><p>  373,</p><p>  734,</p><p>  10032,</p><p>  13,</p><p>  220,</p><p>  50258,</p><p>  50256,</p><p>  50256,</p><p>  ...,</p><p>  50256,</p><p>  50256,</p><p>  50256],</p><p> 'attention_mask': [1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  0,</p><p>  0,</p><p>  0,</p><p>  ...,</p><p>  0,</p><p>  0,</p><p>  0]}</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">As we can see, we have a dictionary with the <code><b>input_ids</b></code> and the <code><b>attention_mask</b></code>, if we pass it to the model we obtain this</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;input_ids&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;attention_mask&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span></p>
<p><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">loss</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>None</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">As we can see it does not return the value of the loss because it is waiting for a value for <code><b>labels</b></code>, which we have not passed it. In the previous example, in which we did fine tuning for text classification, we said that the labels had to be passed to a field of the dataset called <code><b>labels</b></code>, but in this case we do not have that field in the dataset.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;"></p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">If we now assign the <code><b>lables</b></code> to the <code><b>input_ids</b></code> and look again at the <code><b>input_ids</b></code> loss</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;input_ids&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;attention_mask&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;input_ids&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">loss</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor(102.1873, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Now we get a <code><b>loss</b></code>.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;"></p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">So we have two options, add a <code><b>labels</b></code> field to the dataset, with the values of <code><b>input_ids</b></code> or use a function of the <code><b>transformers</b></code> library called <code><b>data_collator</b></code>, in this case we will use <code><b>DataCollatorForLanguageModeling</b></code>. Let's take a look at it</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">DataCollatorForLanguageModeling</span></p>
<p></p>
<p><span style="color: #6b97e8;">my_data_collator</span><span>=</span><span style="color: #6b97e8;">DataCollatorForLanguageModeling</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">mlm</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We pass the <code><b>sample</b></code> sample through this <code><b>data_collator</b></code>.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">collated_sample</span> <span>=</span> <span style="color: #6b97e8;">my_data_collator</span><span style="color: #e3e11d;">([</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We see how the output is</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">key</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">value</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">collated_sample</span><span>.</span><span style="color: #6b97e8;">items</span><span style="color: #e3e11d;">():</span></p>
<p>    <span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">key</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> (</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">value</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">): </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">value</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>input_ids (torch.Size([1, 768])): tensor([[50257,  4162,   750,   262, 18757,  6451,  2245,  2491,    30,  4362,</p><p>           340,   373,   734, 10032,    13,   220, 50258, 50256, ..., 50256, 50256]],</p><p>       device='cuda:0')</p><p>attention_mask (torch.Size([1, 768])): tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, ..., 0, 0]],</p><p>       device='cuda:0')</p><p>labels (torch.Size([1, 768])): tensor([[50257,  4162,   750,   262, 18757,  6451,  2245,  2491,    30,  4362,</p><p>           340,   373,   734, 10032,    13,   220, 50258,  -100,  ...,  -100,  -100]],</p><p>       device='cuda:0')</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">As you can see, the <code><b>data_collator</b></code> has created a <code><b>labels</b></code> field and assigned it the values of <code><b>input_ids</b></code>. The tokens that are masked have been assigned the value -100. This is because when we define the <code><b>data_collator</b></code> we pass the parameter <code><b>mlm=False</b></code>, which means that we are not doing <code><b>Masked Language Modeling</b></code>, but <code><b>Language Modeling</b></code>, that is why it does not mask any original token.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Let's see if now we get a <code><b>loss</b></code> with this <code><b>data_collator</b></code>.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span>**</span><span style="color: #6b97e8;">collated_sample</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">loss</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor(102.7181, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">So we redefine the <code><b>trainer</b></code> with the <code><b>data_collator</b></code> and we train again</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">DataCollatorForLanguageModeling</span></p>
<p></p>
<p><span style="color: #6b97e8;">trainer</span> <span>=</span> <span style="color: #6b97e8;">Trainer</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">training_args</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">train_dataset</span><span>=</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">data_collator</span><span>=</span><span style="color: #6b97e8;">DataCollatorForLanguageModeling</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">mlm</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">),</span></p>
<p><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>TrainOutput(global_step=22341, training_loss=3.505178199598342, metrics={'train_runtime': 9209.5353, 'train_samples_per_second': 67.916, 'train_steps_per_second': 2.426, 'total_flos': 2.45146666696704e+17, 'train_loss': 3.505178199598342, 'epoch': 3.0})</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Evaluation">
					<a class="anchor-link" href="#Evaluation">
						<p style="margin-left: 20px">Evaluation</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Once the model is trained we evaluate the model on the test dataset</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">evaluate</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>{'eval_loss': 3.201305866241455,</p><p> 'eval_runtime': 65.0033,</p><p> 'eval_samples_per_second': 178.191,</p><p> 'eval_steps_per_second': 5.569,</p><p> 'epoch': 3.0}</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Publish-the-model">
					<a class="anchor-link" href="#Publish-the-model">
						<p style="margin-left: 20px">Publish the model</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create the model card</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">create_model_card</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We publish it</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">push_to_hub</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>CommitInfo(commit_url='https://huggingface.co/Maximofn/GPT2-small-finetuned-Maximofn-short-jokes-dataset-casualLM/commit/d107b3bb0e02076483238f9975697761015ec390', commit_message='End of training', commit_description='', oid='d107b3bb0e02076483238f9975697761015ec390', pr_url=None, pr_revision=None, pr_num=None)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Model-use">
					<a class="anchor-link" href="#Model-use">
						<p style="margin-left: 20px">Model use</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We clean as much as possible</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">gc</span></p>
<p></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">clear_hardwares</span><span style="color: #e3e11d;">():</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">clear_autocast_cache</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">ipc_collect</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">empty_cache</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">gc</span><span>.</span><span style="color: #6b97e8;">collect</span><span style="color: #e3e11d;">()</span></p>
<p></p>
<p></p>
<p><span style="color: #6b97e8;">clear_hardwares</span><span style="color: #e3e11d;">()</span></p>
<p><span style="color: #6b97e8;">clear_hardwares</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Download the model and tokenizer</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span></p>
<p></p>
<p><span style="color: #6b97e8;">user</span> <span>=</span> <span style="color: #7e7a34;">&quot;maximofn&quot;</span></p>
<p><span style="color: #6b97e8;">checkpoints</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">user</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">/</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">model_name</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span></p>
<p></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">padding_side</span> <span>=</span> <span style="color: #7e7a34;">&quot;right&quot;</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We check that the tokenizer and the model have the 2 extra tokens we have added.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokenizer_vocab</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">get_vocab</span><span style="color: #e3e11d;">()</span></p>
<p><span style="color: #6b97e8;">model_vocab</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">vocab_size</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;tokenizer_vocab: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer_vocab</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. model_vocab: </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">model_vocab</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tokenizer_vocab: 50259. model_vocab: 50259</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We see that they have 50259 tokens, i.e., the 50257 tokens of GPT2 plus the 2 we added</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create a function to generate jokes</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">generate_joke</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">prompt_text</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">text</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;&lt;SJ&gt; </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">prompt_text</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span></p>
<p>    <span style="color: #6b97e8;">tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">text</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">with</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">no_grad</span><span style="color: #e3e11d;">():</span></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">generate</span><span style="color: #e3e11d;">(</span><span>**</span><span style="color: #6b97e8;">tokens</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_new_tokens</span><span>=</span><span style="color: #7e7a38;">256</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">eos_token_id</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">encode</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;&lt;EJ&gt;&quot;</span><span style="color: #e3e11d;">)[</span><span>-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">])</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">decode</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">skip_special_tokens</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We generate a joke</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">generate_joke</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;Why didn&#39;t the frog cross the road?&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>"&lt;SJ&gt; Why didn't the frog cross the road? Because he was frog-in-the-face. &lt;EJ&gt;"</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">If you want to test the model further you can see it in <a href="https://huggingface.co/Maximofn/GPT2-small-finetuned-Maximofn-short-jokes-dataset-casualLM" target="_blank">Maximofn/GPT2-small-finetuned-Maximofn-short-jokes-dataset-casualLM</a></p>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h2 id="Fine-tuning-for-text-classification-with-Pytorch">
					<a class="anchor-link" href="#Fine-tuning-for-text-classification-with-Pytorch">
						<p style="margin-left: 10px">Fine tuning for text classification with Pytorch</p>
					</a>
				</h2>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We repeat the Pytorch training</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Restart the notebook to make sure</p>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Dataset">
					<a class="anchor-link" href="#Dataset">
						<p style="margin-left: 20px">Dataset</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We downloaded the same dataset as when we did the training with the Hugging Face libraries.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">datasets</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load_dataset</span></p>
<p></p>
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">load_dataset</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;mteb/amazon_reviews_multi&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #7e7a34;">&quot;en&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create a variable with the number of classes</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">num_classes</span> <span>=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">unique</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">num_classes</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>5</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Before we processed the whole dataset to create a field called <code><b>labels</b></code>, but now it is not necessary because as we are going to program everything ourselves, we adapt to what the dataset looks like.</p>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Tokenizer">
					<a class="anchor-link" href="#Tokenizer">
						<p style="margin-left: 20px">Tokenizer</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create the tokenizer. We assign the padding token so that it does not give us an error as before.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span></p>
<p></p>
<p><span style="color: #6b97e8;">checkpoint</span> <span>=</span> <span style="color: #7e7a34;">&quot;openai-community/gpt2&quot;</span></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create a function for tokenizing the dataset</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;text&quot;</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">padding</span><span>=</span><span style="color: #7e7a34;">&quot;max_length&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">truncation</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_length</span><span>=</span><span style="color: #7e7a38;">768</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We tokenize it. We eliminate columns that we don't need, but now we leave the text column</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;id&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;label_text&#39;</span><span style="color: #e3e11d;">])</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['text', 'label', 'input_ids', 'attention_mask'],</p><p>        num_rows: 200000</p><p>    })</p><p>    validation: Dataset({</p><p>        features: ['text', 'label', 'input_ids', 'attention_mask'],</p><p>        num_rows: 5000</p><p>    })</p><p>    test: Dataset({</p><p>        features: ['text', 'label', 'input_ids', 'attention_mask'],</p><p>        num_rows: 5000</p><p>    })</p><p>})</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percentage</span> <span>=</span> <span style="color: #7e7a38;">1</span></p>
<p><span style="color: #6b97e8;">subset_train</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percentage</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #6b97e8;">percentage</span> <span>=</span> <span style="color: #7e7a38;">1</span></p>
<p><span style="color: #6b97e8;">subset_validation</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;validation&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;validation&#39;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percentage</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #6b97e8;">subset_test</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;test&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;test&#39;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percentage</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;len subset_train: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_train</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">, len subset_validation: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_validation</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">, len subset_test: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_test</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>len subset_train: 200000, len subset_validation: 5000, len subset_test: 5000</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Model">
					<a class="anchor-link" href="#Model">
						<p style="margin-left: 20px">Model</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We import the weights and assign the padding token</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">num_labels</span><span>=</span><span style="color: #6b97e8;">num_classes</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Some weights of GPT2ForSequenceClassification were not initialized from the model checkpoint at openai-community/gpt2 and are newly initialized: ['score.weight']</p><p>You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Device">
					<a class="anchor-link" href="#Device">
						<p style="margin-left: 20px">Device</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Create the device where everything is going to be executed</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">device</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;cuda&#39;</span> <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">is_available</span><span style="color: #e3e11d;">()</span> <span style="color: #a04cc1;">else</span> <span style="color: #8d783e;">&#39;cpu&#39;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We pass the model to the device and pass it to FP16 so that it occupies less memory.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">half</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Pytorch-Dataset">
					<a class="anchor-link" href="#Pytorch-Dataset">
						<p style="margin-left: 20px">Pytorch Dataset</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Create a pytorch dataset</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">torch.utils.data</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">Dataset</span></p>
<p></p>
<p><span style="color: #a04cc1;">class</span> <span style="color: #7f6e38;">ReviewsDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">Dataset</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__init__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">huggingface_dataset</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">huggingface_dataset</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__getitem__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #6b97e8;">label</span> <span>=</span> <span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">tensor</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">])</span></p>
<p>        <span style="color: #6b97e8;">attention_mask</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">tensor</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">])</span></p>
<p>        <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">label</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__len__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #a04cc1;">return</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Instantiate the datasets</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">ReviewsDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_train</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validatation_dataset</span> <span>=</span> <span style="color: #6b97e8;">ReviewsDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_validation</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">ReviewsDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_test</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Let's see a sample</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">label</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">label</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([768]), torch.Size([768]), 0)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Pytorch-Dataloader">
					<a class="anchor-link" href="#Pytorch-Dataloader">
						<p style="margin-left: 20px">Pytorch Dataloader</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We now create a pytorch dataloader</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">torch.utils.data</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">DataLoader</span></p>
<p></p>
<p><span style="color: #6b97e8;">BS</span> <span>=</span> <span style="color: #7e7a38;">12</span></p>
<p></p>
<p><span style="color: #6b97e8;">train_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validatation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Let's see a sample</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #dfd84a;">next</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">iter</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([12, 768]),</p><p> torch.Size([12, 768]),</p><p> tensor([2, 1, 2, 0, 3, 3, 0, 4, 3, 3, 4, 2]))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">To check that everything is OK we pass the sample to the model to see if everything is OK. First we pass the tokens to the device</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">at_mask</span> <span>=</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #6b97e8;">labels</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Now we pass them to the model</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">keys</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>odict_keys(['loss', 'logits', 'past_key_values'])</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">As we can see it gives us the loss and the logits</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor(5.9414, device='cuda:0', dtype=torch.float16,</p><p>       grad_fn=&lt;NllLossBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">]</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor([[ 6.1953e+00, -1.2275e+00, -2.4824e+00,  5.8867e+00, -1.4734e+01],</p><p>        [ 5.4062e+00, -8.4570e-01, -2.3203e+00,  5.1055e+00, -1.1555e+01],</p><p>        [ 6.1641e+00, -9.3066e-01, -2.5664e+00,  6.0039e+00, -1.4570e+01],</p><p>        [ 5.2266e+00, -4.2358e-01, -2.0801e+00,  4.7461e+00, -1.1570e+01],</p><p>        [ 3.8184e+00, -2.3460e-03, -1.7666e+00,  3.4160e+00, -7.7969e+00],</p><p>        [ 4.1641e+00, -4.8169e-01, -1.6914e+00,  3.9941e+00, -8.7734e+00],</p><p>        [ 4.6758e+00, -3.0298e-01, -2.1641e+00,  4.1055e+00, -9.3359e+00],</p><p>        [ 4.1953e+00, -3.2471e-01, -2.1875e+00,  3.9375e+00, -8.3438e+00],</p><p>        [-1.1650e+00,  1.3564e+00, -6.2158e-01, -6.8115e-01,  4.8672e+00],</p><p>        [ 4.4961e+00, -8.7891e-02, -2.2793e+00,  4.2812e+00, -9.3359e+00],</p><p>        [ 4.9336e+00, -2.6627e-03, -2.1543e+00,  4.3711e+00, -1.0742e+01],</p><p>        [ 5.9727e+00, -4.3152e-02, -1.4551e+00,  4.3438e+00, -1.2117e+01]],</p><p>       device='cuda:0', dtype=torch.float16, grad_fn=&lt;IndexBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Metric">
					<a class="anchor-link" href="#Metric">
						<p style="margin-left: 20px">Metric</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We are going to create a function to obtain the metric, which in this case is going to be the accuracy</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">predicted_labels</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">percent</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">softmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">dim</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">predictions</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">argmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">percent</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">dim</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">predictions</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">compute_accuracy</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">predictions</span> <span>=</span> <span style="color: #6b97e8;">predicted_labels</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">correct</span> <span>=</span> <span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">predictions</span> <span>==</span> <span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">float</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">correct</span><span>.</span><span style="color: #6b97e8;">mean</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Let's see how well it calculates</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">compute_accuracy</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>0.1666666716337204</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Optimizer">
					<a class="anchor-link" href="#Optimizer">
						<p style="margin-left: 20px">Optimizer</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">As we are going to need an optimizer, we create one</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AdamW</span></p>
<p></p>
<p><span style="color: #6b97e8;">LR</span> <span>=</span> <span style="color: #a09e19;">2e-5</span></p>
<p><span style="color: #6b97e8;">optimizer</span> <span>=</span> <span style="color: #6b97e8;">AdamW</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">parameters</span><span style="color: #e3e11d;">(),</span> <span style="color: #6b97e8;">lr</span><span>=</span><span style="color: #6b97e8;">LR</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>/usr/local/lib/python3.10/dist-packages/transformers/optimization.py:588: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning</p><p>  warnings.warn(</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Training">
					<a class="anchor-link" href="#Training">
						<p style="margin-left: 20px">Training</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create the training loop</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">tqdm</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">tqdm</span></p>
<p></p>
<p><span style="color: #6b97e8;">EPOCHS</span> <span>=</span> <span style="color: #7e7a38;">3</span></p>
<p></p>
<p><span style="color: #6b97e8;">accuracy</span> <span>=</span> <span style="color: #7e7a38;">0</span></p>
<p></p>
<p><span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">epoch</span> <span style="color: #7f6e38;">in</span> <span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">train_loss</span> <span>=</span> <span style="color: #7e7a38;">0</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span> <span>=</span> <span style="color: #6b97e8;">tqdm</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">total</span><span>=</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">desc</span><span>=</span><span style="color: #1b1477;">f</span><span style="color: #8d783e;">&#39;Epoch </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">epoch</span><span style="color: #7f6e38;"> </span><span>+</span><span style="color: #7f6e38;"> </span><span style="color: #7e7a38;">1</span><span style="color: #3b75c2;">}</span><span style="color: #8d783e;">&#39;</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">progresbar</span><span style="color: #e3e11d;">:</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">at_mask</span> <span>=</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">label</span> <span>=</span> <span style="color: #6b97e8;">labels</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">label</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">loss</span> <span>=</span> <span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>        <span style="color: #6b97e8;">train_loss</span> <span>+=</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">optimizer</span><span>.</span><span style="color: #6b97e8;">zero_grad</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">backward</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">optimizer</span><span>.</span><span style="color: #6b97e8;">step</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;train_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()})</span></p>
<p>    <span style="color: #6b97e8;">train_loss</span> <span>/=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;train_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">train_loss</span><span style="color: #e3e11d;">})</span></p>
<p></p>
<p>    <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">eval</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">valid_loss</span> <span>=</span> <span style="color: #7e7a38;">0</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span> <span>=</span> <span style="color: #6b97e8;">tqdm</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_loader</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">total</span><span>=</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_loader</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">desc</span><span>=</span><span style="color: #1b1477;">f</span><span style="color: #8d783e;">&#39;Epoch </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">epoch</span><span style="color: #7f6e38;"> </span><span>+</span><span style="color: #7f6e38;"> </span><span style="color: #7e7a38;">1</span><span style="color: #3b75c2;">}</span><span style="color: #8d783e;">&#39;</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">progresbar</span><span style="color: #e3e11d;">:</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">at_mask</span> <span>=</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #6b97e8;">labels</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">loss</span> <span>=</span> <span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>        <span style="color: #6b97e8;">valid_loss</span> <span>+=</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">step_accuracy</span> <span>=</span> <span style="color: #6b97e8;">compute_accuracy</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">accuracy</span> <span>+=</span> <span style="color: #6b97e8;">step_accuracy</span></p>
<p>        <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;valid_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">(),</span> <span style="color: #8d783e;">&#39;accuracy&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">step_accuracy</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()})</span></p>
<p></p>
<p>    <span style="color: #6b97e8;">valid_loss</span> <span>/=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_loader</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">accuracy</span> <span>/=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_loader</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;valid_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">valid_loss</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;accuracy&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">accuracy</span><span style="color: #e3e11d;">})</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Epoch 1: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 16667/16667 [44:13&lt;00:00,  6.28it/s, train_loss=nan]</p><p>Epoch 1: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 417/417 [00:32&lt;00:00, 12.72it/s, valid_loss=nan, accuracy=0]</p><p>Epoch 2: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 16667/16667 [44:06&lt;00:00,  6.30it/s, train_loss=nan]</p><p>Epoch 2: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 417/417 [00:32&lt;00:00, 12.77it/s, valid_loss=nan, accuracy=0]</p><p>Epoch 3: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 16667/16667 [44:03&lt;00:00,  6.30it/s, train_loss=nan]</p><p>Epoch 3: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 417/417 [00:32&lt;00:00, 12.86it/s, valid_loss=nan, accuracy=0]</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Model-use">
					<a class="anchor-link" href="#Model-use">
						<p style="margin-left: 20px">Model use</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Let's test the model we have trained</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">First we tokenize a text</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">({</span><span style="color: #7e7a34;">&quot;text&quot;</span><span style="color: #e3e11d;">:</span> <span style="color: #7e7a34;">&quot;I love this product. It is amazing.&quot;</span><span style="color: #e3e11d;">})</span></p>
<p><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">shape</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([1, 768]), torch.Size([1, 768]))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Now we pass it to the model</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">]</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor([[nan, nan, nan, nan, nan]], device='cuda:0', dtype=torch.float16,</p><p>       grad_fn=&lt;IndexBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We see the predictions of these logits</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">predicted</span> <span>=</span> <span style="color: #6b97e8;">predicted_labels</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">predicted</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor([0], device='cuda:0')</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h2 id="Fine-tuning-for-text-generation-with-Pytorch">
					<a class="anchor-link" href="#Fine-tuning-for-text-generation-with-Pytorch">
						<p style="margin-left: 10px">Fine tuning for text generation with Pytorch</p>
					</a>
				</h2>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We repeat the Pytorch training</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Restart the notebook to make sure</p>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Dataset">
					<a class="anchor-link" href="#Dataset">
						<p style="margin-left: 20px">Dataset</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We download again the dataset of jokes</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">datasets</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load_dataset</span></p>
<p></p>
<p><span style="color: #6b97e8;">jokes</span> <span>=</span> <span style="color: #6b97e8;">load_dataset</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;Maximofn/short-jokes-dataset&quot;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">jokes</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['ID', 'Joke'],</p><p>        num_rows: 231657</p><p>    })</p><p>})</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Create a subset in case you are short on memory</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percent_of_train_dataset</span> <span>=</span> <span style="color: #7e7a38;">1</span>    <span style="color: #7f6e38;"># If you want 50% of the dataset, set this to 0.5</span></p>
<p></p>
<p><span style="color: #6b97e8;">subset_dataset</span> <span>=</span> <span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percent_of_train_dataset</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #6b97e8;">subset_dataset</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Dataset({</p><p>    features: ['ID', 'Joke'],</p><p>    num_rows: 231657</p><p>})</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We divide the dataset into subsets for training, validation and test.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percent_of_train_dataset</span> <span>=</span> <span style="color: #a09e19;">0.90</span></p>
<p></p>
<p><span style="color: #6b97e8;">split_dataset</span> <span>=</span> <span style="color: #6b97e8;">subset_dataset</span><span>.</span><span style="color: #6b97e8;">train_test_split</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_size</span><span>=</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_dataset</span><span>.</span><span style="color: #6b97e8;">num_rows</span> <span>*</span> <span style="color: #6b97e8;">percent_of_train_dataset</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">19</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">validation_test_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;test&quot;</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #6b97e8;">split_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_test_dataset</span><span>.</span><span style="color: #6b97e8;">train_test_split</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_size</span><span>=</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_test_dataset</span><span>.</span><span style="color: #6b97e8;">num_rows</span> <span>*</span> <span style="color: #a09e19;">0.5</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">19</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;test&quot;</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Size of the train set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Size of the validation set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Size of the test set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Size of the train set: 208491. Size of the validation set: 11583. Size of the test set: 11583</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Tokenizer">
					<a class="anchor-link" href="#Tokenizer">
						<p style="margin-left: 20px">Tokenizer</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We start the tokenizer and assign the end of string token to the padding token</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span></p>
<p></p>
<p><span style="color: #6b97e8;">checkpoints</span> <span>=</span> <span style="color: #7e7a34;">&quot;openai-community/gpt2&quot;</span></p>
<p></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">padding_side</span> <span>=</span> <span style="color: #7e7a34;">&quot;right&quot;</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We add the special tokens for the beginning and end of the joke.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">new_tokens</span> <span>=</span> <span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;&lt;SJ&gt;&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;&lt;EJ&gt;&#39;</span><span style="color: #e3e11d;">]</span>   <span style="color: #7f6e38;"># Start and end of joke tokens</span></p>
<p></p>
<p><span style="color: #6b97e8;">num_added_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">add_tokens</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">new_tokens</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Added </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">num_added_tokens</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> tokens&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Added 2 tokens</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We add them to the dataset</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">joke_column</span> <span>=</span> <span style="color: #7e7a34;">&quot;Joke&quot;</span></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">format_joke</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">]</span> <span>=</span> <span style="color: #8d783e;">&#39;&lt;SJ&gt; &#39;</span> <span>+</span> <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;Joke&#39;</span><span style="color: #e3e11d;">]</span> <span>+</span> <span style="color: #8d783e;">&#39; &lt;EJ&gt;&#39;</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">example</span></p>
<p></p>
<p><span style="color: #6b97e8;">remove_columns</span> <span>=</span> <span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">column</span> <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">column</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">column_names</span> <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">column</span> <span>!=</span> <span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">test_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">test_dataset</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 208491</p><p> }),</p><p> Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 11583</p><p> }),</p><p> Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 11583</p><p> }))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We tokenize the dataset</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">padding</span><span>=</span><span style="color: #7e7a34;">&quot;max_length&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">truncation</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_length</span><span>=</span><span style="color: #7e7a38;">768</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">test_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">test_dataset</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 208491</p><p> }),</p><p> Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 11583</p><p> }),</p><p> Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 11583</p><p> }))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Model">
					<a class="anchor-link" href="#Model">
						<p style="margin-left: 20px">Model</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Instantiate the model, assign the padding token and add the new joke start and joke end tokens.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">resize_token_embeddings</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">))</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Embedding(50259, 768)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Device">
					<a class="anchor-link" href="#Device">
						<p style="margin-left: 20px">Device</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create the device and pass the model to the device</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">device</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;cuda&#39;</span> <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">is_available</span><span style="color: #e3e11d;">()</span> <span style="color: #a04cc1;">else</span> <span style="color: #8d783e;">&#39;cpu&#39;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">half</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Pytorch-Dataset">
					<a class="anchor-link" href="#Pytorch-Dataset">
						<p style="margin-left: 20px">Pytorch Dataset</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Create a pytorch dataset</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">torch.utils.data</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">Dataset</span></p>
<p></p>
<p><span style="color: #a04cc1;">class</span> <span style="color: #7f6e38;">JokesDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">Dataset</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__init__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">huggingface_dataset</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">huggingface_dataset</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__getitem__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">tensor</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">])</span></p>
<p>        <span style="color: #6b97e8;">attention_mask</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">tensor</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">])</span></p>
<p>        <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__len__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #a04cc1;">return</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Instantiate training, validation and test datasets</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">train_pytorch_dataset</span> <span>=</span> <span style="color: #6b97e8;">JokesDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_pytorch_dataset</span> <span>=</span> <span style="color: #6b97e8;">JokesDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_pytorch_dataset</span> <span>=</span> <span style="color: #6b97e8;">JokesDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Let's see a sample</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span> <span>=</span> <span style="color: #6b97e8;">train_pytorch_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>.</span><span style="color: #6b97e8;">shape</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([768]), torch.Size([768]))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Pytorch-Dataloader">
					<a class="anchor-link" href="#Pytorch-Dataloader">
						<p style="margin-left: 20px">Pytorch Dataloader</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create the dataloaders</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">torch.utils.data</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">DataLoader</span></p>
<p></p>
<p><span style="color: #6b97e8;">BS</span> <span>=</span> <span style="color: #7e7a38;">28</span></p>
<p></p>
<p><span style="color: #6b97e8;">train_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_pytorch_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_pytorch_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_pytorch_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We see a sample</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span> <span>=</span> <span style="color: #dfd84a;">next</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">iter</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>.</span><span style="color: #6b97e8;">shape</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([28, 768]), torch.Size([28, 768]))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We pass it to the model</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">attention_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">keys</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>odict_keys(['logits', 'past_key_values'])</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">As we can see we have no <code><b>loss</b></code> value, as we have seen we have to pass the <code><b>input_ids</b></code> and the <code><b>labels</b></code>.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">attention_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">keys</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>odict_keys(['loss', 'logits', 'past_key_values'])</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Now we have <code><b>loss</b></code>.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>80.5625</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Optimizer">
					<a class="anchor-link" href="#Optimizer">
						<p style="margin-left: 20px">Optimizer</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create an optimizer</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AdamW</span></p>
<p></p>
<p><span style="color: #6b97e8;">LR</span> <span>=</span> <span style="color: #a09e19;">2e-5</span></p>
<p><span style="color: #6b97e8;">optimizer</span> <span>=</span> <span style="color: #6b97e8;">AdamW</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">parameters</span><span style="color: #e3e11d;">(),</span> <span style="color: #6b97e8;">lr</span><span>=</span><span style="color: #a09e19;">5e-5</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>/usr/local/lib/python3.10/dist-packages/transformers/optimization.py:588: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning</p><p>  warnings.warn(</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Training">
					<a class="anchor-link" href="#Training">
						<p style="margin-left: 20px">Training</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We create the training loop</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">tqdm</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">tqdm</span></p>
<p></p>
<p><span style="color: #6b97e8;">EPOCHS</span> <span>=</span> <span style="color: #7e7a38;">3</span></p>
<p></p>
<p><span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">epoch</span> <span style="color: #7f6e38;">in</span> <span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">train_loss</span> <span>=</span> <span style="color: #7e7a38;">0</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span> <span>=</span> <span style="color: #6b97e8;">tqdm</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">total</span><span>=</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">desc</span><span>=</span><span style="color: #1b1477;">f</span><span style="color: #8d783e;">&#39;Epoch </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">epoch</span><span style="color: #7f6e38;"> </span><span>+</span><span style="color: #7f6e38;"> </span><span style="color: #7e7a38;">1</span><span style="color: #3b75c2;">}</span><span style="color: #8d783e;">&#39;</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">progresbar</span><span style="color: #e3e11d;">:</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">at_mask</span> <span>=</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">loss</span> <span>=</span> <span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>        <span style="color: #6b97e8;">train_loss</span> <span>+=</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">optimizer</span><span>.</span><span style="color: #6b97e8;">zero_grad</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">backward</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">optimizer</span><span>.</span><span style="color: #6b97e8;">step</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;train_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()})</span></p>
<p>    <span style="color: #6b97e8;">train_loss</span> <span>/=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;train_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">train_loss</span><span style="color: #e3e11d;">})</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Epoch 1: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7447/7447 [51:07&lt;00:00,  2.43it/s, train_loss=nan]</p><p>Epoch 2: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7447/7447 [51:06&lt;00:00,  2.43it/s, train_loss=nan]</p><p>Epoch 3: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7447/7447 [51:07&lt;00:00,  2.43it/s, train_loss=nan]</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Model-use">
					<a class="anchor-link" href="#Model-use">
						<p style="margin-left: 20px">Model use</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">We tested the model</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">generate_text</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">decoded_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_new_tokens</span><span>=</span><span style="color: #7e7a38;">100</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">stop_token</span><span>=</span><span style="color: #8d783e;">&#39;&lt;EJ&gt;&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_k</span><span>=</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">temperature</span><span>=</span><span style="color: #a09e19;">1.0</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">input_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;Joke&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">decoded_joke</span><span style="color: #e3e11d;">})</span></p>
<p>    <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p>    <span style="color: #6b97e8;">nex_token</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">argmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">][:,</span> <span>-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">,</span> <span style="color: #e3e11d;">:],</span> <span style="color: #6b97e8;">dim</span><span>=-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">nex_token_decoded</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">decode</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">nex_token</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">decoded_joke</span> <span>=</span> <span style="color: #6b97e8;">decoded_joke</span> <span>+</span> <span style="color: #6b97e8;">nex_token_decoded</span></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">_</span> <span style="color: #7f6e38;">in</span> <span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">max_new_tokens</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #6b97e8;">nex_token</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">argmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">][:,</span> <span>-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">,</span> <span style="color: #e3e11d;">:],</span> <span style="color: #6b97e8;">dim</span><span>=-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">nex_token_decoded</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">decode</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">nex_token</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">nex_token_decoded</span> <span>==</span> <span style="color: #6b97e8;">stop_token</span><span style="color: #e3e11d;">:</span></p>
<p>            <span style="color: #a04cc1;">break</span></p>
<p>        <span style="color: #6b97e8;">decoded_joke</span> <span>=</span> <span style="color: #6b97e8;">decoded_joke</span> <span>+</span> <span style="color: #6b97e8;">nex_token_decoded</span></p>
<p>        <span style="color: #6b97e8;">input_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;Joke&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">decoded_joke</span><span style="color: #e3e11d;">})</span></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">decoded_joke</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">generated_text</span> <span>=</span> <span style="color: #6b97e8;">generate_text</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;&lt;SJ&gt; Why didn&#39;t the frog cross the road&quot;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">generated_text</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>"&lt;SJ&gt; Why didn't the frog cross the road!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
<!-- Close class contenido -->
</div>
<!-- Close div notebook container -->
</div>
<!-- Close div notebook -->
</div>
