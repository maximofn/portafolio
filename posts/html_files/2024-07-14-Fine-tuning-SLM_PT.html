<p>
	<!-- Custom stylesheet, it must be in the same directory as the html file -->
	<!-- Loading mathjax macro --><!-- Load mathjax --><!-- MathJax configuration -->
<p>
<style>
	/* Media query para pantallas grandes */
	@media screen and (min-width: 1000px) {
		.container {
			flex-wrap: nowrap;
			display: flex;
			justify-content: space-between;
			height: 100vh; /* altura del viewport */
		}
		
		.indice {
			width: 25%; /* Ancho del índice en pantallas grandes */
			border-right: 1px solid #ccc;
			max-height: calc(100vh - 40px); /* Ajustar según tus necesidades. Aquí estamos restando el doble del padding para mantener todo visible */
			padding: 20px;
			box-sizing: border-box;
			overflow-y: auto; /* desplazamiento vertical cuando sea necesario */
		}
		
		.contenido {
			width: 70%; /* Ancho del contenido en pantallas grandes */
			max-height: calc(100vh - 40px); /* Ajustar según tus necesidades. Aquí estamos restando el doble del padding para mantener todo visible */
			padding: 20px;
			box-sizing: border-box;
			overflow-y: auto; /* desplazamiento vertical cuando sea necesario */
		}
	}
</style>
<!-- Open div notebook -->
<div id="notebook" class="border-box-sizing" tabindex="-1">
	<!-- Open div notebook container -->
	<div id="notebook-container" class="container">
		<!-- Open div indice -->
		<div class="indice">
			<!-- Open div index header -->
			<div class="cell border-box-sizing text_cell rendered">
				<h2 class="prompt input_prompt">
					<span style="
					color: var(--darkreader-text--heading-color, var(--darkreader-text--heading-2-color,
					var(--darkreader-text--headings-color)));
					font-family: var(--fontFamily); font-size: var(--fontSize);
					font-style: var(--fontStyle, inherit);
					font-weight: var(--fontWeight);
					letter-spacing: var(--letterSpacing);
					text-transform: var(--textTransform);
					background-color: transparent;
					--darkreader-inline-color: var(--darkreader-text--darkreader-text--heading-color,
					var(--darkreader-text--darkreader-text--heading-2-color, var(--darkreader-text--darkreader-text--headings-color)));
					--darkreader-inline-bgcolor: transparent;"
					data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">
						Índice
					</span>
					<a class="anchor-link" style="
					font-family: var(--fontFamily);
					font-size: var(--fontSize);
					font-style: var(--fontStyle, inherit);
					font-weight: var(--fontWeight);
					letter-spacing: var(--letterSpacing);
					text-transform: var(--textTransform);
					background-color: transparent;
					--darkreader-inline-bgcolor: transparent;"
					href="#Índice" data-darkreader-inline-bgcolor="">
					</a>
				</h2>
			<!-- Close div index header -->
			</div>
			<!-- Index body -->
			<div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Login-index">
									<a class="anchor-link" href="#Login">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Login</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Conjunto-de-dados-index">
									<a class="anchor-link" href="#Conjunto-de-dados">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Conjunto de dados</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Tokeniser-index">
									<a class="anchor-link" href="#Tokeniser">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Tokeniser</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Modelo-index">
									<a class="anchor-link" href="#Modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Treinador-index">
									<a class="anchor-link" href="#Treinador">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Treinador</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Avaliação-index">
									<a class="anchor-link" href="#Avaliação">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Avaliação</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Publicar-o-modelo-index">
									<a class="anchor-link" href="#Publicar-o-modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Publicar o modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Uso-do-modelo-index">
									<a class="anchor-link" href="#Uso-do-modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Uso do modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Ajuste-fino-para-geração-de-texto-com-o-Hugging-Face-index">
									<a class="anchor-link" href="#Ajuste-fino-para-geração-de-texto-com-o-Hugging-Face">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Ajuste fino para geração de texto com o Hugging Face</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Login-index">
									<a class="anchor-link" href="#Login">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Login</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Conjunto-de-dados-index">
									<a class="anchor-link" href="#Conjunto-de-dados">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Conjunto de dados</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Tokeniser-index">
									<a class="anchor-link" href="#Tokeniser">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Tokeniser</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Modelo-index">
									<a class="anchor-link" href="#Modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Treinamento-index">
									<a class="anchor-link" href="#Treinamento">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Treinamento</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Avaliação-index">
									<a class="anchor-link" href="#Avaliação">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Avaliação</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Publicar-o-modelo-index">
									<a class="anchor-link" href="#Publicar-o-modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Publicar o modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Uso-do-modelo-index">
									<a class="anchor-link" href="#Uso-do-modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Uso do modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Ajuste-fino-para-classificação-de-texto-com-o-Pytorch-index">
									<a class="anchor-link" href="#Ajuste-fino-para-classificação-de-texto-com-o-Pytorch">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Ajuste fino para classificação de texto com o Pytorch</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Conjunto-de-dados-index">
									<a class="anchor-link" href="#Conjunto-de-dados">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Conjunto de dados</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Tokeniser-index">
									<a class="anchor-link" href="#Tokeniser">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Tokeniser</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Modelo-index">
									<a class="anchor-link" href="#Modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Dispositivo-index">
									<a class="anchor-link" href="#Dispositivo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Dispositivo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Conjunto-de-dados-Pytorch-index">
									<a class="anchor-link" href="#Conjunto-de-dados-Pytorch">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Conjunto de dados Pytorch</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Carregador-de-dados-Pytorch-index">
									<a class="anchor-link" href="#Carregador-de-dados-Pytorch">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Carregador de dados Pytorch</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Métrica-index">
									<a class="anchor-link" href="#Métrica">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Métrica</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Otimizador-index">
									<a class="anchor-link" href="#Otimizador">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Otimizador</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Treinamento-index">
									<a class="anchor-link" href="#Treinamento">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Treinamento</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Uso-do-modelo-index">
									<a class="anchor-link" href="#Uso-do-modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Uso do modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h2 id="Ajuste-fino-para-geração-de-texto-com-o-Pytorch-index">
									<a class="anchor-link" href="#Ajuste-fino-para-geração-de-texto-com-o-Pytorch">
										<p style="margin-left: 0px; font-size: 12px; line-height: 1.5;">Ajuste fino para geração de texto com o Pytorch</p>
									</a>
								</h2>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Conjunto-de-dados-index">
									<a class="anchor-link" href="#Conjunto-de-dados">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Conjunto de dados</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Tokeniser-index">
									<a class="anchor-link" href="#Tokeniser">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Tokeniser</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Modelo-index">
									<a class="anchor-link" href="#Modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Dispositivo-index">
									<a class="anchor-link" href="#Dispositivo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Dispositivo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Conjunto-de-dados-Pytorch-index">
									<a class="anchor-link" href="#Conjunto-de-dados-Pytorch">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Conjunto de dados Pytorch</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Carregador-de-dados-Pytorch-index">
									<a class="anchor-link" href="#Carregador-de-dados-Pytorch">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Carregador de dados Pytorch</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Otimizador-index">
									<a class="anchor-link" href="#Otimizador">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Otimizador</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Treinamento-index">
									<a class="anchor-link" href="#Treinamento">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Treinamento</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Open div header -->
				<div class="cell border-box-sizing text_cell rendered">
					<div class="prompt input_prompt">
						<div class="inner_cell">
							<div class="text_cell_render border-box-sizing rendered_html">
								<h3 id="Uso-do-modelo-index">
									<a class="anchor-link" href="#Uso-do-modelo">
										<p style="margin-left: 40px; font-size: 12px; line-height: 1.5;">Uso do modelo</p>
									</a>
								</h3>
							</div>
						</div>
					</div>
				</div>
			</div>
		<!-- Close div indice -->
		</div>
 
		<!-- Content -->
		<div class="contenido">
		<div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><a href="https://colab.research.google.com/github/maximofn/portafolio/blob/main/posts/notebooks_translated/2024-07-14-Fine-tuning-SLM_PT.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h1 id="Ajuste-fino-de-SMLs-com-Hugging-Face">
								<a class="anchor-link" href="#Ajuste-fino-de-SMLs-com-Hugging-Face">
									<p style="margin-left: 0px">Ajuste fino de SMLs com Hugging Face</p>
								</a>
							</h1>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Nesta postagem, veremos como ajustar modelos de linguagem pequenos, como ajustar a classificação de texto e a geração de texto. Primeiro, veremos como fazer isso com as bibliotecas da Hugging Face, já que a Hugging Face se tornou um participante muito importante no ecossistema de IA atualmente.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Mas, embora as bibliotecas do Hugging Face sejam muito importantes e úteis, é muito importante saber como o treinamento é realmente feito e o que está acontecendo por trás dele, portanto, vamos repetir o treinamento para classificação e geração de texto, mas com o Pytorch.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Este caderno foi traduzido automaticamente para torná-lo acessível a mais pessoas, por favor me avise se você vir algum erro de digitação..</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">## Ajuste fino para classificação de texto com o Hugging Face</p>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h3 id="Login">
								<a class="anchor-link" href="#Login">
									<p style="margin-left: 20px">Login</p>
								</a>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Para fazer upload do resultado do treinamento no hub, primeiro precisamos fazer login e, para isso, precisamos de um token.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Para criar um token, acesse a página <a href="https://huggingface.co/settings/tokens" target="_blank">setings/tokens</a> de sua conta, que terá a seguinte aparência</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">User-Access-Token-dark](http://maximofn.com/wp-content/uploads/2024/03/User-Access-Token-dark.png)</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Clique em <code><b>New token</b></code> e será exibida uma janela para criar um novo token.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2024/03/new-token-dark.png" alt="new-token-dark"></p></p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Nomeamos o token e o criamos com a função <code><b>write</b></code> ou com a função <code><b>Fine-grained</b></code>, que nos permite selecionar exatamente quais permissões o token terá.</p>
						</div>
					</div>
				</div>
			</div>
	
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Depois de criado, copiamos e colamos o arquivo abaixo</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">huggingface_hub</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">notebook_login</span></p>
<p><span style="color: #6b97e8;">notebook_login</span><span style="color: #e3e11d;">()</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h3 id="Conjunto-de-dados">
								<a class="anchor-link" href="#Conjunto-de-dados">
									<p style="margin-left: 20px">Conjunto de dados</p>
								</a>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Agora, faremos o download de um conjunto de dados. Neste caso, faremos o download de um conjunto de dados de avaliações da <a href="https://huggingface.co/datasets/mteb/amazon_reviews_multi" target="_blank">Amazon</a></p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">datasets</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load_dataset</span></p>
<p></p>
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">load_dataset</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;mteb/amazon_reviews_multi&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #7e7a34;">&quot;en&quot;</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Vamos dar uma olhada nisso</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text'],</p><p>        num_rows: 200000</p><p>    })</p><p>    validation: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text'],</p><p>        num_rows: 5000</p><p>    })</p><p>    test: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text'],</p><p>        num_rows: 5000</p><p>    })</p><p>})</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Vemos que você tem um conjunto de treinamento com 200.000 amostras, um conjunto de validação com 5.000 amostras e um conjunto de teste com 5.000 amostras.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Vamos dar uma olhada em um exemplo do conjunto de treinamento</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">random</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">randint</span></p>
<p></p>
<p><span style="color: #6b97e8;">idx</span> <span>=</span> <span style="color: #6b97e8;">randint</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">])</span> <span>-</span> <span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">]</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>{'id': 'en_0907914',</p><p> 'text': 'Mixed with fir it’s passable\n\nNot the scent I had hoped for . Love the scent of cedar, but this one missed',</p><p> 'label': 3,</p><p> 'label_text': '3'}</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Vemos que você tem a avaliação no campo <code><b>text</b></code> e a pontuação dada pelo usuário no campo <code><b>label</b></code>.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Como vamos criar um modelo de classificação de texto, precisamos saber quantas classes teremos.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">num_classes</span> <span>=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">unique</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">num_classes</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>5</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Teremos 5 classes, agora vamos ver o valor mínimo dessas classes para saber se a pontuação começa em 0 ou 1. Para isso, usamos o método <code><b>unique</b></code></p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span><span>.</span><span style="color: #6b97e8;">unique</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>{'train': [0, 1, 2, 3, 4],</p><p> 'validation': [0, 1, 2, 3, 4],</p><p> 'test': [0, 1, 2, 3, 4]}</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">O valor mínimo será 0</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Para o treinamento, os rótulos precisam estar em um campo chamado <code><b>labels</b></code>, enquanto em nosso conjunto de dados eles estão em um campo chamado <code><b>label</b></code>, portanto, criamos o novo campo <code><b>lables</b></code> com o mesmo valor de <code><b>label</b></code>.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Criamos uma função que faz o que queremos</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">set_labels</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;labels&#39;</span><span style="color: #e3e11d;">]</span> <span>=</span> <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">example</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Aplicamos a função ao conjunto de dados</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">set_labels</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Vejamos como é o conjunto de dados</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">]</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_stream output_stdout output_text">
								<pre style="margin-left: 60px; line-height: 0%;"><p>{'id': 'en_0907914',</p><p> 'text': 'Mixed with fir it’s passable\n\nNot the scent I had hoped for . Love the scent of cedar, but this one missed',</p><p> 'label': 3,</p><p> 'label_text': '3',</p><p> 'labels': 3}</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Open div header -->
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<h3 id="Tokeniser">
								<a class="anchor-link" href="#Tokeniser">
									<p style="margin-left: 20px">Tokeniser</p>
								</a>
							</h3>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Como temos revisões de texto no conjunto de dados, precisamos tokenizá-las para colocar os tokens no modelo.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span></p>
<p></p>
<p><span style="color: #6b97e8;">checkpoint</span> <span>=</span> <span style="color: #7e7a34;">&quot;openai-community/gpt2&quot;</span></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Agora criamos uma função para tokenizar o texto. Vamos fazer com que todas as frases tenham o mesmo comprimento, de modo que o tokenizador truncará quando necessário e adicionará tokens de preenchimento quando necessário. Também pedimos que ele retorne tensores pytorch.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">O comprimento de cada frase é de 768 tokens porque estamos usando o modelo GPT2 pequeno, que, como vimos na postagem <a href="https://maximofn.com/gpt2/#Arquitectura" target="_blank">GPT2</a>, tem uma dimensão de incorporação de 768 tokens.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;text&quot;</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">padding</span><span>=</span><span style="color: #7e7a34;">&quot;max_length&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">truncation</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_length</span><span>=</span><span style="color: #7e7a38;">768</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
			<div class="cell border-box-sizing text_cell rendered">
				<div class="prompt input_prompt">
					<div class="inner_cell">
						<div class="text_cell_render border-box-sizing rendered_html">
							<p style="margin-left: 0px;">Vamos tentar tokenizar um texto</p>
						</div>
					</div>
				</div>
			</div>
			<div class="cell border-box-sizing code_cell rendered">
				<div class="input">
					<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
					<div class="inner_cell">
						<div class="input_area">
							<div class=" highlight hl-python3">
								<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">])</span></p>
								</pre>
							</div>
						</div>
					</div>
				</div>
				<div class="output_wrapper">
					<div class="output">
						<div class="output_area">
							<div class="prompt" style="margin-left: 20px;">Output:</div>
							<div class="output_subarea output_text output_error">
								<pre style="margin-left: 60px; line-height: 0%;"><p><span style="color:red">---------------------------------------------------------------------------</span></p><p><span style="color:red">ValueError</span>                                Traceback (most recent call last)</p><p>Cell <span style="color:green">In[11], line 1</span></p><p><span style="color:green">----&gt; 1</span> tokens [38;5;241m=[39m tokenize_function(dataset[[38;5;124m'[39m[38;5;124mtrain[39m[38;5;124m'[39m][idx])</p><p></p><p>Cell <span style="color:green">In[10], line 2</span>, in tokenize_function<span style="color:blue">(examples)</span></p><p><span style="color:green"><b>      1</b></span> [38;5;28;01mdef[39;00m [38;5;21mtokenize_function[39m(examples):</p><p><span style="color:green">----&gt; 2</span>     [38;5;28;01mreturn[39;00m tokenizer(examples[[38;5;124m"[39m[38;5;124mtext[39m[38;5;124m"[39m], padding[38;5;241m=[39m[38;5;124m"[39m[38;5;124mmax_length[39m[38;5;124m"[39m, truncation[38;5;241m=[39m[38;5;28;01mTrue[39;00m, max_length[38;5;241m=[39m[38;5;241m768[39m, return_tensors[38;5;241m=[39m[38;5;124m"[39m[38;5;124mpt[39m[38;5;124m"[39m)</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:2883</span>, in PreTrainedTokenizerBase.__call__<span style="color:blue">(self, text, text_pair, text_target, text_pair_target, add_special_tokens, padding, truncation, max_length, stride, is_split_into_words, pad_to_multiple_of, return_tensors, return_token_type_ids, return_attention_mask, return_overflowing_tokens, return_special_tokens_mask, return_offsets_mapping, return_length, verbose, **kwargs)</span></p><p><span style="color:green"><b>   2881</b></span>     [38;5;28;01mif[39;00m [38;5;129;01mnot[39;00m [38;5;28mself[39m[38;5;241m.[39m_in_target_context_manager:</p><p><span style="color:green"><b>   2882</b></span>         [38;5;28mself[39m[38;5;241m.[39m_switch_to_input_mode()</p><p><span style="color:green">-&gt; 2883</span>     encodings [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_call_one(text[38;5;241m=[39mtext, text_pair[38;5;241m=[39mtext_pair, [38;5;241m*[39m[38;5;241m*[39mall_kwargs)</p><p><span style="color:green"><b>   2884</b></span> [38;5;28;01mif[39;00m text_target [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m:</p><p><span style="color:green"><b>   2885</b></span>     [38;5;28mself[39m[38;5;241m.[39m_switch_to_target_mode()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:2989</span>, in PreTrainedTokenizerBase._call_one<span style="color:blue">(self, text, text_pair, add_special_tokens, padding, truncation, max_length, stride, is_split_into_words, pad_to_multiple_of, return_tensors, return_token_type_ids, return_attention_mask, return_overflowing_tokens, return_special_tokens_mask, return_offsets_mapping, return_length, verbose, **kwargs)</span></p><p><span style="color:green"><b>   2969</b></span>     [38;5;28;01mreturn[39;00m [38;5;28mself[39m[38;5;241m.[39mbatch_encode_plus(</p><p><span style="color:green"><b>   2970</b></span>         batch_text_or_text_pairs[38;5;241m=[39mbatch_text_or_text_pairs,</p><p><span style="color:green"><b>   2971</b></span>         add_special_tokens[38;5;241m=[39madd_special_tokens,</p><p><span style="color:green">   (...)</span></p><p><span style="color:green"><b>   2986</b></span>         [38;5;241m*[39m[38;5;241m*[39mkwargs,</p><p><span style="color:green"><b>   2987</b></span>     )</p><p><span style="color:green"><b>   2988</b></span> [38;5;28;01melse[39;00m:</p><p><span style="color:green">-&gt; 2989</span>     [38;5;28;01mreturn[39;00m [38;5;28mself[39m[38;5;241m.[39mencode_plus(</p><p><span style="color:green"><b>   2990</b></span>         text[38;5;241m=[39mtext,</p><p><span style="color:green"><b>   2991</b></span>         text_pair[38;5;241m=[39mtext_pair,</p><p><span style="color:green"><b>   2992</b></span>         add_special_tokens[38;5;241m=[39madd_special_tokens,</p><p><span style="color:green"><b>   2993</b></span>         padding[38;5;241m=[39mpadding,</p><p><span style="color:green"><b>   2994</b></span>         truncation[38;5;241m=[39mtruncation,</p><p><span style="color:green"><b>   2995</b></span>         max_length[38;5;241m=[39mmax_length,</p><p><span style="color:green"><b>   2996</b></span>         stride[38;5;241m=[39mstride,</p><p><span style="color:green"><b>   2997</b></span>         is_split_into_words[38;5;241m=[39mis_split_into_words,</p><p><span style="color:green"><b>   2998</b></span>         pad_to_multiple_of[38;5;241m=[39mpad_to_multiple_of,</p><p><span style="color:green"><b>   2999</b></span>         return_tensors[38;5;241m=[39mreturn_tensors,</p><p><span style="color:green"><b>   3000</b></span>         return_token_type_ids[38;5;241m=[39mreturn_token_type_ids,</p><p><span style="color:green"><b>   3001</b></span>         return_attention_mask[38;5;241m=[39mreturn_attention_mask,</p><p><span style="color:green"><b>   3002</b></span>         return_overflowing_tokens[38;5;241m=[39mreturn_overflowing_tokens,</p><p><span style="color:green"><b>   3003</b></span>         return_special_tokens_mask[38;5;241m=[39mreturn_special_tokens_mask,</p><p><span style="color:green"><b>   3004</b></span>         return_offsets_mapping[38;5;241m=[39mreturn_offsets_mapping,</p><p><span style="color:green"><b>   3005</b></span>         return_length[38;5;241m=[39mreturn_length,</p><p><span style="color:green"><b>   3006</b></span>         verbose[38;5;241m=[39mverbose,</p><p><span style="color:green"><b>   3007</b></span>         [38;5;241m*[39m[38;5;241m*[39mkwargs,</p><p><span style="color:green"><b>   3008</b></span>     )</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:3053</span>, in PreTrainedTokenizerBase.encode_plus<span style="color:blue">(self, text, text_pair, add_special_tokens, padding, truncation, max_length, stride, is_split_into_words, pad_to_multiple_of, return_tensors, return_token_type_ids, return_attention_mask, return_overflowing_tokens, return_special_tokens_mask, return_offsets_mapping, return_length, verbose, **kwargs)</span></p><p><span style="color:green"><b>   3032</b></span> [38;5;250m[39m[38;5;124;03m"""[39;00m</p><p><span style="color:green"><b>   3033</b></span> [38;5;124;03mTokenize and prepare for the model a sequence or a pair of sequences.[39;00m</p><p><span style="color:green"><b>   3034</b></span> </p><p><span style="color:green">   (...)</span></p><p><span style="color:green"><b>   3049</b></span> [38;5;124;03m        method).[39;00m</p><p><span style="color:green"><b>   3050</b></span> [38;5;124;03m"""[39;00m</p><p><span style="color:green"><b>   3052</b></span> [38;5;66;03m# Backward compatibility for 'truncation_strategy', 'pad_to_max_length'[39;00m</p><p><span style="color:green">-&gt; 3053</span> padding_strategy, truncation_strategy, max_length, kwargs [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_get_padding_truncation_strategies(</p><p><span style="color:green"><b>   3054</b></span>     padding[38;5;241m=[39mpadding,</p><p><span style="color:green"><b>   3055</b></span>     truncation[38;5;241m=[39mtruncation,</p><p><span style="color:green"><b>   3056</b></span>     max_length[38;5;241m=[39mmax_length,</p><p><span style="color:green"><b>   3057</b></span>     pad_to_multiple_of[38;5;241m=[39mpad_to_multiple_of,</p><p><span style="color:green"><b>   3058</b></span>     verbose[38;5;241m=[39mverbose,</p><p><span style="color:green"><b>   3059</b></span>     [38;5;241m*[39m[38;5;241m*[39mkwargs,</p><p><span style="color:green"><b>   3060</b></span> )</p><p><span style="color:green"><b>   3062</b></span> [38;5;28;01mreturn[39;00m [38;5;28mself[39m[38;5;241m.[39m_encode_plus(</p><p><span style="color:green"><b>   3063</b></span>     text[38;5;241m=[39mtext,</p><p><span style="color:green"><b>   3064</b></span>     text_pair[38;5;241m=[39mtext_pair,</p><p><span style="color:green">   (...)</span></p><p><span style="color:green"><b>   3080</b></span>     [38;5;241m*[39m[38;5;241m*[39mkwargs,</p><p><span style="color:green"><b>   3081</b></span> )</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:2788</span>, in PreTrainedTokenizerBase._get_padding_truncation_strategies<span style="color:blue">(self, padding, truncation, max_length, pad_to_multiple_of, verbose, **kwargs)</span></p><p><span style="color:green"><b>   2786</b></span> [38;5;66;03m# Test if we have a padding token[39;00m</p><p><span style="color:green"><b>   2787</b></span> [38;5;28;01mif[39;00m padding_strategy [38;5;241m!=[39m PaddingStrategy[38;5;241m.[39mDO_NOT_PAD [38;5;129;01mand[39;00m ([38;5;28mself[39m[38;5;241m.[39mpad_token [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m [38;5;129;01mor[39;00m [38;5;28mself[39m[38;5;241m.[39mpad_token_id [38;5;241m&lt;[39m [38;5;241m0[39m):</p><p><span style="color:green">-&gt; 2788</span>     [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(</p><p><span style="color:green"><b>   2789</b></span>         [38;5;124m"[39m[38;5;124mAsking to pad but the tokenizer does not have a padding token. [39m[38;5;124m"[39m</p><p><span style="color:green"><b>   2790</b></span>         [38;5;124m"[39m[38;5;124mPlease select a token to use as `pad_token` `(tokenizer.pad_token = tokenizer.eos_token e.g.)` [39m[38;5;124m"[39m</p><p><span style="color:green"><b>   2791</b></span>         [38;5;124m"[39m[38;5;124mor add a new pad token via `tokenizer.add_special_tokens([39m[38;5;124m{[39m[38;5;124m'[39m[38;5;124mpad_token[39m[38;5;124m'[39m[38;5;124m: [39m[38;5;124m'[39m[38;5;124m[PAD][39m[38;5;124m'[39m[38;5;124m})`.[39m[38;5;124m"[39m</p><p><span style="color:green"><b>   2792</b></span>     )</p><p><span style="color:green"><b>   2794</b></span> [38;5;66;03m# Check that we will truncate to a multiple of pad_to_multiple_of if both are provided[39;00m</p><p><span style="color:green"><b>   2795</b></span> [38;5;28;01mif[39;00m (</p><p><span style="color:green"><b>   2796</b></span>     truncation_strategy [38;5;241m!=[39m TruncationStrategy[38;5;241m.[39mDO_NOT_TRUNCATE</p><p><span style="color:green"><b>   2797</b></span>     [38;5;129;01mand[39;00m padding_strategy [38;5;241m!=[39m PaddingStrategy[38;5;241m.[39mDO_NOT_PAD</p><p><span style="color:green">   (...)</span></p><p><span style="color:green"><b>   2800</b></span>     [38;5;129;01mand[39;00m (max_length [38;5;241m%[39m pad_to_multiple_of [38;5;241m!=[39m [38;5;241m0[39m)</p><p><span style="color:green"><b>   2801</b></span> ):</p><p></p><p><span style="color:red">ValueError</span>: Asking to pad but the tokenizer does not have a padding token. Please select a token to use as `pad_token` `(tokenizer.pad_token = tokenizer.eos_token e.g.)` or add a new pad token via `tokenizer.add_special_tokens({'pad_token': '[PAD]'})`.</p></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Recebemos um erro porque o tokenizador GPT2 não tem um token para preenchimento e nos pede para atribuir um, sugerindo que façamos <code><b>tokenizer.pad_token = tokenizer.eos_token</b></code>, e assim o fazemos.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Testamos novamente a função de tokenização.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">shape</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([1, 768]), torch.Size([1, 768]))</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Agora que verificamos que a função tokeniza bem, aplicamos essa função ao conjunto de dados, mas também a aplicamos em lotes para que seja executada mais rapidamente.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"></p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Também tiramos proveito disso e eliminamos as colunas que não são necessárias.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;text&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;id&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;label_text&#39;</span><span style="color: #e3e11d;">])</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Agora vamos ver como é o conjunto de dados</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text', 'labels'],</p><p>        num_rows: 200000</p><p>    })</p><p>    validation: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text', 'labels'],</p><p>        num_rows: 5000</p><p>    })</p><p>    test: Dataset({</p><p>        features: ['id', 'text', 'label', 'label_text', 'labels'],</p><p>        num_rows: 5000</p><p>    })</p><p>})</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Vemos que temos os campos "labels" (rótulos), "input_ids" (IDs de entrada) e "attention_mask" (máscara de atenção), que é o que nos interessa treinar.</p>
					</div>
				</div>
			</div>
		</div>
		<!-- Open div header -->
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<h3 id="Modelo">
							<a class="anchor-link" href="#Modelo">
								<p style="margin-left: 20px">Modelo</p>
							</a>
						</h3>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Instanciamos um modelo para classificação de sequências e informamos a ele o número de classes que temos.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">num_labels</span><span>=</span><span style="color: #6b97e8;">num_classes</span><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>Some weights of GPT2ForSequenceClassification were not initialized from the model checkpoint at openai-community/gpt2 and are newly initialized: ['score.weight']</p><p>You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Ele nos informa que os pesos da camada <code><b>score</b></code> foram inicializados aleatoriamente e que precisamos treiná-los novamente.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">O modelo GPT2 teria a seguinte aparência</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span></p>
<p></p>
<p><span style="color: #6b97e8;">casual_model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Enquanto o modelo GPT2 para gerar texto é o seguinte</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Vamos dar uma olhada em sua arquitetura</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">casual_model</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>GPT2LMHeadModel(</p><p>  (transformer): GPT2Model(</p><p>    (wte): Embedding(50257, 768)</p><p>    (wpe): Embedding(1024, 768)</p><p>    (drop): Dropout(p=0.1, inplace=False)</p><p>    (h): ModuleList(</p><p>      (0-11): 12 x GPT2Block(</p><p>        (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>        (attn): GPT2Attention(</p><p>          (c_attn): Conv1D()</p><p>          (c_proj): Conv1D()</p><p>          (attn_dropout): Dropout(p=0.1, inplace=False)</p><p>          (resid_dropout): Dropout(p=0.1, inplace=False)</p><p>        )</p><p>        (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>        (mlp): GPT2MLP(</p><p>          (c_fc): Conv1D()</p><p>          (c_proj): Conv1D()</p><p>          (act): NewGELUActivation()</p><p>          (dropout): Dropout(p=0.1, inplace=False)</p><p>        )</p><p>      )</p><p>    )</p><p>    (ln_f): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>  )</p><p>  (lm_head): Linear(in_features=768, out_features=50257, bias=False)</p><p>)</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">E agora a arquitetura do modelo que usaremos para classificar as avaliações.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">model</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_stream output_stdout output_text">
							<pre style="margin-left: 60px; line-height: 0%;"><p>GPT2ForSequenceClassification(</p><p>  (transformer): GPT2Model(</p><p>    (wte): Embedding(50257, 768)</p><p>    (wpe): Embedding(1024, 768)</p><p>    (drop): Dropout(p=0.1, inplace=False)</p><p>    (h): ModuleList(</p><p>      (0-11): 12 x GPT2Block(</p><p>        (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>        (attn): GPT2Attention(</p><p>          (c_attn): Conv1D()</p><p>          (c_proj): Conv1D()</p><p>          (attn_dropout): Dropout(p=0.1, inplace=False)</p><p>          (resid_dropout): Dropout(p=0.1, inplace=False)</p><p>        )</p><p>        (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>        (mlp): GPT2MLP(</p><p>          (c_fc): Conv1D()</p><p>          (c_proj): Conv1D()</p><p>          (act): NewGELUActivation()</p><p>          (dropout): Dropout(p=0.1, inplace=False)</p><p>        )</p><p>      )</p><p>    )</p><p>    (ln_f): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p><p>  )</p><p>  (score): Linear(in_features=768, out_features=5, bias=False)</p><p>)</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Há dois aspectos a serem mencionados aqui</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"></p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"> + A primeira é que, em ambas, a primeira camada tem dimensões de 50257x768, o que corresponde a 50257 tokens possíveis do vocabulário GPT2 e 768 dimensões da incorporação, portanto, fizemos bem em tokenizar as avaliações com um tamanho de 768 tokens.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"> + A segunda é que o modelo <code><b>casual</b></code> (o modelo de geração de texto) tem, no final, uma camada <code><b>Linear</b></code> que gera 50257 valores, ou seja, é responsável por prever o próximo token e atribui um valor a cada token possível. Já o modelo de classificação tem uma camada <code><b>Linear</b></code> que gera apenas 5 valores, um para cada classe, o que nos dará a probabilidade de a avaliação pertencer a cada classe.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;"></p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">É por isso que recebemos a mensagem de que os pesos da camada <code><b>score</b></code> foram inicializados aleatoriamente, porque a biblioteca de transformadores removeu a camada <code><b>Linear</b></code> de 768x50257 e adicionou uma camada <code><b>Linear</b></code> de 768x5, inicializou-a com valores aleatórios e precisamos treiná-la para nosso problema específico.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Excluímos o modelo casual, porque não vamos usá-lo.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">del</span> <span style="color: #6b97e8;">casual_model</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<!-- Open div header -->
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<h3 id="Treinador">
							<a class="anchor-link" href="#Treinador">
								<p style="margin-left: 20px">Treinador</p>
							</a>
						</h3>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Vamos agora configurar os argumentos de treinamento</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">TrainingArguments</span></p>
<p></p>
<p><span style="color: #6b97e8;">metric_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;accuracy&quot;</span></p>
<p><span style="color: #6b97e8;">model_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;GPT2-small-finetuned-amazon-reviews-en-classification&quot;</span></p>
<p><span style="color: #6b97e8;">LR</span> <span>=</span> <span style="color: #a09e19;">2e-5</span></p>
<p><span style="color: #6b97e8;">BS_TRAIN</span> <span>=</span> <span style="color: #7e7a38;">28</span></p>
<p><span style="color: #6b97e8;">BS_EVAL</span> <span>=</span> <span style="color: #7e7a38;">40</span></p>
<p><span style="color: #6b97e8;">EPOCHS</span> <span>=</span> <span style="color: #7e7a38;">3</span></p>
<p><span style="color: #6b97e8;">WEIGHT_DECAY</span> <span>=</span> <span style="color: #a09e19;">0.01</span></p>
<p></p>
<p><span style="color: #6b97e8;">training_args</span> <span>=</span> <span style="color: #6b97e8;">TrainingArguments</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">save_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">learning_rate</span><span>=</span><span style="color: #6b97e8;">LR</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_train_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_TRAIN</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_eval_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_EVAL</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">num_train_epochs</span><span>=</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">weight_decay</span><span>=</span><span style="color: #6b97e8;">WEIGHT_DECAY</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">lr_scheduler_type</span><span>=</span><span style="color: #7e7a34;">&quot;cosine&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">warmup_ratio</span> <span>=</span> <span style="color: #a09e19;">0.1</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">fp16</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">load_best_model_at_end</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">metric_for_best_model</span><span>=</span><span style="color: #6b97e8;">metric_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">push_to_hub</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Definir uma métrica para o carregador de dados de validação</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">numpy</span> <span style="color: #a04cc1;">as</span> <span style="color: #4fcd7d;">np</span></p>
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">evaluate</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load</span></p>
<p></p>
<p><span style="color: #6b97e8;">metric</span> <span>=</span> <span style="color: #6b97e8;">load</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;accuracy&quot;</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">compute_metrics</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">eval_pred</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">eval_pred</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">predictions</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #6b97e8;">eval_pred</span></p>
<p>    <span style="color: #6b97e8;">predictions</span> <span>=</span> <span style="color: #6b97e8;">np</span><span>.</span><span style="color: #6b97e8;">argmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">predictions</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">axis</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">metric</span><span>.</span><span style="color: #6b97e8;">compute</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">predictions</span><span>=</span><span style="color: #6b97e8;">predictions</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">references</span><span>=</span><span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Agora definimos o treinador</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">Trainer</span></p>
<p></p>
<p><span style="color: #6b97e8;">trainer</span> <span>=</span> <span style="color: #6b97e8;">Trainer</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">training_args</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">train_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">],</span></p>
<p>    <span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;validation&#39;</span><span style="color: #e3e11d;">],</span></p>
<p>    <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">compute_metrics</span><span>=</span><span style="color: #6b97e8;">compute_metrics</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
		<div class="cell border-box-sizing text_cell rendered">
			<div class="prompt input_prompt">
				<div class="inner_cell">
					<div class="text_cell_render border-box-sizing rendered_html">
						<p style="margin-left: 0px;">Treinamos</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cell border-box-sizing code_cell rendered">
			<div class="input">
				<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
				<div class="inner_cell">
					<div class="input_area">
						<div class=" highlight hl-python3">
							<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
							</pre>
						</div>
					</div>
				</div>
			</div>
			<div class="output_wrapper">
				<div class="output">
					<div class="output_area">
						<div class="prompt" style="margin-left: 20px;">Output:</div>
						<div class="output_subarea output_text output_error">
							<pre style="margin-left: 60px; line-height: 0%;"><p><span style="color:red">---------------------------------------------------------------------------</span></p><p><span style="color:red">ValueError</span>                                Traceback (most recent call last)</p><p>Cell <span style="color:green">In[21], line 1</span></p><p><span style="color:green">----&gt; 1</span> trainer[38;5;241m.[39mtrain()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:1876</span>, in Trainer.train<span style="color:blue">(self, resume_from_checkpoint, trial, ignore_keys_for_eval, **kwargs)</span></p><p><span style="color:green"><b>   1873</b></span> [38;5;28;01mtry[39;00m:</p><p><span style="color:green"><b>   1874</b></span>     [38;5;66;03m# Disable progress bars when uploading models during checkpoints to avoid polluting stdout[39;00m</p><p><span style="color:green"><b>   1875</b></span>     hf_hub_utils[38;5;241m.[39mdisable_progress_bars()</p><p><span style="color:green">-&gt; 1876</span>     [38;5;28;01mreturn[39;00m inner_training_loop(</p><p><span style="color:green"><b>   1877</b></span>         args[38;5;241m=[39margs,</p><p><span style="color:green"><b>   1878</b></span>         resume_from_checkpoint[38;5;241m=[39mresume_from_checkpoint,</p><p><span style="color:green"><b>   1879</b></span>         trial[38;5;241m=[39mtrial,</p><p><span style="color:green"><b>   1880</b></span>         ignore_keys_for_eval[38;5;241m=[39mignore_keys_for_eval,</p><p><span style="color:green"><b>   1881</b></span>     )</p><p><span style="color:green"><b>   1882</b></span> [38;5;28;01mfinally[39;00m:</p><p><span style="color:green"><b>   1883</b></span>     hf_hub_utils[38;5;241m.[39menable_progress_bars()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:2178</span>, in Trainer._inner_training_loop<span style="color:blue">(self, batch_size, args, resume_from_checkpoint, trial, ignore_keys_for_eval)</span></p><p><span style="color:green"><b>   2175</b></span>     rng_to_sync [38;5;241m=[39m [38;5;28;01mTrue[39;00m</p><p><span style="color:green"><b>   2177</b></span> step [38;5;241m=[39m [38;5;241m-[39m[38;5;241m1[39m</p><p><span style="color:green">-&gt; 2178</span> [38;5;28;01mfor[39;00m step, inputs [38;5;129;01min[39;00m [38;5;28menumerate[39m(epoch_iterator):</p><p><span style="color:green"><b>   2179</b></span>     total_batched_samples [38;5;241m+[39m[38;5;241m=[39m [38;5;241m1[39m</p><p><span style="color:green"><b>   2181</b></span>     [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39margs[38;5;241m.[39minclude_num_input_tokens_seen:</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/accelerate/data_loader.py:454</span>, in DataLoaderShard.__iter__<span style="color:blue">(self)</span></p><p><span style="color:green"><b>    452</b></span> [38;5;66;03m# We iterate one batch ahead to check when we are at the end[39;00m</p><p><span style="color:green"><b>    453</b></span> [38;5;28;01mtry[39;00m:</p><p><span style="color:green">--&gt; 454</span>     current_batch [38;5;241m=[39m [38;5;28mnext[39m(dataloader_iter)</p><p><span style="color:green"><b>    455</b></span> [38;5;28;01mexcept[39;00m [38;5;167;01mStopIteration[39;00m:</p><p><span style="color:green"><b>    456</b></span>     [38;5;28;01myield[39;00m</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/torch/utils/data/dataloader.py:631</span>, in _BaseDataLoaderIter.__next__<span style="color:blue">(self)</span></p><p><span style="color:green"><b>    628</b></span> [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39m_sampler_iter [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m:</p><p><span style="color:green"><b>    629</b></span>     [38;5;66;03m# TODO(https://github.com/pytorch/pytorch/issues/76750)[39;00m</p><p><span style="color:green"><b>    630</b></span>     [38;5;28mself[39m[38;5;241m.[39m_reset()  [38;5;66;03m# type: ignore[call-arg][39;00m</p><p><span style="color:green">--&gt; 631</span> data [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_next_data()</p><p><span style="color:green"><b>    632</b></span> [38;5;28mself[39m[38;5;241m.[39m_num_yielded [38;5;241m+[39m[38;5;241m=[39m [38;5;241m1[39m</p><p><span style="color:green"><b>    633</b></span> [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39m_dataset_kind [38;5;241m==[39m _DatasetKind[38;5;241m.[39mIterable [38;5;129;01mand[39;00m \</p><p><span style="color:green"><b>    634</b></span>         [38;5;28mself[39m[38;5;241m.[39m_IterableDataset_len_called [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m [38;5;129;01mand[39;00m \</p><p><span style="color:green"><b>    635</b></span>         [38;5;28mself[39m[38;5;241m.[39m_num_yielded [38;5;241m&gt;[39m [38;5;28mself[39m[38;5;241m.[39m_IterableDataset_len_called:</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/torch/utils/data/dataloader.py:675</span>, in _SingleProcessDataLoaderIter._next_data<span style="color:blue">(self)</span></p><p><span style="color:green"><b>    673</b></span> [38;5;28;01mdef[39;00m [38;5;21m_next_data[39m([38;5;28mself[39m):</p><p><span style="color:green"><b>    674</b></span>     index [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_next_index()  [38;5;66;03m# may raise StopIteration[39;00m</p><p><span style="color:green">--&gt; 675</span>     data [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39m_dataset_fetcher[38;5;241m.[39mfetch(index)  [38;5;66;03m# may raise StopIteration[39;00m</p><p><span style="color:green"><b>    676</b></span>     [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39m_pin_memory:</p><p><span style="color:green"><b>    677</b></span>         data [38;5;241m=[39m _utils[38;5;241m.[39mpin_memory[38;5;241m.[39mpin_memory(data, [38;5;28mself[39m[38;5;241m.[39m_pin_memory_device)</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py:54</span>, in _MapDatasetFetcher.fetch<span style="color:blue">(self, possibly_batched_index)</span></p><p><span style="color:green"><b>     52</b></span> [38;5;28;01melse[39;00m:</p><p><span style="color:green"><b>     53</b></span>     data [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mdataset[possibly_batched_index]</p><p><span style="color:green">---&gt; 54</span> [38;5;28;01mreturn[39;00m [38;5;28mself[39m[38;5;241m.[39mcollate_fn(data)</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/data/data_collator.py:271</span>, in DataCollatorWithPadding.__call__<span style="color:blue">(self, features)</span></p><p><span style="color:green"><b>    270</b></span> [38;5;28;01mdef[39;00m [38;5;21m__call__[39m([38;5;28mself[39m, features: List[Dict[[38;5;28mstr[39m, Any]]) [38;5;241m-[39m[38;5;241m&gt;[39m Dict[[38;5;28mstr[39m, Any]:</p><p><span style="color:green">--&gt; 271</span>     batch [38;5;241m=[39m pad_without_fast_tokenizer_warning(</p><p><span style="color:green"><b>    272</b></span>         [38;5;28mself[39m[38;5;241m.[39mtokenizer,</p><p><span style="color:green"><b>    273</b></span>         features,</p><p><span style="color:green"><b>    274</b></span>         padding[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mpadding,</p><p><span style="color:green"><b>    275</b></span>         max_length[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mmax_length,</p><p><span style="color:green"><b>    276</b></span>         pad_to_multiple_of[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mpad_to_multiple_of,</p><p><span style="color:green"><b>    277</b></span>         return_tensors[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mreturn_tensors,</p><p><span style="color:green"><b>    278</b></span>     )</p><p><span style="color:green"><b>    279</b></span>     [38;5;28;01mif[39;00m [38;5;124m"[39m[38;5;124mlabel[39m[38;5;124m"[39m [38;5;129;01min[39;00m batch:</p><p><span style="color:green"><b>    280</b></span>         batch[[38;5;124m"[39m[38;5;124mlabels[39m[38;5;124m"[39m] [38;5;241m=[39m batch[[38;5;124m"[39m[38;5;124mlabel[39m[38;5;124m"[39m]</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/data/data_collator.py:66</span>, in pad_without_fast_tokenizer_warning<span style="color:blue">(tokenizer, *pad_args, **pad_kwargs)</span></p><p><span style="color:green"><b>     63</b></span> tokenizer[38;5;241m.[39mdeprecation_warnings[[38;5;124m"[39m[38;5;124mAsking-to-pad-a-fast-tokenizer[39m[38;5;124m"[39m] [38;5;241m=[39m [38;5;28;01mTrue[39;00m</p><p><span style="color:green"><b>     65</b></span> [38;5;28;01mtry[39;00m:</p><p><span style="color:green">---&gt; 66</span>     padded [38;5;241m=[39m tokenizer[38;5;241m.[39mpad([38;5;241m*[39mpad_args, [38;5;241m*[39m[38;5;241m*[39mpad_kwargs)</p><p><span style="color:green"><b>     67</b></span> [38;5;28;01mfinally[39;00m:</p><p><span style="color:green"><b>     68</b></span>     [38;5;66;03m# Restore the state of the warning.[39;00m</p><p><span style="color:green"><b>     69</b></span>     tokenizer[38;5;241m.[39mdeprecation_warnings[[38;5;124m"[39m[38;5;124mAsking-to-pad-a-fast-tokenizer[39m[38;5;124m"[39m] [38;5;241m=[39m warning_state</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/tokenization_utils_base.py:3299</span>, in PreTrainedTokenizerBase.pad<span style="color:blue">(self, encoded_inputs, padding, max_length, pad_to_multiple_of, return_attention_mask, return_tensors, verbose)</span></p><p><span style="color:green"><b>   3297</b></span> [38;5;66;03m# The model's main input name, usually `input_ids`, has be passed for padding[39;00m</p><p><span style="color:green"><b>   3298</b></span> [38;5;28;01mif[39;00m [38;5;28mself[39m[38;5;241m.[39mmodel_input_names[[38;5;241m0[39m] [38;5;129;01mnot[39;00m [38;5;129;01min[39;00m encoded_inputs:</p><p><span style="color:green">-&gt; 3299</span>     [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(</p><p><span style="color:green"><b>   3300</b></span>         [38;5;124m"[39m[38;5;124mYou should supply an encoding or a list of encodings to this method [39m[38;5;124m"[39m</p><p><span style="color:green"><b>   3301</b></span>         [38;5;124mf[39m[38;5;124m"[39m[38;5;124mthat includes [39m[38;5;132;01m{[39;00m[38;5;28mself[39m[38;5;241m.[39mmodel_input_names[[38;5;241m0[39m][38;5;132;01m}[39;00m[38;5;124m, but you provided [39m[38;5;132;01m{[39;00m[38;5;28mlist[39m(encoded_inputs[38;5;241m.[39mkeys())[38;5;132;01m}[39;00m[38;5;124m"[39m</p><p><span style="color:green"><b>   3302</b></span>     )</p><p><span style="color:green"><b>   3304</b></span> required_input [38;5;241m=[39m encoded_inputs[[38;5;28mself[39m[38;5;241m.[39mmodel_input_names[[38;5;241m0[39m]]</p><p><span style="color:green"><b>   3306</b></span> [38;5;28;01mif[39;00m required_input [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m [38;5;129;01mor[39;00m ([38;5;28misinstance[39m(required_input, Sized) [38;5;129;01mand[39;00m [38;5;28mlen[39m(required_input) [38;5;241m==[39m [38;5;241m0[39m):</p><p></p><p><span style="color:red">ValueError</span>: You should supply an encoding or a list of encodings to this method that includes input_ids, but you provided ['label', 'labels']</p></pre>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Recebemos um erro novamente porque o modelo não foi atribuído a um token de preenchimento, portanto, assim como no tokenizador, nós o atribuímos ao modelo</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Recriamos os argumentos do instrutor com o novo modelo, que agora tem um token de preenchimento, o instrutor e treinamos novamente.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">training_args</span> <span>=</span> <span style="color: #6b97e8;">TrainingArguments</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">save_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">learning_rate</span><span>=</span><span style="color: #6b97e8;">LR</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_train_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_TRAIN</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_eval_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_EVAL</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">num_train_epochs</span><span>=</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">weight_decay</span><span>=</span><span style="color: #6b97e8;">WEIGHT_DECAY</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">lr_scheduler_type</span><span>=</span><span style="color: #7e7a34;">&quot;cosine&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">warmup_ratio</span> <span>=</span> <span style="color: #a09e19;">0.1</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">fp16</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">load_best_model_at_end</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">metric_for_best_model</span><span>=</span><span style="color: #6b97e8;">metric_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">push_to_hub</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">logging_dir</span><span>=</span><span style="color: #7e7a34;">&quot;./runs&quot;</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
<p></p>
<p><span style="color: #6b97e8;">trainer</span> <span>=</span> <span style="color: #6b97e8;">Trainer</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">training_args</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">train_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">],</span></p>
<p>    <span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;validation&#39;</span><span style="color: #e3e11d;">],</span></p>
<p>    <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">compute_metrics</span><span>=</span><span style="color: #6b97e8;">compute_metrics</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Agora que vimos que tudo está bem, podemos treinar.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>TrainOutput(global_step=21429, training_loss=0.7846888848762739, metrics={'train_runtime': 26367.7801, 'train_samples_per_second': 22.755, 'train_steps_per_second': 0.813, 'total_flos': 2.35173445632e+17, 'train_loss': 0.7846888848762739, 'epoch': 3.0})</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Avaliação">
						<a class="anchor-link" href="#Avaliação">
							<p style="margin-left: 20px">Avaliação</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Depois de treinados, avaliamos o conjunto de dados de teste</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">evaluate</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;test&#39;</span><span style="color: #e3e11d;">])</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>{'eval_loss': 0.7973636984825134,</p><p> 'eval_accuracy': 0.6626,</p><p> 'eval_runtime': 76.3016,</p><p> 'eval_samples_per_second': 65.529,</p><p> 'eval_steps_per_second': 1.638,</p><p> 'epoch': 3.0}</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Publicar-o-modelo">
						<a class="anchor-link" href="#Publicar-o-modelo">
							<p style="margin-left: 20px">Publicar o modelo</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Agora que temos nosso modelo treinado, podemos compartilhá-lo com o mundo, portanto, primeiro criamos um cartão de modelo.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">create_model_card</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">E agora podemos publicá-lo. Como a primeira coisa que fizemos foi fazer login no hub da huggingface, poderemos fazer o upload para o nosso hub sem nenhum problema.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">push_to_hub</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Uso-do-modelo">
						<a class="anchor-link" href="#Uso-do-modelo">
							<p style="margin-left: 20px">Uso do modelo</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Limpamos o máximo possível</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">gc</span></p>
<p></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">clear_hardwares</span><span style="color: #e3e11d;">():</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">clear_autocast_cache</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">ipc_collect</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">empty_cache</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">gc</span><span>.</span><span style="color: #6b97e8;">collect</span><span style="color: #e3e11d;">()</span></p>
<p></p>
<p></p>
<p><span style="color: #6b97e8;">clear_hardwares</span><span style="color: #e3e11d;">()</span></p>
<p><span style="color: #6b97e8;">clear_hardwares</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Como fizemos o upload do modelo em nosso hub, podemos baixá-lo e usá-lo.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">pipeline</span></p>
<p></p>
<p><span style="color: #6b97e8;">user</span> <span>=</span> <span style="color: #7e7a34;">&quot;maximofn&quot;</span></p>
<p><span style="color: #6b97e8;">checkpoints</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">user</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">/</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">model_name</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span></p>
<p><span style="color: #6b97e8;">task</span> <span>=</span> <span style="color: #7e7a34;">&quot;text-classification&quot;</span></p>
<p><span style="color: #6b97e8;">classifier</span> <span>=</span> <span style="color: #6b97e8;">pipeline</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">task</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">model</span><span>=</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Agora, se quisermos retornar a probabilidade de todas as classes, basta usar o classificador que acabamos de instanciar, com o parâmetro <code><b>top_k=None</b></code>.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #6b97e8;">classifier</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;I love this product&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_k</span><span>=</span><span style="color: #7f6e38;">None</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">labels</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>[{'label': 'LABEL_4', 'score': 0.8253807425498962},</p><p> {'label': 'LABEL_3', 'score': 0.15411493182182312},</p><p> {'label': 'LABEL_2', 'score': 0.013907806016504765},</p><p> {'label': 'LABEL_0', 'score': 0.003939222544431686},</p><p> {'label': 'LABEL_1', 'score': 0.0026572425849735737}]</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Se quisermos apenas a classe com a maior probabilidade, faremos o mesmo, mas com o parâmetro <code><b>top_k=1</b></code>.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">label</span> <span>=</span> <span style="color: #6b97e8;">classifier</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;I love this product&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_k</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">label</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>[{'label': 'LABEL_4', 'score': 0.8253807425498962}]</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">E se quisermos n classes, faremos o mesmo, mas com o parâmetro <code><b>top_k=n</b></code>.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">two_labels</span> <span>=</span> <span style="color: #6b97e8;">classifier</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;I love this product&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_k</span><span>=</span><span style="color: #7e7a38;">2</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">two_labels</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>[{'label': 'LABEL_4', 'score': 0.8253807425498962},</p><p> {'label': 'LABEL_3', 'score': 0.15411493182182312}]</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Também podemos testar o modelo com o Automodel e o AutoTokenizer.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span></p>
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">model_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;GPT2-small-finetuned-amazon-reviews-en-classification&quot;</span></p>
<p><span style="color: #6b97e8;">user</span> <span>=</span> <span style="color: #7e7a34;">&quot;maximofn&quot;</span></p>
<p><span style="color: #6b97e8;">checkpoint</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">user</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">/</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">model_name</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span></p>
<p><span style="color: #6b97e8;">num_classes</span> <span>=</span> <span style="color: #7e7a38;">5</span></p>
<p></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">num_labels</span><span>=</span><span style="color: #6b97e8;">num_classes</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">half</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">eval</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;cuda&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">encode</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;I love this product&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #a04cc1;">with</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">no_grad</span><span style="color: #e3e11d;">():</span></p>
<p>    <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokens</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">logits</span> <span>=</span> <span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">logits</span></p>
<p><span style="color: #6b97e8;">lables</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">softmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">dim</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">cpu</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">numpy</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">tolist</span><span style="color: #e3e11d;">()</span></p>
<p><span style="color: #6b97e8;">lables</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">]</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>[0.003963470458984375,</p><p> 0.0026721954345703125,</p><p> 0.01397705078125,</p><p> 0.154541015625,</p><p> 0.82470703125]</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Se você quiser testar o modelo com mais detalhes, poderá vê-lo em <a href="https://huggingface.co/Maximofn/GPT2-small-finetuned-amazon-reviews-en-classification" target="_blank">Maximofn/GPT2-small-finetuned-amazon-reviews-en-classification</a></p>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h2 id="Ajuste-fino-para-geração-de-texto-com-o-Hugging-Face">
						<a class="anchor-link" href="#Ajuste-fino-para-geração-de-texto-com-o-Hugging-Face">
							<p style="margin-left: 10px">Ajuste fino para geração de texto com o Hugging Face</p>
						</a>
					</h2>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Para ter certeza de que não tenho problemas de memória VRAM, reiniciei o notebook.</p>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Login">
						<a class="anchor-link" href="#Login">
							<p style="margin-left: 20px">Login</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Para fazer upload do resultado do treinamento no hub, primeiro precisamos fazer login e, para isso, precisamos de um token.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Para criar um token, acesse a página <a href="https://huggingface.co/settings/tokens" target="_blank">setings/tokens</a> de sua conta, que terá a seguinte aparência</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">User-Access-Token-dark](http://maximofn.com/wp-content/uploads/2024/03/User-Access-Token-dark.png)</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Clique em <code><b>New token</b></code> e será exibida uma janela para criar um novo token.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"><p align="center"><img src="http://maximofn.com/wp-content/uploads/2024/03/new-token-dark.png" alt="new-token-dark"></p></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Nomeamos o token e o criamos com a função <code><b>write</b></code> ou com a função <code><b>Fine-grained</b></code>, que nos permite selecionar exatamente quais permissões o token terá.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;"></p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Depois de criado, copiamos e colamos o arquivo abaixo</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">huggingface_hub</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">notebook_login</span></p>
<p><span style="color: #6b97e8;">notebook_login</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Conjunto-de-dados">
						<a class="anchor-link" href="#Conjunto-de-dados">
							<p style="margin-left: 20px">Conjunto de dados</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Vamos usar um conjunto de dados de [piadas em inglês] (https://huggingface.co/datasets/Maximofn/short-jokes-dataset)</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">datasets</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load_dataset</span></p>
<p></p>
<p><span style="color: #6b97e8;">jokes</span> <span>=</span> <span style="color: #6b97e8;">load_dataset</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;Maximofn/short-jokes-dataset&quot;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">jokes</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['ID', 'Joke'],</p><p>        num_rows: 231657</p><p>    })</p><p>})</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Vamos dar uma olhada nisso</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">jokes</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['ID', 'Joke'],</p><p>        num_rows: 231657</p><p>    })</p><p>})</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Vemos que se trata de um único conjunto de treinamento com mais de 200.000 piadas. Portanto, mais adiante, teremos de dividi-lo em treinamento e avaliação.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Vamos dar uma olhada em um exemplo</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">random</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">randint</span></p>
<p></p>
<p><span style="color: #6b97e8;">idx</span> <span>=</span> <span style="color: #6b97e8;">randint</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">])</span> <span>-</span> <span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">][</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">]</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>{'ID': 198387,</p><p> 'Joke': 'My hot dislexic co-worker said she had an important massage to give me in her office... When I got there, she told me it can wait until I put on some clothes.'}</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Vemos que ela tem uma identificação da piada que não nos interessa em absoluto e a piada em si</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Caso você tenha pouca memória de GPU, farei um subconjunto do conjunto de dados, escolha a porcentagem de piadas que deseja usar.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percent_of_train_dataset</span> <span>=</span> <span style="color: #7e7a38;">1</span>    <span style="color: #7f6e38;"># If you want 50% of the dataset, set this to 0.5</span></p>
<p></p>
<p><span style="color: #6b97e8;">subset_dataset</span> <span>=</span> <span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percent_of_train_dataset</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #6b97e8;">subset_dataset</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>Dataset({</p><p>    features: ['ID', 'Joke'],</p><p>    num_rows: 231657</p><p>})</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Agora, dividimos o subconjunto em um conjunto de treinamento e um conjunto de validação.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percent_of_train_dataset</span> <span>=</span> <span style="color: #a09e19;">0.90</span></p>
<p></p>
<p><span style="color: #6b97e8;">split_dataset</span> <span>=</span> <span style="color: #6b97e8;">subset_dataset</span><span>.</span><span style="color: #6b97e8;">train_test_split</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_size</span><span>=</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_dataset</span><span>.</span><span style="color: #6b97e8;">num_rows</span> <span>*</span> <span style="color: #6b97e8;">percent_of_train_dataset</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">19</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">validation_test_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;test&quot;</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #6b97e8;">split_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_test_dataset</span><span>.</span><span style="color: #6b97e8;">train_test_split</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_size</span><span>=</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_test_dataset</span><span>.</span><span style="color: #6b97e8;">num_rows</span> <span>*</span> <span style="color: #a09e19;">0.5</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">19</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;test&quot;</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Size of the train set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Size of the validation set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Size of the test set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>Size of the train set: 208491. Size of the validation set: 11583. Size of the test set: 11583</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Tokeniser">
						<a class="anchor-link" href="#Tokeniser">
							<p style="margin-left: 20px">Tokeniser</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Instanciar o tokenizador. Instanciar o token de preenchimento do tokenizador para não recebermos um erro como antes.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span></p>
<p></p>
<p><span style="color: #6b97e8;">checkpoints</span> <span>=</span> <span style="color: #7e7a34;">&quot;openai-community/gpt2&quot;</span></p>
<p></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">padding_side</span> <span>=</span> <span style="color: #7e7a34;">&quot;right&quot;</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Para maior controle, adicionaremos dois novos tokens para o início e o fim de uma piada.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">new_tokens</span> <span>=</span> <span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;&lt;SJ&gt;&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;&lt;EJ&gt;&#39;</span><span style="color: #e3e11d;">]</span>   <span style="color: #7f6e38;"># Start and end of joke tokens</span></p>
<p></p>
<p><span style="color: #6b97e8;">num_added_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">add_tokens</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">new_tokens</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Added </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">num_added_tokens</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> tokens&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>Added 2 tokens</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Criamos uma função para adicionar os novos tokens às sentenças</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">joke_column</span> <span>=</span> <span style="color: #7e7a34;">&quot;Joke&quot;</span></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">format_joke</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">]</span> <span>=</span> <span style="color: #8d783e;">&#39;&lt;SJ&gt; &#39;</span> <span>+</span> <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;Joke&#39;</span><span style="color: #e3e11d;">]</span> <span>+</span> <span style="color: #8d783e;">&#39; &lt;EJ&gt;&#39;</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">example</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Selecionamos as colunas de que não precisamos</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">remove_columns</span> <span>=</span> <span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">column</span> <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">column</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">column_names</span> <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">column</span> <span>!=</span> <span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">remove_columns</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>['ID']</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Formatamos o conjunto de dados e excluímos as colunas de que não precisamos.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">test_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">test_dataset</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>(Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 208491</p><p> }),</p><p> Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 11583</p><p> }),</p><p> Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 11583</p><p> }))</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Agora, criamos uma função para tokenizar as piadas.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">padding</span><span>=</span><span style="color: #7e7a34;">&quot;max_length&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">truncation</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_length</span><span>=</span><span style="color: #7e7a38;">768</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Tokenize o conjunto de dados e exclua a coluna com o texto</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">test_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">test_dataset</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>(Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 208491</p><p> }),</p><p> Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 11583</p><p> }),</p><p> Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 11583</p><p> }))</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Modelo">
						<a class="anchor-link" href="#Modelo">
							<p style="margin-left: 20px">Modelo</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Agora, instanciamos o modelo para geração de texto e atribuímos o token de fim de cadeia ao token de carregamento.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Vemos o tamanho do vocabulário do modelo</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">vocab_size</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">vocab_size</span></p>
<p><span style="color: #6b97e8;">vocab_size</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>50257</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Ele tem 50257 tokens, que é o tamanho do vocabulário do GPT2. Mas como dissemos que criaríamos dois novos tokens com o início da piada e o fim da piada, nós os adicionamos ao modelo</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">resize_token_embeddings</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">))</span></p>
<p></p>
<p><span style="color: #6b97e8;">new_vocab_size</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">vocab_size</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Old vocab size: </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">vocab_size</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. New vocab size: </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">new_vocab_size</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Added </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">new_vocab_size</span><span style="color: #7f6e38;"> </span><span>-</span><span style="color: #7f6e38;"> </span><span style="color: #6b97e8;">vocab_size</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> tokens&quot;</span><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_stream output_stdout output_text">
						<pre style="margin-left: 60px; line-height: 0%;"><p>Old vocab size: 50257. New vocab size: 50259. Added 2 tokens</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Os dois novos tokens foram adicionados</p>
				</div>
			</div>
		</div>
	</div>
	<!-- Open div header -->
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<h3 id="Treinamento">
						<a class="anchor-link" href="#Treinamento">
							<p style="margin-left: 20px">Treinamento</p>
						</a>
					</h3>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Definimos os parâmetros de treinamento</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">TrainingArguments</span></p>
<p></p>
<p><span style="color: #6b97e8;">metric_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;accuracy&quot;</span></p>
<p><span style="color: #6b97e8;">model_name</span> <span>=</span> <span style="color: #7e7a34;">&quot;GPT2-small-finetuned-Maximofn-short-jokes-dataset-casualLM&quot;</span></p>
<p><span style="color: #6b97e8;">output_dir</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;./training_results&quot;</span></p>
<p><span style="color: #6b97e8;">LR</span> <span>=</span> <span style="color: #a09e19;">2e-5</span></p>
<p><span style="color: #6b97e8;">BS_TRAIN</span> <span>=</span> <span style="color: #7e7a38;">28</span></p>
<p><span style="color: #6b97e8;">BS_EVAL</span> <span>=</span> <span style="color: #7e7a38;">32</span></p>
<p><span style="color: #6b97e8;">EPOCHS</span> <span>=</span> <span style="color: #7e7a38;">3</span></p>
<p><span style="color: #6b97e8;">WEIGHT_DECAY</span> <span>=</span> <span style="color: #a09e19;">0.01</span></p>
<p><span style="color: #6b97e8;">WARMUP_STEPS</span> <span>=</span> <span style="color: #7e7a38;">100</span></p>
<p></p>
<p><span style="color: #6b97e8;">training_args</span> <span>=</span> <span style="color: #6b97e8;">TrainingArguments</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model_name</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">save_strategy</span><span>=</span><span style="color: #7e7a34;">&quot;epoch&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">learning_rate</span><span>=</span><span style="color: #6b97e8;">LR</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_train_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_TRAIN</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">per_device_eval_batch_size</span><span>=</span><span style="color: #6b97e8;">BS_EVAL</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">warmup_steps</span><span>=</span><span style="color: #6b97e8;">WARMUP_STEPS</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">num_train_epochs</span><span>=</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">weight_decay</span><span>=</span><span style="color: #6b97e8;">WEIGHT_DECAY</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">lr_scheduler_type</span><span>=</span><span style="color: #7e7a34;">&quot;cosine&quot;</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">warmup_ratio</span> <span>=</span> <span style="color: #a09e19;">0.1</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">fp16</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">load_best_model_at_end</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #7f6e38;"># metric_for_best_model=metric_name,</span></p>
<p>    <span style="color: #6b97e8;">push_to_hub</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Agora não usamos <code><b>metric_for_best_model</b></code>, depois de definir o treinador, explicamos o motivo</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Definimos o treinador</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">Trainer</span></p>
<p></p>
<p><span style="color: #6b97e8;">trainer</span> <span>=</span> <span style="color: #6b97e8;">Trainer</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">training_args</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">train_dataset</span><span>=</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #7f6e38;"># compute_metrics=compute_metrics,</span></p>
<p><span style="color: #e3e11d;">)</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Nesse caso, não passamos uma função <code><b>compute_metrics</b></code>; se ela não for passada, a <code><b>loss</b></code> será usada durante a avaliação para avaliar o modelo. É por isso que, ao definir os argumentos, não definimos <code><b>metric_for_best_model</b></code>, pois não usaremos uma métrica para avaliar o modelo, mas a <code><b>loss</b></code>.</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing text_cell rendered">
		<div class="prompt input_prompt">
			<div class="inner_cell">
				<div class="text_cell_render border-box-sizing rendered_html">
					<p style="margin-left: 0px;">Treinamos</p>
				</div>
			</div>
		</div>
	</div>
	<div class="cell border-box-sizing code_cell rendered">
		<div class="input">
			<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
			<div class="inner_cell">
				<div class="input_area">
					<div class=" highlight hl-python3">
						<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
						</pre>
					</div>
				</div>
			</div>
		</div>
		<div class="output_wrapper">
			<div class="output">
				<div class="output_area">
					<div class="prompt" style="margin-left: 20px;">Output:</div>
					<div class="output_subarea output_text output_error">
						<pre style="margin-left: 60px; line-height: 0%;"><p><span style="color:red">---------------------------------------------------------------------------</span></p><p><span style="color:red">ValueError</span>                                Traceback (most recent call last)</p><p>Cell <span style="color:green">In[19], line 1</span></p><p><span style="color:green">----&gt; 1</span> trainer[38;5;241m.[39mtrain()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:1885</span>, in Trainer.train<span style="color:blue">(self, resume_from_checkpoint, trial, ignore_keys_for_eval, **kwargs)</span></p><p><span style="color:green"><b>   1883</b></span>         hf_hub_utils[38;5;241m.[39menable_progress_bars()</p><p><span style="color:green"><b>   1884</b></span> [38;5;28;01melse[39;00m:</p><p><span style="color:green">-&gt; 1885</span>     [38;5;28;01mreturn[39;00m inner_training_loop(</p><p><span style="color:green"><b>   1886</b></span>         args[38;5;241m=[39margs,</p><p><span style="color:green"><b>   1887</b></span>         resume_from_checkpoint[38;5;241m=[39mresume_from_checkpoint,</p><p><span style="color:green"><b>   1888</b></span>         trial[38;5;241m=[39mtrial,</p><p><span style="color:green"><b>   1889</b></span>         ignore_keys_for_eval[38;5;241m=[39mignore_keys_for_eval,</p><p><span style="color:green"><b>   1890</b></span>     )</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:2216</span>, in Trainer._inner_training_loop<span style="color:blue">(self, batch_size, args, resume_from_checkpoint, trial, ignore_keys_for_eval)</span></p><p><span style="color:green"><b>   2213</b></span>     [38;5;28mself[39m[38;5;241m.[39mcontrol [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mcallback_handler[38;5;241m.[39mon_step_begin(args, [38;5;28mself[39m[38;5;241m.[39mstate, [38;5;28mself[39m[38;5;241m.[39mcontrol)</p><p><span style="color:green"><b>   2215</b></span> [38;5;28;01mwith[39;00m [38;5;28mself[39m[38;5;241m.[39maccelerator[38;5;241m.[39maccumulate(model):</p><p><span style="color:green">-&gt; 2216</span>     tr_loss_step [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mtraining_step(model, inputs)</p><p><span style="color:green"><b>   2218</b></span> [38;5;28;01mif[39;00m (</p><p><span style="color:green"><b>   2219</b></span>     args[38;5;241m.[39mlogging_nan_inf_filter</p><p><span style="color:green"><b>   2220</b></span>     [38;5;129;01mand[39;00m [38;5;129;01mnot[39;00m is_torch_xla_available()</p><p><span style="color:green"><b>   2221</b></span>     [38;5;129;01mand[39;00m (torch[38;5;241m.[39misnan(tr_loss_step) [38;5;129;01mor[39;00m torch[38;5;241m.[39misinf(tr_loss_step))</p><p><span style="color:green"><b>   2222</b></span> ):</p><p><span style="color:green"><b>   2223</b></span>     [38;5;66;03m# if loss is nan or inf simply add the average of previous logged losses[39;00m</p><p><span style="color:green"><b>   2224</b></span>     tr_loss [38;5;241m+[39m[38;5;241m=[39m tr_loss [38;5;241m/[39m ([38;5;241m1[39m [38;5;241m+[39m [38;5;28mself[39m[38;5;241m.[39mstate[38;5;241m.[39mglobal_step [38;5;241m-[39m [38;5;28mself[39m[38;5;241m.[39m_globalstep_last_logged)</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:3238</span>, in Trainer.training_step<span style="color:blue">(self, model, inputs)</span></p><p><span style="color:green"><b>   3235</b></span>     [38;5;28;01mreturn[39;00m loss_mb[38;5;241m.[39mreduce_mean()[38;5;241m.[39mdetach()[38;5;241m.[39mto([38;5;28mself[39m[38;5;241m.[39margs[38;5;241m.[39mdevice)</p><p><span style="color:green"><b>   3237</b></span> [38;5;28;01mwith[39;00m [38;5;28mself[39m[38;5;241m.[39mcompute_loss_context_manager():</p><p><span style="color:green">-&gt; 3238</span>     loss [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mcompute_loss(model, inputs)</p><p><span style="color:green"><b>   3240</b></span> [38;5;28;01mdel[39;00m inputs</p><p><span style="color:green"><b>   3241</b></span> torch[38;5;241m.[39mcuda[38;5;241m.[39mempty_cache()</p><p></p><p>File <span style="color:green">~/miniconda3/envs/nlp_/lib/python3.11/site-packages/transformers/trainer.py:3282</span>, in Trainer.compute_loss<span style="color:blue">(self, model, inputs, return_outputs)</span></p><p><span style="color:green"><b>   3280</b></span> [38;5;28;01melse[39;00m:</p><p><span style="color:green"><b>   3281</b></span>     [38;5;28;01mif[39;00m [38;5;28misinstance[39m(outputs, [38;5;28mdict[39m) [38;5;129;01mand[39;00m [38;5;124m"[39m[38;5;124mloss[39m[38;5;124m"[39m [38;5;129;01mnot[39;00m [38;5;129;01min[39;00m outputs:</p><p><span style="color:green">-&gt; 3282</span>         [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(</p><p><span style="color:green"><b>   3283</b></span>             [38;5;124m"[39m[38;5;124mThe model did not return a loss from the inputs, only the following keys: [39m[38;5;124m"[39m</p><p><span style="color:green"><b>   3284</b></span>             [38;5;124mf[39m[38;5;124m"[39m[38;5;132;01m{[39;00m[38;5;124m'[39m[38;5;124m,[39m[38;5;124m'[39m[38;5;241m.[39mjoin(outputs[38;5;241m.[39mkeys())[38;5;132;01m}[39;00m[38;5;124m. For reference, the inputs it received are [39m[38;5;132;01m{[39;00m[38;5;124m'[39m[38;5;124m,[39m[38;5;124m'[39m[38;5;241m.[39mjoin(inputs[38;5;241m.[39mkeys())[38;5;132;01m}[39;00m[38;5;124m.[39m[38;5;124m"[39m</p><p><span style="color:green"><b>   3285</b></span>         )</p><p><span style="color:green"><b>   3286</b></span>     [38;5;66;03m# We don't use .loss here since the model may return tuples instead of ModelOutput.[39;00m</p><p><span style="color:green"><b>   3287</b></span>     loss [38;5;241m=[39m outputs[[38;5;124m"[39m[38;5;124mloss[39m[38;5;124m"[39m] [38;5;28;01mif[39;00m [38;5;28misinstance[39m(outputs, [38;5;28mdict[39m) [38;5;28;01melse[39;00m outputs[[38;5;241m0[39m]</p><p></p><p><span style="color:red">ValueError</span>: The model did not return a loss from the inputs, only the following keys: logits,past_key_values. For reference, the inputs it received are input_ids,attention_mask.</p></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Como podemos ver, ele nos dá um erro, diz que o modelo não retorna o valor da perda, o que é fundamental para podermos treinar.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Primeiro, vamos ver como é um exemplo do conjunto de dados.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">idx</span> <span>=</span> <span style="color: #6b97e8;">randint</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">)</span> <span>-</span> <span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">sample</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">sample</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>{'input_ids': [50257,</p><p>  4162,</p><p>  750,</p><p>  262,</p><p>  18757,</p><p>  6451,</p><p>  2245,</p><p>  2491,</p><p>  30,</p><p>  4362,</p><p>  340,</p><p>  373,</p><p>  734,</p><p>  10032,</p><p>  13,</p><p>  220,</p><p>  50258,</p><p>  50256,</p><p>  50256,</p><p>  ...,</p><p>  50256,</p><p>  50256,</p><p>  50256],</p><p> 'attention_mask': [1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  1,</p><p>  0,</p><p>  0,</p><p>  0,</p><p>  ...,</p><p>  0,</p><p>  0,</p><p>  0]}</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Como podemos ver, temos um dicionário com <code><b>input_ids</b></code> e <code><b>attention_mask</b></code> e, se o passarmos para o modelo, obteremos o seguinte</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;input_ids&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;attention_mask&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span></p>
<p><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">loss</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>None</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Como podemos ver, ele não retorna o valor da perda porque está aguardando um valor para <code><b>labels</b></code>, que não foi passado a ele. No exemplo anterior, em que fizemos o ajuste fino para a classificação de texto, dissemos que os rótulos tinham de ser passados para um campo no conjunto de dados chamado <code><b>labels</b></code>, mas, nesse caso, não temos esse campo no conjunto de dados.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;"></p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Se agora atribuirmos os <code><b>lables</b></code> aos <code><b>input_ids</b></code> e observarmos novamente a perda</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;input_ids&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;attention_mask&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span></p>
<p>    <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">Tensor</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;input_ids&quot;</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">long</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">unsqueeze</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">loss</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor(102.1873, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Agora temos uma "perda".</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;"></p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Portanto, temos duas opções: adicionar um campo <code><b>labels</b></code> ao conjunto de dados, com os valores de <code><b>input_ids</b></code> ou usar uma função da biblioteca <code><b>transformers</b></code> chamada <code><b>data_collator</b></code>; nesse caso, usaremos <code><b>DataCollatorForLanguageModeling</b></code>. Vamos dar uma olhada nisso</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">DataCollatorForLanguageModeling</span></p>
<p></p>
<p><span style="color: #6b97e8;">my_data_collator</span><span>=</span><span style="color: #6b97e8;">DataCollatorForLanguageModeling</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">mlm</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Passamos a amostra <code><b>sample</b></code> por meio desse <code><b>data_collator</b></code>.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">collated_sample</span> <span>=</span> <span style="color: #6b97e8;">my_data_collator</span><span style="color: #e3e11d;">([</span><span style="color: #6b97e8;">sample</span><span style="color: #e3e11d;">])</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vemos como é a saída</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">key</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">value</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">collated_sample</span><span>.</span><span style="color: #6b97e8;">items</span><span style="color: #e3e11d;">():</span></p>
<p>    <span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">key</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> (</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">value</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">): </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">value</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>input_ids (torch.Size([1, 768])): tensor([[50257,  4162,   750,   262, 18757,  6451,  2245,  2491,    30,  4362,</p><p>           340,   373,   734, 10032,    13,   220, 50258, 50256, ..., 50256, 50256]],</p><p>       device='cuda:0')</p><p>attention_mask (torch.Size([1, 768])): tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, ..., 0, 0]],</p><p>       device='cuda:0')</p><p>labels (torch.Size([1, 768])): tensor([[50257,  4162,   750,   262, 18757,  6451,  2245,  2491,    30,  4362,</p><p>           340,   373,   734, 10032,    13,   220, 50258,  -100,  ...,  -100,  -100]],</p><p>       device='cuda:0')</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Como você pode ver, o <code><b>data_collator</b></code> criou um campo <code><b>labels</b></code> e atribuiu a ele os valores de <code><b>input_ids</b></code>. Os tokens que são mascarados receberam um valor de -100. Isso se deve ao fato de que, quando definimos o <code><b>data_collator</b></code>, passamos a ele o parâmetro <code><b>mlm=False</b></code>, o que significa que não estamos fazendo <code><b>Masked Language Modeling</b></code>, mas <code><b>Language Modeling</b></code>, portanto, ele não mascara nenhum token original.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vamos ver se agora temos uma <code><b>perda</b></code> com esse <code><b>data_collator</b></code>.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span>**</span><span style="color: #6b97e8;">collated_sample</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">loss</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor(102.7181, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Portanto, redefinimos o <code><b>trainer</b></code> com o <code><b>data_collator</b></code> e treinamos novamente.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">DataCollatorForLanguageModeling</span></p>
<p></p>
<p><span style="color: #6b97e8;">trainer</span> <span>=</span> <span style="color: #6b97e8;">Trainer</span><span style="color: #e3e11d;">(</span></p>
<p>    <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">training_args</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">train_dataset</span><span>=</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span></p>
<p>    <span style="color: #6b97e8;">data_collator</span><span>=</span><span style="color: #6b97e8;">DataCollatorForLanguageModeling</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">mlm</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">),</span></p>
<p><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>TrainOutput(global_step=22341, training_loss=3.505178199598342, metrics={'train_runtime': 9209.5353, 'train_samples_per_second': 67.916, 'train_steps_per_second': 2.426, 'total_flos': 2.45146666696704e+17, 'train_loss': 3.505178199598342, 'epoch': 3.0})</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Avaliação">
					<a class="anchor-link" href="#Avaliação">
						<p style="margin-left: 20px">Avaliação</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Depois de treinado, avaliamos o modelo no conjunto de dados de teste.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">evaluate</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">eval_dataset</span><span>=</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>{'eval_loss': 3.201305866241455,</p><p> 'eval_runtime': 65.0033,</p><p> 'eval_samples_per_second': 178.191,</p><p> 'eval_steps_per_second': 5.569,</p><p> 'epoch': 3.0}</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Publicar-o-modelo">
					<a class="anchor-link" href="#Publicar-o-modelo">
						<p style="margin-left: 20px">Publicar o modelo</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos o cartão modelo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">create_model_card</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Nós o publicamos</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">trainer</span><span>.</span><span style="color: #6b97e8;">push_to_hub</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>CommitInfo(commit_url='https://huggingface.co/Maximofn/GPT2-small-finetuned-Maximofn-short-jokes-dataset-casualLM/commit/d107b3bb0e02076483238f9975697761015ec390', commit_message='End of training', commit_description='', oid='d107b3bb0e02076483238f9975697761015ec390', pr_url=None, pr_revision=None, pr_num=None)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Uso-do-modelo">
					<a class="anchor-link" href="#Uso-do-modelo">
						<p style="margin-left: 20px">Uso do modelo</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Limpamos o máximo possível</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">gc</span></p>
<p></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">clear_hardwares</span><span style="color: #e3e11d;">():</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">clear_autocast_cache</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">ipc_collect</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">empty_cache</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">gc</span><span>.</span><span style="color: #6b97e8;">collect</span><span style="color: #e3e11d;">()</span></p>
<p></p>
<p></p>
<p><span style="color: #6b97e8;">clear_hardwares</span><span style="color: #e3e11d;">()</span></p>
<p><span style="color: #6b97e8;">clear_hardwares</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Baixamos o modelo e o tokenizador</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span></p>
<p></p>
<p><span style="color: #6b97e8;">user</span> <span>=</span> <span style="color: #7e7a34;">&quot;maximofn&quot;</span></p>
<p><span style="color: #6b97e8;">checkpoints</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">user</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">/</span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">model_name</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span></p>
<p></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">padding_side</span> <span>=</span> <span style="color: #7e7a34;">&quot;right&quot;</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Verificamos se o tokenizador e o modelo têm os dois tokens extras que adicionamos.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">tokenizer_vocab</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">get_vocab</span><span style="color: #e3e11d;">()</span></p>
<p><span style="color: #6b97e8;">model_vocab</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">vocab_size</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;tokenizer_vocab: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer_vocab</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. model_vocab: </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">model_vocab</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tokenizer_vocab: 50259. model_vocab: 50259</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vemos que eles têm 50259 tokens, ou seja, os 50257 tokens do GPT2 mais os 2 que adicionamos.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos uma função para gerar piadas</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">generate_joke</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">prompt_text</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">text</span> <span>=</span> <span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;&lt;SJ&gt; </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">prompt_text</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span></p>
<p>    <span style="color: #6b97e8;">tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">text</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">with</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">no_grad</span><span style="color: #e3e11d;">():</span></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">generate</span><span style="color: #e3e11d;">(</span><span>**</span><span style="color: #6b97e8;">tokens</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_new_tokens</span><span>=</span><span style="color: #7e7a38;">256</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">eos_token_id</span><span>=</span><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">encode</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;&lt;EJ&gt;&quot;</span><span style="color: #e3e11d;">)[</span><span>-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">])</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">decode</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">skip_special_tokens</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Geramos uma piada</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">generate_joke</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;Why didn&#39;t the frog cross the road?&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>"&lt;SJ&gt; Why didn't the frog cross the road? Because he was frog-in-the-face. &lt;EJ&gt;"</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Se você quiser testar o modelo com mais detalhes, poderá vê-lo em <a href="https://huggingface.co/Maximofn/GPT2-small-finetuned-Maximofn-short-jokes-dataset-casualLM" target="_blank">Maximofn/GPT2-small-finetuned-Maximofn-short-jokes-dataset-casualLM</a></p>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h2 id="Ajuste-fino-para-classificação-de-texto-com-o-Pytorch">
					<a class="anchor-link" href="#Ajuste-fino-para-classificação-de-texto-com-o-Pytorch">
						<p style="margin-left: 10px">Ajuste fino para classificação de texto com o Pytorch</p>
					</a>
				</h2>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Repetimos o treinamento com o Pytorch</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Reinicie o notebook para ter certeza de que</p>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Conjunto-de-dados">
					<a class="anchor-link" href="#Conjunto-de-dados">
						<p style="margin-left: 20px">Conjunto de dados</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Fizemos o download do mesmo conjunto de dados que usamos no treinamento com as bibliotecas Hugging Face.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">datasets</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load_dataset</span></p>
<p></p>
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">load_dataset</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;mteb/amazon_reviews_multi&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #7e7a34;">&quot;en&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos uma variável com o número de classes</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">num_classes</span> <span>=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">unique</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">num_classes</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>5</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Antes, processávamos todo o conjunto de dados para criar um campo chamado <code><b>labels</b></code>, mas agora isso não é necessário porque vamos programar tudo nós mesmos, portanto, nos adaptamos à aparência do conjunto de dados.</p>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Tokeniser">
					<a class="anchor-link" href="#Tokeniser">
						<p style="margin-left: 20px">Tokeniser</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos o tokenizador. Atribuímos o token de preenchimento para não recebermos um erro como antes.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span></p>
<p></p>
<p><span style="color: #6b97e8;">checkpoint</span> <span>=</span> <span style="color: #7e7a34;">&quot;openai-community/gpt2&quot;</span></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos uma função para tokenizar o conjunto de dados</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;text&quot;</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">padding</span><span>=</span><span style="color: #7e7a34;">&quot;max_length&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">truncation</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_length</span><span>=</span><span style="color: #7e7a38;">768</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Nós a tokenizamos. Removemos as colunas que não são necessárias, mas agora deixamos a coluna de texto.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;id&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;label_text&#39;</span><span style="color: #e3e11d;">])</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">dataset</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['text', 'label', 'input_ids', 'attention_mask'],</p><p>        num_rows: 200000</p><p>    })</p><p>    validation: Dataset({</p><p>        features: ['text', 'label', 'input_ids', 'attention_mask'],</p><p>        num_rows: 5000</p><p>    })</p><p>    test: Dataset({</p><p>        features: ['text', 'label', 'input_ids', 'attention_mask'],</p><p>        num_rows: 5000</p><p>    })</p><p>})</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percentage</span> <span>=</span> <span style="color: #7e7a38;">1</span></p>
<p><span style="color: #6b97e8;">subset_train</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;train&#39;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percentage</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #6b97e8;">percentage</span> <span>=</span> <span style="color: #7e7a38;">1</span></p>
<p><span style="color: #6b97e8;">subset_validation</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;validation&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;validation&#39;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percentage</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #6b97e8;">subset_test</span> <span>=</span> <span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;test&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;test&#39;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percentage</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;len subset_train: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_train</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">, len subset_validation: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_validation</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">, len subset_test: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_test</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>len subset_train: 200000, len subset_validation: 5000, len subset_test: 5000</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Modelo">
					<a class="anchor-link" href="#Modelo">
						<p style="margin-left: 20px">Modelo</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Importamos os pesos e atribuímos o token de preenchimento</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForSequenceClassification</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoint</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">num_labels</span><span>=</span><span style="color: #6b97e8;">num_classes</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Some weights of GPT2ForSequenceClassification were not initialized from the model checkpoint at openai-community/gpt2 and are newly initialized: ['score.weight']</p><p>You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Dispositivo">
					<a class="anchor-link" href="#Dispositivo">
						<p style="margin-left: 20px">Dispositivo</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos o dispositivo onde tudo será executado</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">device</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;cuda&#39;</span> <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">is_available</span><span style="color: #e3e11d;">()</span> <span style="color: #a04cc1;">else</span> <span style="color: #8d783e;">&#39;cpu&#39;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Passamos o modelo para o dispositivo e o passamos para o FP16 para que ele ocupe menos memória.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">half</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Conjunto-de-dados-Pytorch">
					<a class="anchor-link" href="#Conjunto-de-dados-Pytorch">
						<p style="margin-left: 20px">Conjunto de dados Pytorch</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criar um conjunto de dados pytorch</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">torch.utils.data</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">Dataset</span></p>
<p></p>
<p><span style="color: #a04cc1;">class</span> <span style="color: #7f6e38;">ReviewsDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">Dataset</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__init__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">huggingface_dataset</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">huggingface_dataset</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__getitem__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #6b97e8;">label</span> <span>=</span> <span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;label&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">tensor</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">])</span></p>
<p>        <span style="color: #6b97e8;">attention_mask</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">tensor</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">])</span></p>
<p>        <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">label</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__len__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #a04cc1;">return</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Instanciar os conjuntos de dados</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">ReviewsDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_train</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validatation_dataset</span> <span>=</span> <span style="color: #6b97e8;">ReviewsDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_validation</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">ReviewsDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_test</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vamos dar uma olhada em um exemplo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">label</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">label</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([768]), torch.Size([768]), 0)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Carregador-de-dados-Pytorch">
					<a class="anchor-link" href="#Carregador-de-dados-Pytorch">
						<p style="margin-left: 20px">Carregador de dados Pytorch</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos agora um carregador de dados pytorch</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">torch.utils.data</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">DataLoader</span></p>
<p></p>
<p><span style="color: #6b97e8;">BS</span> <span>=</span> <span style="color: #7e7a38;">12</span></p>
<p></p>
<p><span style="color: #6b97e8;">train_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validatation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vamos dar uma olhada em um exemplo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #dfd84a;">next</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">iter</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([12, 768]),</p><p> torch.Size([12, 768]),</p><p> tensor([2, 1, 2, 0, 3, 3, 0, 4, 3, 3, 4, 2]))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Para verificar se está tudo certo, passamos a amostra para o modelo para ver se está tudo certo. Primeiro, passamos os tokens para o dispositivo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">at_mask</span> <span>=</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #6b97e8;">labels</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Agora, nós os passamos para o modelo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">keys</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>odict_keys(['loss', 'logits', 'past_key_values'])</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Como podemos ver, ele nos fornece a perda e os logits.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor(5.9414, device='cuda:0', dtype=torch.float16,</p><p>       grad_fn=&lt;NllLossBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">]</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor([[ 6.1953e+00, -1.2275e+00, -2.4824e+00,  5.8867e+00, -1.4734e+01],</p><p>        [ 5.4062e+00, -8.4570e-01, -2.3203e+00,  5.1055e+00, -1.1555e+01],</p><p>        [ 6.1641e+00, -9.3066e-01, -2.5664e+00,  6.0039e+00, -1.4570e+01],</p><p>        [ 5.2266e+00, -4.2358e-01, -2.0801e+00,  4.7461e+00, -1.1570e+01],</p><p>        [ 3.8184e+00, -2.3460e-03, -1.7666e+00,  3.4160e+00, -7.7969e+00],</p><p>        [ 4.1641e+00, -4.8169e-01, -1.6914e+00,  3.9941e+00, -8.7734e+00],</p><p>        [ 4.6758e+00, -3.0298e-01, -2.1641e+00,  4.1055e+00, -9.3359e+00],</p><p>        [ 4.1953e+00, -3.2471e-01, -2.1875e+00,  3.9375e+00, -8.3438e+00],</p><p>        [-1.1650e+00,  1.3564e+00, -6.2158e-01, -6.8115e-01,  4.8672e+00],</p><p>        [ 4.4961e+00, -8.7891e-02, -2.2793e+00,  4.2812e+00, -9.3359e+00],</p><p>        [ 4.9336e+00, -2.6627e-03, -2.1543e+00,  4.3711e+00, -1.0742e+01],</p><p>        [ 5.9727e+00, -4.3152e-02, -1.4551e+00,  4.3438e+00, -1.2117e+01]],</p><p>       device='cuda:0', dtype=torch.float16, grad_fn=&lt;IndexBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Métrica">
					<a class="anchor-link" href="#Métrica">
						<p style="margin-left: 20px">Métrica</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vamos criar uma função para obter a métrica, que, neste caso, será a precisão</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">predicted_labels</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">percent</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">softmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">dim</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">predictions</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">argmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">percent</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">dim</span><span>=</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">predictions</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">compute_accuracy</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">predictions</span> <span>=</span> <span style="color: #6b97e8;">predicted_labels</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">logits</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">correct</span> <span>=</span> <span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">predictions</span> <span>==</span> <span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">float</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">correct</span><span>.</span><span style="color: #6b97e8;">mean</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vamos ver como ele calcula bem</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">compute_accuracy</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>0.1666666716337204</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Otimizador">
					<a class="anchor-link" href="#Otimizador">
						<p style="margin-left: 20px">Otimizador</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Como precisaremos de um otimizador, criamos um.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AdamW</span></p>
<p></p>
<p><span style="color: #6b97e8;">LR</span> <span>=</span> <span style="color: #a09e19;">2e-5</span></p>
<p><span style="color: #6b97e8;">optimizer</span> <span>=</span> <span style="color: #6b97e8;">AdamW</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">parameters</span><span style="color: #e3e11d;">(),</span> <span style="color: #6b97e8;">lr</span><span>=</span><span style="color: #6b97e8;">LR</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>/usr/local/lib/python3.10/dist-packages/transformers/optimization.py:588: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning</p><p>  warnings.warn(</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Treinamento">
					<a class="anchor-link" href="#Treinamento">
						<p style="margin-left: 20px">Treinamento</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos o loop de treinamento</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">tqdm</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">tqdm</span></p>
<p></p>
<p><span style="color: #6b97e8;">EPOCHS</span> <span>=</span> <span style="color: #7e7a38;">3</span></p>
<p></p>
<p><span style="color: #6b97e8;">accuracy</span> <span>=</span> <span style="color: #7e7a38;">0</span></p>
<p></p>
<p><span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">epoch</span> <span style="color: #7f6e38;">in</span> <span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">train_loss</span> <span>=</span> <span style="color: #7e7a38;">0</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span> <span>=</span> <span style="color: #6b97e8;">tqdm</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">total</span><span>=</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">desc</span><span>=</span><span style="color: #1b1477;">f</span><span style="color: #8d783e;">&#39;Epoch </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">epoch</span><span style="color: #7f6e38;"> </span><span>+</span><span style="color: #7f6e38;"> </span><span style="color: #7e7a38;">1</span><span style="color: #3b75c2;">}</span><span style="color: #8d783e;">&#39;</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">progresbar</span><span style="color: #e3e11d;">:</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">at_mask</span> <span>=</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">label</span> <span>=</span> <span style="color: #6b97e8;">labels</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">label</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">loss</span> <span>=</span> <span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>        <span style="color: #6b97e8;">train_loss</span> <span>+=</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">optimizer</span><span>.</span><span style="color: #6b97e8;">zero_grad</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">backward</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">optimizer</span><span>.</span><span style="color: #6b97e8;">step</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;train_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()})</span></p>
<p>    <span style="color: #6b97e8;">train_loss</span> <span>/=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;train_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">train_loss</span><span style="color: #e3e11d;">})</span></p>
<p></p>
<p>    <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">eval</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">valid_loss</span> <span>=</span> <span style="color: #7e7a38;">0</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span> <span>=</span> <span style="color: #6b97e8;">tqdm</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_loader</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">total</span><span>=</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_loader</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">desc</span><span>=</span><span style="color: #1b1477;">f</span><span style="color: #8d783e;">&#39;Epoch </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">epoch</span><span style="color: #7f6e38;"> </span><span>+</span><span style="color: #7f6e38;"> </span><span style="color: #7e7a38;">1</span><span style="color: #3b75c2;">}</span><span style="color: #8d783e;">&#39;</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">progresbar</span><span style="color: #e3e11d;">:</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">at_mask</span> <span>=</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">labels</span> <span>=</span> <span style="color: #6b97e8;">labels</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">loss</span> <span>=</span> <span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>        <span style="color: #6b97e8;">valid_loss</span> <span>+=</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">step_accuracy</span> <span>=</span> <span style="color: #6b97e8;">compute_accuracy</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">labels</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">accuracy</span> <span>+=</span> <span style="color: #6b97e8;">step_accuracy</span></p>
<p>        <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;valid_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">(),</span> <span style="color: #8d783e;">&#39;accuracy&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">step_accuracy</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()})</span></p>
<p></p>
<p>    <span style="color: #6b97e8;">valid_loss</span> <span>/=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_loader</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">accuracy</span> <span>/=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_loader</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;valid_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">valid_loss</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;accuracy&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">accuracy</span><span style="color: #e3e11d;">})</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Epoch 1: 100%|██████████| 16667/16667 [44:13&lt;00:00,  6.28it/s, train_loss=nan]</p><p>Epoch 1: 100%|██████████| 417/417 [00:32&lt;00:00, 12.72it/s, valid_loss=nan, accuracy=0]</p><p>Epoch 2: 100%|██████████| 16667/16667 [44:06&lt;00:00,  6.30it/s, train_loss=nan]</p><p>Epoch 2: 100%|██████████| 417/417 [00:32&lt;00:00, 12.77it/s, valid_loss=nan, accuracy=0]</p><p>Epoch 3: 100%|██████████| 16667/16667 [44:03&lt;00:00,  6.30it/s, train_loss=nan]</p><p>Epoch 3: 100%|██████████| 417/417 [00:32&lt;00:00, 12.86it/s, valid_loss=nan, accuracy=0]</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Uso-do-modelo">
					<a class="anchor-link" href="#Uso-do-modelo">
						<p style="margin-left: 20px">Uso do modelo</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vamos testar o modelo que treinamos</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Primeiro, tokenizamos um texto</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">({</span><span style="color: #7e7a34;">&quot;text&quot;</span><span style="color: #e3e11d;">:</span> <span style="color: #7e7a34;">&quot;I love this product. It is amazing.&quot;</span><span style="color: #e3e11d;">})</span></p>
<p><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">shape</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([1, 768]), torch.Size([1, 768]))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Agora, passamos isso para o modelo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">]</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor([[nan, nan, nan, nan, nan]], device='cuda:0', dtype=torch.float16,</p><p>       grad_fn=&lt;IndexBackward0&gt;)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vemos as previsões desses logits</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">predicted</span> <span>=</span> <span style="color: #6b97e8;">predicted_labels</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">predicted</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>tensor([0], device='cuda:0')</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h2 id="Ajuste-fino-para-geração-de-texto-com-o-Pytorch">
					<a class="anchor-link" href="#Ajuste-fino-para-geração-de-texto-com-o-Pytorch">
						<p style="margin-left: 10px">Ajuste fino para geração de texto com o Pytorch</p>
					</a>
				</h2>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Repetimos o treinamento com o Pytorch</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Reinicie o notebook para ter certeza de que</p>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Conjunto-de-dados">
					<a class="anchor-link" href="#Conjunto-de-dados">
						<p style="margin-left: 20px">Conjunto de dados</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Baixamos novamente o conjunto de dados de piadas</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">datasets</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">load_dataset</span></p>
<p></p>
<p><span style="color: #6b97e8;">jokes</span> <span>=</span> <span style="color: #6b97e8;">load_dataset</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;Maximofn/short-jokes-dataset&quot;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">jokes</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>DatasetDict({</p><p>    train: Dataset({</p><p>        features: ['ID', 'Joke'],</p><p>        num_rows: 231657</p><p>    })</p><p>})</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Crie um subconjunto caso você esteja com pouca memória</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percent_of_train_dataset</span> <span>=</span> <span style="color: #7e7a38;">1</span>    <span style="color: #7f6e38;"># If you want 50% of the dataset, set this to 0.5</span></p>
<p></p>
<p><span style="color: #6b97e8;">subset_dataset</span> <span>=</span> <span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">select</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">jokes</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">])</span> <span>*</span> <span style="color: #6b97e8;">percent_of_train_dataset</span><span style="color: #e3e11d;">)))</span></p>
<p><span style="color: #6b97e8;">subset_dataset</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Dataset({</p><p>    features: ['ID', 'Joke'],</p><p>    num_rows: 231657</p><p>})</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Dividimos o conjunto de dados em subconjuntos de treinamento, validação e teste.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">percent_of_train_dataset</span> <span>=</span> <span style="color: #a09e19;">0.90</span></p>
<p></p>
<p><span style="color: #6b97e8;">split_dataset</span> <span>=</span> <span style="color: #6b97e8;">subset_dataset</span><span>.</span><span style="color: #6b97e8;">train_test_split</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_size</span><span>=</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">subset_dataset</span><span>.</span><span style="color: #6b97e8;">num_rows</span> <span>*</span> <span style="color: #6b97e8;">percent_of_train_dataset</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">19</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">validation_test_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;test&quot;</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #6b97e8;">split_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_test_dataset</span><span>.</span><span style="color: #6b97e8;">train_test_split</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_size</span><span>=</span><span style="color: #dfd84a;">int</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_test_dataset</span><span>.</span><span style="color: #6b97e8;">num_rows</span> <span>*</span> <span style="color: #a09e19;">0.5</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">seed</span><span>=</span><span style="color: #7e7a38;">19</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">False</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;train&quot;</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">split_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a34;">&quot;test&quot;</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Size of the train set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Size of the validation set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">. Size of the test set: </span><span style="color: #3b75c2;">{</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">)</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;">&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Size of the train set: 208491. Size of the validation set: 11583. Size of the test set: 11583</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Tokeniser">
					<a class="anchor-link" href="#Tokeniser">
						<p style="margin-left: 20px">Tokeniser</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Iniciamos o tokenizador e atribuímos o token do final da string ao token de preenchimento.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoTokenizer</span></p>
<p></p>
<p><span style="color: #6b97e8;">checkpoints</span> <span>=</span> <span style="color: #7e7a34;">&quot;openai-community/gpt2&quot;</span></p>
<p></p>
<p><span style="color: #6b97e8;">tokenizer</span> <span>=</span> <span style="color: #6b97e8;">AutoTokenizer</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">pad_token</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">eos_token</span></p>
<p><span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">padding_side</span> <span>=</span> <span style="color: #7e7a34;">&quot;right&quot;</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Adicionamos os tokens especiais para o início e o fim de uma piada.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">new_tokens</span> <span>=</span> <span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;&lt;SJ&gt;&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #8d783e;">&#39;&lt;EJ&gt;&#39;</span><span style="color: #e3e11d;">]</span>   <span style="color: #7f6e38;"># Start and end of joke tokens</span></p>
<p></p>
<p><span style="color: #6b97e8;">num_added_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">add_tokens</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">new_tokens</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">(</span><span style="color: #1b1477;">f</span><span style="color: #7e7a34;">&quot;Added </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">num_added_tokens</span><span style="color: #3b75c2;">}</span><span style="color: #7e7a34;"> tokens&quot;</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Added 2 tokens</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Nós os adicionamos ao conjunto de dados</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">joke_column</span> <span>=</span> <span style="color: #7e7a34;">&quot;Joke&quot;</span></p>
<p></p>
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">format_joke</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">]</span> <span>=</span> <span style="color: #8d783e;">&#39;&lt;SJ&gt; &#39;</span> <span>+</span> <span style="color: #6b97e8;">example</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;Joke&#39;</span><span style="color: #e3e11d;">]</span> <span>+</span> <span style="color: #8d783e;">&#39; &lt;EJ&gt;&#39;</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">example</span></p>
<p></p>
<p><span style="color: #6b97e8;">remove_columns</span> <span>=</span> <span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">column</span> <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">column</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">column_names</span> <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">column</span> <span>!=</span> <span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">]</span></p>
<p></p>
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">test_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">format_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #6b97e8;">remove_columns</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">test_dataset</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 208491</p><p> }),</p><p> Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 11583</p><p> }),</p><p> Dataset({</p><p>     features: ['Joke'],</p><p>     num_rows: 11583</p><p> }))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Tokenizamos o conjunto de dados</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">tokenize_function</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">examples</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">],</span> <span style="color: #6b97e8;">padding</span><span>=</span><span style="color: #7e7a34;">&quot;max_length&quot;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">truncation</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_length</span><span>=</span><span style="color: #7e7a38;">768</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">return_tensors</span><span>=</span><span style="color: #7e7a34;">&quot;pt&quot;</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p><span style="color: #6b97e8;">train_dataset</span> <span>=</span> <span style="color: #6b97e8;">train_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">validation_dataset</span> <span>=</span> <span style="color: #6b97e8;">validation_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">test_dataset</span> <span>=</span> <span style="color: #6b97e8;">test_dataset</span><span>.</span><span style="color: #6b97e8;">map</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batched</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">remove_columns</span><span>=</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">joke_column</span><span style="color: #e3e11d;">])</span></p>
<p><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">test_dataset</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 208491</p><p> }),</p><p> Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 11583</p><p> }),</p><p> Dataset({</p><p>     features: ['input_ids', 'attention_mask'],</p><p>     num_rows: 11583</p><p> }))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Modelo">
					<a class="anchor-link" href="#Modelo">
						<p style="margin-left: 20px">Modelo</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Instanciar o modelo, atribuir o token de preenchimento e adicionar os novos tokens de início e fim de piada.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span></p>
<p></p>
<p><span style="color: #6b97e8;">model</span> <span>=</span> <span style="color: #6b97e8;">AutoModelForCausalLM</span><span>.</span><span style="color: #6b97e8;">from_pretrained</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">checkpoints</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">pad_token_id</span> <span>=</span> <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">config</span><span>.</span><span style="color: #6b97e8;">eos_token_id</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">resize_token_embeddings</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">tokenizer</span><span style="color: #e3e11d;">))</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Embedding(50259, 768)</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Dispositivo">
					<a class="anchor-link" href="#Dispositivo">
						<p style="margin-left: 20px">Dispositivo</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos o dispositivo e passamos o modelo para o dispositivo.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">import</span> <span style="color: #4fcd7d;">torch</span></p>
<p></p>
<p><span style="color: #6b97e8;">device</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">(</span><span style="color: #8d783e;">&#39;cuda&#39;</span> <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">cuda</span><span>.</span><span style="color: #6b97e8;">is_available</span><span style="color: #e3e11d;">()</span> <span style="color: #a04cc1;">else</span> <span style="color: #8d783e;">&#39;cpu&#39;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">half</span><span style="color: #e3e11d;">()</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #dfd84a;">print</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Conjunto-de-dados-Pytorch">
					<a class="anchor-link" href="#Conjunto-de-dados-Pytorch">
						<p style="margin-left: 20px">Conjunto de dados Pytorch</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criar um conjunto de dados pytorch</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">torch.utils.data</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">Dataset</span></p>
<p></p>
<p><span style="color: #a04cc1;">class</span> <span style="color: #7f6e38;">JokesDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">Dataset</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__init__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">huggingface_dataset</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span> <span>=</span> <span style="color: #6b97e8;">huggingface_dataset</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__getitem__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">tensor</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">])</span></p>
<p>        <span style="color: #6b97e8;">attention_mask</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">tensor</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">[</span><span style="color: #6b97e8;">idx</span><span style="color: #e3e11d;">][</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">])</span></p>
<p>        <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span></p>
<p></p>
<p>    <span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">__len__</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #a04cc1;">return</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #7f6e38;">self</span><span>.</span><span style="color: #6b97e8;">dataset</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Instanciamos os conjuntos de dados de treinamento, validação e teste.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">train_pytorch_dataset</span> <span>=</span> <span style="color: #6b97e8;">JokesDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_dataset</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_pytorch_dataset</span> <span>=</span> <span style="color: #6b97e8;">JokesDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_dataset</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_pytorch_dataset</span> <span>=</span> <span style="color: #6b97e8;">JokesDataset</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_dataset</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Aqui está um exemplo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span> <span>=</span> <span style="color: #6b97e8;">train_pytorch_dataset</span><span style="color: #e3e11d;">[</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">]</span></p>
<p><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>.</span><span style="color: #6b97e8;">shape</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([768]), torch.Size([768]))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Carregador-de-dados-Pytorch">
					<a class="anchor-link" href="#Carregador-de-dados-Pytorch">
						<p style="margin-left: 20px">Carregador de dados Pytorch</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos os carregadores de dados</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">torch.utils.data</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">DataLoader</span></p>
<p></p>
<p><span style="color: #6b97e8;">BS</span> <span>=</span> <span style="color: #7e7a38;">28</span></p>
<p></p>
<p><span style="color: #6b97e8;">train_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_pytorch_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">shuffle</span><span>=</span><span style="color: #7f6e38;">True</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">validation_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">validation_pytorch_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">test_loader</span> <span>=</span> <span style="color: #6b97e8;">DataLoader</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">test_pytorch_dataset</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">batch_size</span><span>=</span><span style="color: #6b97e8;">BS</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Vemos uma amostra</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span> <span>=</span> <span style="color: #dfd84a;">next</span><span style="color: #e3e11d;">(</span><span style="color: #dfd84a;">iter</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">shape</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>.</span><span style="color: #6b97e8;">shape</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>(torch.Size([28, 768]), torch.Size([28, 768]))</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Passamos isso para o modelo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">attention_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">keys</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>odict_keys(['logits', 'past_key_values'])</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Como podemos ver, não temos nenhum valor de <code><b>perda</b></code>, pois, como vimos, temos que passar os <code><b>input_ids</b></code> e os <code><b>labels</b></code>.</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">attention_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p><span style="color: #6b97e8;">output</span><span>.</span><span style="color: #6b97e8;">keys</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>odict_keys(['loss', 'logits', 'past_key_values'])</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Agora temos a "perda".</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>80.5625</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Otimizador">
					<a class="anchor-link" href="#Otimizador">
						<p style="margin-left: 20px">Otimizador</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos um otimizador</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">transformers</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">AdamW</span></p>
<p></p>
<p><span style="color: #6b97e8;">LR</span> <span>=</span> <span style="color: #a09e19;">2e-5</span></p>
<p><span style="color: #6b97e8;">optimizer</span> <span>=</span> <span style="color: #6b97e8;">AdamW</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">parameters</span><span style="color: #e3e11d;">(),</span> <span style="color: #6b97e8;">lr</span><span>=</span><span style="color: #a09e19;">5e-5</span><span style="color: #e3e11d;">)</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>/usr/local/lib/python3.10/dist-packages/transformers/optimization.py:588: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning</p><p>  warnings.warn(</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Treinamento">
					<a class="anchor-link" href="#Treinamento">
						<p style="margin-left: 20px">Treinamento</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Criamos o loop de treinamento</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #833aa0;">from</span> <span style="color: #4fcd7d;">tqdm</span> <span style="color: #833aa0;">import</span> <span style="color: #6b97e8;">tqdm</span></p>
<p></p>
<p><span style="color: #6b97e8;">EPOCHS</span> <span>=</span> <span style="color: #7e7a38;">3</span></p>
<p></p>
<p><span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">epoch</span> <span style="color: #7f6e38;">in</span> <span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">EPOCHS</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">model</span><span>.</span><span style="color: #6b97e8;">train</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">train_loss</span> <span>=</span> <span style="color: #7e7a38;">0</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span> <span>=</span> <span style="color: #6b97e8;">tqdm</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">total</span><span>=</span><span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">desc</span><span>=</span><span style="color: #1b1477;">f</span><span style="color: #8d783e;">&#39;Epoch </span><span style="color: #3b75c2;">{</span><span style="color: #6b97e8;">epoch</span><span style="color: #7f6e38;"> </span><span>+</span><span style="color: #7f6e38;"> </span><span style="color: #7e7a38;">1</span><span style="color: #3b75c2;">}</span><span style="color: #8d783e;">&#39;</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">at_mask</span> <span style="color: #7f6e38;">in</span> <span style="color: #6b97e8;">progresbar</span><span style="color: #e3e11d;">:</span></p>
<p>        <span style="color: #6b97e8;">input_ids</span> <span>=</span> <span style="color: #6b97e8;">input_ids</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #6b97e8;">at_mask</span> <span>=</span> <span style="color: #6b97e8;">at_mask</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_ids</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">at_mask</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">labels</span><span>=</span><span style="color: #6b97e8;">input_ids</span><span style="color: #e3e11d;">)</span></p>
<p></p>
<p>        <span style="color: #6b97e8;">loss</span> <span>=</span> <span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;loss&#39;</span><span style="color: #e3e11d;">]</span></p>
<p>        <span style="color: #6b97e8;">train_loss</span> <span>+=</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">optimizer</span><span>.</span><span style="color: #6b97e8;">zero_grad</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">backward</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">optimizer</span><span>.</span><span style="color: #6b97e8;">step</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;train_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">loss</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()})</span></p>
<p>    <span style="color: #6b97e8;">train_loss</span> <span>/=</span> <span style="color: #dfd84a;">len</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">train_loader</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">progresbar</span><span>.</span><span style="color: #6b97e8;">set_postfix</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;train_loss&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">train_loss</span><span style="color: #e3e11d;">})</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>Epoch 1: 100%|██████████| 7447/7447 [51:07&lt;00:00,  2.43it/s, train_loss=nan]</p><p>Epoch 2: 100%|██████████| 7447/7447 [51:06&lt;00:00,  2.43it/s, train_loss=nan]</p><p>Epoch 3: 100%|██████████| 7447/7447 [51:07&lt;00:00,  2.43it/s, train_loss=nan]</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Open div header -->
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<h3 id="Uso-do-modelo">
					<a class="anchor-link" href="#Uso-do-modelo">
						<p style="margin-left: 20px">Uso do modelo</p>
					</a>
				</h3>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
	<div class="prompt input_prompt">
		<div class="inner_cell">
			<div class="text_cell_render border-box-sizing rendered_html">
				<p style="margin-left: 0px;">Testamos o modelo</p>
			</div>
		</div>
	</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #a04cc1;">def</span> <span style="color: #7f6e38;">generate_text</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">decoded_joke</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">max_new_tokens</span><span>=</span><span style="color: #7e7a38;">100</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">stop_token</span><span>=</span><span style="color: #8d783e;">&#39;&lt;EJ&gt;&#39;</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">top_k</span><span>=</span><span style="color: #7e7a38;">0</span><span style="color: #e3e11d;">,</span> <span style="color: #6b97e8;">temperature</span><span>=</span><span style="color: #a09e19;">1.0</span><span style="color: #e3e11d;">):</span></p>
<p>    <span style="color: #6b97e8;">input_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;Joke&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">decoded_joke</span><span style="color: #e3e11d;">})</span></p>
<p>    <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p>    <span style="color: #6b97e8;">nex_token</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">argmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">][:,</span> <span>-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">,</span> <span style="color: #e3e11d;">:],</span> <span style="color: #6b97e8;">dim</span><span>=-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p>    <span style="color: #6b97e8;">nex_token_decoded</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">decode</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">nex_token</span><span style="color: #e3e11d;">)</span></p>
<p>    <span style="color: #6b97e8;">decoded_joke</span> <span>=</span> <span style="color: #6b97e8;">decoded_joke</span> <span>+</span> <span style="color: #6b97e8;">nex_token_decoded</span></p>
<p>    <span style="color: #a04cc1;">for</span> <span style="color: #6b97e8;">_</span> <span style="color: #7f6e38;">in</span> <span style="color: #dfd84a;">range</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">max_new_tokens</span><span style="color: #e3e11d;">):</span></p>
<p>        <span style="color: #6b97e8;">nex_token</span> <span>=</span> <span style="color: #6b97e8;">torch</span><span>.</span><span style="color: #6b97e8;">argmax</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">output</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;logits&#39;</span><span style="color: #e3e11d;">][:,</span> <span>-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">,</span> <span style="color: #e3e11d;">:],</span> <span style="color: #6b97e8;">dim</span><span>=-</span><span style="color: #7e7a38;">1</span><span style="color: #e3e11d;">)</span><span>.</span><span style="color: #6b97e8;">item</span><span style="color: #e3e11d;">()</span></p>
<p>        <span style="color: #6b97e8;">nex_token_decoded</span> <span>=</span> <span style="color: #6b97e8;">tokenizer</span><span>.</span><span style="color: #6b97e8;">decode</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">nex_token</span><span style="color: #e3e11d;">)</span></p>
<p>        <span style="color: #a04cc1;">if</span> <span style="color: #6b97e8;">nex_token_decoded</span> <span>==</span> <span style="color: #6b97e8;">stop_token</span><span style="color: #e3e11d;">:</span></p>
<p>            <span style="color: #a04cc1;">break</span></p>
<p>        <span style="color: #6b97e8;">decoded_joke</span> <span>=</span> <span style="color: #6b97e8;">decoded_joke</span> <span>+</span> <span style="color: #6b97e8;">nex_token_decoded</span></p>
<p>        <span style="color: #6b97e8;">input_tokens</span> <span>=</span> <span style="color: #6b97e8;">tokenize_function</span><span style="color: #e3e11d;">({</span><span style="color: #8d783e;">&#39;Joke&#39;</span><span style="color: #e3e11d;">:</span> <span style="color: #6b97e8;">decoded_joke</span><span style="color: #e3e11d;">})</span></p>
<p>        <span style="color: #6b97e8;">output</span> <span>=</span> <span style="color: #6b97e8;">model</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;input_ids&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">),</span> <span style="color: #6b97e8;">attention_mask</span><span>=</span><span style="color: #6b97e8;">input_tokens</span><span style="color: #e3e11d;">[</span><span style="color: #8d783e;">&#39;attention_mask&#39;</span><span style="color: #e3e11d;">]</span><span>.</span><span style="color: #6b97e8;">to</span><span style="color: #e3e11d;">(</span><span style="color: #6b97e8;">device</span><span style="color: #e3e11d;">))</span></p>
<p>    <span style="color: #a04cc1;">return</span> <span style="color: #6b97e8;">decoded_joke</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
<div class="cell border-box-sizing code_cell rendered">
	<div class="input">
		<div class="prompt input_prompt" style="margin-left: 20px;">Code:</div>
		<div class="inner_cell">
			<div class="input_area">
				<div class=" highlight hl-python3">
					<pre class="python" style="margin-left: 40px; line-height: 0%;font-family:monospace;">
<p><span style="color: #6b97e8;">generated_text</span> <span>=</span> <span style="color: #6b97e8;">generate_text</span><span style="color: #e3e11d;">(</span><span style="color: #7e7a34;">&quot;&lt;SJ&gt; Why didn&#39;t the frog cross the road&quot;</span><span style="color: #e3e11d;">)</span></p>
<p><span style="color: #6b97e8;">generated_text</span></p>
					</pre>
				</div>
			</div>
		</div>
	</div>
	<div class="output_wrapper">
		<div class="output">
			<div class="output_area">
				<div class="prompt" style="margin-left: 20px;">Output:</div>
				<div class="output_subarea output_stream output_stdout output_text">
					<pre style="margin-left: 60px; line-height: 0%;"><p>"&lt;SJ&gt; Why didn't the frog cross the road!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</p></pre>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
<!-- Close class contenido -->
</div>
<!-- Close div notebook container -->
</div>
<!-- Close div notebook -->
</div>
